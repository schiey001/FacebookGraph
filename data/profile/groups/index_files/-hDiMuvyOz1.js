/*!CK:714311458!*//*1432609827,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gk\/Rh"]); }

__d("TimelineSeenStateConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={FT_TIMELINE_HASH_IDENTIFIER_KEY:"thid"};},null);
__d("TimelineViewportTrackingLogType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={IMPRESSION:"impression",DURATION:"duration"};},null);
__d("XPhotosetSearchPivotController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d("PhotosetSearchPivotData",["AsyncRequest","PhotoStreamCache","Promise","XPhotosetSearchPivotController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=/^(perm:)?tag:(\d+)/,l={},m={fetch:function(n,o){if(!(n in l)){var p=(j.getURIBuilder()).setInt('fbid',n);if(o){var q={};o.fbidList.forEach(function(r){var s=o.getCacheContent(r,h.EXTRA);if(s)Object.keys(s.tagRects).forEach(function(t){if(k.test(t)){var u=RegExp.$2;if(u in q){q[u]++;}else q[u]=1;}});});p.setIntToIntMap('tags',q);}l[n]=new i(function(r,s){(new g()).setURI(p.getURI()).setHandler(function(t){r(t.getPayload());}).setErrorHandler(s).setAllowCrossPageTransition(true).send();});}return l[n]["catch"](function(r){delete l[n];throw r;});}};e.exports=m;},null);
__d("ComposerXDatepickerIconReset",["CSS","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){g.removeClass(j.element,"_4_na");g.removeClass(j.element,"_509o");}e.exports=i;},null);
__d("PhotosetSearchPivot.react",["LeftRight.react","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","React","XUISpinner.react","XUIText.react","cx","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=j,q=p.PropTypes,r=j.createClass({displayName:"PhotosetSearchPivotItem",propTypes:{normalized:q.string,title:q.object,uri:q.string,images:q.array},onClick:function(){h.logMorePhotosNavigation(this.props.normalized);},render:function(){return (j.createElement("div",{className:"_25r"},j.createElement("a",{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},j.createElement("div",{className:"_25u"},j.createElement("div",{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),j.createElement("div",{className:"_25x"},j.createElement("div",{className:"_25y"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),j.createElement("div",{className:"_274"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),j.createElement(l,{display:"block",className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),s=j.createClass({displayName:"PhotosetSearchPivot",propTypes:{fbid:q.string,endofalbum:q.bool,withBackground:q.bool,linesAroundHeader:q.bool,onclose:q.func},fetchPivots:function(t){i.fetch(t).then(function(u){setTimeout(this.onFetchSuccess.bind(this,t,u.pivots),0);}.bind(this),function(u){setTimeout(this.onFetchError.bind(this,t),0);}.bind(this));},onFetchSuccess:function(t,u){if(!this.isMounted()||this.props.fbid!==t)return;u=u||[];var v='show';if(u.length===0)v='hide';this.setState({pivots:u,action:v});},onFetchError:function(t){if(!this.isMounted()||this.props.fbid!==t)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(t){if(t.fbid){this.setState({action:'loading'});this.fetchPivots(t.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (j.createElement("div",{className:o(this.props.className,"_27h _2ph_")},j.createElement(k,{size:"large"})));if(this.state.action==='hide')return j.createElement("span",null);var t=this.state.pivots.map(function(x){return j.createElement(r,{normalized:x.normalized,title:x.title,uri:x.uri,images:x.images});}),u=this.props.endofalbum?j.createElement("span",{className:"_2pij"},n._("End of album")):null,v=(("_27m")+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":'')),w=j.createElement("span",null,u,j.createElement("span",{className:"_4ptz"},n._("Other photos you may like")));if(this.props.onclose){w=j.createElement(g,{className:v},w,j.createElement("a",{href:"#",onClick:this.onExitClicked,className:"_27n"}));}else w=j.createElement("div",{className:v},w);return (j.createElement("div",{className:o(this.props.className,((this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":'')))},j.createElement("div",{className:(("_27l")+(this.props.withBackground?' '+"_3-tf":''))},w,j.createElement("div",{className:"_27o _2pi8 clearfix"},t))));}});e.exports=s;},null);
__d("PhotosetPivotSlide.react",["Image.react","Link.react","PhotosetSearchPivot.react","React","XUIText.react","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j,p=o.PropTypes,q=j.createClass({displayName:"PhotosetPivotSlide",propTypes:{fbid:p.string,isAlbum:p.bool,albumOwnerName:p.string,visible:p.bool,onReturn:p.func},render:function(){return (j.createElement("div",{className:(("_1_ap")+(this.props.visible?' '+"_1_aq":''))},j.createElement("div",{className:"_1_ar"},j.createElement(k,{display:"block"},this._getEndOfAlbumTitle()),j.createElement(h,{className:"_1_as",onClick:this.props.onReturn},j.createElement(g,{className:"_1_at",src:n({name:'arrow-right',shade:'white',size:'small'})}),m._("Return to Beginning"))),j.createElement(i,{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return (m._("End of {user_name}'s album",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else return (m._("End of {user_name}'s photos",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else if(this.props.isAlbum){return (m._("End of album"));}else return (m._("End of photos"));}});e.exports=q;},null);
__d("XPhotosSnowliftProfilePicXOutAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/profilepic\/xout\/",{});},null);
__d("SnowliftProfilePhotoNUX",["AsyncRequest","CSS","Event","XPhotosSnowliftProfilePicXOutAsyncController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={registerXOut:function(l,m){i.listen(l,'click',function(n){h.hide(n);var o=(j.getURIBuilder()).getURI();new g().setURI(o).setMethod('POST').send();}.bind(this,m));}};e.exports=k;},null);
__d("PhotoSnowliftAds",["Arbiter","Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(t,u){if(u)this.adsStatus=t;var v=Date.now();this.adsEvents[t+'_'+v]=v;},init:function(t,u,v,w){this.reset();this.root=t;this.snowlift=u;this.minAds=v.min_ads;this.displayedCallback=w;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(t){this.availableDimensions=t;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(t,u,v){var w={};t.forEach(function(x){var y=x.root.firstChild.offsetHeight;x.units.forEach(function(aa){if(!j.hasClass(aa,'hidden')&&!this.getIsHoldout(aa)&&!this.getIsShadow(aa)){var ba=this.getHeight(aa.firstChild,u);y-=ba;}}.bind(this));var z={height:y,visible:false};x.units.forEach(function(aa){var ba=this.getIsAds(aa),ca=this.getHeight(aa.firstChild,u),da=this.getUnitId(aa),ea=this.getIsHoldout(aa);if(ea&&v)return;w[da]={height:ca,visible:false,priority:0,is_ads:ba,is_holdout:ea,section_ref:z};}.bind(this));}.bind(this));return w;},calculateVisibleUnits:function(t,u,v){var w=0,x=this.getUnitPriority(u);x.forEach(function(y){if(u.hasOwnProperty(y)){var z=u[y],aa=z.height;if(!z.section_ref.visible)aa+=z.section_ref.height;z.height_below=v-aa;z.visible=z.height_below>=0&&aa>0;if(z.visible){z.section_ref.visible=true;v-=aa;w++;}}}.bind(this));return u;},displayUnits:function(t,u){t.forEach(function(v){var w=false,x=true;v.units.forEach(function(y){var z=this.getUnitId(y),aa=u[z];if(!aa)return;var ba=aa.visible,ca=aa.height_below,da=aa.is_ads;j.conditionClass(y,'hidden',!ba);if(da&&ba&&x){var ea=m.find(y,'div.ego_unit');j.addClass(ea,'ego_unit_no_top_border');x=false;}w=w||ba;this.calcUnitStats(this.units[da][z],ba,ca);}.bind(this));j.conditionClass(v.root,'hidden',!w);}.bind(this));g.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(t,u){var v=0;t.forEach(function(w){w.units.forEach(function(x){var y=this.getUnitId(x),z=u[y];if(!z||!z.visible)return;v++;}.bind(this));}.bind(this));return v;},getHeightsRequired:function(t,u){var v=0,w=[];t.forEach(function(x){var y=false;x.units.forEach(function(z){var aa=this.getUnitId(z),ba=u[aa];if(!ba)return;v+=ba.height;if(!y){v+=ba.section_ref.height;y=true;}w.push(v);}.bind(this));}.bind(this));return w;},getUnitPriority:function(t){var u=[],v=0,w=0;for(var x in t){var y=t[x];u.push(x);var z=this.minAds+v+w;if(y.is_ads){if(w<this.minAds)z=w;w++;}else v++;y.priority=z;}u=u.sort(function(aa,ba){var ca=t[aa],da=t[ba];return ca.priority-da.priority;}.bind(this));return u;},updateUnitsStatus:function(){var t=this.availableDimensions.x,u=this.availableDimensions.y,v=this.calculateUnitSizes(this.sections,t);v=this.calculateVisibleUnits(this.sections,v,u);for(var w in v){if(!v.hasOwnProperty(w))continue;var x=v[w];if(!x.is_holdout||!x.visible)continue;var y=this.units[1][w];this.calcUnitStats(y,x.visible,x.height_below);}v=this.calculateUnitSizes(this.sections,t,true);v=this.calculateVisibleUnits(this.sections,v,u);this.displayUnits(this.sections,v);if(this.displayedCallback){var z=this.getUnitsDisplayed(this.sections,v),aa=this.getHeightsRequired(this.sections,v);this.displayedCallback(z,aa);}},calcUnitStats:function(t,u,v){var w=Date.now();if(t.visible)t.totalTime+=w-t.lastShowTime;if(t.trackingCode!==null&&t.totalTime>=this.UNITS_REGISTER_DELAY){var x=t.trackingCode;t.trackingCode=null;this.registerImpression(x,t.registerUrl);}t.visible=u;t.heightBelow=v;t.lastShowTime=w;},prepareResize:function(){var t=function(u){var v=m.create('div',{className:'inner'}),w=m.create('div',{className:'wrapper'},v);m.replace(u,w);m.setContent(v,u);return w;};this.sections=m.scry(this.root,'div.ego_section').map(function(u){return {root:t(u),units:m.scry(u,'div.ego_unit').map(t)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var t=this.nextRegisterTime();if(t!==Infinity)setTimeout(this.processResize.bind(this),t);},setIsLogAdData:function(t){this.isLogAdData=t;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var t=this.snowlift.getImageId();if(this.isLogAdData&&t){var u=q.getElementDimensions(this.snowlift.getImage()),v=q.getElementDimensions(this.snowlift.getRHCHeader()),w=q.getElementDimensions(this.snowlift.getRHCBody()),x=q.getElementDimensions(this.snowlift.getRHCFooter()),y={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:u.x,image_y:u.y,header_x:v.x,header_y:v.y,body_x:w.x,body_y:w.y,footer_x:x.x,footer_y:x.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(t,y);}},getAdsBelowSpace:function(){var t=[],u=this.units[1];for(var v in u)if(u.hasOwnProperty(v)&&!this.getIsHoldout(this.getAdUnit(v)))t.push(u[v].heightBelow);return t;},getIsAds:function(t){var u=m.scry(t,"div._4u8");return u.length;},getUnitId:function(t){if(this.getIsAds(t)){return this.getAdId(t);}else return this.getEgoId(t);},getEgoId:function(t){var u=m.find(t,'div.ego_unit');return u.getAttribute('data-ego-fbid');},getAdData:function(t){var u=m.find(t,"div._4u8"),v=u.getAttribute('data-ad');return v&&JSON.parse(v)||{};},getAdId:function(t){return this.getAdData(t).adid;},getIsHoldout:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).holdout;},getIsShadow:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).shadow;},getAdUnit:function(t){if(!this.sections)return null;var u=[];this.sections.forEach(function(w){r(u,w.units);});for(var v=0;v<u.length;v++)if(this.getIsAds(u[v])&&this.getAdId(u[v])==t)return u[v];return null;},nextRegisterTime:function(){var t=Infinity,u=i(i({},this.units[0]),this.units[1]);for(var v in u)if(u.hasOwnProperty(v)){var w=u[v];if(w.trackingCode!==null&&w.visible)t=Math.min(t,this.UNITS_REGISTER_DELAY-w.totalTime);}return t;},getHeight:function(t,u){var v=l.get(t,'height');if(v&&v.x===u)return v.y;return this.cacheHeight(t,u);},cacheHeight:function(t,u){var v={x:u,y:t.offsetHeight};l.set(t,'height',v);return v.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var t=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,t,false,this.snowlift.getOpaqueCursor(t)]},{crossPage:true,bundle:false});},getCursorFBID:function(t){if(t.v!==(void 0))return t.v;if(t.fbid!==(void 0))return t.fbid;return '0';},unitsLoaded:function(t,u){var v;if(u){v='/ai.php';this.addEvent('adsLoaded',true);}else{v='/ajax/ei.php';this.addEvent('egoLoaded',true);}var w={};for(var x in t)if(t.hasOwnProperty(x))w[x]={trackingCode:t[x],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:v};this.units[u]=w;if(u)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var t=Date.now()-this.lastLoadTime;if(!this.isLoading&&t>s.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(t,u){var v=m.create('iframe',{src:new p(u).addQueryData({aed:t}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});v.setAttribute('aria-hidden','true');m.appendContent(this.root,v);},waitForImages:function(t){var u=m.scry(this.root,'img.img'),v=u.length,w=v;if(w===0)t();var x=function(){w--;if(w===0)setTimeout(t,0);};for(var y=0;y<v;y++){var z=u[y];if(z.complete){x();}else h.listen(z,{load:x,error:x,abort:x});}}};e.exports=s;},null);
__d("SnowliftVideoPivotsCarouselController",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={setPivotsCarousel:function(h,i){this._pivotsCarousel=h;this.adjustCarousel(i);},adjustCarousel:function(h){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(h);},adjustCarouselOnAutoPlay:function(){if(this._pivotsCarousel)this._pivotsCarousel.page();}};e.exports=g;},null);
__d("XPhotosSnowliftProfilePicAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/profilepic\/",{uri:{type:"String",required:true}});},null);
__d("PhotoSnowlift",["Arbiter","AsyncRequest","Bootloader","CSS","DataStore","Dialog","DisplaySnowliftProfilePhotoNux","DOM","DOMQuery","DOMControl","Event","fbt","FullScreen","GraphicPhotoWarning","GraphicPhotoWarningMixin","ImageUtils","Input","Keys","Layer","LayerHideOnEscape","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","tickerPhoteSnowLiftOpenStatus","Locale","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotosetPivotSlide.react","PhotosetSearchPivot.react","PhotosetSearchPivotData","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoTagSearchPivotLogger","PhotoViewer","React","Rect","ScriptPath","ScrollableArea","SnowliftVideoPivotsCarouselController","XPhotosSnowliftProfilePicAsyncController","Style","Toggler","Tooltip","UFIFeedbackTargets","UIPagelet","URI","UserAgent_DEPRECATED","Vector","VideoPermalinkURI","VideoPlayerReason","$","arrayContains","classWithMixins","computeRelativeURI","copyProperties","createArrayFromMixed","csx","cx","emptyFunction","ge","getActiveElement","goURI","invariant","mixin","setTimeoutAcrossTransitions","GraphicPhotoWarningConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb){b.__markCompiled&&b.__markCompiled();var yb=b('GraphicPhotoWarningConfig').Events,zb=74,ac=75,bc=70,cc=76,dc=315,ec=new RegExp('\\/posts\\/(\\d+)\\/?$'),fc=lb(sa,wb(u));for(var gc in fc)if(fc.hasOwnProperty(gc))ic[gc]=fc[gc];var hc=fc===null?null:fc.prototype;ic.prototype=Object.create(hc);ic.prototype.constructor=ic;ic.__superConstructor__=fc;function ic(){"use strict";fc.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}ic.prototype.preload=function(jc,kc){"use strict";i.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(mc){this.PhotoTagger=mc;}.bind(this));this.checkProfilePhotoNUX(jc);var lc=this.getImageSrc(new eb(jc).getQueryData());if(lc)if(!this._log(lc))(new Image()).src=lc;};ic.prototype.checkProfilePhotoNUX=function(jc){"use strict";if(!m.display)return;var kc=o.scry(this.root,'#profile_photo_snowlift_nux');if(kc.length>0)j.hide(kc[0]);var lc=(ya.getURIBuilder()).setString('uri',jc).getURI();new h().setURI(lc).setHandler(function(mc){if(mc&&mc.payload){var nc=o.scry(this.root,'#profile_photo_snowlift_nux');if(nc.length>0)j.show(nc[0]);}}.bind(this)).send();};ic.prototype.bootstrap=function(jc,kc){"use strict";this.preload(jc,kc);this._href=jc;this._elem=kc;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,jc,kc),0);return;}oa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var lc=ga.byAttribute(kc,'data-cursor');if(lc){try{var nc=JSON.parse(lc.getAttribute('data-ft'));this._dataFt={qid:nc.qid,mf_story_key:nc.mf_story_key};}catch(mc){}}else try{lc=ga.byAttribute(kc,'data-ad');var oc=JSON.parse(lc.getAttribute('data-ad'));this._dataFt={ad_id:oc.adid};}catch(mc){}va.openOverlayView('snowlift');this.returningToStart=false;this.loading&&j.removeClass(this.loading,'loading');if(kc){j.addClass((this.loading=kc),'loading');var pc=ga.byClass(kc,'uiStreamStory')||ga.byClass(kc,"_5jmm");if(pc){this.storyID=pc.id;}else{var qc=ga.byClass(kc,"_5b9c");if(qc)this.storyID=qc.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(kc);}else this.loading=null;g.inform('PhotoSnowlift.GO',jc,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();this._setupNextItemUI();};ic.prototype._updateContainerOwnerID=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};ic.prototype.setupFromSnowflake=function(jc,kc){"use strict";this.extraClasses=jc;this.snowflake=true;this.firstInSet=kc;if(this.root){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(lc){j.addClass(this.root,lc);},this);}};ic.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var jc=this.stream.getCurrentImageData();return jc.originalDimensions||jc.dimensions;};ic.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};ic.prototype.getRoot=function(){"use strict";return this.root;};ic.prototype.getSourceString=function(){"use strict";return 'snowlift';};ic.prototype.getViewerSource=function(){"use strict";return this.source;};ic.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};ic.prototype.getVersionConst=function(){"use strict";return ja.VIEWER_SNOWLIFT;};ic.prototype.getImage=function(){"use strict";return this.image;};ic.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};ic.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};ic.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};ic.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};ic.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};ic.prototype.getCurrentPhotoInfo=function(){"use strict";var jc=this.stream.getCurrentImageData();if(jc)return jc.info;return null;};ic.prototype.getOwnerId=function(){"use strict";var jc=this.stream.getCurrentImageData();if(jc)return jc.info.owner;return null;};ic.prototype.getThumbAndSize=function(jc){"use strict";this.currentImageSize=null;this.thumbSrc=null;var kc=new eb(jc.getAttribute('ajaxify')).getQueryData();if(!kc.size)return;var lc=gb.deserialize(kc.size);if(!lc.x||!lc.y)return;this.currentImageSize=lc;if(jc.getAttribute('data-cropped'))return;var mc=n.scry(jc,'img')[0],nc=n.scry(jc,'i')[0],oc=ga.byAttribute(jc,'data-size');this.shouldStretch=oc&&this.currentImageSize&&mc&&oc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=ic.TIMELINE_STRETCH_WIDTH&&mc.offsetWidth===ic.TIMELINE_STRETCH_WIDTH;var pc;if(mc){pc=mc.src;}else if(nc){pc=za.get(nc,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=pc;};ic.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new h('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};ic.prototype.init=function(jc,kc){"use strict";this.init=rb;this._shouldLog=kc.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ha(ja.VIEWER_SNOWLIFT_STRING);this._showHover=kc.pivot_hover;this._showMorePhotos=kc.show_more_photos;this._extraSlidePivot=kc.extra_slide_pivot;ka.setEndMetrics(kc.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=s.isSupportedWithKeyboardInput();this.showOGVideos=kc.og_videos;this.resizeCommentsForAds=kc.resize_comments_for_ads;this._canSeeGraphicWarning=!!kc.can_see_graphic_warning;this.initGraphicWarningDOM(kc.graphic_warning_markup);this.spotlight=jc;this.spotlight.subscribe('blur',function(){this.closingAction=ka.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());oa.init(this.sideAdUnit,this,kc,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){ba.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(lc,mc){this.openExplicitly=true;this.loading&&j.removeClass(this.loading,'loading');this.open(mc);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;fa.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)s.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=kc.snowlift_slideshow;this.buttonTruncateGk=kc.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&kc.www_panorama_viewer;this.allowIrrelevantRequests=!!kc.snowlift_allow_irrelevant_requests;if(this.snowflake){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(lc){j.addClass(this.root,lc);},this);}this._setupNextItemUI();};ic.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var jc=s.isFullScreen();j.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',jc);if(jc){if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var kc=this.stream.getCurrentImageData();if(kc&&kc.url&&this.image.src!==kc.url&&this.shouldShowHiRes(kc))this.switchImage(kc.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(fb.chrome()&&!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}ab.hide();};ic.prototype.initializeNodes=function(jc){"use strict";this.root=jc;this.container=n.find(jc,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=n.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=n.find(this.snowliftPopup,'div.rhc');this.rhcHeader=n.find(this.rhc,'div.rhcHeader');this.rhcFooter=n.find(this.rhc,'div.rhcFooter');this.taglist=n.find(this.rhc,'span.fbPhotoTagList');this.ufiForm=n.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=n.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=n.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=n.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=n.find(this.snowliftPopup,'div.stageWrapper');this.overlay=n.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=n.find(this.stageWrapper,'div.stageError');this.image=n.find(this.stageWrapper,'img.spotlight');this.stage=n.find(this.stageWrapper,'div.stage');this.showZoomInButton=n.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=n.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=n.scry(this.stage,"._10zw").pop();this.outerImageSlider=n.scry(this.stage,"._10zx").pop();this.innerImageSlider=n.scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);}this.videoStage=n.find(this.stageWrapper,'div.videoStage');this.prevPager=n.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=n.find(this.snowliftPopup,'a.snowliftPager.next');this.upPager=n.find(this.container,'a.snowliftPager.up');this.downPager=n.find(this.container,'a.snowliftPager.down');this.stageActions=n.find(jc,'div.stageActions');this.buttonActions=n.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=n.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=n.find(jc,"._5ciw");j.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};ic.prototype.getGraphicWarningContainer=function(){"use strict";return this.stageWrapper;};ic.prototype.getGraphicWarningHiddenContent=function(){"use strict";return this.stage;};ic.prototype.initializeScroller=function(){"use strict";this.initializeScroller=rb;j.addClass(this.scroller,"_467y");this.scrollableArea=wa.fromNative(this.scroller,{fade:true,persistent:true});var jc=function(event){var kc=q.$E(event).getTarget();if(n.contains(this.ufiInputContainer,kc)){var lc=p.getInstance(kc);if(lc){this.scrollableArea.scrollToBottom();var mc=lc.subscribe('resize',function(){var oc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();oc&&this.scrollableArea.scrollToBottom();}.bind(this)),nc=q.listen(kc,'blur',function(){lc.unsubscribe(mc);nc.remove();});}}if(kc.classList.contains('UFIPagerLink')||kc.classList.contains('UFICommentLink'))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true;}.bind(this);g.subscribe('ufi/inputHeightChanged',function(kc,lc){if(n.contains(this.ufiInputContainer,lc.node))this.adjustScroller();}.bind(this));g.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));g.subscribe('ufi/changed',function(kc,lc){if(this.ufiForm===lc.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(kc,lc){if(this.ufiForm===lc.form){this.adjustScrollerIfNecessary();if(lc.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));q.listen(this.rhc,'click',function(event){var kc=event.getTarget();if(ga.byTag(kc,'a')||ga.byTag(kc,'button')||n.isNodeOfType(kc,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/translationRendered',function(){this.adjustScrollerIfNecessary();}.bind(this));q.listen(this.ufiForm,'focusin',jc);};ic.prototype.openHandler=function(jc){"use strict";if(this.isOpen||!ia.isValid(jc)||this.returningToStart||jc.getQueryData().closeTheater||jc.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(jc);this._uriStack.push(new eb(jc).getQualifiedURI().toString());fa.transitionComplete(true);return true;};ic.prototype.addHaltAutoplaySubscription=function(){"use strict";g.subscribe(['ufi/focus'],function(){this.haltAutoplay=true;}.bind(this));g.subscribe(['ufi/blur'],function(jc,kc){this.haltAutoplay=kc.hasEnteredText;}.bind(this));};ic.prototype.getImageSrc=function(jc){"use strict";if(jc.smallsrc){if(!jc.size)return jc.smallsrc;var kc=gb.deserialize(jc.size),lc=this.getStageSize(kc);lc=this._adjustStageSizeForPixelRatio(lc);if(lc.x<=ic.STAGE_NORMAL_MAX.x&&lc.y<=ic.STAGE_NORMAL_MAX.y)return jc.smallsrc;}return jc.src;};ic.prototype.open=function(jc){"use strict";var kc=new eb(jc),lc=kc.getQueryData(),mc=ia.parse(kc);if(mc!==null){lc.fbid=mc.photo_id;lc.set=mc.set_token;}var nc=hb.parse(kc);if(nc!==null){lc.v=nc.video_id;lc.set=nc.set_token;}if(!lc.fbid&&!lc.v&&!lc.pid){var oc=ec.exec(kc.getPath());if(oc)lc.v=oc[1];}var pc=this.getImageSrc(lc);if(pc){delete lc.src;delete lc.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){lc.firstLoad=true;this.initialLoad=true;ca.registerBlocker(function(){return this.isOpen;}.bind(this));da.registerOpenChecker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=nb(lc,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;j.show(this.nextPager);j.show(this.prevPager);this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new pa();this.stream.init(ja.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,lc.tagSuggestionMode||'everyone');if(!!eb.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(eb.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(ic.STATE_HTML,true);this.rhcCollapsed=false;this._open(jc,pc);i.loadModules(["PhotosButtonTooltips"],function(qc){qc.init();});};ic.prototype._open=function(jc,kc){"use strict";this.createLoader(kc);this.spotlight.show();g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[q.listen(window,'resize',this.adjustForResize.bind(this)),q.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),q.listen(this.stageWrapper,'mouseleave',function(event){var nc=event.getTarget();if(!(ga.byClass(nc,'snowliftOverlay')||ga.byClass(nc,'fbPhotoSnowliftTagApproval')||ga.byClass(nc,'tagPointer')||ga.byClass(nc,'arrow')||ga.byClass(nc,'faceboxSuggestion')||ga.byClass(nc,'typeaheadWrapper')||ga.byClass(nc,'photoTagTypeahead')||ga.byClass(nc,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),q.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),q.listen(this.root,'mousemove',this.hiliteProductItemPager.bind(this)),q.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),q.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),q.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),q.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),q.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),q.listen(this.root,'focusin',this.hiliteProductItemPager.bind(this)),q.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(q.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(q.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(q.listen(this.container,'click',function(event){var nc=event.getTarget();if(ga.byClass(nc,'rotateRight')){this.rotate('right');}else if(ga.byClass(nc,'rotateLeft')){this.rotate('left');}else if(ga.byClass(nc,'closeTheater')){if(s.isFullScreen()){s.toggleFullScreen();return;}this.closingAction=ka.X;this.spotlight.hide();return false;}else if(ga.byClass(nc,"_32_l")){var oc=ga.byClass(nc,"_32_l"),pc=oc.getAttribute('data-fbid'),qc=this.stream.getCursor(),rc=this.stream.calculateDistance(qc,pc),sc=this.stream.fbidList.indexOf(pc);xa.adjustCarousel(sc);this.page(rc,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen();}else if(this.fullscreen)if(ga.byClass(nc,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ga.byClass(nc,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var lc=sb('fbPhotoSnowliftFeedback');if(lc)this.stageHandlers.push(q.listen(lc,'click',function(event){var nc=event.getTarget();if(ga.byClass(nc,'like_link')||(ga.byClass(nc,'UFILikeLink')&&ga.byClass(nc,'UIActionLinks')))this.toggleLikeButton();var oc=ga.byClass(event.getTarget(),'uiUfiCollapsedComment');if(oc)j.addClass(oc,'uiUfiCollapsedCommentToggle');}.bind(this)));var mc=sb('fbPhotoSnowliftOnProfile');if(mc)this.stageHandlers.push(q.listen(mc,'click',function(event){if(ga.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=eb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!kc)this.setLoadingState(ic.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){fa.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ka.initLogging(ka.SNOWLIFT);if(this.pivots)ka.setRelevantCount(this.pivots.relevantCount);};ic.prototype.toggleFullScreen=function(){"use strict";var jc=s.toggleFullScreen(document.documentElement);if(jc){var kc=this.stream.getCurrentImageData();if(kc&&kc.url&&this.image.src!==kc.url&&this.shouldShowHiRes(kc))if(!this._log(kc.url))(new Image()).src=kc.url;ka.logEnterFullScreen(this.stream.getCursor());}};ic.prototype.getStream=function(){"use strict";return this.stream;};ic.prototype.fetchInitialData=function(){"use strict";this.stream.waitForInitData();db.loadFromEndpoint('PhotoViewerInitPagelet',sb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:cb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};ic.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};ic.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;j.addClass(this.root,'collapseRHC');this.adjustForResize();};ic.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;j.removeClass(this.root,'collapseRHC');this.adjustForResize();};ic.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||ka.ESC;if(eb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};ic.prototype.returnToStartingURI=function(jc,kc){"use strict";if(!jc)if(kc){this.squashNextTransition(ub.bind(null,kc));}else this.squashNextTransition();this.returningToStart=true;var lc=g.subscribe('page_transition',(function(){this.returningToStart=false;lc.unsubscribe();}).bind(this)),mc=jc||isNaN(fb.opera()),nc=this._uriStack.length;if(mc&&nc<window.history.length){window.history.go(-nc);}else{var oc=this.startingURI,pc=new eb(oc).removeQueryData('closeTheater');if(oc.getQueryData().sk=='approve'&&oc.getPath()=='/profile.php'){pc.removeQueryData('highlight');pc.removeQueryData('notif_t');}ub(pc);}};ic.prototype.squashNextTransition=function(jc){"use strict";this.squashNext=true;fa.registerHandler(function kc(){if(this.squashNext){this.squashNext=false;if(jc)setTimeout(jc,0);fa.transitionComplete(true);return true;}return false;}.bind(this),7);};ic.prototype.handleNavigateAway=function(jc){"use strict";var kc=mb(fa._most_recent_uri.getQualifiedURI(),jc.getAttribute('href'));if(this.isOpen&&(kc instanceof eb)&&kc.getUnqualifiedURI().toString()!=this.startingURI.toString()&&kc.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ka.NAVIGATE;this.returnToStartingURI(false,kc);this.close();return false;}return true;};ic.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var jc=null;if(this.source===ic.COLLECTIONS_UNTAGGED_PHOTOS){jc='/ajax/photos/photo/edit/skiptag/';}else if(this.source===ic.PHOTOS_OF_YOU_SUGGESTIONS||this.source===ic.FRIENDS_IN_PHOTOS_SUGGESTIONS)jc='/ajax/photos/photo/add_to_star_grid/';if(jc)new h().setURI(jc).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};ic.prototype.onTagSaved=function(jc,kc){"use strict";if(this.taggedPhotoIds){if(this.source===ic.PHOTOS_OF_YOU_SUGGESTIONS&&!kc.self_tag)return;this.taggedPhotoIds.push(kc.photo_fbid);}};ic.prototype.clearAlbumBoundaries=function(){"use strict";this._albumBoundaries={start:0,end:0,dir:0};};ic.prototype.close=function(){"use strict";if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)s.disableFullScreen();va.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;xb(this.closeCleanup.bind(this),0);if(this.snowflake){j.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(jc){j.removeClass(this.root,jc);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};ic.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;j.removeClass(this.root,'dataLoading');ka.logPhotoViews(this.closingAction);this.destroy();j.hide(this.errorBox);j.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var jc=this.stream.getCursor();j.removeClass(this.stageWrapper,'showVideo');n.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();n.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var kc=this.closingAction===ka.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){fa.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',{is_navigating:kc,fbid:jc});this._setZoomOut();this._previousZoomScrollPercent=null;};ic.prototype.createLoader=function(jc){"use strict";if(this.currentImageSize===null){this.adjustStageSize(ic.STAGE_MIN);}else{var kc=this.getStageSize(this.currentImageSize);kc=new gb(Math.max(kc.x,ic.STAGE_MIN.x),Math.max(kc.y,ic.STAGE_MIN.y));var lc=this.getImageSizeInStage(this.currentImageSize,kc);if(this.thumbSrc===null){this.adjustStageSize(lc);}else this.useImage(n.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:lc.x+'px',height:lc.y+'px'}}),lc,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(jc)setTimeout((function(){var mc=new Image(),nc=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(jc,this.currentImageSize);this.setLoadingState(ic.STATE_IMAGE_DATA,false);}}.bind(this),oc=q.listen(mc,'load',nc),pc=function(){if(oc){oc.remove();oc=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',pc);g.subscribeOnce('PhotoSnowlift.CLOSE',pc);this._log(jc);mc.src=jc;}).bind(this),0);j.hide(this.stageActions);this.setStagePagersState('disabled');};ic.prototype.initDataFetched=function(jc){"use strict";ka.setPhotoSet(this.stream.getPhotoSet());ka.setLogFbids(jc.logids);this._albumBoundaries.start=this.stream.getCursor();var kc=this.stream.getCurrentImageData();ka.addPhotoView(kc.info,this.shouldShowHiRes(kc),this.fullscreen&&s.isFullScreen());var lc=this.stream.getCurrentExtraData();if(this._showHover&&lc)ra.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(lc.tagRects));if(lc&&lc.source!==(void 0)){this.source=parseInt(lc.source,10);ka.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[q.listen(this.root,'click',this.pageListener.bind(this)),q.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];j.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=jc.loggedin;this.disableAds=!this.isLoggedInViewer||jc.fromad||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(kc)){ka.addPanoramaImpression();var mc=new gb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(mc);}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);};ic.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};ic.prototype.adjustScroller=function(jc){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var kc=gb.getElementDimensions(this.rhc),lc=kc.y;lc-=gb.getElementDimensions(this.rhcHeader).y;lc-=gb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var mc=gb.getElementDimensions(this.placeInfo);lc-=mc.y;za.set(this.sideAdUnit,'bottom',mc.y+'px');}if(jc==null)jc=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=jc;lc=Math.max(0,lc);var nc=gb.getElementDimensions(this.scrollerBody).y,oc=Math.max(ic.MIN_UFI_HEIGHT,lc-jc);if(nc>=oc){if(lc>oc){j.removeClass(this.rhc,'pinnedUfi');lc-=oc;}else{j.addClass(this.rhc,'pinnedUfi');lc=0;}za.set(this.scroller,'height',oc+'px');}else{za.set(this.scroller,'height','auto');j.removeClass(this.rhc,'pinnedUfi');lc-=nc;}var pc=gb.getElementDimensions(this.ufiInputContainer).y;za.set(this.ufiForm,'padding-bottom',pc+'px');oa.resize(new gb(kc.x,lc));this.scrollableArea.adjustGripper();};ic.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};ic.prototype.shouldShowHiRes=function(jc){"use strict";if(!jc||!jc.smallurl)return false;var kc=this.getStageSize(jc.dimensions);kc=this._adjustStageSizeForPixelRatio(kc);var lc=this.getImageSizeInStage(jc.dimensions,kc);return (lc.x>ic.STAGE_NORMAL_MAX.x||lc.y>ic.STAGE_NORMAL_MAX.y);};ic.prototype._adjustStageSizeForPixelRatio=function(jc){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)jc=new gb(jc.x*window.devicePixelRatio,jc.y*window.devicePixelRatio);return jc;};ic.prototype.getImageURL=function(jc){"use strict";if(jc.video){return null;}else if(jc.smallurl&&!this.shouldShowHiRes(jc))return jc.smallurl;return jc.url;};ic.prototype.getImageOrVideoDimensions=function(jc){"use strict";if(jc.video){var kc=this.getVideoElement(jc.video);if(kc)return this.getVideoSize(kc);}return this.getImageDimensions(jc);};ic.prototype.getImageDimensions=function(jc){"use strict";if(this._isZoomOn)return jc.originalDimensions;if(jc.smalldims&&(!this.shouldShowHiRes(jc)||this.image.src===jc.smallurl))return jc.smalldims;return jc.dimensions;};ic.prototype.getStageSize=function(jc,kc){"use strict";var lc=gb.getViewportDimensions(),mc=new gb(jc.x,jc.y+this.getExtraVerticalSpace());if(kc)mc=new gb(Math.max(jc.x,kc.x),Math.max(jc.y,kc.y));var nc,oc;if(this.fullscreen&&s.isFullScreen()){oc=screen.height-ic.FULL_SCREEN_PADDING*2;return new gb(this.rhcCollapsed?screen.width:screen.width-ic.SIDEBAR_SIZE_MAX,this._isItemPagerEnabled()?oc-ic.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:oc);}else{nc=Math.min(mc.x,(lc.x-ic.SIDEBAR_SIZE_MAX-ic.STAGE_CHROME.x));var pc=lc.y-ic.STAGE_CHROME.y;oc=Math.min(mc.y,this._isItemPagerEnabled()?pc-ic.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:pc);}if(nc===0&&oc===0)return new gb(0,0);var qc=nc/oc,rc=mc.x/mc.y;if(qc<rc)return new gb(nc,Math.round(nc/rc));return new gb(Math.round(oc*rc),oc);};ic.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return ic.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};ic.prototype.getComponentsHeight=function(){"use strict";var jc=this.getVideoOnStage();if(jc)return this.getVideoComponentsHeight(sb(jc));return 0;};ic.prototype.getImageSizeInStage=function(jc,kc){"use strict";var lc=jc.x,mc=jc.y,nc=this.getComponentsHeight(),oc=this.getExtraVerticalSpace();mc-=nc;kc=new gb(kc.x,kc.y-nc-oc);if(lc>=kc.x||mc>=kc.y){var pc=kc.x/kc.y,qc=lc/mc;if(pc<qc){lc=kc.x;mc=Math.round(lc/qc);}else if(pc>qc){mc=kc.y;lc=Math.round(mc*qc);}else{lc=kc.x;mc=kc.y;}}return new gb(lc,mc+nc);};ic.prototype.getStageSizeForZoomedImage=function(jc,kc){"use strict";if(this.fullscreen&&s.isFullScreen()){var lc=this.rhcCollapsed?screen.width:screen.width-ic.SIDEBAR_SIZE_MAX,mc=screen.height-ic.FULL_SCREEN_PADDING*2;return new gb(lc,mc);}var nc=gb.getViewportDimensions();if(kc===null)kc=new gb(0,0);var oc=new gb(Math.max(jc.x,ic.STAGE_MIN.x,kc.x),Math.max(jc.y,ic.STAGE_MIN.y,kc.y)),pc=nc.x-ic.STAGE_CHROME.x;if(!this.rhcCollapsed)pc-=ic.SIDEBAR_SIZE_MAX;lc=Math.min(oc.x,pc);mc=Math.min(oc.y,nc.y-ic.STAGE_CHROME.y);return new gb(lc,mc);};ic.prototype.adjustStageSize=function(jc){"use strict";var kc=this.currentImageSize;if(jc){kc=jc;}else{var lc=this.stream&&this.stream.getCurrentImageData();if(lc)kc=this.getImageOrVideoDimensions(lc);}if(!kc)return;this.currentImageSize=kc;var mc=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&kc.x>kc.y&&kc.x<=ic.TIMELINE_STRETCH_WIDTH&&kc.x>=ic.TIMELINE_STRETCH_MIN){kc.y=Math.round(kc.y*ic.TIMELINE_STRETCH_WIDTH/kc.x);kc.x=ic.TIMELINE_STRETCH_WIDTH;}var nc;if(this._isZoomOn){nc=this.getStageSizeForZoomedImage(kc,this.currentMinSize);}else nc=this.getStageSize(kc,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new gb(0,0);this.currentMinSize=new gb(Math.max(nc.x,ic.STAGE_MIN.x,this.currentMinSize.x),Math.max(nc.y,ic.STAGE_MIN.y,this.currentMinSize.y));var oc=this.getImageSizeInStage(kc,this.currentMinSize),pc=this.currentMinSize.x-oc.x,qc=this.currentMinSize.y-oc.y;if(pc>0&&pc<ic.PADDING_MIN){this.currentMinSize.x-=pc;}else if(qc>0&&qc<ic.PADDING_MIN)this.currentMinSize.y-=qc;var rc=this.currentMinSize.x+ic.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)rc=this.currentMinSize.x;var sc=this.getVideoOnStage()&&this.pivotsCarouselElement,tc=0,uc=this.currentMinSize.y;if(sc){var vc=this.pivotsCarouselElement.clientHeight;tc=Math.ceil(vc/100)*100;uc=uc+tc;}this.snowliftPopup.style.cssText='width:'+rc+'px;'+'height:'+uc+'px;';var wc=this.currentMinSize.y-mc,xc=wc+tc;if(fb.firefox()){var yc=za.get(this.stageWrapper,'font-size');wc=(wc/parseFloat(yc))+'em';xc=(xc/parseFloat(yc))+'em';}else{wc=wc+'px';xc=xc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+wc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+xc+';';if(this._isZoomOn){var zc=this.currentMinSize.y-mc;if(kc.y>zc){var ad=(kc.x/kc.y)*zc;za.apply(this.zoomedImage,{width:ad+"px",height:zc+"px"});}else za.apply(this.zoomedImage,{width:kc.x+"px",height:kc.y+"px"});}else{oc.y-=this.getComponentsHeight();this.setMediaElementSize(oc);}if(sc)this.setPivotCarouselElementWidth(yc);var bd=this.getTagger();if(bd)bd.repositionTagger();this.adjustScrollerIfNecessary();};ic.prototype.setMediaElementSize=function(jc){"use strict";var kc=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(jc.x,jc.y);}else kc=n.scry(this.videoStage,"._53j5")[0]||kc;kc.style.cssText='width:'+jc.x+'px;'+'height:'+jc.y+'px;';};ic.prototype.setPivotCarouselElementWidth=function(jc){"use strict";var kc=this.videoStage.clientWidth;if(fb.firefox()){kc=(kc/parseFloat(jc))+'em';}else kc=kc+'px';this.pivotsCarouselElement.style.width=kc;};ic.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var jc=n.scry(this.stage,'div.tagsWrapper')[0],kc=gb.getElementDimensions(this.image);if(jc){za.set(jc,'width',kc.x+'px');za.set(jc,'height',kc.y+'px');}};ic.prototype.adsDisplayedCallback=function(jc,kc){"use strict";var lc=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&jc<ic.MIN_ADS_VISIBLE&&kc.length>=ic.MIN_ADS_VISIBLE;if(lc){this.inAdsDisplayedCallback=true;var mc=kc[ic.MIN_ADS_VISIBLE-1];this.adjustScroller(mc);this.inAdsDisplayedCallback=false;}};ic.prototype.setLoadingState=function(jc,kc){"use strict";switch(jc){case ic.STATE_IMAGE_PIXELS:j.conditionClass(this.root,'imagePixelsLoading',kc);break;case ic.STATE_IMAGE_DATA:this.loadingStates[jc]=kc;j.conditionClass(this.root,'imageLoading',kc);break;case ic.STATE_HTML:this.loadingStates[jc]=kc;j.conditionClass(this.root,'dataLoading',kc);this.rhc.setAttribute('aria-busy',kc?'true':'false');break;}};ic.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(jc){jc.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(jc){jc.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};ic.prototype.checkState=function(jc){"use strict";if(jc!=ic.STATE_ERROR&&!this.loadingStates[jc])return;switch(jc){case ic.STATE_IMAGE_DATA:var kc=this.stream.getCurrentImageData();if(kc){var lc=this.getImageURL(kc);if(lc){this.switchImage(lc,null,true);}else if(kc.video)this.switchVideo(kc.video,true);this.setLoadingState(jc,false);}break;case ic.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(jc,false);}break;default:if(this.stream.errorInCurrent()){j.hide(this.image);j.show(this.errorBox);}break;}};ic.prototype.buttonListener=function(event){"use strict";var jc=event.getTarget(),kc=Date.now();if(ga.byClass(jc,"_5qmg")){ka.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ga.byClass(jc,"_5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ga.byClass(jc,'fbPhotoTagApprovalBox'))return;if(kc-this.lastPage<350)return;if(ga.byClass(jc,'fbPhotosPhotoLike')){this.likePhoto();}else if(ga.byClass(jc,'tagApproveIgnore')){this.updateTagBox(event,jc);}else if(ga.byClass(jc,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ga.byClass(jc,"_5ymu")){if(!this._showingMorePhotos){ra.logShowMorePhotos();var lc=this.stream.getCursor();if(lc)this.showMorePhotos(String(lc));if(this._hasZoomCapability)j.hide(this.showZoomInButton);}else{ra.logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(ga.byClass(jc,"_27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};ic.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};ic.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,fb.chrome()&&s.isFullScreen()),ic.SLIDESHOW_TIME);j.addClass(this.root,'slideshowStarted');j.removeClass(this.root,'slideshowAvailable');};ic.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;j.addClass(this.root,'slideshowAvailable');j.removeClass(this.root,'slideshowStarted');};ic.prototype.likePhoto=function(){"use strict";ka.addButtonLike();var jc=jb('fbPhotoSnowliftFeedback'),kc=n.scry(jc,'button.like_link')[0];if(!kc)kc=n.scry(jc,'a.UFILikeLink')[0];var lc=kc.getAttribute('href');if(s.isFullScreen())if(fb.chrome())kc.setAttribute('href','javascript:;');kc.click();kc.setAttribute('href',lc);};ic.prototype.toggleLikeButton=function(){"use strict";var jc=n.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(jc){var kc=n.find(this.root,'.likeCount'),lc=n.find(kc,'.likeCountNum');if(kc)if(j.hasClass(jc,'viewerLikesThis')){n.setContent(lc,parseInt(lc.textContent,10)-1);}else n.setContent(lc,parseInt(lc.textContent,10)+1);j.toggleClass(jc,'viewerLikesThis');j.removeClass(jc,'viewerAlreadyLikedThis');}};ic.prototype.likePhotoWithKey=function(){"use strict";return aa.like(this.likePhoto.bind(this),tb());};ic.prototype.updateTagBox=function(jc,kc){"use strict";this.unhiliteAllTags();var lc=sb(jc);if(!lc)return;j.addClass(lc,'tagBox');j.addClass(lc,'tagBoxPendingResponse');j.removeClass(lc,'tagBoxPending');j.hide(n.find(lc,'span.tagForm'));if(kc){j.show(n.find(lc,'span.tagApproved'));}else j.show(n.find(lc,'span.tagIgnored'));};ic.prototype.rotate=function(jc){"use strict";var kc=this.stream.getCursor();if(this.getVideoOnStage()){var lc=(jc=='left')?270:90;vb(!!this.videoRotateURI);i.loadModules(["VideoRotate"],function(nc){new nc(kc,this.videoRotateURI).motionRotate(lc);}.bind(this));return;}var mc=nb({fbid:kc,opaquecursor:this.stream.getOpaqueCursor(kc),cs_ver:ja.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());mc[jc]=1;this.setLoadingState(ic.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);j.hide(this.image);new h('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(mc).setErrorHandler(this.rotationError.bind(this,kc)).setFinallyHandler(this.rotationComplete.bind(this,kc)).setMethod('POST').setReadOnly(false).send();};ic.prototype.rotationComplete=function(jc,kc){"use strict";if(jc==this.stream.getCursor()){this.setLoadingState(ic.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};ic.prototype.rotationError=function(jc,kc){"use strict";if(jc==this.stream.getCursor()){this.setLoadingState(ic.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));i.loadModules(["AsyncResponse"],function(lc){lc.defaultErrorHandler(kc);});}};ic.prototype.saveTagsFromPayload=function(jc){"use strict";this.storeFromData(jc);if('data' in jc&&this.stream.getCursor() in jc.data)this.swapData();};ic.prototype.saveEdit=function(){"use strict";if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;i.loadModules(["PhotoInlineEditor","Form"],function(jc,kc){var lc=jc.getInstance(this.getViewerConst());lc&&kc.bootstrap(lc.getForm().controller);}.bind(this));};ic.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};ic.prototype.hiliteProductItemPager=function(event){"use strict";var jc=gb.getEventPosition(event),kc=gb.getElementDimensions(this.root),lc=kc.y-jc.y;if(lc>ic.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE&&jc.y>ic.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE){j.conditionClass(this.upPager,'hilightPager',false);j.conditionClass(this.downPager,'hilightPager',false);return;}var mc=lc<ic.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE;j.conditionClass(this.upPager,'hilightPager',!mc);j.conditionClass(this.downPager,'hilightPager',mc);};ic.prototype.hilitePager=function(event){"use strict";var jc=gb.getEventPosition(event),kc=gb.getElementPosition(this.stage),lc=gb.getElementDimensions(this.stage);if(ea.isRTL()){this.stagePagerPrev=lc.x-(jc.x-kc.x)<ic.GOPREV_AREA;}else this.stagePagerPrev=jc.x-kc.x<ic.GOPREV_AREA;j.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);j.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var mc,nc=event.getTarget();if(!ga.byClass(nc,'snowliftOverlay')&&!ga.byClass(nc,'bottomBarActions')&&!ga.byClass(nc,'snowliftPager'))mc=ic.PAGER_FADE;this.showPagers(mc);};ic.prototype.showPagers=function(jc){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof jc!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),jc);};ic.prototype.hidePagers=function(){"use strict";var jc=n.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(jc)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};ic.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ja.VIEWER_SNOWLIFT));};ic.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);n.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(kc){j.removeClass(kc,'hover');});n.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(kc){j.removeClass(kc,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!j.hasClass(this.root,'taggingMode')){var jc=this.getTagger();if(jc){jc.hideTagger();jc.setCurrentFacebox(null);}}};ic.prototype.onCancelSaveRejectedLocation=function(event){"use strict";var jc=o.find(this.root,"#locationSuggestionDialogForm").childNodes,kc=null;for(var lc=0;lc<jc.length;lc++){var mc=jc[lc];if(mc.name==="fbid"){kc=mc.value;break;}}if(kc){var nc=new h("/ajax/photos/photo/location/edit/reject.php").setMethod("POST").setData({photoID:kc});nc.send();}};ic.prototype.switchHilitedTags=function(jc,kc){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var lc=sb(jc);if(lc){this.hilitedTag=jc;if(!j.hasClass(this.root,'taggingMode')&&qa.isFacebox(this.hilitedTag)){var mc=this.getTagger();if(mc){j.addClass(lc,'hover');var nc=mc.getFacebox(jc);mc.setCurrentFacebox(nc);if(nc)mc.addTagFromFacebox(nc);}}else j.addClass(lc,'hover');if(j.hasClass(lc,'tagBoxPending')&&!j.hasClass(lc,'showPendingTagName')&&kc===true){n.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(oc){j.removeClass(oc,'showPendingTagName');});j.addClass(lc,'showPendingTagName');}}};ic.prototype.reHilitePendingTag=function(){"use strict";var jc=sb(this.hilitedTag);if(jc&&j.hasClass(jc,'showPendingTagName'))return;var kc=n.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(kc)this.switchHilitedTags(kc.id);};ic.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var jc=event.getTarget();if(ga.byClass(jc,'snowliftOverlay')||ga.byClass(jc,'fbPhotoSnowliftTagApproval')||ga.byClass(jc,'tagPointer')||ga.byClass(jc,'arrow')||ga.byClass(jc,'faceboxSuggestion')||ga.byClass(jc,'typeaheadWrapper')||ga.byClass(jc,'photoTagTypeahead'))return;var kc=ga.byClass(jc,'tagBoxPending'),lc=false;if(this.hilitedTag){var mc=sb(this.hilitedTag);lc=mc&&j.hasClass(mc,'tagBoxPending');}var nc=((!this.hilitedTag&&kc)||(!lc&&kc));if(nc){this.switchHilitedTags(kc.id);return;}if(kc&&(kc.id==this.hilitedTag))return;var oc=250,pc=15,qc=gb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=qc;var rc=qa.absoluteToNormalizedPosition(this.image,qc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(qc)<pc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(rc))return;var sc=qa.getNearestBox(this.stream.getCurrentExtraData().tagRects,rc);if(!sc){if(!lc){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var tc=null;if(lc){var uc={};uc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];tc=qa.getNearestBox(uc,rc);}if(tc!==null&&lc)return;if(this.hilitedTag!=sc)if(lc){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,sc),oc);}else{if(this._showHover&&!this._seenTags[sc]){this._seenTags[sc]=true;ra.logPivotImpression('snowlift',sc);}this.switchHilitedTags(sc);}};ic.prototype.currentTagHasPrecedence=function(jc){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var kc=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],lc=new ua(kc.t+(kc.h()/2),kc.r,kc.b+(qa.isFacebox(this.hilitedTag)?10:0),kc.l,kc.domain);return lc.contains(jc);};ic.prototype.getVideoOnStage=function(){"use strict";var jc=this.stream&&this.stream.getCurrentImageData();return jc&&jc.video;};ic.prototype.shouldPageOnAction=function(jc,kc){"use strict";if(!this.isOpen||aa.isShowingConfirmation())return false;var lc=n.isNode(kc)&&(ga.byClass(kc,'snowliftPager')||ga.byClass(kc,'stagePagers')||ga.byClass(kc,'pivotPageColumn')),mc=n.isNode(kc)&&ga.byClass(kc,'stage'),nc=j.hasClass(kc,'faceBox'),oc=(!j.hasClass(this.root,'taggingMode')&&nc&&!lc);if(oc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){n.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var pc=((mc&&j.hasClass(this.root,'taggingMode'))||ga.byClass(kc,'tagBoxPending')||ga.byClass(kc,'tagBoxPendingResponse')||ga.byClass(kc,'fbPhotoTagApprovalBox')||ga.byClass(kc,'tag'));if(pc)return false;if(mc&&this._isZoomOn)mc=false;return jc==x.LEFT||jc==x.RIGHT||jc==x.UP||jc==x.DOWN||jc==zb||jc==ac||lc||oc||mc;};ic.prototype.keyHandler=function(jc,event){"use strict";if(event.getModifiers().any||y.getTopmostLayer()!==this.spotlight)return true;switch(q.getKeyCode(event)){case x.LEFT:case x.RIGHT:case x.UP:case x.DOWN:case zb:case ac:this.pageListener(event);return false;case bc:return this.toggleFullScreen();case cc:return this.likePhotoWithKey();case x.SPACE:this.toggleSlideshow();this.showPagers(ic.PAGER_FADE);return false;case x.ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};ic.prototype._isItemPagerEnabled=function(){"use strict";var jc=this._scrapProductItemSnowLiftLinks();return jc!==null&&jc.length>1;};ic.prototype._setupNextItemUI=function(){"use strict";if(!this.upPager||!this.downPager)return;var jc=this._scrapProductItemSnowLiftLinks();if(!jc||jc.length<2){j.hide(this.upPager);j.hide(this.downPager);}else{var kc=gb.getElementDimensions(this.stage),lc=gb.getElementDimensions(this.root),mc=(lc.y-kc.y)/2-ic.PRODUCT_ITEM_PAGER_MARGIN;this.upPager.style.marginTop="-"+mc+"px";this.downPager.style.marginTop=(mc-ic.PRODUCT_ITEM_PAGER_HEIGHT)+"px";j.show(this.upPager);j.show(this.downPager);}};ic.prototype._scrapProductItemSnowLiftLinks=function(){"use strict";if(!this._elem)return null;var jc=sb('pagelet_group_forsaleposts');if(!jc)jc=sb('group_commerce_cross_group_feed_stories');if(!jc)return null;var kc=n.scry(jc,'a[name="snowlift"]').filter(function(nc){return n.scry(nc,'img').length==1;}),lc=kc.map(function(nc){return nc.href;}),mc=kb(lc,this._elem.href);return mc?kc:[];};ic.prototype._loadNextItem=function(jc){"use strict";var kc=this._scrapProductItemSnowLiftLinks();if(!kc)return;var lc=kc[0];kc.every(function(mc,nc){if(mc.href===this._elem.href){var oc=jc?++nc:--nc;if(oc<0){lc=kc[kc.length-1];}else if(oc<kc.length)lc=kc[oc];return false;}return true;}.bind(this));lc.click();};ic.prototype.shouldHandlePendingTag=function(event){"use strict";var jc=this.getTagger();if(!jc||!jc.tags.length)return false;var kc=qa.absoluteToNormalizedPosition(this.getImage(),gb.getEventPosition(event)),lc=jc.findNearestTag(kc);if(!lc||!j.hasClass(lc.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:lc.id,version:this.getVersionConst()});return true;};ic.prototype.pageListener=function(event){"use strict";var jc=q.getKeyCode(event),kc=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(jc,kc))return;if(this.shouldHandlePendingTag(event))return;var lc=0,mc=null,nc=null;if(jc==x.RIGHT||jc==ac){lc=1;ka.setPagingAction('key_right');this._disableMouseOver=true;}else if(jc==x.LEFT||jc==zb){lc=-1;ka.setPagingAction('key_left');this._disableMouseOver=true;}else if(jc==x.UP){ka.setPagingAction('key_up');this._disableMouseOver=true;mc=false;}else if(jc==x.DOWN){ka.setPagingAction('key_down');this._disableMouseOver=true;mc=true;}else if(ga.byClass(kc,'next')){lc=1;ka.setPagingAction('click_next');}else if(ga.byClass(kc,'prev')){lc=-1;ka.setPagingAction('click_prev');}else if(ga.byClass(kc,'down')){mc=true;ka.setPagingAction('click_down');}else if(ga.byClass(kc,'up')){mc=false;ka.setPagingAction('click_up');}else if(nc=ga.byClass(kc,'seek')){var oc=k.get(nc,'seek-fbid');lc=this.stream.getRelativeMovement(oc);ka.setPagingAction('seek');}else if(!this.stagePagerPrev){lc=1;ka.setPagingAction('click_stage');}else{lc=-1;ka.setPagingAction('click_stage_back');}var pc=n.scry(this.ufiForm,'input.mentionsHidden'),qc=false;for(var rc=0;rc<pc.length;rc++)if(!w.isEmpty(pc[rc])){qc=true;break;}if(qc||j.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,lc));}else{this.page(lc,fb.chrome()&&s.isFullScreen());this._previousZoomScrollPercent=null;}if(null!==mc)this._loadNextItem(mc);};ic.prototype.warnLeavePage=function(jc){"use strict";new l().setTitle(r._("Are You Sure You Want To Leave This Page?")).setBody(r._("You have unsaved changes that will be lost if you leave the page.")).setButtons([{name:'leave_page',label:r._("Leave This Page"),handler:jc},{name:'continue_editing',label:r._("Stay on This Page"),className:'inputaux'}]).setModal(true).show();};ic.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};ic.prototype.getOpaqueCursor=function(jc){"use strict";return this.stream.getOpaqueCursor(jc);};ic.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};ic.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};ic.prototype.page=function(jc,kc,lc){"use strict";if(!this.stream.isValidMovement(jc)||!this.stream.nonCircularPhotoSetCanPage(jc)){this.showPagers(ic.PAGER_FADE);return;}var mc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(jc));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&jc<0)||(this.firstInSet==mc&&jc>0))){this.showPagers(ic.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=jc;var nc=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&nc===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=jc;}else if(nc===-1)na.fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&mc===this._albumBoundaries.start&&jc===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,kc);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&mc===this._albumBoundaries.end&&jc===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,kc);}else{this.hidePivotSlide();if(jc===-this._albumBoundaries.dir)return;}}var oc=this.getVideoOnStage();if(oc)this.switchVideo(oc,false);if(this.pivots&&this.pivots.page(jc))return;g.inform('PhotoSnowlift.PAGE');ab.hide();this.recacheData();this.stream.moveCursor(jc);j.hide(this.image);if(jc!==0){this.storyID=null;this._updateContainerOwnerID();}if(jc!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(ic.STATE_HTML,true);j.show(this.errorBox);return;}this.movementDelta+=jc;var pc=this.stream.getCurrentImageData();if(pc){var qc=this.getImageURL(pc);if(qc){if(pc.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();t.log(yb.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();t.log(yb.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(qc,null,true);}else if(pc.video)this.switchVideo(pc.video,true,lc);if(!kc){this.replaceUrl=true;ub(pc.info.permalink);}this.setLoadingState(ic.STATE_IMAGE_DATA,false);}else{this.setLoadingState(ic.STATE_IMAGE_PIXELS,true);this.setLoadingState(ic.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(ic.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){j.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)j.addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(nc===-1){na.fetch(this._albumFBID,this.stream);}else if(nc===0){ra.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}};ic.prototype.showMorePhotos=function(jc,kc){"use strict";if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));j.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ta.render(ta.createElement(ma,{className:"_27g",fbid:jc,onclose:this.hideMorePhotos.bind(this),endofalbum:kc||false,withBackground:true}),this.searchPivot);};ic.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;j.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};ic.prototype.showPivotSlide=function(jc,kc){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;j.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=n.create('div');n.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ta.render(ta.createElement(la,{fbid:jc,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,kc)}),this.pivotSlide);};ic.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});j.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};ic.prototype.logImpressionDetailsForPhoto=function(){"use strict";var jc=[].concat(n.scry(jb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),n.scry(jb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(jc.length===0)return;var kc={};for(var lc=0;lc<jc.length;lc++)kc[jc[lc].name]=jc[lc].value;if(this.getVideoOnStage()){kc.width=0;kc.height=0;}else{var mc=this.getImageDimensions(this.stream.getCurrentImageData());kc.width=mc.x;kc.height=mc.y;}ka.addDetailData(this.stream.getCursor(),kc);oa.setIsLogAdData(true);};ic.prototype.loadAds=function(){"use strict";if(this.disableAds)return;oa.loadAdsFromUserActivity();};ic.prototype.transitionHandler=function(jc){"use strict";if(jc.getQueryData().closeTheater||jc.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(jc.getQualifiedURI().toString());fa.transitionComplete(true);return true;}var kc=this._uriStack.length;if(kc>=2&&this._uriStack[kc-2]==jc.getQualifiedURI().toString())this._uriStack.pop();var lc=this.stream.getCursorForURI(jc.getUnqualifiedURI().toString());if(lc){var mc=this.stream.getRelativeMovement(lc);this.page(mc,true);fa.transitionComplete(false);return true;}if(this.isOpen){fa.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};ic.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var jc=this.stream.getCurrentHtml();for(var kc in jc){jc[kc]=ob(jb(kc).childNodes);n.empty(jb(kc));}}};ic.prototype.reloadIfTimeout=function(){"use strict";if(!v.hasLoaded(this.image)){var jc=this.makeNewImage(this.image.src,true);q.listen(jc,'load',this.useImage.bind(this,jc,null,true));this._log(jc.src);}};ic.prototype.useImage=function(jc,kc,lc){"use strict";if(lc&&v.hasLoaded(this.image))return;n.replace(this.image,jc);this.image=jc;this.adjustStageSize(kc);};ic.prototype.makeNewImage=function(jc,kc){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!kc)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),ic.LOADING_TIMEOUT);var lc=n.create('img',{className:'spotlight',alt:''});lc.setAttribute('aria-describedby','fbPhotosSnowliftCaption');lc.setAttribute('aria-busy','true');var mc=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);q.listen(lc,'load',mc);this._log(jc);lc.src=jc;return lc;};ic.prototype.switchImage=function(jc,kc,lc){"use strict";j.hide(this.image);j.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var mc=this.stream&&this.stream.getCurrentImageData();if(mc){ka.addPhotoView(mc.info,this.shouldShowHiRes(mc),this.fullscreen&&s.isFullScreen());if(this._showHover){var nc=this.stream.getCurrentExtraData();if(nc)ra.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(nc.tagRects));}}this.useImage(this.makeNewImage(jc,false),kc,false);if(lc)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(mc)){ka.addPanoramaImpression();var oc=new gb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(oc);}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);if(this._isZoomOn)this.switchIntoZoomedImage();g.inform('PhotoSnowlift.SWITCH_IMAGE');};ic.prototype._conditionDisplayZoomInButton=function(){"use strict";if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var jc=new gb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(jc);}else j.hide(this.showZoomInButton);};ic.prototype._displayZoomInButton=function(jc){"use strict";var kc=parseInt(this.image.style.height,10),lc=(jc.y-kc)/2;if(lc>=ic.ZOOM_BUTTON_TOP_PAD+ic.ZOOM_BUTTON_BOT_PAD+ic.ZOOM_BUTTON_HEIGHT){var mc=lc-ic.ZOOM_BUTTON_HEIGHT-ic.ZOOM_BUTTON_TOP_PAD;za.set(this.showZoomInButton,'bottom',mc+'px');}else za.set(this.showZoomInButton,'bottom','60px');j.show(this.showZoomInButton);};ic.prototype._isZoomAvailable=function(jc){"use strict";if(typeof jc==="undefined")jc=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!jc||!jc.originalDimensions)return false;var kc=new gb(this.stage.clientWidth,this.stage.clientHeight),lc=jc.originalDimensions,mc=lc.x/lc.y,nc=Math.min(kc.y*mc,lc.x);if(!isNaN(mc)&&mc>2&&lc.y>ic.MIN_PANORAMA_Y&&kc.x*ic.MIN_PANO_TO_STAGE_RATIO<nc){return true;}else return false;};ic.prototype._setZoomIn=function(){"use strict";this._isZoomOn=true;j.hide(this.showZoomInButton);j.hide(this.stageActions);j.show(this.showZoomOutButton);za.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(z);this.collapseRHC();};ic.prototype._setZoomOut=function(){"use strict";if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(z);za.set(this.stage,'overflow','visible');j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);j.show(this.stageActions);this.uncollapseRHC();};ic.prototype.switchIntoZoomedImage=function(jc){"use strict";this._setZoomIn();j.hide(this.zoomedImage);j.hide(this.outerImageSlider);var kc=this.stream.getCurrentImageData(),lc=kc.originalDimensions;this.zoomedImage.src=kc.url;this.adjustStageSize(lc);this._initializeZoomedImagePositions(new gb(parseInt(za.get(this.zoomedImage,'width'),10),parseInt(za.get(this.zoomedImage,'height'),10)));j.hide(this.image);};ic.prototype._adjustInnerImageSlider=function(jc){"use strict";var kc=this.stage.clientWidth,lc=Math.min(100,(kc/jc.x)*100);za.set(this.innerImageSlider,'width',lc+'%');return lc;};ic.prototype._getSliderSizeForZoomedImage=function(jc){"use strict";var kc=ic.MAX_SLIDER_HEIGHT*this.stage.clientHeight/jc.y,lc=ic.MAX_SLIDER_WIDTH*this.stage.clientWidth/jc.x,mc=Math.min(kc,lc);return new gb(100*jc.x*mc/this.stage.clientWidth,100*jc.y*mc/this.stage.clientHeight);};ic.prototype._initializeZoomedImagePositions=function(jc){"use strict";this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var kc=this._getSliderSizeForZoomedImage(jc);za.set(this.outerImageSlider,'width',kc.x+'%');za.set(this.outerImageSlider,'height',kc.y+'%');za.set(this.outerImageSlider,'left',(50-kc.x/2)+'%');za.set(this.showZoomOutButton,'bottom',kc.y*this.stage.clientHeight/100+parseInt(za.get(this.outerImageSlider,'bottom'),10)+20+'px');j.show(this.zoomedImage);j.show(this.outerImageSlider);};ic.prototype._zoomedImageMouseDown=function(event){"use strict";if(!this._isZoomOn)return;j.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var jc=false,kc=event.getTarget();if(ga.byClass(kc,"_10zv")){this.startSliderMargins=new gb(parseFloat(za.get(this.innerImageSlider,'marginLeft')),parseFloat(za.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new gb(event.clientX,event.clientY);}else if(ga.byClass(kc,"_10zx")){this.startSliderMargins=new gb(parseInt(za.get(this.innerImageSlider,'marginLeft'),10),parseInt(za.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var lc=parseInt(za.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new gb(this.innerImageSlider.getBoundingClientRect().left+lc/2,event.clientY);jc=true;}else if(ga.byClass(kc,"_10zw")){this.startImageMargins=new gb(parseInt(za.get(this.zoomedImage,'marginLeft'),10),parseInt(za.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new gb(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=q.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(jc){this._zoomedImagePan(event);}else event.kill();};ic.prototype._zoomedImageMouseUp=function(event){"use strict";if(this._zoomedImageMouseMoveHandle){j.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var jc=parseFloat(za.get(this.zoomedImage,'marginLeft')),kc=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=jc/kc;}};ic.prototype._zoomedImagePan=function(event){"use strict";var jc;if(this.startSliderMargins){jc=event.clientX-this.mouseDownStartPosition.x;var kc=parseFloat(za.get(this.outerImageSlider,'width')),lc=parseFloat(za.get(this.innerImageSlider,'width')),mc=Math.max(0,Math.min(kc-lc,this.startSliderMargins.x+jc))/kc;za.set(this.innerImageSlider,'marginLeft',100*mc+"%");za.set(this.zoomedImage,'marginLeft',-1*mc*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){jc=1.75*(this.mouseDownStartPosition.x-event.clientX);var nc=Math.min(0,Math.max(this.startImageMargins.x-jc,-this.zoomedImage.width+this.stage.clientWidth));za.set(this.zoomedImage,'marginLeft',nc+'px');za.set(this.innerImageSlider,'marginLeft',(-nc/this.zoomedImage.width*100)+"%");event.kill();}};ic.prototype._scrollZoomedImageToPercent=function(jc){"use strict";if(jc===(void 0)||jc===null)jc=.5;var kc=new gb(parseInt(za.get(this.zoomedImage,'width'),10),parseInt(za.get(this.zoomedImage,'height'),10));za.set(this.innerImageSlider,'marginLeft',((100-this._adjustInnerImageSlider(kc))*jc)+'%');za.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-kc.x)*jc)+'px');};ic.prototype.switchVideo=function(jc,kc,lc){"use strict";this._pauseVideoIfNeeded();var mc='swf_'+jc;n.empty(this.videoStage);if(kc){j.addClass(this.stageWrapper,'showVideo');var nc=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){j.hide(this.nextPager);j.hide(this.prevPager);}var oc=nc.video_element;n.find(oc,"._ox1").style.cssText='';var pc=null;if(this.pivotsCarouselElement)pc=o.scry(this.pivotsCarouselElement,"._32_l");if(pc)pc.forEach(function(tc){var uc=tc.getAttribute('data-fbid'),vc=this.stream.getCursor(),wc=n.find(tc,"._1pqn");if(uc===vc){j.show(wc);}else j.hide(wc);}.bind(this));j.addClass(oc,'videoStageContainer');n.appendContent(this.videoStage,oc);n.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[mc]&&!sb(mc))window[mc].write(jc);var qc='video_warning_'+jc,rc=sb(jc);if(!this.videoWarnings)this.videoWarnings=[];if(rc&&this.videoWarnings[qc])n.setContent(rc,this.videoWarnings[qc]);this._videoPlayerStateManager=nc.controller;this._videoPlayerStateManager.reset();this._videoPlayerStateManager.collectFeedTrackingData();if(this._autoplayVideos){var sc=lc||ib.USER;this._videoPlayerStateManager.play(sc);}if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',function(){var tc=nc.info.fbid.toString();if(this.haltAutoplay&&tc!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var uc=this.autoplayOptionScreenConfig.controller;uc.registerCallbacks(oc,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,nc));}}else this.handleAutoplay(nc);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,jc),0);}else{window[mc]&&window[mc].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);j.removeClass(this.stageWrapper,'showVideo');}};ic.prototype.removeAutoplayOptionScreen=function(){"use strict";if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf();};ic.prototype.chooseToReplayVideo=function(jc){"use strict";jc.play(ib.USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false;};ic.prototype.handleAutoplay=function(jc){"use strict";var kc=jc.info.fbid.toString();if(kc===this.stream.getCursor()&&kc!==this.stream.fbidList[this.stream.fbidList.length-1]){xa.adjustCarouselOnAutoPlay();this.page(1,false,ib.AUTOPLAY);}this.removeAutoplayOptionScreen();this.haltAutoplay=false;};ic.prototype.checkVideoStatus=function(jc){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var kc=this.getVideoOnStage();if(!kc){return;}else{if(kc!==jc)return;this.adjustStageSizeForVideo(jc);}};ic.prototype.getVideoSize=function(jc){"use strict";return new gb(jc.getAttribute('data-video-width'),+jc.getAttribute('data-video-height')+this.getVideoComponentsHeight(jc));};ic.prototype.getVideoElement=function(jc){"use strict";return n.scry(this.videoStage,"._ox1")[0];};ic.prototype.getVideoComponentsHeight=function(jc){"use strict";var kc=0,lc=ga.byClass(jc,"_1c_u");if(!lc)return 0;var mc=n.scry(lc,"._2i84");if(mc.length){var nc=mc[0].getBoundingClientRect();kc=nc.bottom-nc.top;}return kc;};ic.prototype.adjustStageSizeForVideo=function(jc){"use strict";var kc=this.getVideoElement(jc);if(!kc){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,jc),200);}else this.adjustStageSize(this.getVideoSize(kc));};ic.prototype.handleServerError=function(jc,kc){"use strict";n.setContent(this.errorBox,jc);this.storeFromData(kc);};ic.prototype.fixButtonText=function(jc){"use strict";if(!this.buttonTruncateGk)return;var kc=n.scry(jc,".photosTruncatingUIButton"),lc=parseInt(za.get(jc,'width'),10);if(lc>dc){var mc={tagPhoto:r._("Tag Photo"),doneTagPhoto:r._("Done Tagging"),addLocation:r._("Add Location"),editPhoto:r._("Edit")};for(var nc=0;nc<kc.length;nc++){var oc=kc[nc];j.addClass(oc,"_2n0k");bb.set(oc,mc[oc.getAttribute('data-buttonname')],'below','center');}}};ic.prototype.swapData=function(){"use strict";var jc,kc=this.stream.getCurrentHtml();if(kc){this.setLoadingState(ic.STATE_HTML,false);for(var lc in kc){jc=sb(lc);jc&&n.setContent(jc,kc[lc]);}var mc=sb('photosTruncatingUIButtonGroup');mc&&this.fixButtonText(mc);g.inform('PhotoSnowlift.DATA_CHANGE',nb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),g.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};ic.prototype.updateTotalCount=function(jc,kc,lc){"use strict";var mc=this.stream.getCurrentHtml();if(mc){var nc=jb('fbPhotoSnowliftPositionAndCount');n.replace(nc,lc);nc=lc;j.show(nc);var oc='fbPhotoSnowliftPositionAndCount';mc[oc]=ob(nc.childNodes);}this.stream.setTotalCount(jc);this.stream.setFirstCursorIndex(kc);};ic.prototype.addPhotoFbids=function(jc,kc,lc,mc){"use strict";if(mc&&this.sessionID&&mc!=this.sessionID)return;var nc=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(jc,kc,lc);if(lc&&nc)this.page(0,true);if(this.pivots&&lc)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;j.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var oc=this.stream.getCursor(),pc=this.stream.calculateDistance(oc,this._mediaFBID);this.stream.moveCursor(pc);}};ic.prototype.attachTagger=function(jc,kc){"use strict";n.appendContent(this.stageActions,jc);if(kc)kc.setTokenarea(this.taglist);};ic.prototype.storeFromData=function(jc){"use strict";if(!this.isOpen)return;if(jc.pivots)this.pivotsCarouselElement=jc.pivots;if(jc.autoplay_option_screen_config){this.autoplayOptionScreenConfig=jc.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription();}this.shouldRenderVideoPivots=jc.should_render_pivots;if(jc.ssid&&this.sessionID&&this.sessionID!=jc.ssid)return;var kc=this.stream.storeToCache(jc);if('error' in kc){this.checkState(ic.STATE_ERROR);return;}if('init' in jc){if(this.shouldRenderVideoPivots)this._videoSameAsSource=jc.init.videoSameAsSource;this._mediaFBID=jc.init.fbid;this._albumFBID=jc.init.album_fbid;this._isAlbum=jc.init.is_album;this._albumOwnerName=jc.init.album_owner_name;this._autoplayVideos=jc.init.autoplay_videos;this._autoplayNextVideo=jc.init.autoplay_next_video;}if('init' in kc){this.initDataFetched(kc.init);if(this.openExplicitly){this.replaceUrl=true;ub(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();}if('image' in kc)this.checkState(ic.STATE_IMAGE_DATA);if('data' in kc)this.checkState(ic.STATE_HTML);};ic.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){j.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));j.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){j.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var jc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));j.conditionClass(this.root,'disableRight',jc==this.firstInSet);}};ic.prototype.setStagePagersState=function(jc){"use strict";switch(jc){case 'ready':j.addClass(this.root,'pagingReady');this.pagersShown=true;this._setupNextItemUI();return;case 'active':j.addClass(this.root,'pagingActivated');return;case 'inactive':j.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':j.removeClass(this.root,'pagingReady');return;}};ic.prototype.deletePhoto=function(jc){"use strict";this.closeRefresh();};ic.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};ic.prototype.onHiliteTag=function(jc,kc){"use strict";if(kc.version!=ja.VIEWER_SNOWLIFT)return;var lc=kc.tag;if(lc)this.switchHilitedTags(lc,true);};ic.prototype.onUpdateTagBox=function(jc,kc){"use strict";if(kc.version==ja.VIEWER_SNOWLIFT)this.updateTagBox(kc.id,kc.approve);};ic.prototype._log=function(jc){"use strict";if(this._shouldLog){this._logger&&this._logger.log(jc);return true;}return false;};ic.prototype._enableMouseOver=function(){"use strict";this._disableMouseOver=false;};ic.prototype._interceptMouseOver=function(event){"use strict";if(this._disableMouseOver)event.kill();};ic.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};ic.prototype._pauseVideoIfNeeded=function(){"use strict";if(this._videoPlayerStateManager)this._videoPlayerStateManager.pause('unloaded');};ic.getInstance=function(){"use strict";if(!ic._instance)ic._instance=new ic();return ic._instance;};ic.initWithSpotlight=function(jc,kc){"use strict";ic.getInstance().init(jc,kc);};ic.addPhotoFbids=function(jc,kc,lc,mc){"use strict";ic.getInstance().addPhotoFbids(jc,kc,lc,mc);};ic.setReachedLeftEnd=function(){"use strict";ic.getInstance().setReachedLeftEnd();};ic.setReachedRightEnd=function(){"use strict";ic.getInstance().setReachedRightEnd();};ic.attachFollowFlyout=function(jc){"use strict";n.insertAfter(jb('fbPhotoSnowliftSubscribe'),jc);};ic.attachSubscribeFlyout=function(jc){"use strict";n.insertAfter(jb('fbPhotoSnowliftSubscribe'),jc);};ic.attachTagger=function(jc,kc){"use strict";ic.getInstance().attachTagger(jc,kc);};ic.preload=function(jc,kc){"use strict";ic.getInstance().preload(jc,kc);};ic.bootstrap=function(jc,kc){"use strict";var lc=jc&&new eb(jc).getQueryData();if(lc&&lc.hasOwnProperty('share_id')){i.loadModules(["SpotlightShareViewer"],function(mc){mc.bootstrap(jc,kc);});return;}ic.getInstance().bootstrap(jc,kc);};ic.closeRefresh=function(){"use strict";ic.getInstance().closeRefresh();};ic.deletePhoto=function(jc){"use strict";ic.getInstance().deletePhoto(jc);};ic.getImage=function(){"use strict";return ic.getInstance().getImage();};ic.getImageId=function(){"use strict";return ic.getInstance().getImageId();};ic.getLoadQuery=function(){"use strict";return ic.getInstance().getLoadQuery();};ic.getRHCBody=function(){"use strict";return ic.getInstance().getRHCBody();};ic.getRHCFooter=function(){"use strict";return ic.getInstance().getRHCFooter();};ic.getRHCHeader=function(){"use strict";return ic.getInstance().getRHCHeader();};ic.getRoot=function(){"use strict";return ic.getInstance().getRoot();};ic.likePhotoSkipConfirmation=function(jc){"use strict";ic.getInstance().likePhotoSkipConfirmation(jc);};ic.onCancelSaveRejectedLocation=function(event){"use strict";ic.getInstance().onCancelSaveRejectedLocation(event);};ic.saveTagsFromPayload=function(jc){"use strict";ic.getInstance().saveTagsFromPayload(jc);};ic.saveTagsFromPayloadDelayed=function(jc){"use strict";setTimeout(ic.saveTagsFromPayload.bind(null,jc),2000);};ic.handleServerError=function(jc,kc){"use strict";ic.getInstance().handleServerError(jc,kc);};ic.setVideoWarning=function(jc,kc){"use strict";var lc=ic.getInstance(),mc='video_warning_'+jc;if(!lc.videoWarnings)lc.videoWarnings=[];lc.videoWarnings[mc]=kc;};ic.storeFromData=function(jc){"use strict";ic.getInstance().storeFromData(jc);};ic.swapData=function(){"use strict";ic.getInstance().swapData();};ic.updateTotalCount=function(jc,kc,lc){"use strict";ic.getInstance().updateTotalCount(jc,kc,lc);};ic.setVideoRotateURI=function(jc){"use strict";ic.getInstance().videoRotateURI=jc;};nb(ic,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:rb,touchMarkup:rb,PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE:100,PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:70,PRODUCT_ITEM_PAGER_HEIGHT:21,PRODUCT_ITEM_PAGER_MARGIN:20});nb(ic.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:ic.STAGE_NORMAL_MAX,stageChrome:ic.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});e.exports=ic;},null);
__d("TimelineContextItemLogger",["BanzaiLogger","Event","FBJSON","Parent","Run","cx","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n='MTimelineXContextItemsLoggerConfig',o='impression',p='click',q='context_item_url',r='event',s="_md0",t=[];function u(w,x,y){var z=i.parse(w.getAttribute('data-store'));z[r]=x;if(y)z[q]=y;g.log(n,z);}var v={logWhenVisible:function(w){if(!t.length)k.onLeave(function(){t=[];});t.push(w);},logWhenClicked:function(w){m(h.listen(w,'click',function(x){var y=x.getTarget();if(y.nodeName!=='A')return;var z=j.byClass(y,s);z&&u(z,p,y.href);}));},listenToExpand:function(w){m(w.addListener('expanded',function(){while(t.length)u(t.pop(),o);}));}};e.exports=v;},null);
__d("TimelineSecondaryColumnUnitList",["CSS","DOM","Event","Run","csx","cx","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=30;function o(p,q){"use strict";var r=i.listen(q,'click',function(){this.$TimelineSecondaryColumnUnitList0=h.scry(p,"._16f_");this.$TimelineSecondaryColumnUnitList1();h.remove(q);this.emit('expanded');}.bind(this));j.onLeave(r.remove.bind(r));}o.prototype.$TimelineSecondaryColumnUnitList1=function(){"use strict";if(!this.$TimelineSecondaryColumnUnitList0.length)return;g.removeClass(this.$TimelineSecondaryColumnUnitList0.shift(),"_16f_");setTimeout(this.$TimelineSecondaryColumnUnitList1.bind(this),n);};m(o,{expanded:true});e.exports=o;},null);
__d("TimelineCapsule",["Arbiter","CSS","DataStore","DOM","DOMQuery","DOMScroll","Parent","TimelineConstants","TimelineLegacySections","Vector","$","csx","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=(function(){var u={},v={};function w(y){k.scry(y,"._3ram").forEach(function(z){var aa=z.getAttribute('data-endmarker'),ba=z.getAttribute('data-pageindex'),ca=function(){if(!z.parentNode)return;i.set(n.DS_LOADED,y.id,ba);j.remove(z);g.inform(n.SECTION_FULLY_LOADED,{scrubberKey:aa,pageIndex:ba,capsuleID:y.id,childCount:y.childNodes.length});};if(o.get(aa)){ca();}else var da=g.subscribe(n.SECTION_REGISTERED,function(ea,fa){if(fa.scrubberKey===aa){ca();da.unsubscribe();}});});g.inform('TimelineCapsule/balanced',{capsule:y});}function x(y,z){var aa=m.byAttribute(y,'data-size');if(aa)if(h.hasClass(y.parentNode,'timelineReportContent')){z(y);}else z(aa);}return {removeUnit:function(y){x(y,function(z){j.remove(z);});},removeUnitWithID:function(y){t.removeUnit(q(y));},hideUnit:function(y){x(y,function(z){h.addClass(z,'fbTimelineColumnHidden');});},undoHideUnit:function(y,z){j.remove(m.byClass(z,'hiddenText'));x(y,function(aa){h.removeClass(aa,'fbTimelineColumnHidden');});},unplacehold:function(y){var z=q(y);z.style.top=null;h.removeClass(z,'visiblePlaceholder');h.removeClass(z,'placeholder');var aa=m.byClass(z,'fbTimelineCapsule');delete u[aa.id][y];t.balanceCapsule(aa);},scrollToCapsule:function(y){if(!v.hasOwnProperty(y.id)){var z=p.getElementPosition(y.parentNode);l.scrollTo(new p(p.getScrollPosition().x,z.y-n.SCROLL_TO_OFFSET,'document'));v[y.id]=true;}},loadTwoColumnUnits:function(y,z,aa){var ba=q(y);s(function(){var ca=m.byClass(ba,'fbTimelineSection');if(ca&&!z){var da=k.find(ba,"._3rbf"),ea=k.find(ba,"._3rbh"),fa=ea.offsetHeight-da.offsetHeight;i.set(n.DS_COLUMN_HEIGHT_DIFFERENTIAL,aa,fa);}},w.bind(null,ba));}};})();e.exports=t;},null);
__d("TimelineCapsuleUtilities",["CSS"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={setFirstUnit:function(i){var j=true;for(var k=0;k<i.childNodes.length;++k){var l=i.childNodes[k];if(l.id.indexOf('tl_unit_')===0)if(j){j=false;g.addClass(l,'firstUnit');}else{g.removeClass(l,'firstUnit');break;}}}};e.exports=h;},null);
__d("TimelineComposer",["Arbiter","Bootloader","ComposerXMarauderLogger","ComposerXStore","CSS","DOM","Parent","Run","TimelineCapsuleUtilities","$","getObjectValues","goURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s,t;function u(){i.logCompleted(s.id);}function v(x){if(x.hidePost){u();return;}if(x.redirect){var y=j.getAllForComposer(s.id);q(y).forEach(function(aa){if(aa.reset)aa.reset(aa);});r(x.redirect);u();return;}if(!x.streamStory){window.location.reload();return;}if(x.backdatedTime){h.loadModules(["TimelineStoryPublisher"],function(aa){aa.publish(x);});u();return;}var z=w.renderCapsuleBasedStory(s,x.streamStory);g.inform('TimelineComposer/on_after_publish',z,g.BEHAVIOR_PERSISTENT);u();}var w={init:function(x){s=p(x);t=g.subscribe('composer/publish',function(event,y){if(y.composer_id===s.id)v(y);});n.onLeave(w.destroy);},destroy:function(){t&&t.unsubscribe();},renderCapsuleBasedStory:function(x,y){var z=m.byClass(x,'fbTimelineCapsule');if(!z)return;var aa=m.byClass(x,'fbTimelineUnit'),ba=aa.nextSibling;if(ba&&ba.getAttribute('data-spine'))aa=aa.nextSibling;l.insertAfter(aa,y);var ca=y;if(k.hasClass(y,'fbTimelineUnit'))ca=l.find(y,'div.timelineUnitContainer');h.loadModules(["Animation"],function(da){new da(ca).from('backgroundColor','#fff8dd').to('backgroundColor','#fff').duration(2000).ease(da.ease.both).go();});o.setFirstUnit(z);return y;}};e.exports=a.TimelineComposer||w;},null);
__d("TimelineLogging",["TimelineComponentKeys","TimelineController","reportData"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=false,k=0,l=null,m=null,n={init:function(o){if(j)return;k=o;h.register(g.LOGGING,this);},reset:function(){j=false;k=0;l=null;},log:function(o,p){p.profile_id=k;i(o,{gt:p});},logSectionChange:function(o,p){var q={timeline_section_change:1,key:o};if(l&&o==l){q.timeline_scrubber=1;l=null;}if(m&&o==m){q.sticky_header_nav=1;m=null;}n.log('timeline',q);},logScrubberClick:function(o){l=o;},logStickyHeaderNavClick:function(o){m=o;}};e.exports=n;},null);
__d("TimelineSpinelessComposer",["Arbiter","Bootloader","ComposerXMarauderLogger","Run","TimelineComposer","TimelineComposerUtilities"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m;function n(){i.logCompleted(m.id);}function o(q){if(q.hidePost){n();return;}if(!q.streamStory){window.location.reload();return;}if(q.backdatedTime){h.loadModules(["TimelineStoryPublisher"],function(r){r.publish(q);});n();return;}k.renderCapsuleBasedStory(m,q.streamStory);n();}var p={init:function(q){m=q;var r=g.subscribe('composer/publish',function(event,s){if(s.composer_id===m.id)o(s);});j.onLeave(r.unsubscribe.bind(r));}};e.exports=p;},null);
__d("TimelineStickyRightColumn",["Arbiter","CSS","DOMQuery","Event","PhotoSnowlift","Run","Style","TimelineContentLoader","TimelineGating","Vector","csx","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=100,t=15,u=15,v=35,w="._3rbf",x="._4_7u",y="._3rbh",z=false,aa=null,ba=null,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma;function na(){if(k.getInstance().isOpen)return;ca=n.getCurrentSection();da=n.getRecentActivitySection();if(!ca||!ca.isRightColumnFinished())return;var db,eb;if(o.hasShortReports){db=xa(da);eb=va(da);}else{eb=va(ca);db=wa(ca);}fa=db?db.offsetHeight:0;ga=eb?eb.offsetHeight:0;ha=p.getViewportDimensions().y;la=db?p.getElementPosition(db).y:0;ea=n.getLastVisibleSection();ia=ca.getNode().offsetHeight;ma=document.body.clientWidth<document.body.scrollWidth;}function oa(){if(!ca||k.getInstance().isOpen)return;if(!o.hasShortReports&&ba&&ba!==ca){var db=va(ba);if(db)ya(db,'','','');}var eb;if(o.hasShortReports){eb=va(da);}else eb=va(ca);if(!eb)return;if(ma){ya(eb,'','','');return;}if(ca.isRightColumnFinished()||(o.hasShortReports&&da.isRightColumnFinished())){pa(ca,eb);ba=sa(eb)==='fixed'?ca:null;}}function pa(db,eb){if(ga>=fa||fa<=ha)return;ka=ja;ja=p.getScrollPosition().y;var fb=la-za();if(ja<=fb){ya(eb,'','','');return;}var gb=u+v,hb=ja+ha-gb,ib=ja+ga+za(),jb=la+ia;if(ca===ea)jb+=v;if(!o.hasShortReports&&jb<=Math.min(ib,hb)){ya(eb,'absolute','',u+'px');return;}var kb=ha-u-za();if(ga<=kb){ya(eb,'fixed',za()+'px','');return;}if(ja<ka){qa(eb);}else ra(eb);}function qa(db){var eb=false;if(sa(db)==='absolute'){var fb=la+fa-za(),gb=ja+za()-la;if(!!ua(db)&&gb<=ua(db)){eb=true;}else if(db.style.bottom!==''&&ja<=fb-ga)eb=true;}if(eb){ya(db,'fixed',za()+'px','');return;}if(sa(db)==='absolute'&&!!ua(db))return;if(ta(db)){if(ua(db)>=za())return;var hb=ha-v,ib=ja-la-(ga-hb);if(ka)ib+=ka-ja;ya(db,'absolute',ib+'px','');return;}}function ra(db){var eb,fb=false;if(!ta(db)){eb=ua(db);var gb=ja+ha,hb=la+eb+ga+v;if(gb>=hb)fb=true;}if(!fb)if(ja===ka||!ta(db))return;if(fb){eb=ha-ga-u-v;ya(db,'fixed',eb+'px','');return;}if(ta(db)&&ua(db)>=za()){eb=ja-la+za();if(ka)eb+=ka-ja;ya(db,'absolute',eb+'px','');}}function sa(db){switch(db.style.position){case 'absolute':case 'static':return db.style.position;default:return h.hasClass(db,'fixed_always')?'fixed':'static';}}function ta(db){switch(sa(db)){case 'absolute':case 'static':return false;default:return true;}}function ua(db){return db.style.top?parseInt(db.style.top,10):0;}function va(db){return i.scry(db.getNode(),y)[0];}function wa(db){return i.scry(db.getNode(),w)[0];}function xa(db){return i.scry(db.getNode(),x)[0];}function ya(db,eb,fb,gb){m.set(db,'bottom',gb);if(eb==='fixed'){h.addClass(db,'fixed_always');m.set(db,'position','');}else{h.removeClass(db,'fixed_always');m.set(db,'position',eb);}m.set(db,'top',fb);g.inform('reflow');}function za(){return h.hasClass(document.documentElement,'tinyViewport')?t:s;}function ab(){r(na,oa);}function bb(){z=false;ba=null;while(aa.length)aa.pop().remove();aa=null;}var cb={init:function(){if(!z){z=true;aa=[j.listen(window,'scroll',ab),j.listen(window,'resize',ab)];l.onLeave(bb);}},adjust:function(){if(z){na();oa();}}};e.exports=cb;},null);
__d("TimelineViewportTracking",["Arbiter","Banzai","DOM","TimelineSeenStateConstants","TimelineViewportTrackingLogType","ViewportTracking","$","csx","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p;for(var q in l)if(l.hasOwnProperty(q))s[q]=l[q];var r=l===null?null:l.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=l;function s(){"use strict";if(l!==null)l.apply(this,arguments);}s.prototype.getAllStories=function(){"use strict";var t=i.scry(this.getStream(),"._5pat"),u=[];for(var v=0;v<t.length;v++)if(this.getStoryID(t[v]))u.push(t[v]);return u;};s.prototype.getStream=function(){"use strict";if(!this.$TimelineViewportTracking0)this.$TimelineViewportTracking0=m('timeline_tab_content');return this.$TimelineViewportTracking0;};s.prototype.getStoryID=function(t){"use strict";var u=JSON.parse(t.getAttribute('data-ft')),v=j.FT_TIMELINE_HASH_IDENTIFIER_KEY;return u[v];};s.prototype.getDataToLog=function(t){"use strict";var u=JSON.parse(t.getAttribute('data-ft'));return {ft:u,log_type:k.IMPRESSION};};s.prototype.getTimetrackingDataToLog=function(t){"use strict";var u=r.getTimetrackingDataToLog.call(this,t);u.log_type=k.DURATION;return u;};s.prototype.sendDataToLog=function(t,u,v,w){"use strict";if(!u.ft)return;var x={};if(w)x.retry=w;if(v)x.delay=2000;h.post('timeline_feed_tracking',u,x);};s.prototype.getDataFromConfig=function(t){"use strict";this.timeout=t.record_delay;this.isSeenStateLoggingEnabled=t.is_seen_state_logging_enabled;this.isTimetrackingEnabled=t.is_timetracking_enabled;this.vpvdDebug=!!t.vpvd_debug;o(g.subscribe(['TimelineConstants/unitSegmentLoaded','Timeline/unrankedStoriesLoaded'],function(){this.invalidateAllStoriesCache();this.invalidateVisibleStoriesCache();}.bind(this)));};s.prototype.getTimeout=function(){"use strict";return this.timeout;};s.prototype.cleanup=function(){"use strict";p=null;r.cleanup.call(this);};e.exports={getInstance:function(){return p;},init:function(t){if(p)return;p=new s();p.init(t);}};},null);