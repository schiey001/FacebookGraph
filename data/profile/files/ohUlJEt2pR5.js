/*!CK:2556007833!*//*1430116244,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["bU6jj"]); }

__d("legacy:UIFilterList",["UIFilterList"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.UIFilterList=b('UIFilterList');},3);
__d("SearchFunnelTypeaheadLogger",["Arbiter","Banzai","DOM","Event","PageEvents","PageTransitions","SubscriptionsHandler","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o='search_funnel',p='search_end_to_end',q={focus:'entrant',render:'results_displayed',keydown:'interaction',select:'search'},r,s={init:function(t,u){if(!t||!u)return;this._isColdStart=true;this._sampleRates=u;this._core=t.getCore();this._data=t.getData();this._view=t.getView();this._handler=new m();this.log=this.log.bind(this);this.onKeydown=this.onKeydown.bind(this);this.onSelect=this.onSelect.bind(this);this.onTypeaheadImpression=this.onTypeaheadImpression.bind(this);this._transitionInProgress=true;this.onTypeaheadImpression();},onTypeaheadImpression:function(t){this._initTime=this._getInitTime();this.e2eMarkers=[];if(this._transitionInProgress&&i.scry(document.body,'.fbPhotoSnowlift').length===0)this.log('impression',{funnel_path:n.getNextURI().path});this.reset();this._handler.addSubscriptions(this._core.subscribeOnce('focus',this.log),this._view.subscribeOnce('render',this.log),this._view.subscribeOnce('select',this.onSelect));j.listen(this._core.getElement(),'keydown',this.onKeydown);l.registerHandler(function(){this._transitionInProgress=true;}.bind(this));l.registerCompletionCallback(this.onTypeaheadImpression);},onKeydown:function(event){if(!this._sawKeydown){this._sawKeydown=true;this.log('keydown',event);}},onSelect:function(event,t){t.funnel_data={selected_position:t.selected.globalIndex,selected_type:t.selected.type};if(t.selected.isNullState){t.funnel_data.interaction_type='null_state';}else if(t.selected.isSingleState){t.funnel_data.interaction_type='single_state';}else t.funnel_data.interaction_type='typed';this._endToEndPath=n.getMostRecentURI().path;r=null;g.subscribe('BigPipe/init',function(event,u){if(!u.arbiter)return;var v={arbiter:u.arbiter,event:k.AJAXPIPE_ONLOAD,markers:this.e2eMarkers,init_time:this._initTime,from_path:this._endToEndPath};setTimeout(function(){this.setupE2EPerfLogging(v);}.bind(this),0);}.bind(this));this.log(event,t);},reset:function(){this._handler.release();this._handler.engage();this._sawKeydown=false;this._transitionInProgress=false;},log:function(t,u){if(q[t])t=q[t];this.e2eMarkers.push({event:t,time:String(Date.now()-this._initTime)});if(!this._sampleRates[t])return;u=u||{};u.funnel_data=u.funnel_data||{};u.funnel_data.sample_rate=this._sampleRates[t];u.funnel_data.current_event_time=Date.now();if(this._prevTime&&this._prevEvt){u.funnel_data.previous_event_time=this._prevTime;u.funnel_data.previous_event=this._prevEvt;}this._prevTime=u.funnel_data.current_event_time;this._prevEvt=t;h.post(o,{funnel_data:u.funnel_data,path:u.funnel_path||l.getMostRecentURI().path,stage:t},h.VITAL);},setupE2EPerfLogging:function(t){return t.arbiter.subscribeOnce(t.event,function(u){if(r)return;r=true;t.markers.push({event:'end',time:String(Date.now()-t.init_time)});h.post(p,{from_path:this._endToEndPath,to_path:n.getNextURI().path,markers:t.markers,cold_start:this._isColdStart},h.VITAL);this._isColdStart=false;}.bind(this));},_getInitTime:function(){if(window.ExitTime)return window.ExitTime;var t=window.performance||window.msPerformance;if(!t||!t.timing)return;return t.timing.navigationStart;}};e.exports=s;},null);