/*!CK:2259409106!*//*1432609919,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["8UGJr"]); }

__d("TimelinePageLoadParam",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={REQUEST_PARAM_NAME:"tipld",LAST_RANKED_UNIT_TIME:"rt",REPORT_UNIT_COUNT:"rc",STORY_UNIT_COUNT:"sc",VISIBLE_UNIT_COUNT:"vc"};},null);
__d("onViewportChanged",["EventListener","emptyFunction","getViewportDimensions","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=[],l=false,m=null,n,o;function p(){var aa=i.withoutScrollbars();return {top:0,bottom:aa.height,left:0,right:aa.width};}function q(aa,ba){var ca={transform:ba||h.thatReturnsArgument,callback:aa,needsUpdate:true};k.push(ca);x();s();return {remove:r.bind(null,ca),scheduleCheck:v.bind(null,ca)};}function r(aa){var ba=k.indexOf(aa);if(ba!==-1){k.splice(ba,1);if(k.length===0){t();m=null;}}}function s(){if(!o){o=g.listen(window,'scroll',w);n=g.listen(window,'resize',u);}}function t(){if(o){o.remove();n.remove();o=n=null;}}function u(){m=null;w();}function v(aa){aa.needsUpdate=true;x();}function w(){k.map(function(aa){return aa.needsUpdate=true;});x();}function x(){if(!l){l=true;j(function(){l=false;z();});}}function y(aa){if(aa.needsUpdate){aa.needsUpdate=false;return true;}return false;}function z(){if(!m)m=p();var aa=k.filter(y),ba=aa.map(function(ca){return ca.transform.call(null,m);});aa.forEach(function(ca,da){return ca.callback.call(null,ba[da]);});}e.exports=q;},null);
__d("onRectIsWithinViewport",["onViewportChanged"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(j,k){return !(j.bottom<k.top||j.top>k.bottom||j.right<k.left||j.left>k.right);}function i(j,k){var l;function m(o){var p=j();return !!p&&h(p,o);}function n(o){if(l!==o){l=o;k(o);}}return g(n,m);}e.exports=i;},null);
__d("OnVisible.react",["React","getElementRect","onRectIsWithinViewport","onlyChild"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes,m=g.createClass({displayName:"OnVisible",propTypes:{onVisible:l.func,onHidden:l.func,buffer:l.number},componentDidMount:function(){this._createListener();},componentDidUpdate:function(){this._createListener();},componentWillUnmount:function(){this._removeListener();},reset:function(){this._removeListener();this._createListener();},check:function(){if(this._listener)this._listener.scheduleCheck();},_measureElementRect:function(){if(!this.isMounted())return null;var n=this.props.buffer||0,o=h(g.findDOMNode(this));o.left-=n;o.right+=n;o.top-=n;o.bottom+=n;return o;},_createListener:function(){var n=g.findDOMNode(this);if(this._listener&&n!==this._element)this._removeListener();if(!this._listener){this._element=n;this._listener=i(this._measureElementRect,function(o){var p=o?this.props.onVisible:this.props.onHidden;p&&p();}.bind(this));}},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}},render:function(){return j(this.props.children);}});e.exports=m;},null);
__d("TimelineLoadState",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={NOT_LOADED:0,LOADING:1,LOADED:2};e.exports=g;},null);
__d("TimelineSectionStore",["TimelinePageLoadParam","KeyedCallbackManager","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=new h(),k='num_reports_tried',l='num_reports_visible',m='more_pager_data',n='finished',o={getDataToLoadNextSegment:function(p,q){j.executeOrEnqueue(p,function(r){this._mergeReportsAndStoriesDataCallback(r,q);}.bind(this));},setSectionFinished:function(p,q){var r=this._getSectionData(p);if(!r[n])r[n]={};r[n][q]=true;j.setResource(p,r);if(r[n].stories&&r[n].reports)this.emitAndHold('section_finished',p);},setReportsData:function(p,q,r){var s=this._getSectionData(p);s[k]=q;s[l]=r;j.setResource(p,s);},setStoriesData:function(p,q){var r=this._getSectionData(p);r[m]=q;j.setResource(p,r);},_getSectionData:function(p){var q=j.getResource(p);return q||{};},_mergeReportsAndStoriesDataCallback:function(p,q){var r=p[m];if(!r.hasOwnProperty(g.REQUEST_PARAM_NAME))r[g.REQUEST_PARAM_NAME]={};r[g.REQUEST_PARAM_NAME][g.REPORT_UNIT_COUNT]=p[k];var s=r[g.REQUEST_PARAM_NAME][g.VISIBLE_UNIT_COUNT];r[g.REQUEST_PARAM_NAME][g.VISIBLE_UNIT_COUNT]=s+p[l];q(r);}};i(o,{section_finished:true});e.exports=o;},null);
__d("TimelineSectionPager.react",["Arbiter","DataStore","Link.react","React","ReactComponentWithPureRenderMixin","TimelineConstants","TimelineLegacySections","TimelineLoadState","TimelineSectionStore","UIPagelet","FeedPlaceHolderStory.react","OnVisible.react","$","cx","keyMirror"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=j,w=v.PropTypes,x=null,y={},z=u({LINK:null,LOADING:null,ON_VISIBLE:null}),aa=500,ba=j.createClass({displayName:"TimelineSectionPager",_storeListener:x,_sectionLoadSubscription:x,mixins:[k],propTypes:{loadMoreLabel:w.string.isRequired,sectionKey:w.string.isRequired,rootID:w.string.isRequired},componentWillMount:function(){y[this.props.sectionKey]=this;this._storeListener=o.addListener('section_finished',this._handleSectionFinished);this._sectionLoadSubscription=g.subscribe(l.SECTION_FULLY_LOADED,this._handleSectionLoad);},getInitialState:function(){return {buffer:aa,pagerState:z.ON_VISIBLE};},render:function(){if(this.state.pagerState===z.LINK)return (j.createElement(i,{className:"_3g20",onClick:this._onPagerClick},this.props.loadMoreLabel));var ca=j.createElement(q,{className:"_lr_"});if(this.state.pagerState===z.LOADING)return ca;return (j.createElement(r,{buffer:this.state.buffer,onVisible:this._loadNextSegment},ca));},componentWillUnmount:function(){this._storeListener.remove();this._sectionLoadSubscription.unsubscribe();y[this.props.sectionKey]=null;},statics:{getInstance:function(ca){return y[ca];}},removeOnVisible:function(){this.setState({pagerState:z.LINK});},restoreOnVisible:function(){this.setState({pagerState:z.ON_VISIBLE});},unmount:function(){j.unmountComponentAtNode(s(this.props.rootID));},_onPagerClick:function(){var ca=m.get(this.props.sectionKey);if(ca)ca.activateContentScrollLoad();this._loadNextSegment();},_loadNextSegment:function(){var ca=m.get(this.props.sectionKey);if(ca&&ca.hasPendingCallbacks()){ca.runPendingDisplayCallbacks();this._onLoadComplete();}else this.setState({pagerState:z.LOADING},function(){return o.getDataToLoadNextSegment(this.props.sectionKey,this._nextSegmentDataHandler);}.bind(this));},_nextSegmentDataHandler:function(ca){var da=m.get(this.props.sectionKey);if(da){this._loadPagelet(ca);return;}var ea=g.subscribe(l.SECTION_REGISTERED,function(fa,ga){if(ga.scrubberKey===this.props.sectionKey){this._loadPagelet(ca);ea.unsubscribe();}}.bind(this));},_loadPagelet:function(ca){var da=ca.page_index,ea=m.get(this.props.sectionKey);if(!ea)return;var fa=ea.getPageLoadStatus(da);if(fa!==n.NOT_LOADED){this._enableNextPage();return;}var ga=function(ia){return this._pageletDisplay(da,ia);}.bind(this),ha={append:true,constHeight:true,crossPage:true,displayCallback:ga,finallyHandler:this._onLoadComplete,jsNonblock:true,usePipe:true};ea.setPageLoadStatus(da,n.LOADING);p.loadFromEndpoint('ProfileTimelineSectionPagelet',ca.unit_container_id,ca,ha);},_handleSectionFinished:function(ca){if(ca===this.props.sectionKey)this.unmount();},_handleSectionLoad:function(ca,da){if(da.scrubberKey===this.props.sectionKey){var ea=m.get(this.props.sectionKey),fa=0;if(ea&&!ea.isRightColumnFinished())fa=h.get(l.DS_COLUMN_HEIGHT_DIFFERENTIAL,this.props.sectionKey);this.setState({buffer:Math.abs(fa)+aa});}},_canScrollLoad:function(){var ca=m.get(this.props.sectionKey);return !!ca&&ca.canContentScrollLoad();},_onLoadComplete:function(){if(this.isMounted())this._enableNextPage();},_enableNextPage:function(){this.setState({pagerState:this._canScrollLoad()?z.ON_VISIBLE:z.LINK});},_pageletDisplay:function(ca,da){var ea=m.get(this.props.sectionKey);if(ea){ea.setPageLoadStatus(ca,n.LOADED);if(ea.canContentScrollLoad()){da();}else ea.queueDisplayCallback(ca,da);}}});e.exports=ba;},null);
__d("TimelineUnitSelector",["DOMQuery","csx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getUnitsWithTime:function(j){return g.scry(j,"._5jmm[data-time]");}};e.exports=i;},null);
__d("TimelineComposerUtilities",["Event","Arbiter","Bootloader","CSS","DOM","DOMQuery","Parent","TimelineUnitSelector","Vector","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=86400*31,r=86400000,s={listenToSetEstimatedDate:function(t,u){return h.subscribe('ComposerXTimelineTagger/init',function(v,w){if(l.contains(t,w.datePickerElement)){s.setEstimatedDate(w.datePickerInstance,u());w.composerTimelineTagger.switchToTagger('date');}});},listenToPublish:function(t,u){if(t.root)t=t.root;return h.subscribe('composer/publish',function(event,v){if(v.composer_id===t.id)i.loadModules(["TimelineStoryPublisher"],function(w){w.publish(v);u&&u();});});},listenToAnotherComposerOpen:function(t,u){return h.subscribe('composer/mutate',function(v,w){if(w!==t)u();});},listenToCancel:function(t,u){return g.listen(t,'click',function(event){if(m.byClass(event.getTarget(),"_306"))u();});},setEstimatedDate:function(t,u){var v,w;if(u&&j.hasClass(u,'fbTimelineCapsule')){v=u.getAttribute('data-start');w=u.getAttribute('data-end');if(v&&w){var x=new Date(w*1000),y=new Date();if(x>y){t.setDate(y.getFullYear(),y.getMonth()+1,y.getDate());}else if(w-v>2*q){t.setDate(x.getFullYear());}else t.setDate(x.getFullYear(),x.getMonth()+1);}return;}var z=m.byClass(u,'fbTimelineCapsule');if(z){v=z.getAttribute('data-start');w=z.getAttribute('data-end');var aa=o.getElementPosition(u).y,ba=[w,null],ca=[v,null],da=n.getUnitsWithTime(z);for(var ea=0;ea<da.length;ea++){var fa=da[ea],ga=k.scry(fa.parentNode,'.spinePointer')[0];if(!ga)continue;var ha=o.getElementPosition(ga).y;if(ha<=aa){if(!ba[1]||ha>ba[1])ba=[fa.getAttribute('data-time'),ha];}else if(!ca[1]||ha<ca[1])ca=[fa.getAttribute('data-time'),ha];}if(ba[0]!==null&&ca[0]!==null){var ia=Math.round((parseInt(ba[0],10)+parseInt(ca[0],10))/2)*1000;ia=Math.min(new Date()-r,ia);t.setDateWithTimestamp(ia);}}}};e.exports=s;},null);
__d("TimelineSection",["Arbiter","CSS","DOM","Parent","ScrollingPager","TimelineConstants","TimelineLegacySections","TimelineLoadState","TimelineScrubberKey","UIPagelet","TimelineSectionPager.react","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v,w,x){"use strict";this.$TimelineSection0=t;this.$TimelineSection1=w;this.$TimelineSection2=u;this.$TimelineSection3=null;this.$TimelineSection4=null;this.$TimelineSection5=true;this.$TimelineSection6=true;this.$TimelineSection7=u!==o.RECENT_ACTIVITY;this.$TimelineSection8=x;this.$TimelineSection9=v;this.$TimelineSectiona={};this.$TimelineSectionb=false;this.$TimelineSectionc=[];this.$TimelineSectiond=false;this.$TimelineSectione=[];}s.prototype.load=function(t,u){"use strict";if(this.$TimelineSection1){this.activateContentScrollLoad();return;}var v=this.$TimelineSection9;g.inform(l.SECTION_LOADING,{data:v,scrubberKey:this.$TimelineSection2});this.$TimelineSection1=true;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');var w='ProfileTimelineSectionPagelet',x=this.$TimelineSection2===o.WAY_BACK;if(x)w='ProfileTimelineRemainingYearsPagelet';var y=m.shouldForceNoFriendActivity();v=r(v,{highlight_unit_data:t,parent_key:this.$TimelineSection3,force_no_friend_activity:y});h.addClass(this.$TimelineSection0,'fbTimelineSectionLoading');this.$TimelineSection5=false;this.activateContentScrollLoad();var z=null;if(u){this.$TimelineSection0.style.minHeight=window.innerHeight+'px';z=function(){this.$TimelineSection0.style.minHeight='';m.destroyOnVisible(this.$TimelineSection2);}.bind(this);}m.addLoadPagelet(this.$TimelineSection2,p.loadFromEndpoint(w,this.$TimelineSection0.id,v,{usePipe:true,jsNonblock:true,constHeight:true,append:false,finallyHandler:z}));m.collapsePlaceHolderHeaders();};s.prototype.preload=function(){"use strict";h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');var t=i.find(this.$TimelineSection0,'span.sectionLabel');if(t.getAttribute('data-original-label')){i.setContent(t,t.getAttribute('data-original-label'));t.removeAttribute('data-original-label');}};s.prototype.unload=function(){"use strict";if(!this.$TimelineSection1||!this.$TimelineSection7)return;this.$TimelineSection1=false;m.cancelLoadPagelet(this.$TimelineSection2);h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');if(this.$TimelineSection0.nextSibling&&h.hasClass(this.$TimelineSection0.nextSibling,'fbTimelineSection')){i.setContent(this.$TimelineSection0,this.$TimelineSection0.nextSibling);h.show(this.$TimelineSection0.firstChild);}else i.empty(this.$TimelineSection0);this.deactivateScrollLoad();};s.prototype.canScrollLoad=function(){"use strict";return this.$TimelineSection5;};s.prototype.activateScrollLoad=function(){"use strict";this.$TimelineSection5=true;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');var t=m.getOnVisible(this.$TimelineSection2);if(t)t.reset();return this;};s.prototype.deactivateScrollLoad=function(){"use strict";if(!this.$TimelineSection1){this.$TimelineSection5=false;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');var t=m.getOnVisible(this.$TimelineSection2);if(t)t.remove();}i.scry(this.$TimelineSection0,'.fbTimelineSectionExpandPager').forEach(function(u){var v=k.getInstance(u.id);v&&v.removeOnVisible();var w=j.byClass(u,'stat_elem');if(w)h.removeClass(w,'async_saving');});return this;};s.prototype.canContentScrollLoad=function(){"use strict";return this.$TimelineSection6;};s.prototype.activateContentScrollLoad=function(){"use strict";this.$TimelineSection6=true;var t=q.getInstance(this.$TimelineSection2);if(t)t.restoreOnVisible();return this;};s.prototype.deactivateContentScrollLoad=function(){"use strict";this.$TimelineSection6=false;var t=q.getInstance(this.$TimelineSection2);if(t)t.removeOnVisible();return this;};s.prototype.removeSectionPager=function(){"use strict";var t=q.getInstance(this.$TimelineSection2);if(t)t.unmount();return this;};s.prototype.getNode=function(){"use strict";return this.$TimelineSection0;};s.prototype.getScrubberKey=function(){"use strict";return this.$TimelineSection2;};s.prototype.getParentKey=function(){"use strict";return this.$TimelineSection3;};s.prototype.setParentKey=function(t){"use strict";this.$TimelineSection3=t;return this;};s.prototype.addSubSection=function(t,u){"use strict";if(!Array.isArray(this.$TimelineSection4))this.$TimelineSection4=[];if(Array.isArray(this.$TimelineSection4))this.$TimelineSection4[t]=u;return this;};s.prototype.getSubSections=function(){"use strict";return this.$TimelineSection4;};s.prototype.isLoaded=function(){"use strict";return this.$TimelineSection1;};s.prototype.isRightColumnFinished=function(){"use strict";return this.$TimelineSectionb;};s.prototype.setRightColumnFinished=function(){"use strict";this.$TimelineSectionb=true;return this;};s.prototype.getHistoricUnitCount=function(){"use strict";return this.$TimelineSection8;};s.prototype.setExpandLoadData=function(t){"use strict";this.$TimelineSectiona=t;return this;};s.prototype.expand=function(t){"use strict";if(!this.$TimelineSection1)return this;var u=i.find(this.$TimelineSection0,'.fbTimelineSectionExpander');h.addClass(u.firstChild,'async_saving');t&&h.addClass(t,'async_saving');g.inform(l.SECTION_EXPAND,this.$TimelineSection2);i.scry(this.$TimelineSection0,'.fbTimelineCapsule').forEach(i.remove);this.$TimelineSectiona.new_expand=true;m.cancelLoadPagelet(this.$TimelineSection2);m.addLoadPagelet(this.$TimelineSection2,p.loadFromEndpoint('ProfileTimelineSectionPagelet',u.id,this.$TimelineSectiona,{usePipe:true,jsNonblock:true,constHeight:true}));return this;};s.prototype.isPermalinkPeriod=function(){"use strict";return !!this.$TimelineSection9.is_permalink_period;};s.prototype.isHidden=function(){"use strict";return this.$TimelineSectiond;};s.prototype.hide=function(){"use strict";this.$TimelineSectiond=true;h.hide(i.find(this.$TimelineSection0,'.fbTimelineSection'));return this;};s.prototype.isHiddenFromView=function(){"use strict";return (!this.$TimelineSection1||this.$TimelineSectiond||h.hasClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded'));};s.prototype.hasPendingCallbacks=function(){"use strict";return this.$TimelineSectionc.length>0;};s.prototype.queueDisplayCallback=function(t,u){"use strict";this.$TimelineSectionc[t]=u;return this;};s.prototype.runPendingDisplayCallbacks=function(){"use strict";while(this.hasPendingCallbacks()){var t=this.$TimelineSectionc.shift();if(t)t();}return this;};s.prototype.setPageLoadStatus=function(t,u){"use strict";this.$TimelineSectione[t]=u;return this;};s.prototype.getPageLoadStatus=function(t){"use strict";if(this.$TimelineSectione[t]===(void 0))this.$TimelineSectione[t]=n.NOT_LOADED;return this.$TimelineSectione[t];};e.exports=s;},null);
__d("TimelineContentLoader",["Arbiter","CSS","DOM","DOMScroll","Event","OnVisible","Parent","ScrollingPager","TimelineComponentKeys","TimelineConstants","TimelineController","TimelineDOMID","TimelineLegacySections","TimelineScrubberKey","TimelineSection","TimelineSectionStore","TimelineSmartInsert","Vector","$","arrayContains","copyProperties","createArrayFromMixed","csx","debounce","ge","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){b.__markCompiled&&b.__markCompiled();var ga=false,ha=null,ia={},ja={},ka=[],la={},ma=null,na=null,oa=null,pa=80,qa=250,ra=500;function sa(){if(ga)return;q.register(o.CONTENT,ya);na=g.subscribe(p.SECTION_EXPAND,function(za,ab){ya.navigateToSection(ab);});oa=v.addRetroactiveListener('section_finished',va);ga=true;}var ta=da(function(za,ab,bb){var cb=s.get(za).getHistoricUnitCount();ab-=cb;bb-=1;if(cb==-1||bb<=0||ab<0)return;var db=ya.getNextSectionKey(za);if(db){s.get(db).load();ta(db,ab,bb);}},ra);function ua(za,ab){if(!ab)ab=0;if(ab<pa&&!za())setTimeout(ua.bind(null,za,ab+1),qa);}function va(za){ua(function(){if(za===t.WAY_BACK)return true;var ab=ya.getNextSectionKey(za);if(ab){xa(ab);return true;}return false;});}function wa(za,ab,bb){ua(function(){if(ab===t.WAY_BACK)return true;var cb=ya.getNextSectionKey(ab);if(cb){s.addOnVisible(cb,new l(za,xa.bind(null,cb),false,bb||1000));return true;}return false;});}function xa(za){var ab=s.get(za);if(ab&&ab.canScrollLoad()){ab.load();if(ma)ta(za,ma.required_units,ma.max_parallelism);}}var ya={CURRENT_SECTION_OFFSET:150,registerTimePeriod:function(za,ab,bb,cb,db,eb,fb){sa();if(z(ka,ab))return;if(ja)aa(bb,ja);var gb=new u(za,ab,bb,cb,fb);if(!db){s.setMainSectionOrder(ab,eb);ia[ab]=true;}else{gb.setParentKey(db);var hb=s.get(db);if(hb)hb.addSubSection(eb,gb);}s.set(ab,gb);ya.checkCurrentSectionChange();g.inform(p.SECTION_REGISTERED,{scrubberKey:ab,section:gb});},reset:function(){s.removeAllOnVisibles();s.cancelLoadPagelets();for(var za in la){la[za].unsubscribe();delete la[za];}na&&na.unsubscribe();na=null;oa&&oa.remove();oa=null;s.removeAll();ha=null;ia={};ja={};ka=[];ga=false;},checkCurrentSectionChange:function(){var za=null;fa(function(){za=ya.getCurrentSection();},function(){var ab=ha&&ha.getScrubberKey();if(za&&za.getScrubberKey()!==ab&&!za.isPermalinkPeriod()){ha=za;var bb=za.getScrubberKey(),cb=za.getParentKey();if(!cb){cb=bb;bb=null;}q.sectionHasChanged(cb,bb);}});},setParallelLoadConfig:function(za){ma=za;},getCurrentSection:function(){var za={},ab=s.getAll();for(var bb in ab){var cb=ab[bb];if(!cb||cb.isHiddenFromView())continue;var db=x.getElementPosition(cb.getNode(),'viewport').y;if(cb.getScrubberKey()===t.RECENT_ACTIVITY)db--;if(db<ya.CURRENT_SECTION_OFFSET)za[db]=cb;}var eb=Math.max.apply(null,Object.keys(za)),fb=s.getMainSectionOrder(),gb=eb==-Infinity;if(!gb){return za[eb];}else if(fb[0])return s.get(fb[0]);return null;},getLastVisibleSection:function(){var za=s.getMainSectionOrder();for(var ab=za.length-1;ab>=0;ab--){var bb=s.get(za[ab]);if(bb&&!bb.isHiddenFromView())return bb;}return null;},getRecentActivitySection:function(){return s.get(t.RECENT_ACTIVITY);},capsuleForCurrentSection:function(){var za=ya.getCurrentSection();return za&&i.scry(za.getNode(),'.fbTimelineCapsule')[0];},enableScrollLoad:function(za,ab,bb,cb){za=y(za);var db=m.byClass(za,'fbTimelineSection')||za.parentNode,eb=db&&i.scry(db,'.fbTimelineCapsule')[0];if(!eb)return;if(bb===null){wa(za,ab,cb);}else q.runOnceWhenSectionFullyLoaded(wa.bind(null,za,ab,cb),ab,bb);},expandSectionOnClick:function(za,ab){k.listen(za,'click',function(bb){bb.prevent();s.get(ab).expand();});},expandSubSectionsOnClick:function(za,ab){k.listen(za,'click',function(bb){bb.prevent();s.cancelLoadPagelet(ab);var cb=s.get(ab),db=cb.getSubSections();if(db&&db.length)ya.navigateToSection(db[0].getScrubberKey());});},getNextSectionKey:function(za){var ab=s.getMainSectionOrder();for(var bb=0;bb<ab.length-1;bb++)if(ab[bb]==za){while(bb<ab.length-1&&!ab[bb+1])bb++;return ab[bb+1];}var cb=s.get(za);if(!cb||!cb.getParentKey())return;var db=s.get(cb.getParentKey());if(!db)return;var eb=db.getSubSections();for(var fb=0;fb<eb.length-1;fb++)if(eb[fb].getScrubberKey()==za)return eb[fb+1].getScrubberKey();},hideSection:function(za){var ab=s.get(za);if(ab)ab.hide();var bb=q.getCurrentScrubber();if(bb){var cb=null;if(!ia[za]){cb=q.getCurrentScrubber().getSubnav(ab.getParentKey(),za);}else cb=q.getCurrentScrubber().getNav(za);cb&&h.hide(cb);}var db=q.getCurrentStickyHeaderNav();db&&db.removeTimePeriod(za);},loadSectionOnClick:function(za,ab){k.listen(za,'click',function(bb){bb.prevent();s.get(ab).load();});},removeSection:function(za){s.removeOnVisible(za);s.remove(za);delete ia[za];var ab=q.getCurrentStickyHeaderNav();ab&&ab.removeTimePeriod(za);ka.push(za);},removeSectionParent:function(za){i.remove(y(za).parentNode);},navigateToSection:function(za,ab,bb){ab=!!ab;var cb=za,db=s.get(za);if(!db)return;if(!db.isLoaded()){w.enable();i.scry(y(r.TAB_CONTENT),'.fbTimelineShowOlderSections').forEach(i.remove);}if(!ia[za]){if(!db.isLoaded())db.getNode().style.minHeight=x.getViewportDimensions().y+'px';var eb=g.subscribe(p.SECTION_FULLY_LOADED,function(ob,pb){if(pb.scrubberKey===za){db.getNode().style.minHeight='';eb.unsubscribe();}});cb=db.getParentKey();var fb=s.get(cb);if(fb){var gb=fb.getNode();fb.removeSectionPager();if(!h.hasClass(gb,'fbTimelineSectionExpanded')){j.scrollTo(gb,0);h.addClass(gb,'fbTimelineSectionExpanded');i.scry(gb,'.fbTimelineCapsule').forEach(i.remove);i.scry(gb,'div.fbTimelineSectionExpandPager').forEach(i.remove);i.scry(gb,'div.fbTimelineContentHeader').forEach(i.remove);i.scry(gb,"._5vf").forEach(function(ob){if(!ob.getAttribute('data-subsection'))i.remove(ob);});}}var hb=ya.getNextSectionKey(cb),ib=s.getOnVisible(hb);if(ib)ib.setBuffer(0);}var jb=s.getMainSectionOrder();for(var kb=0;kb<jb.length;kb++){var lb=jb[kb];if(!lb)continue;if(lb==cb)break;s.get(lb).deactivateScrollLoad().deactivateContentScrollLoad();}db.load(bb,true);s.collapsePlaceHolderHeaders();var mb=x.getScrollPosition().x,nb=x.getElementPosition(db.getNode()).y;if(!ab)j.scrollTo(new x(mb,nb-p.SCROLL_TO_OFFSET,'document'),true,false,false,0,function(){var ob=x.getElementPosition(db.getNode()).y;j.scrollTo(new x(mb,ob-p.SCROLL_TO_OFFSET,'document'),false);var pb=i.scry(db.getNode(),'h3.uiHeaderTitle')[0];if(pb){pb.tabIndex=0;pb.focus();}});},appendContentAfterLoad:function(za,ab,bb){q.runOnceWhenSectionFullyLoaded(i.appendContent.bind(null,y(za),ab),bb,'0');},markSectionAsLoaded:function(za,ab,bb){q.runOnceWhenSectionFullyLoaded(function(){ea(za)&&h.removeClass(y(za).parentNode,'fbTimelineSectionLoading');},ab,bb);},suppressSectionsAbove:function(za){var ab,bb,cb=s.getMainSectionOrder();for(var db=0;db<cb.length;db++){var eb=cb[db];if(!eb)continue;ab=s.get(eb).getNode();bb=null;if(ba(za.parentNode.children).indexOf(za)<=ba(ab.parentNode.children).indexOf(ab)){bb=eb;break;}s.get(eb).deactivateScrollLoad();}if(bb)ya.navigateToSection(bb,true);},forceNoFriendActivity:function(){s.forceNoFriendActivity();},removeDupes:function(za){var ab=ea(za);if(!ab)return;var bb=i.scry(ab,'li.fbTimelineUnit'),cb={};for(var db=0;db<bb.length;db++){var eb=bb[db];if(eb.id&&eb.id.startsWith('tl_unit_')){var fb=eb.id.substring(8,eb.id.length),gb=i.scry(eb,'div.timelineUnitContainer');if(gb.length>0)fb=fb+gb[0].getAttribute('data-time');if(cb.hasOwnProperty(fb)){eb.id='dupe_unit_'+Math.random();eb.className="hidden_elem";}else cb[fb]=1;}}},removeLoadingState:function(za){ea(za)&&h.removeClass(y(za),'fbTimelineSectionLoading');},setExpandLoadDataForSection:function(za,ab){var bb=s.get(za);bb&&bb.setExpandLoadData(ab);},updatePagerAfterLoad:function(za,ab,bb,cb,db){var eb=n.getInstance(za.firstChild.id);if(!eb){la[za.firstChild.id]=g.subscribe(n.REGISTERED,function(gb,hb){la[za.firstChild.id].unsubscribe();delete la[za.firstChild.id];if(hb.id===za.firstChild.id)ya.updatePagerAfterLoad(za,ab,bb,cb,db);});return;}var fb=eb.getHandler();eb.setHandler(function(gb){h.addClass(za,'async_saving');fb(gb);});q.runOnceWhenSectionFullyLoaded(function(){h.removeClass(za,'fbTimelineHiddenPager');eb.checkBuffer();},bb,cb);if(db)q.runOnceWhenSectionFullyLoaded(q.adjustScrollingPagerBuffer.bind(null,za.firstChild.id,bb),bb,cb);},repositionDialog:function(za){g.subscribe(p.SECTION_LOADED,function(){za.updatePosition();});},rightColumnFinished:function(za){var ab=s.get(za);ab.setRightColumnFinished();},addUnrankedUnits:function(za){var ab=y(za),bb=i.scry(ab,'li.fbTimelineUnit');for(var cb=bb.length-1;cb>=0;cb--){var db=bb[cb];i.insertAfter(ab,db);h.addClass(i.find(db,'div.timelineUnitContainer'),'fbTimelineHighlightUnit');}i.remove(ab);},addUnrankedStories:function(za){var ab=y(za),bb=i.scry(ab,"._5pat");for(var cb=bb.length-1;cb>=0;cb--){var db=bb[cb];i.insertAfter(ab,db);}i.remove(ab);g.inform('Timeline/unrankedStoriesLoaded');}};e.exports=ya;},null);