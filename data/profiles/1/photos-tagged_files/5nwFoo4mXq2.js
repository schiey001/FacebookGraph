/*!CK:2004049085!*//*1432611609,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["PHVGp"]); }

__d("MNCommerceErrors",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ALREADY_UNLINKED:1893001};},null);
__d("MNCommerceReplyTypes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={COMMERCE_LINK:2};},null);
__d("P2PPaymentLogMessageSubtype",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SENT_IN_GROUP:"sent_in_group",CANCELED_SENDER_RISK:"canceled_sender_risk",CANCELED_DECLINED:"canceled_declined",CANCELED_RECIPIENT_RISK:"canceled_recipient_risk",CANCELED_EXPIRED:"canceled_expired",CANCELED_SAME_CARD:"canceled_same_card",CANCELED_CUSTOMER_SERVICE:"canceled_customer_service",CANCELED_CHARGEBACK:"canceled_chargeback",CANCELED_SYSTEM_FAIL:"canceled_system_fail"};},null);
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","TypingDetector","TypingStates","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v,w,x,y){"use strict";this.userID=t;this.input=u;this.source=v;this.threadID=x;this.remoteState=n.INACTIVE;this.notifyTimer=null;w=w||{};this.notifyDelay=w.notifyDelay||this.notifyDelay;this._typingDetector=new m(u,y);this._typingDetector.init(w);this._typingDetector.subscribe('change',this._stateChange.bind(this));}s.prototype.setUserAndThread=function(t,u){"use strict";if(this.userID!==t||this.threadID!==u){this.resetState();this.userID=t;this.threadID=u;}};s.prototype.setIgnoreEnter=function(t){"use strict";var u=t?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(u);};s.prototype.resetState=function(){"use strict";this._notifyState(n.INACTIVE);this.remoteState=n.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};s.prototype.destroy=function(){"use strict";this.resetState();this._typingDetector.destroy();};s.prototype._stateChange=function(t,u){"use strict";if(u!=n.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=q(r(this._notifyState,this,u),this.notifyDelay);}else this._notifyState(u,true);};s.prototype._notifyState=function(t,u){"use strict";if((!this.userID&&!this.threadID)||!k.isOnline()||t===this.remoteState||j.disconnected())return;this._sendRequest(t,this.userID,u);};s.prototype._sendRequest=function(t,u,v){"use strict";this.remoteState=t;var w={typ:t,to:u,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,u)).setErrorHandler(p).setData(w).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!v).send();};s.prototype._onTypResponse=function(t,u){"use strict";var v=u.getPayload()||{};if(v.offline)h.set(t,i.OFFLINE,'typing_response');};o(s.prototype,{notifyDelay:1000});e.exports=s;},null);
__d("MercuryMessageError.react",["CurrentUser","ImmutableObject","MercuryErrorInfo","MercuryMessageActions","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=k,o=n.PropTypes,p=k.createClass({displayName:"MercuryMessageError",propTypes:{authorFBID:o.string,message:o.instanceOf(h).isRequired},getDefaultProps:function(){return {authorFBID:g.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (k.createElement("div",k.__spread({},this.props,{className:m(this.props.className,this._getClassNameFromStatus(q)),tabIndex:i.isTransient(r)?0:null,onClick:i.isTransient(r)?this.messageResend:null}),k.createElement("div",{className:"_2fs1"}),k.createElement("span",{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){j.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(i.hasErrorStatus(q)){return (("_2fs2")+(' '+"_2fs3")+(i.isTransient(q.error_data)?' '+"_2fs4":'')+(i.isPermanent(q.error_data)?' '+"_2fs5":''));}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(i.hasErrorStatus(q))r=i.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});e.exports=p;},null);
__d("WaterfallIDGenerator",["CurrentUser","md5"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.getID(),j(),i()].join(':'));}};e.exports=k;},null);
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;},null);
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this._form=k;}j.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};j.prototype._submit=function(){"use strict";i(this._form.getRoot());};h(j.prototype,{_listener:null});e.exports=j;},null);
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=x(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(ea,fa,ga,ha){"use strict";this.$MercuryFileUploader0=ea;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.$MercuryFileUploader9={};this.updateElements(fa,ga,ha);}ca.prototype.updateElements=function(ea,fa,ga){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploadera=new t();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.$MercuryFileUploaderb=new l(ea,[o,m]);this.$MercuryFileUploaderb.setAllowCrossOrigin(true);this.$MercuryFileUploaderb.setUploadInParallel(true);var ha=j.find(ea,"._4q60"),ia=j.find(ha,"._4q61");new n(ha,ia,fa);this.$MercuryFileUploadera.addSubscriptions(this.$MercuryFileUploaderb.subscribe('submit',function(){var ja={count:0,file_sizes:[]};if(fa.files){for(var ka=0;ka<fa.files.length;ka++)if(fa.files[ka].size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var la={};for(var ma=0;ma<fa.files.length;ma++){var na=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(na,fa.files[ma].name);ja.count++;ja.file_sizes.push(fa.files[ma].size);la[na]=fa.files[ma];}this.$MercuryFileUploaderb.setFiles(la);}else{ga.value=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga.value,fa.value);ja.count=1;}this.inform('submit',ja);}.bind(this)),this.$MercuryFileUploaderb.subscribe('success',this.$MercuryFileUploadere.bind(this)),this.$MercuryFileUploaderb.subscribe('failure',this.$MercuryFileUploaderf.bind(this)),k.listen(ia,'click',y(this.inform,this,'open')));};ca.prototype.showAttachmentSizeErrorDialog=function(){"use strict";this.$MercuryFileUploaderb.abort();this.$MercuryFileUploaderb.clear();new i().setTitle(v._("The file you have selected is too large")).setBody(v._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(i.OK).setSemiModal(true).show();};ca.prototype.addDroppedFiles=function(ea){"use strict";if(!this.$MercuryFileUploaderb||!this.$MercuryFileUploaderb.canUseXHR())return;var fa={},ga={count:0,file_sizes:[]};for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia.size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var ja=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ja,ia.name);fa[ja]=ia;ga.file_sizes.push(ia.size);ga.count++;}this.$MercuryFileUploaderb.setFiles(fa);this.$MercuryFileUploaderb.forceSendViaXHR();this.inform('submit',ga);};ca.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader7).length;};ca.prototype.addCachedAttachments=function(ea){"use strict";ea.forEach(function(fa){var ga=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga,fa.filename);this.$MercuryFileUploaderg(ga,fa);}.bind(this));};ca.prototype.addCachedImageFiles=function(ea){"use strict";var fa=v._("Photo");ea.forEach(function(ga){var ha=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ha,fa);this.$MercuryFileUploaderg(ha,{filename:ga,image_id:ga,filetype:'image/jpeg'});}.bind(this));};ca.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ca.prototype.getImageFiles=function(){"use strict";var ea=Object.keys(this.$MercuryFileUploader2).sort(),fa=[];ea.forEach(function(ga){return fa.push(this.$MercuryFileUploader2[ga]);}.bind(this));return fa;};ca.prototype.getAnimatedImageFiles=function(){"use strict";return w(this.$MercuryFileUploader3);};ca.prototype.getVideoFiles=function(){"use strict";return w(this.$MercuryFileUploader4);};ca.prototype.getAudioFiles=function(){"use strict";return w(this.$MercuryFileUploader5);};ca.prototype.getFiles=function(){"use strict";return w(this.$MercuryFileUploader6);};ca.prototype.removeAttachments=function(){"use strict";if(this.$MercuryFileUploader0)j.empty(this.$MercuryFileUploader0);this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader8={};this.$MercuryFileUploader7={};this.$MercuryFileUploader9={};if(this.$MercuryFileUploader0)h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.destroy=function(){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.removeAttachments();};ca.prototype.$MercuryFileUploaderd=function(ea,fa){"use strict";var ga=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader8[ea]=ga;this.$MercuryFileUploader7[ea]=true;this.$MercuryFileUploader9[ea]=Date.now();j.appendContent(ga.getNode('iconText'),da(fa));k.listen(ga.getNode('closeFileUpload'),'click',this.$MercuryFileUploaderh.bind(this,ea));if(this.$MercuryFileUploader0){j.appendContent(this.$MercuryFileUploader0,ga.getRoot());h.show(this.$MercuryFileUploader0);}this.inform('dom-updated');};ca.prototype.$MercuryFileUploaderh=function(ea,event){"use strict";if(this.$MercuryFileUploader7[ea]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ea]||this.$MercuryFileUploader2[ea]||this.$MercuryFileUploader3[ea]||this.$MercuryFileUploader4[ea]||this.$MercuryFileUploader5[ea]||this.$MercuryFileUploader6[ea])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ea];delete this.$MercuryFileUploader2[ea];delete this.$MercuryFileUploader3[ea];delete this.$MercuryFileUploader4[ea];delete this.$MercuryFileUploader5[ea];delete this.$MercuryFileUploader6[ea];delete this.$MercuryFileUploader7[ea];delete this.$MercuryFileUploader9[ea];var fa=this.$MercuryFileUploader8[ea];delete this.$MercuryFileUploader8[ea];if(fa){j.remove(fa.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ca.prototype.$MercuryFileUploaderi=function(ea,fa){"use strict";var ga=this.$MercuryFileUploader8[ea],ha=p.getAttachIconClassByMime(fa);h.addClass(ga.getNode('iconText'),ha);h.addClass(ga.getRoot(),'done');};ca.prototype.$MercuryFileUploaderg=function(ea,fa){"use strict";if(this.$MercuryFileUploader7[ea]){delete this.$MercuryFileUploader7[ea];if(fa.image_id){this.$MercuryFileUploader2[ea]=fa.image_id;}else if(fa.gif_id){this.$MercuryFileUploader3[ea]=fa.gif_id;}else if(fa.video_id){this.$MercuryFileUploader4[ea]=fa.video_id;}else if(fa.audio_id){this.$MercuryFileUploader5[ea]=fa.audio_id;}else if(fa.file_id){this.$MercuryFileUploader6[ea]=fa.file_id;}else this.$MercuryFileUploader1[ea]=fa;this.$MercuryFileUploaderi(ea,fa.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader9[ea]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ca.prototype.$MercuryFileUploadere=function(event,ea){"use strict";var fa=ea.response.getPayload();this.$MercuryFileUploaderg(this.$MercuryFileUploaderj(ea),fa.metadata[0]);};ca.prototype.$MercuryFileUploaderf=function(event,ea){"use strict";this.inform('one-upload-failed');this.$MercuryFileUploaderh(this.$MercuryFileUploaderj(ea),event);};ca.prototype.$MercuryFileUploaderc=function(){"use strict";return 'upload_'+s.getNewID();};ca.prototype.$MercuryFileUploaderj=function(ea){"use strict";var fa=ea.response.getPayload();if(ea.upload){return ea.upload.getName();}else return fa.uploadID;};function da(ea){if(ea&&ea.startsWith('C:\\fakepath\\'))return ea.substring(12);return ea;}e.exports=ca;},null);
__d("URLScraper",["ArbiterMixin","DataStore","Event","URLMatcher","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m='scraperLastPermissiveMatch',n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s){"use strict";this.input=r;this.enable();this.getValueFn=s;}q.prototype.reset=function(){"use strict";h.set(this.input,m,null);};q.prototype.enable=function(){"use strict";if(this.events)return;var r=function(s){setTimeout(this.check.bind(this,s),30);};this.events=i.listen(this.input,{paste:r.bind(this,false),keydown:r.bind(this,true)});};q.prototype.disable=function(){"use strict";if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;};q.prototype.check=function(r){"use strict";var s=this.getValueFn?this.getValueFn():this.input.value;if(r&&q.trigger(s))return;var t=q.match(s),u=j.permissiveMatch(s);if(u&&(u!=h.get(this.input,m))){h.set(this.input,m,u);this.inform('match',{url:t||u,alt_url:u});}};k(q,j);e.exports=q;},null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Event","Form","URLScraper","WebMessengerEvents","mixin","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=o(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v,w,x,y){"use strict";this.$MercuryShareLinkUploader0=u;this.$MercuryShareLinkUploader1=v;this.$MercuryShareLinkUploader2=w;this.$MercuryShareLinkUploader3=y;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;k.listen(x,'click',this.close.bind(this));k.listen(y,'keyup',function(){!y.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new m(y);this.$MercuryShareLinkUploader7.subscribe('match',function(z,aa){this.loadShare(aa&&aa.url);}.bind(this));}t.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};t.prototype.getShareDataFromStage=function(u,v){"use strict";var w=l.serialize(v),x=w.attachment&&w.attachment.params;if(!x)return null;if(x instanceof Object){var y=[];y.push(x[0]);y.push(x[1]);x=y;}return {params:x,type:w.attachment.type};};t.prototype.loadAttachData=function(u,v,w,x){"use strict";if(u){var y=l.serialize(v),z=y.attachment&&y.attachment.params,aa=y.link_metrics?y.link_metrics.no_image:true;if(!z||p(z))return null;var ba=x?x():w.value;if(ba.indexOf(z.url)===-1)return y;if(!z.summary&&!z.favicon&&aa&&z.title&&z.url&&z.url.substr(0,z.title.length)===z.title)return null;return y;}return null;};t.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};t.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};t.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};t.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};t.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};t.prototype.loadShare=function(u){"use strict";this.$MercuryShareLinkUploader5=u;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,u)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};t.prototype.$MercuryShareLinkUploader9=function(u,v){"use strict";if(this.$MercuryShareLinkUploader5!==u)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,v.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}n.detailDOMChanged();};t.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();n.detailDOMChanged();};e.exports=t;},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} messaged {groupName}",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} messaged you",[j.param("name",s.short_name)]));});}else o(j._("New message!"));});});}e.exports={renderDocumentTitle:m};},null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;},null);
__d("ChatTitleBarBlinker",["ChatActivity","ChatConfig","DocumentTitle","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreadInformer').get(),n=b('MercuryTimestampTracker').get(),o=j.create('chat_title'),p=null,q=0,r=false;function s(){if(p){p.stop();p=null;return true;}return false;}function t(y){var z=y||n.getLastUserMessageTimestamp();if(q<=z){q=z;if(s()||r)l.doSync();}}var u={blink:function(y,z){if(h.get('remove_notification_blink'))return;if(!p&&q<z)k.renderDocumentTitle(y,function(aa){if(!p)p=i.blink(aa);});},stopBlinking:function(){t();},blinkingElsewhere:function(){r=true;}};function v(y){var z=l.verifyNumber(y.sb2);if(!z||z<=q)return null;return z;}function w(y){var z=y&&v(y);if(z){q=z;o.debug('load',q);s();r=false;}}function x(y){var z=v(y);if(!z){o.debug('store',q);y.sb2=q;r=false;}return y;}l.registerStateStorer(x);l.registerStateLoader(w);m.subscribe('thread-read-changed',function(y,z){var aa=n.getLastUserMessageTimestamp(),ba=0;for(var ca in z)if(z[ca].mark_as_read&&z[ca].timestamp>=aa&&z[ca].timestamp>ba)ba=z[ca].timestamp;ba&&t(ba);});g.subscribe('activity',function(){t();});(function(){var y=l.getInitial();if(y)q=v(y)||0;})();e.exports=u;},null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryThreadInfo","MercuryViewer","MessagingTag","Sound","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=b('MercuryThreads').get();o.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))o.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(m.isViewer(t.author)||!t.is_unread||(t.folder!=n.INBOX&&t.folder!=n.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}q.getThreadMeta(u,function(x){var y=l.isMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=p(s,g);},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={init:function(){g.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(i,j,k){var l=k.getInstance();i.subscribe(i.SEND,function(){j.logSavedSummaries(l);});});}};e.exports=h;},null);
__d("FBRTCAvailability",["ChannelConstants","PresenceStatus","RTCConfig"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={isCallable:function(k){var l=h.getCapabilities(k),m=g.CAPABILITY_VOIP_INTEROP|g.CAPABILITY_VIDEO;return !!(l&m);},isMDotComCallable:function(k){if(i.MobileFriendsCallableGk)return this.isCallable(k.fbid)||!!(k.is_friend&&k.is_messenger_user);return this.isCallable(k.fbid);}};e.exports=j;},null);
__d("FBRTCStruct",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=function(i,j,k){var l,m;if(typeof i=='string'||i instanceof String){m=i;l=i;}else for(var n in i)if(i.hasOwnProperty(n))if(n==='index'){k=i[n];}else{m=n;l=i[n];}j[m]=k;j.strNames[k]=l;};function h(i){"use strict";this.strNames=[];for(var j=0;j<i.length;j++)g(i[j],this,j);}e.exports=h;},null);
__d("FBRTCConstants",["FBRTCStruct"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',SDP_UPDATE:'sdp_update',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video',VIDEO_REQUEST:'video_request',ACK:'ack'},i=new g([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),j={TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,START_CALL:9},k={PayloadType:h,CallEndReason:i,UIEventType:j,endCallReasonFromString:function(l){return i.strNames.indexOf(l);},callEndReasonString:function(l){if(l<0||l>i.strNames.length)return 'Unknown';return i.strNames[l];},fullCallEndReasonString:function(l,m){return this.callEndReasonString(l)+'_'+(m?'remote':'local');}};e.exports=k;},null);
__d("FBRTCIceStatsParser",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=null;h.getInstance=function(){"use strict";if(!g)g=new h();return g;};function h(){"use strict";}h.prototype.extractIceInfo=function(i){"use strict";var j=[],k=i.split("\r\n");for(var l=0;l<k.length;l++){var m=k[l];if(this.$FBRTCIceStatsParser0(m))j.push({gen:this.$FBRTCIceStatsParser1(m),type:this.$FBRTCIceStatsParser2(m)});}return j;};h.prototype.$FBRTCIceStatsParser0=function(i){"use strict";return (i.indexOf('candidate:')>-1);};h.prototype.$FBRTCIceStatsParser1=function(i){"use strict";var j=0,k=i.match(/generation (\d+)/);if(k)j=parseInt(k[1],10);return j;};h.prototype.$FBRTCIceStatsParser2=function(i){"use strict";var j=i.match(/typ (host|relay|srflx|prflx)/);if(j){return j[1];}else return 'unknown';};e.exports=h;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed',TOGGLE_SCREEN_SHARING:'toggle_screen_sharing',SCREEN_SHARING_ENABLED:'screen_sharing_status'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};e.exports=ha;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","copyProperties","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=5*60*1000,n={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};o.CURRENT_SUMMARY_VERSION=10;function o(p){"use strict";this.peerID=p.peerID;this.callID=p.callID;this.$FBRTCCallSummary0=p.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=l();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=this.$FBRTCCallSummaryg;this.$FBRTCCallSummaryk=0;this.$FBRTCCallSummaryl={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummarym());this.$FBRTCCallSummaryn();this.$FBRTCCallSummaryo=h.getInstance();this.$FBRTCCallSummaryp=i.getInstance();}o.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:o.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryk,extraInfo:this.$FBRTCCallSummaryl,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryq()});};o.fromJsonString=function(p){"use strict";var q;try{q=JSON.parse(p);}catch(r){return null;}if(q.version!==o.CURRENT_SUMMARY_VERSION)return null;if(!q.hasOwnProperty('peerID')||!q.hasOwnProperty('callID')||!q.hasOwnProperty('isCaller')||!q.hasOwnProperty('startTime')||!q.hasOwnProperty('trigger')||!q.hasOwnProperty('signalingTime')||!q.hasOwnProperty('endCallReason')||!q.hasOwnProperty('isRemoteEnded')||!q.hasOwnProperty('lastUpdatedTime')||!q.hasOwnProperty('lastSerializedTime'))return null;var s=new o({peerID:q.peerID,callID:q.callID,isCaller:q.isCaller});s.$FBRTCCallSummary1=q.startTime;s.$FBRTCCallSummary2=q.trigger;s.$FBRTCCallSummary3=q.signalingTime;s.$FBRTCCallSummary4=q.endCallReason;s.$FBRTCCallSummary5=q.endCallSubreason;s.$FBRTCCallSummary6=q.isRemoteEnded;s.$FBRTCCallSummary7=q.lastUpdatedTime;s.$FBRTCCallSummary8=q.lastSerializedTime;if(q.unsetOnRetrieve)s.$FBRTCCallSummary9=q.unsetOnRetrieve;if(q.openCount)s.$FBRTCCallSummaryk=q.openCount;if(q.extraInfo)s.$FBRTCCallSummaryl=q.extraInfo;if(q.pcStats)s.$FBRTCCallSummarya=q.pcStats;if(q.captureStats)s.$FBRTCCallSummaryb=q.captureStats;if(q.gen0IceSentCount)s.$FBRTCCallSummaryc=q.gen0IceSentCount;if(q.gen0IceReceivedCount)s.$FBRTCCallSummaryd=q.gen0IceReceivedCount;if(q.iceSentCount)s.$FBRTCCallSummarye=q.iceSentCount;if(q.iceReceivedCount)s.$FBRTCCallSummaryf=q.iceReceivedCount;if(q.newSignalingTime)s.$FBRTCCallSummaryi=q.newSignalingTime;if(q.accumulatedCallTime)s.$FBRTCCallSummaryh=q.accumulatedCallTime;return s;};o.restoreOrInitialize=function(p,q,r,s,t){"use strict";var u=p.retrieveCallSummary(q,r);if(!u){u=new o({peerID:q,callID:r,isCaller:s});if(t){u.onFullMessageReceived({msg:t});u.onOfferAckSent(t);}else u.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(q,r,'Missing call summary from storage');}else if(u.$FBRTCCallSummary9){u.$FBRTCCallSummary4=null;u.$FBRTCCallSummary5=null;u.$FBRTCCallSummary6=null;delete u.$FBRTCCallSummary3[n.CALL_ENDED];delete u.$FBRTCCallSummaryi[n.CALL_ENDED];u.$FBRTCCallSummary9=null;}return u;};o.logSavedSummaries=function(p){"use strict";var q=p.getLoggableSummaries(),r=q.length;if(r<=0)return;var s=i.getInstance(),t=[];for(var u=0;u<r;u++){var v=q[u];s.logEndCallSummary(v);t.push({peerID:v.peerID,callID:v.callID});}p.removeCallSummaries(t);s.logToConsole('Logged pending summaries: '+r);};o.prototype.save=function(p){"use strict";var q=l(),r=q-this.$FBRTCCallSummaryj;if(r>m){this.$FBRTCCallSummaryp.logInfo(this.peerID,this.callID,'Summary too old: '+r);return;}p.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummaryj=q;};o.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};o.prototype.setLastUpdatedTime=function(p){"use strict";this.$FBRTCCallSummary7=p;};o.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryl;};o.prototype.addExtraInfo=function(p,q){"use strict";this.$FBRTCCallSummaryl[p]=q;this.$FBRTCCallSummaryn();};o.prototype.onCallStarted=function(p){"use strict";this.$FBRTCCallSummary2=p;this.$FBRTCCallSummaryr(n.CALL_STARTED);this.$FBRTCCallSummaryn();};o.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummaryr(n.POPUP_OPENED);this.$FBRTCCallSummaryk++;this.$FBRTCCallSummaryn();};o.prototype.setPcStats=function(p){"use strict";this.$FBRTCCallSummarya=p;this.$FBRTCCallSummaryn();};o.prototype.setVideoCaptureStats=function(p,q){"use strict";this.$FBRTCCallSummaryb={w:p,h:q};this.$FBRTCCallSummaryn();};o.prototype.onOfferAckSent=function(p){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:p.flag});};o.prototype.onMessageSent=function(p){"use strict";var q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummarys(q,n.SENT_OFFER,n.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummarys(q,n.SENT_ANSWER,n.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(q,n.SENT_OFFER_ACK,n.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(q,n.SENT_ANSWER_ACK,n.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummaryn();};o.prototype.$FBRTCCallSummaryt=function(p,q,r){"use strict";var s=null,t=null,u=this.$FBRTCCallSummaryo.extractIceInfo(p.sdp);for(var v=0;v<u.length;v++){s=u[v].gen;t=u[v].type;if(s===0)this.$FBRTCCallSummaryu(q,t);this.$FBRTCCallSummaryu(r,t);}};o.prototype.$FBRTCCallSummaryu=function(p,q){"use strict";if(!p[q]){p[q]=1;}else p[q]=p[q]+1;};o.prototype.$FBRTCCallSummaryv=function(p){"use strict";if(p.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};o.prototype.onFullMessageReceived=function(p){"use strict";var q=p.msg,r=q.flag===1;switch(q.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_OFFER,n.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_ANSWER,n.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummaryn();};o.prototype.onMsgAckReceived=function(p,q){"use strict";var r=p.msg.flag===1;if(q){this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);};o.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummaryr(n.NETWORK_READY);this.$FBRTCCallSummaryr(n.CALL_CONNECTED);this.$FBRTCCallSummaryn();};o.prototype.onCallEnded=function(p,q,r,s){"use strict";this.$FBRTCCallSummary9=r;this.$FBRTCCallSummary4=p;this.$FBRTCCallSummary5=s;this.$FBRTCCallSummary6=q;this.$FBRTCCallSummaryr(n.CALL_ENDED);this.$FBRTCCallSummaryn();};o.prototype.toString=function(){"use strict";var p={};p.core_metrics=this.$FBRTCCallSummaryw();p.time_series=null;return JSON.stringify(p);};o.prototype.$FBRTCCallSummaryw=function(){"use strict";var p={};p.ver=o.CURRENT_SUMMARY_VERSION;p.caller=this.$FBRTCCallSummary0;p.conn=this.$FBRTCCallSummaryx();p.peer_id=this.peerID;p.has_video=true;p.open_count=this.$FBRTCCallSummaryk;p.signaling=this.$FBRTCCallSummaryy();p.sender=this.$FBRTCCallSummaryz();p.receiver=this.$FBRTCCallSummaryA();p.end=this.$FBRTCCallSummaryB();p.video=this.$FBRTCCallSummaryC();return p;};o.prototype.$FBRTCCallSummaryx=function(){"use strict";var p={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)p.rtt=this.$FBRTCCallSummarya.sender.rtt;return p;};o.prototype.$FBRTCCallSummaryy=function(){"use strict";var p={};if(this.$FBRTCCallSummary2)p.trigger=this.$FBRTCCallSummary2;p.start_time=this.$FBRTCCallSummary1;p.time_from_start=this.$FBRTCCallSummary3;var q=this.$FBRTCCallSummary3[n.CALL_CONNECTED],r=this.$FBRTCCallSummary3[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummary8){r=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else r=this.$FBRTCCallSummaryD();var s=r-q;if(s>0)p.duration=s;}p.new_time_from_start=this.$FBRTCCallSummaryi;q=this.$FBRTCCallSummaryi[n.CALL_CONNECTED];r=this.$FBRTCCallSummaryi[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummaryh>0){r=this.$FBRTCCallSummaryh;}else r=this.$FBRTCCallSummaryq();s=r-q;if(s>0)p.new_duration=s;}return p;};o.prototype.$FBRTCCallSummaryz=function(){"use strict";var p={};if(this.$FBRTCCallSummaryc)p.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)p.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)k(p,this.$FBRTCCallSummarya.sender);return p;};o.prototype.$FBRTCCallSummaryA=function(){"use strict";var p={};if(this.$FBRTCCallSummaryd)p.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)p.ice=this.$FBRTCCallSummaryf;return p;};o.prototype.$FBRTCCallSummaryB=function(){"use strict";var p={};if(this.$FBRTCCallSummary4!==null){p.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)p.end_call_subreason_string=this.$FBRTCCallSummary5;p.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)k(p,this.$FBRTCCallSummarya.end);return p;};o.prototype.$FBRTCCallSummaryC=function(){"use strict";var p={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)k(p,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)k(p.capture,this.$FBRTCCallSummaryb);return {sender:p};};o.prototype.$FBRTCCallSummaryD=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};o.prototype.$FBRTCCallSummaryq=function(){"use strict";var p=l()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+p);};o.prototype.$FBRTCCallSummaryr=function(p){"use strict";if(this.$FBRTCCallSummary3[p])return;this.$FBRTCCallSummary3[p]=this.$FBRTCCallSummaryD();this.$FBRTCCallSummaryi[p]=this.$FBRTCCallSummaryq();};o.prototype.$FBRTCCallSummarys=function(p,q,r){"use strict";if(p){this.$FBRTCCallSummaryr(r);}else this.$FBRTCCallSummaryr(q);};o.prototype.$FBRTCCallSummaryn=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};o.prototype.$FBRTCCallSummarym=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=o;},null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k='localstorage',l='RTC_CALL_SUMMARY_',m='summary',n=2000,o=3,p=3*60*1000,q=null;r.getInstance=function(){"use strict";if(!q)q=new r();return q;};function r(){"use strict";this.$FBRTCCallSummaryStore0=new g(k,l);this.$FBRTCCallSummaryStore1=i.getInstance();}r.prototype.storeCallSummary=function(s,t,u){"use strict";var v=this;this.$FBRTCCallSummaryStore2(function(w){if(!w[s])w[s]={};var x=w[s][t];if(x){var y=v.$FBRTCCallSummaryStore3(x);if(y&&y.getLastUpdatedTime()>u.getLastUpdatedTime()){v.$FBRTCCallSummaryStore1.logToConsole('Outdated summaries');return null;}}w[s][t]=v.$FBRTCCallSummaryStore4(u);return w;},v.$FBRTCCallSummaryStore1.logError.bind(v.$FBRTCCallSummaryStore1,s,t));};r.prototype.retrieveCallSummary=function(s,t){"use strict";var u=this.$FBRTCCallSummaryStore5(),v=null;if(u[s])v=u[s][t];if(v){return this.$FBRTCCallSummaryStore3(v);}else return null;};r.prototype.removeCallSummary=function(s,t){"use strict";this.removeCallSummaries([{peerID:s,callID:t}]);};r.prototype.removeCallSummaries=function(s){"use strict";var t=this;this.$FBRTCCallSummaryStore2(function(u){var v=s.length;for(var w=0;w<v;w++){var x=s[w].peerID,y=s[w].callID;if(u[x]&&u[x][y]){delete u[x][y];if(t.$FBRTCCallSummaryStore6(u[x]))delete u[x];}}return u;},t.$FBRTCCallSummaryStore1.logError.bind(t.$FBRTCCallSummaryStore1,null,null));};r.prototype.getLoggableSummaries=function(){"use strict";var s=this.$FBRTCCallSummaryStore5(),t=[];for(var u in s)if(s.hasOwnProperty(u))for(var v in s[u])if(s[u].hasOwnProperty(v)){var w=this.$FBRTCCallSummaryStore3(s[u][v],p);if(w)t.push(w);}return t;};r.prototype.$FBRTCCallSummaryStore6=function(s){"use strict";for(var t in s)if(s.hasOwnProperty(t))return false;return true;};r.prototype.$FBRTCCallSummaryStore4=function(s){"use strict";var t={__t:Date.now(),__d:s.toJsonString()};return t;};r.prototype.$FBRTCCallSummaryStore3=function(s,t){"use strict";if(s)if(!t||(Date.now()-s.__t>=t))return h.fromJsonString(s.__d);return null;};r.prototype.$FBRTCCallSummaryStore5=function(){"use strict";var s=this.$FBRTCCallSummaryStore0.get(m)||{};return s;};r.prototype.$FBRTCCallSummaryStore2=function(s,t,u,v){"use strict";if(u===(void 0)||u===null)u=o;var w=this.$FBRTCCallSummaryStore5(),x=this.$FBRTCCallSummaryStore5(),y=s(w);if(y===null)return;var z=this.$FBRTCCallSummaryStore5();if(j(x,z)){this.$FBRTCCallSummaryStore0.set(m,y);this.$FBRTCCallSummaryStore1.logToConsole('Updated summaries');}else if(u>0){t('Retry lock');if(v){var aa=this;setTimeout(function(){aa.$FBRTCCallSummaryStore2(s,t,u-1,true);},n);}else this.$FBRTCCallSummaryStore2(s,t,u-1,true);}else t('Failed to lock');};e.exports=r;},null);
__d("FBRTCUtils",["emptyFunction","randomInt","AsyncRequest"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=6000,k={attachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=window.webkitURL.createObjectURL(m);}else{l.mozSrcObject=m;l.play();}},reattachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=m.src;}else{l.mozSrcObject=m.mozSrcObject;l.play();}},generateRandomInt:function(){return h(0,4294967294)+1;},aboutEqual:function(l,m){return (l-m)<.01&&(m-l)<.01;},sendServerRequest:function(l,m,n,o,p,q){m=m||g;n=n||g;o=o||false;p=p||j;q=q||{};var r=new i().setURI(l).setData(q).setAllowCrossPageTransition(true).setHandler(m).setErrorHandler(n).setTimeoutHandler(p,function(){n();});if(o)r.setOption('asynchronous',false);r.send();}};e.exports=k;},null);
__d("XVideoCallInitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("XVideoCallController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitController","XVideoCallController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=3,l=function(p,q,r,s){g.getInstance().logCallAction(p,q,g.CallAction.OLD_URI);return j.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();},m=function(p,q,r,s,t,u,v){if(v===(void 0)||v===null)v=k;var w=i.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();h.sendServerRequest(w,function(x){t(x.payload.uri);},function(x){if(v>0){m(p,q,r,s,t,u,v-1);}else t(l(p,q,r,s));});},n=function(p){window.history.replaceState({},'',p);},o={init:function(p){this._peerID=p;},onCallStarted:function(){n(l(this._peerID));},getCallUri:m};e.exports=o;},null);
__d("FBRTCCallUI",["BanzaiLogger","Cookie","UserAgent","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCUrlManager","pageID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q={openAsCaller:function(r,s,t,u){if(!p&&window.rtcCallChildWindow){p=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(r)){p.focus();return;}if(this._shouldCloseCallWindow())p.close();g.log('VideoCallLoggerConfig',{event:'open_as_caller'});m.getInstance().logCallAction(r,s,m.CallAction.START_CALL,null,t);var v=new j({peerID:r,callID:s,isCaller:true});v.onCallStarted(t);this._open(r,s,true,v,false,u);},openAsCallee:function(r,s,t,u,v){g.log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(r,s,false,t,u,v);},_shouldFocusCallWindow:function(r){return p&&!p.closed&&p.rtcCallInProgessWith===r;},_shouldCloseCallWindow:function(){return p&&!p.closed&&!p.rtcCallInProgessWith;},_open:function(r,s,t,u,v,w){h.clear('vcpwn');h.clear('vctid');var x=this._windowPosition(),y=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',x.height,x.width,x.top,x.left].join(',');if(this._isSparkBrowser())y='';u.addExtraInfo(m.Key.INITIATED_BY_PAGE_ID,o);u.onCallEnded(l.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');u.save(k.getInstance());g.log('VideoCallLoggerConfig',{event:'open_popup'});if(!v){p=window.open('','Video Call',y);this._setUri(p,r,s,t,w);}else{m.getInstance().logCallAction(r,s,m.CallAction.OPEN_POPUP);p=window.open(v,'Video Call',y);}if(window.focus)p.focus();},_setUri:function(r,s,t,u,v){n.getCallUri(s,t,u,v,function(w){m.getInstance().logCallAction(s,t,m.CallAction.OPEN_POPUP);r.location=w;},function(){m.getInstance().logCallAction(s,t,m.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var r=960,s=540,t,u,v,w;if(screen&&screen.width>1280){r=1280;s=720;}if(window.innerWidth!==(void 0)){u=window.innerWidth;t=window.innerHeight;}else{u=screen.width;t=screen.height;}if(window.screenLeft!==(void 0)){v=window.screenLeft;w=window.screenTop;}else{v=window.screenX;w=window.screenY;}var x=Math.floor(((u/2)-(r/2))+v),y=Math.floor(((t/2)-(s/2))+w);return {height:'height='+s.toString(),width:'width='+r.toString(),top:'top='+y.toString(),left:'left='+x.toString()};},_isSparkBrowser:function(){return i.isBrowser('Chrome < 34')&&i.isBrowser('Chrome > 33');}};e.exports=q;},null);
__d("XBrowserNotSupportedDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/browser_not_supported\/",{user_id:{type:"Int"},warning:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("FBRTCSoundController",["RTCConfig","Sound"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.ringtone_mp3_url,g.ringtone_ogg_url],j={playIncomingRingtone:function(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');h.play(i,n,m);},stopIncomingRingtone:function(){h.stop(i);}};e.exports=j;},null);
__d("FBRTCUnsupportedBrowserMessage",["AsyncDialog","AsyncRequest","XBrowserNotSupportedDialogController","FBRTCSoundController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={_dialog:null,warnForOutgoingCall:function(l){var m=i.getURIBuilder().setBool('warning',true).getURI();this._presentDialog(m,l);},showForOutgoingCall:function(){var l=i.getURIBuilder().getURI();this._presentDialog(l);},showForIncomingCall:function(l,m){j.playIncomingRingtone(l,m,false);var n=i.getURIBuilder().setInt('user_id',m).getURI();this._presentDialog(n);},dismiss:function(){if(this._dialog)this._dialog.hide();},_presentDialog:function(l,m){if(this._dialog)return;var n=new h(l);g.send(n,function(o){this._dialog=o;o.subscribe('hide',function(){this._dialog=null;if(m)m();}.bind(this));}.bind(this));}};e.exports=k;},null);
__d("FBRTCCore",["Arbiter","ChatVisibility","FBRTCAvailability","FBRTCCallUI","FBRTCStruct","FBRTCUnsupportedBrowserMessage","mixInEventEmitter","PresencePrivacy","UserAgent","VideoCallSupport","fbt","randomInt","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=false,u={startOutgoingCall:function(v,w,x){s(!isNaN(parseInt(v,10)));if(t)return;t=true;setTimeout(function(){t=false;},1000);if(p.isWebrtcSupported()){var y=this._generateCallID();j.openAsCaller(v,y,w,x);}else l.showForOutgoingCall();},isAvailableForWebrtcCalling:function(v){return i.isCallable(v);},shouldEnableVideoCalling:function(){return !o.isPlatform('Android')&&!o.isPlatform('iOS');},callabilityForUser:function(v){if(!h.isOnline()){return u.CallabilityStatus.OFFLINE;}else if(u.isAvailableForWebrtcCalling(v)){return u.CallabilityStatus.AVAILABLE;}else if(!n.allows(v)){return u.CallabilityStatus.BLOCKED;}else return u.CallabilityStatus.UNAVAILABLE;},generateCallButtonTooltip:function(v,w){switch(w){case u.CallabilityStatus.AVAILABLE:return q._("Start a video call with {shortname}",[q.param("shortname",v)]);case u.CallabilityStatus.BLOCKED:return q._("You must turn on chat for {shortname} to make a call.",[q.param("shortname",v)]);case u.CallabilityStatus.UNAVAILABLE:return q._("{shortname} is currently unavailable for video calling",[q.param("shortname",v)]);case u.CallabilityStatus.OFFLINE:return q._("You must be online to make a call.");default:return q._("You must be online to make a call.");}},_generateCallID:function(){return r(0,4294967295);},buddyCallabilityChanged:function(){this.emit('callabilityChanged');}};u.CallabilityStatus=new k(['AVAILABLE','BLOCKED','OFFLINE','UNAVAILABLE']);g.subscribe(['buddylist/availability-changed'],function(v,w){u.buddyCallabilityChanged();});n.subscribe(['privacy-changed','privacy-availability-changed'],function(v,w){u.buddyCallabilityChanged();});m(u,{callabilityChanged:true});e.exports=u;},null);
__d("FBRTCMessageListener",["Arbiter","ChannelConstants","invariant","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=[],l=null,m={init:function(){g.subscribe(h.getArbiterType('webrtc'),function(n,o){this._onMessage(o.obj);}.bind(this));},setMessageHandler:function(n,o){i(!l);l=o?n.bind(o):n;while(k.length)l(k.shift());},_onMessage:function(n){this.emit('messageReceived',n);if(l){l(n);}else k.push(n);}};j(m,{messageReceived:true});e.exports=m;},null);
__d("VideoCallCore",["Bootloader","FBRTCCallSummaryUploader","FBRTCCore","FBRTCLogger","FBRTCMessageListener","FBRTCUnsupportedBrowserMessage","VideoCallSupport","FBRTCCallUI","randomInt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q=false,r={availableForCall:function(v){return u(v);},showOutgoingCallDialog:function(v,w,x){if(q)return;q=true;setTimeout(function(){q=false;},1000);if(m.isWebrtcSupported()){this.makeWebRTCCall(v,x||j.Trigger.CHAT_TAB_ICON);}else l.showForOutgoingCall();},canCallByWebrtc:function(v){if(m.isSendWebrtcSupported())return u(v);return false;},makeWebRTCCall:function(v,w){var x=parseInt(v,10),y=t();n.openAsCaller(x,y,w,false);}};function s(){if(!p)g.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(v,w,x,y){p=new v(w,y,(new x(r)));k.setMessageHandler(p.onMessageReceived,p);});}function t(){return o(0,4294967295);}function u(v){return i.isAvailableForWebrtcCalling(v);}if(m.isReceiveWebrtcSupported()){h.init();k.init();k.once('messageReceived',function(v){s();});}e.exports=r;},null);
__d("FBRTCDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatEmployeeAwayWarning",["MercuryIDs","MercuryParticipants","MercuryViewer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={updateEmployeeAwayWarning:function(k,l,m){h.get(i.getID(),function(n){var o=n.employee;if(o)h.getMulti(k.participants,function(p){var q=false,r=g.getUserIDFromThreadID(k.thread_id);if(!r)return;var s='fbid:'+r;for(var t in p)if(s==p[t].id&&p[t].is_employee_away)q=true;if(q){l();}else m();});});}};e.exports=j;},null);
__d("MNCommerceDialogFooter.react",["CurrentEnvironment","MessengerDialogFooter.react","React","XUIDialogFooter.react","cloneWithProps","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i.createClass({displayName:"MNCommerceDialogFooter",render:function(){var n=g.messengerdotcom,o=n?h:j,p,q=this.props.children;if(n){p=i.Children.count(this.props.children);q=i.Children.map(this.props.children,function(r,s){if(!r)return null;return k(r,{className:"_4ec0",type:s===0&&p===2?'secondary':'primary'});});}return (i.createElement(o,i.__spread({},this.props),q));}});e.exports=m;},null);
__d("MNCommerceUnlinkDialog.react",["MNCommerceButton.react","MNCommerceDialog.react","MNCommerceDialogBody.react","MNCommerceDialogFooter.react","MNCommerceDialogTitle.react","React","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=l,o=n.PropTypes,p=l.createClass({displayName:"MNCommerceUnlinkDialog",propTypes:{onCancelButtonClick:o.func,onTurnOffButtonClick:o.func},render:function(){var q=m._("Cancel"),r=m._("Turn Off");return (l.createElement(h,{onToggle:this.props.onToggle,shown:this.props.shown},l.createElement(k,{showCloseButton:false},m._("Unlink account?")),l.createElement(i,null,l.createElement("div",null,m._("You can turn off updates if you didn't sign up or just don't want to get them anymore."))),l.createElement(j,null,l.createElement(g,{label:q,onClick:this.props.onCancelButtonClick,use:"default"}),l.createElement(g,{label:r,onClick:this.props.onTurnOffButtonClick,use:"confirm"}))));}});e.exports=p;},null);
__d("MNCommerceUnlinkErrorDialog.react",["MNCommerceAttachmentConstants","MNCommerceErrors","React","MNCommerceButton.react","MNCommerceDialog.react","MNCommerceDialogBody.react","MNCommerceDialogFooter.react","MNCommerceDialogTitle.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=i,q=p.PropTypes,r=i.createClass({displayName:"MNCommerceUnlinkErrorDialog",propTypes:{errorType:q.number,onOkayButtonClick:q.func},render:function(){var s=o._("OK"),t=null,u=null;switch(this.props.errorType){case h.ALREADY_UNLINKED:u=i.createElement("div",null,o._("Updates Are Already Off"));t=i.createElement("div",null,o._("You aren't getting updates in Messenger."));break;default:u=i.createElement("div",null,o._("Couldn't Turn Off Updates"));t=i.createElement("div",null,o._("Sorry, something went wrong. Please try again."));break;}return (i.createElement(k,{onToggle:this.props.onToggle,shown:this.props.shown,width:g.UNLINK_ERROR_DIALOG.WIDTH},i.createElement(n,null,u),i.createElement(l,null,t),i.createElement(m,null,i.createElement(j,{label:s,onClick:this.props.onOkayButtonClick,use:"confirm"}))));}});e.exports=r;},null);
__d("MNCommerceUnlinkDialogContainer.react",["BanzaiLogger","MNCommerceDialogStateActions","MNCommerceDialogStateStore","MNCommerceLoggingConstants","MNCommerceLoggerEvents","MNCommerceUnlinkDialog.react","MNCommerceUnlinkErrorDialog.react","React"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=n.createClass({displayName:"MNCommerceUnlinkDialogContainer",render:function(){var p=i.getState();if(p&&p.errorType){g.log('MessengerCommerceLoggerConfig',{event:k.DIALOG_LOAD_SUCCESS,debug_data:JSON.stringify({dialog_surface:j.DIALOG_SURFACE.UNLINK_ERROR})});return (n.createElement(m,{onToggle:this._onToggle,shown:!!p,errorType:p.errorType,onOkayButtonClick:this._hideDialog}));}else{g.log('MessengerCommerceLoggerConfig',{event:k.DIALOG_LOAD_SUCCESS,debug_data:JSON.stringify({dialog_surface:j.DIALOG_SURFACE.UNLINK})});return (n.createElement(l,{onToggle:this._onToggle,shown:!!p,onCancelButtonClick:this._hideDialog,onTurnOffButtonClick:p&&p.onTurnOffButtonClick}));}},_onToggle:function(p){if(!p)this._hideDialog();},_hideDialog:function(){h.hideDialog();}});e.exports=o;},null);
__d("XMNCommerceUnlinkController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/messages\/commerce\/unlink\/",{page_id:{type:"String",required:true},user_id:{type:"String",required:true}});},null);
__d("MNCommerceUnlinkDataManager",["AsyncRequest","MNCommerceDialogStateActions","MNCommerceUnlinkDialogContainer.react","XMNCommerceUnlinkController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';function k(){}k.prototype.unlink=function(l,m){var n=j.getURIBuilder().setString('page_id',l).setString('user_id',m).getURI();new g().setURI(n).setErrorHandler(this.$MNCommerceUnlinkDataManager0).send();};k.prototype.$MNCommerceUnlinkDataManager0=function(l){h.showDialog(i,{errorType:l.error});};e.exports=new k();},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","DOM","MercuryThreadInfo"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;i.scry(this.getRoot(),'input[type="radio"]').forEach(function(p){if(p.checked)o=p.value;});o=k.convertRawMuteSetting(o);d(['MercuryThreadActions'],function(p){p.get().updateMuteSetting(l,o);});}.bind(n));});},convertRawMuteSetting:function(l){switch(l){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var m,n=new Date(),o=new Date();o.setHours(8);o.setMinutes(0);o.setSeconds(0);if(o>n){m=o-n;}else m=o-n+(24*3600*1000);return m/1000;default:return 0;}}};e.exports=k;},null);
__d("MercuryCallLogMessage.react",["FBRTCCore","FBRTCLogger","React","SimpleXUIDialog","Tooltip.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=i.createClass({displayName:"MercuryCallLogMessage",render:function(){if(this.props.isAnswered){return (this._renderAnsweredCallLogMessage(this.props.peerFBID,this.props.peerName,this.props.isOutgoingCall));}else return (this._renderMissedCallLogMessage(this.props.peerFBID,this.props.peerName,this.props.isOutgoingCall));},_renderAnsweredCallLogMessage:function(o,p,q){var r=m._("call {firstname}",[m.param("firstname",p)]),s;if(q){s=m._("You called {firstname}.",[m.param("firstname",p)]);}else s=m._("{firstname} called you.",[m.param("firstname",p)]);return this._generateCallLink(s,r,o,p);},_renderMissedCallLogMessage:function(o,p,q){var r,s;if(q){r=m._("{firstname} missed a call from you.",[m.param("firstname",p)]);s=m._("call {firstname} again",[m.param("firstname",p)]);}else{r=m._("You missed a call from {firstname}.",[m.param("firstname",p)]);s=m._("call {firstname} back",[m.param("firstname",p)]);}return this._generateCallLink(r,s,o,p);},_generateCallLink:function(o,p,q,r){if(g.shouldEnableVideoCalling()){return (i.createElement("a",{className:"_1xpw",onClick:this._handleClick.bind(this,q,r)},i.createElement(k,{alignH:"center",position:"above",tooltip:p},o)));}else return (i.createElement("span",{className:"_1xpw"},o));},_handleClick:function(o,p){if(g.isAvailableForWebrtcCalling(o)){g.startOutgoingCall(o,h.Trigger.ADMIN_MESSAGE,false);}else j.show(m._("{firstname} can't be called because they are temporarily offline.",[m.param("firstname",p)]),m._("Can't Connect Call"));}});e.exports=n;},null);
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionType","MercuryIDs","MercuryPayloadSource","MercuryViewer","TypingStates","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=b('MercuryServerRequests').get(),q,r={},s=30000,t={};n(t,{'state-changed':true});function u(aa){var ba=r[aa]||{},ca=Object.keys(ba);ca.sort(function(da,ea){return ba[da]-ba[ea];});return ca;}function v(){q=null;var aa=Date.now(),ba={},ca=false;for(var da in r){var ea=false;for(var fa in r[da]||{})if(r[da][fa]<aa-s){delete r[da][fa];ea=true;}else ca=true;if(ea)ba[da]=u(da);}for(var ga in ba){x(ba);break;}if(ca)q=o(v,3000);}function w(aa,ba){if(aa in r)if(ba in r[aa]){delete r[aa][ba];y(aa);}}function x(aa){t.releaseHeldEventType('state-changed');t.emitAndHold('state-changed',aa);}function y(aa){var ba={};ba[aa]=u(aa);x(ba);}function z(aa){if(aa.thread_fbid)return p.getClientThreadIDNow(aa.thread_fbid);if(aa.type==='typ')return j.getThreadIDFromUserID(aa.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(aa,ba){var ca=ba.obj,da=z(ca);if(da){var ea=j.getParticipantIDFromUserID(ca.from);if(ca.st==m.TYPING){r[da]=r[da]||{};var fa=r[da][ea];r[da][ea]=Date.now();if(!q)q=o(v,3000);!fa&&y(da);}else if(ca.st==m.INACTIVE)w(da,ea);}});p.subscribe('update-typing-state',function(aa,ba){var ca=ba.payload_source;if(ca!=k.CLIENT_CHANNEL_MESSAGE)return;var da=ba.actions;if(!da||!da.length)return;var ea=i.USER_GENERATED_MESSAGE;da.forEach(function(fa){if(fa.action_type==ea&&fa.author!=l.getID())w(fa.thread_id,fa.author);});});e.exports=t;},null);
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionType","MercuryDelayedRoger","MercuryIDs","MercuryMessageSourceTags","MercuryParticipants","MercuryTypingReceiver","MercuryViewer","arrayContains","copyProperties","formatDate","removeFromArray","fbt","MercuryRoger","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryRoger').get(),v=b('MercuryThreads').get(),w=[];function x(y){this._threadID=y;this._canonicalUser=k.getUserIDFromThreadID(y);w.push(this);}q(x.prototype,g,{destroy:function(){s(w,this);},setLastMessage:function(y){this._lastMsg=y;this._handleStateChange();},_informStateChanged:function(y){if(y.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&o.isViewer(this._lastMsg.author))y.self_authored=true;this._currentActivity=y.activity;this.inform('state-changed',y);},_notifySentFrom:function(){var y,z,aa=this._lastMsg.location_text,ba=this._lastMsg.source_tags||[];if(aa){y=t._("Sent from {location}",[t.param("location",aa)]);z='sentFromMobile';}else if(p(ba,l.MESSENGER)){y=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},t._("Sent from Messenger"));z='sentFromMobile';}else if(p(ba,l.MOBILE)){y=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Mobile"));z='sentFromMobile';}else if(p(ba,l.EMAIL)){y=t._("Sent from email");z='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:z,text:y});},_notifySeenTimestamp:function(y){var z=u.getSeenTimestamp(this._threadID,y[0])*.001,aa=Date.now()*.001,ba;if(z<aa-518400){ba='M j';}else if(z<aa-86400){ba='D g:ia';}else ba='g:ia';this._informStateChanged({activity:'seen-timestamp',text:t._("Seen {timestamp}",[t.param("timestamp",r(z,ba))])});},_nameNormalizer:function(y){var z;m.getMulti(y,function(aa){function ba(da){if(aa[da]!==(void 0)){return aa[da].short_name.toLowerCase();}else return da;}var ca=y.map(ba);z=function(da){var ea=ba(da),fa=ca.indexOf(ea)!==ca.lastIndexOf(ea);return fa?aa[da].name:aa[da].short_name;};});return z;},_notifySeenBy:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea=y.length+(z.author!=o.getID()),fa,ga=false,ha=da>2&&ea>=da-1,ia;if(ca)ia=this._nameNormalizer(ca.participants);if(!ia)ia=function(ma){return ba[ma].short_name;};if(ha){fa=t._("Seen by everyone");}else if(y.length==1){fa=t._("Seen by {user}",[t.param("user",ba[y[0]].short_name)]);}else if(y.length==2){fa=t._("Seen by {user1}, {user2}",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=t._("Seen by {user1}, {user2}, {user3}",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name),t.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ja=Object.keys(ba).length-2,ka=t._({"*":"{num} more"},[t.param("num",ja,[0])]),la=h.create('span',{className:'more'},ka);fa=t._("Seen by {user1}, {user2}, {=num more link}",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name),t.param("=num more link",la)]);ga=true;}this._informStateChanged({activity:'seen-by',text:fa,seenBy:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_notifyTyping:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea;if(ca)ea=this._nameNormalizer(ca.participants);if(!ea)ea=function(ka){return ba[ka].short_name;};var fa,ga=false;if(da>2&&y.length>=da-1){fa=t._("Everyone is typing...");}else if(y.length==1){fa=t._("{name} is typing...",[t.param("name",ba[y[0]].short_name)]);}else if(y.length==2){fa=t._("{user1} and {user2} are typing...",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=t._("{user1}, {user2}, and {user3} are typing...",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name),t.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ha=Object.keys(ba).length-2,ia=t._({"*":"{num} more"},[t.param("num",ha,[0])]),ja=h.create('a',{href:'#'},ia);fa=t._("{user1}, {user2}, and {=num more link} are typing...",[t.param("user1",ba[y[0]].short_name),t.param("user2",ba[y[1]].short_name),t.param("=num more link",ja)]);ga=true;}this._informStateChanged({activity:'typing',text:fa,typing:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var y=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==y){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=o.getID()){this._notifySentFrom();return;}var z=j.getSeenBy(this._threadID,true);if(z.length)if(this._canonicalUser){this._notifySeenTimestamp(z);return;}else{this._notifySeenBy(z);return;}this._informStateChanged({activity:'none'});}});n.addRetroactiveListener('state-changed',function(y){w.forEach(function(z){var aa=y[z._threadID];if(aa!==(void 0)){z._typing=aa;z._handleStateChange();}});});j.subscribe('state-changed',function(y,z){w.forEach(function(aa){z[aa._threadID]&&aa._handleStateChange();});});e.exports=x;},null);
__d("MercuryLastMessageIndicator.react",["DOM","MercuryIndicatorController","MercuryParticipants","React","Tooltip","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j,p=o.PropTypes,q=j.createClass({displayName:"MercuryLastMessageIndicator",propTypes:{hideTyping:p.bool,indicatorWillShow:p.func,indicatorDidShow:p.func,lastMessage:p.object,threadID:p.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:m,indicatorDidShow:m};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(r){if(r.threadID!=this.props.threadID){this._destroy();this._setup(r);}else if(r.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(r.lastMessage);},componentWillUpdate:function(r,s){if(this.isVisible(r,s))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (j.createElement("div",{className:this.getRootClass()},j.createElement("div",{className:"_510h"}),j.createElement("span",{className:"_510f",ref:"text"}," ")));},getRootClass:function(){var r=(("_510g")+(this.state.data.self_authored?' '+"_510e":'')),s=this.state.data.activity,t=null;if(String(s).startsWith('seen')){t='seen';}else if(s=='typing'){t=this.props.hideTyping?null:s;}else t=s;return n(r,t,this.props.className);},isVisible:function(r,s){r=r||this.props;s=s||this.state;return (s.data&&s.data.activity!='none'&&!(r.hideTyping&&s.data.activity=='typing'));},setText:function(){if(this.state.data.text)g.setContent(j.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)i.getMulti(this.state.data.seenBy,function(r){var s=g.create('div',null,this.state.data.seenBy.map(function(t){return g.create('div',null,r[t].name);}));k.set(g.find(j.findDOMNode(this),'span.more'),s,'above','center');}.bind(this));},_setup:function(r){this._controller=new h(r.threadID);this._subscription=this._controller.subscribe('state-changed',function(s,t){return this.setState({data:t});}.bind(this));r.lastMessage&&this._controller.setLastMessage(r.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});e.exports=q;},null);
__d("WebMessengerDeleteThreadDialog",["Dialog","fbt","MercuryThreadActions"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=b('MercuryThreadActions').get(),j={show:function(k){var l=[];l.push({name:'delete_conversation',label:h._("Delete Conversation"),handler:function(){return i["delete"](k);}});l.push(g.CANCEL);new g().setTitle(h._("Delete This Entire Conversation?")).setBody(h._("Once you delete your copy of this conversation, it cannot be undone.")).setButtons(l).show();}};e.exports=j;},null);
__d("MessagesEmoticons.react",["Grid.react","React","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g.GridItem,m=h,n=m.PropTypes,o=8,p={smile:k._("smile"),frown:k._("frown"),tongue:k._("tongue"),grin:k._("grin"),gasp:k._("gasp"),wink:k._("wink"),pacman:k._("pacman"),grumpy:k._("grumpy"),unsure:k._("unsure"),cry:k._("cry"),kiki:k._("kiki"),glasses:k._("glasses"),sunglasses:k._("sunglasses"),heart:k._("heart"),devil:k._("devil"),angel:k._("angel"),squint:k._("squint"),confused:k._("confused"),upset:k._("upset"),colonthree:k._("colonthree"),like:k._("like")},q=h.createClass({displayName:"MessagesEmoticons",propTypes:{onEmoticonSelect:n.func},getDefaultProps:function(){return {onEmoticonSelect:j};},getEmoticons:function(){return Object.keys(p).map(function(r){return (h.createElement(l,{key:r},h.createElement("div",{className:"panelCell"},h.createElement("a",{"aria-label":p[r],className:'emoticon emoticon_'+r,onClick:function(){return this.props.onEmoticonSelect(r);}.bind(this)}))));}.bind(this));},render:function(){return (h.createElement("div",{className:"emoticonsTable"},h.createElement(g,{cols:o,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=q;},null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=g.delivery_timeout||120000;function p(q){this.$MercuryDeliveryState0=q;this.$MercuryDeliveryState1=i.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState2=k.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState3=[];if(!g.ChatWebDRGK)return;this.$MercuryDeliveryState2.subscribe('messages-received',this.$MercuryDeliveryState4.bind(this));m.subscribe(n(this.$MercuryDeliveryState5,300,this));}p.prototype.$MercuryDeliveryState4=function(q,r){for(var s in r){var t=r[s];t.forEach(function(u){if(this.$MercuryDeliveryState7(u))this.$MercuryDeliveryState3.push(u);}.bind(this));}if(m.isActive(o))this.$MercuryDeliveryState5();};p.prototype.$MercuryDeliveryState5=function(){if(this.$MercuryDeliveryState3.length===0)return;var q=this.$MercuryDeliveryState3.filter(this.$MercuryDeliveryState7,this).map(function(r){return r.message_id;});if(q)this.$MercuryDeliveryState1.sendDeliveryReceipts(q);this.$MercuryDeliveryState3=[];};p.prototype.$MercuryDeliveryState7=function(q){var r=q.author?h.getUserIDFromParticipantID(q.author):null;if(r===this.$MercuryDeliveryState0)return false;if(!q.is_unread)return false;if(!l.allows(r))return false;return true;};Object.assign(p,j);e.exports=p;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionType","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","PageMessageEnumTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();'use strict';var u=g.getInstance('ordered_threadlist_model'),v=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),w=j.getSupportedFolders();function x(ha,ia,ja,ka){var la=[],ma=false,na=false,oa=(ia||[]).filter(function(va){var wa=va.filter||i.ALL;return (va.folder==ja||(!va.folder&&ja==m.INBOX))&&wa==ka;}),pa=ha._threadlistOrderMap[ja][ka].getAllResources(),qa;oa.forEach(function(va){la=la.concat(va.thread_ids);if(va.error){if(va.end>pa.length)na=va.error;}else{var wa=va.end-va.start;if(va.thread_ids.length<wa)ma=true;}if(!qa||va.end>qa)qa=va.end;});ba(ha,la,ja,ka);if(ma){ha._threadlistOrderMap[ja][ka].setReachedEndOfArray();}else if(na){ha._threadlistOrderMap[ja][ka].setError(na);}else{var ra=ha._threadlistOrderMap[ja][ka].getCurrentArraySize();if(qa&&ra<qa){var sa={},ta=pa.concat(la),ua=ta.filter(function(va){var wa=sa[va];sa[va]=true;return wa;});if(ua.length){u.warn('duplicate_threads',{folder:ja,expected_final_size:qa,actual_final_size:ra,duplicate_thread_ids:ua});ha._serverRequests.fetchThreadlistInfo(qa,ua.length,ja,ka==i.ALL?null:ka);}}}}function y(ha,ia){w.forEach(function(ja){v.forEach(function(ka){x(ha,ia,ja,ka);});});}function z(ha,ia){var ja={};w.forEach(function(ka){ja[ka]={};v.forEach(function(la){ja[ka][la]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ia.forEach(function(ka){if(ka.is_forward)return;var la=ka.thread_id,ma=ca(ha,la),na=da(ha,la);function oa(){na.forEach(function(qa){if(!s(v,qa))return;ja[ma][qa].to_add.push(la);if(!ha._threadlistOrderMap[ma][qa].hasReachedEndOfArray()&&!ha._threadlistOrderMap[ma][qa].hasResource(la))ja[ma][qa].to_remove_if_last_after_add[la]=true;});}function pa(qa){if(s(v,qa))if(s(na,qa)){ja[ma][qa].to_add.push(la);}else ja[ma][qa].to_remove.push(la);}if(!ma){if(ka.action_type===h.CHANGE_FOLDER||ka.action_type===h.CHANGE_ARCHIVED_STATUS)w.forEach(function(qa){if(qa!==ma)v.forEach(function(ra){ha._threadlistOrderMap[qa][ra].removeResources([la]);});});return;}switch(ka.action_type){case h.DELETE_THREAD:na.forEach(function(qa){if(!s(v,qa))return;ja[ma][qa].to_remove.push(la);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:oa();break;case h.CHANGE_READ_STATUS:pa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:na.forEach(function(qa){if(!s(v,qa))return;if(ea(ha,la,ma,qa))ja[ma][qa].to_add.push(la);});break;case h.CHANGE_FLAG:pa(n.FLAG);break;}});w.forEach(function(ka){v.forEach(function(la){var ma=ha._threadlistOrderMap[ka][la];ba(ha,ja[ka][la].to_add,ka,la);for(var na=ma.getCurrentArraySize()-1;na>=0;na--){var oa=ma.getResourceAtIndex(na);if(!ja[ka][la].to_remove_if_last_after_add[oa])break;ja[ka][la].to_remove.push(oa);}ma.removeResources(ja[ka][la].to_remove);});});}function aa(ha,ia){var ja={};w.forEach(function(ka){ja[ka]={};v.forEach(function(la){ja[ka][la]=[];});});ia.forEach(function(ka){var la=ca(ha,ka.thread_id),ma=da(ha,ka.thread_id);if(la)ma.forEach(function(na){if(ea(ha,ka.thread_id,la,na))ja[la][na].push(ka.thread_id);});});w.forEach(function(ka){v.forEach(function(la){if(ja[ka][la].length>0)ba(ha,ja[ka][la],ka,la);});});}function ba(ha,ia,ja,ka){ka=ka||i.ALL;ha._threadlistOrderMap[ja][ka].addResources(ia);w.forEach(function(la){if(la!=ja)ha._threadlistOrderMap[la][ka].removeResources(ia);});}function ca(ha,ia){var ja=ha._threads.getThreadMetaNow(ia),ka=null;if(!ja){ka='No thread metadata';}else if(!ja.folder)ka='No thread folder';if(ka){var la={error:ka,tid:ia};u.warn('no_thread_folder',la);return null;}var ma=ja.folder;if(ja.is_archived)ma=m.ACTION_ARCHIVED;if(ha._threadlistOrderMap[ma]){return ma;}else return null;}function da(ha,ia){var ja=ha._threads.getThreadMetaNow(ia),ka=[i.ALL];if(!ja){var la={error:'no_thread_metadata',tid:ia};u.warn('no_thread_metadata',la);return [];}if(ja.unread_count)ka.push(m.UNREAD);if(!ja.is_canonical)ka.push(m.GROUPS);var ma=ja.page_thread_info;if(ma&&ma.flagged)ka.push(n.FLAG);return ka;}function ea(ha,ia,ja,ka){var la=ha._threads.getThreadMetaNow(ia);return la&&la.timestamp&&ca(ha,ia)==ja&&s(da(ha,ia),ka);}function fa(ha){this._fbid=ha;this._serverRequests=p.getForFBID(this._fbid);this._threadInformer=q.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._threadlistOrderMap={};w.forEach(function(ia){this._threadlistOrderMap[ia]={};v.forEach(function(ja){this._threadlistOrderMap[ia][ja]=new o(function(ka){return this._threads.getThreadMetaNow(ka).timestamp;}.bind(this),function(ka,la){return la-ka;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ia,ja){if(!ga(ja))return;var ka=ja.ordered_threadlists;if(ka&&ka.length){y(this,ka);}else{var la=(ja.actions||[]).filter(function(ma){return ma.thread_id;});aa(this,ja.threads||[]);z(this,la);}this._threadInformer.updatedThreadlist();}.bind(this));}t(fa.prototype,{getThreadlistOrderMap:function(ha,ia){if(!this._threadlistOrderMap[ha][ia]){v=v.concat([ia]);w.forEach(function(ja){this._threadlistOrderMap[ja][ia]=new o(function(ka){return this._threads.getThreadMetaNow(ka).timestamp;}.bind(this),function(ka,la){return la-ka;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}return this._threadlistOrderMap[ha][ia];},getThreadlist:function(ha,ia,ja,ka,la,ma){return this.getFilteredThreadlist(ha,ia,ja,i.ALL,ka,la,ma);},getFilteredThreadlist:function(ha,ia,ja,ka,la,ma,na){var oa=this.getThreadlistOrderMap(ja,ka),pa=oa.executeOrEnqueue(ha,ia,la,ma),qa=oa.getUnavailableResources(pa),ra=oa.getError(ha,ia,ma);if(qa.length||ra){if(oa.getCurrentArraySize()<ha){var sa={start:ha,limit:ia,filter:ka,resources_size:oa.getCurrentArraySize()};u.warn('range_with_gap',sa);}oa.setError(false);this._serverRequests.fetchThreadlistInfo(oa.getCurrentArraySize(),qa.length,ja,ka==i.ALL?null:ka,na);}return pa;},getThreadlistUntilTimestamp:function(ha,ia,ja){ja=ja||i.ALL;return this.getThreadlistOrderMap(ia,ja).getElementsUntil(ha);},getAvailableThreadlistNow:function(ha,ia){ia=ia||i.ALL;return this.getThreadlistOrderMap(ha,ia).getAllResources();},getThreadCount:function(ha,ia){ia=ia||i.ALL;return this.getThreadlistOrderMap(ha,ia).getCurrentArraySize();},hasLoadedThreadlist:function(ha,ia){ia=ia||i.ALL;return this.getThreadlistOrderMap(ha,ia).hasReachedEndOfArray();},unsubscribe:function(ha,ia,ja){ja=ja||i.ALL;this.getThreadlistOrderMap(ia,ja).unsubscribe(ha);}});t(fa,l);function ga(ha){switch(ha.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ha.ordered_threadlists;default:return false;}}e.exports=fa;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","LogHistory","MercuryAPIArgsSource","MercuryFolders","MercuryOrderedThreadlist","MercuryServerRequests","MercurySingletonMixin","MessagingTag","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=i.getInstance('mercury_state_check');function r(s){"use strict";this.$MercuryStateCheck0=s;this.$MercuryStateCheck1=m.getForFBID(this.$MercuryStateCheck0);this.$MercuryStateCheck2=l.getForFBID(this.$MercuryStateCheck0);g.subscribe(h.ON_INVALID_HISTORY,this.$MercuryStateCheck3.bind(this,h.ON_INVALID_HISTORY));d(['ChannelConnection'],function(t){t.subscribe(t.CONNECTED,function(u,v){if(!v.init)this.$MercuryStateCheck4(t.CONNECTED);}.bind(this));}.bind(this));}r.prototype.$MercuryStateCheck3=function(s){"use strict";var t;if(p.getRequestURI().getPath().search(/messages/)!==-1){t=k.getSupportedFolders();}else t=[o.INBOX];q.debug('check',{folders:t,source:s});this.$MercuryStateCheck1.fetchMissedMessages(t,j.MERCURYSYNC);};r.prototype.$MercuryStateCheck4=function(s){"use strict";var t=this.$MercuryStateCheck2.getAvailableThreadlistNow(o.INBOX)||[];t=t.slice(0,20);q.debug('full_check',{threads:t,source:s});this.$MercuryStateCheck1.fetchThreadData(t,j.MERCURYSYNC);this.$MercuryStateCheck3(s);};Object.assign(r,n);e.exports=r;},null);
__d("MNCommerceLogMessageUtils",["BanzaiLogger","Link.react","MercuryIDs","MNCommerceLoggingConstants","MNCommerceLoggerEvents","MNCommerceUnlinkDataManager","MNCommerceDialogStateActions","MNCommerceReplyTypes","MNCommerceUnlinkDialogContainer.react","React","cx","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=b('MercuryThreads').get();function t(){}t.prototype.isCommercePageAdminMessage=function(u){return !!(u&&u.log_message_data&&u.log_message_data.replyType===n.COMMERCE_LINK);};t.prototype.getCommercePageUnlink=function(u){var v=function(){var w=i.getUserIDFromParticipantID(u.author),x=s.getThreadMetaNow(u.thread_id),y=null;x.participants.every(function(aa){if(aa!==u.author){y=i.getUserIDFromParticipantID(aa);return false;}return true;});var z=function(){m.hideDialog();l.unlink(w,y);};m.showDialog(o,{onTurnOffButtonClick:z});g.log('MessengerCommerceLoggerConfig',{event:k.DIALOG_OPENED,debug_data:JSON.stringify({dialog_surface:j.DIALOG_SURFACE.UNLINK})});};return (p.createElement("span",null,u.log_message_body,' ',p.createElement(h,{className:"_2w2m",onClick:v},r._("Not You?"))));};e.exports=new t();},null);
__d("P2PNonEnabledGroupReceiptDialog.react",["CurrentEnvironment","LeftRight.react","P2PAmountUtils","P2PButton.react","P2PBigAmount.react","P2PDialog.react","P2PDialogBody.react","P2PDialogFooter.react","XUICloseButton.react","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PText.react","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();'use strict';var w=t,x=w.PropTypes,y=t.createClass({displayName:"P2PNonEnabledGroupSendReceiptDialog",propTypes:{amount:x.string.isRequired,onClose:x.func.isRequired,receiverName:x.string.isRequired,senderName:x.string.isRequired},componentDidMount:function(){this.log(q.UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CLICKED,{raw_amount:this.props.amount});},log:function(z,aa){p.log(z,Object.assign({www_event_flow:r.UI_FLOW_P2P_GROUP_SEND},aa));},_handleToggle:function(z){if(!z){this.props.onClose();this.log(q.UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CANCELLED);}},_handleOKClick:function(){this._handleToggle(false);},_handleCloseClick:function(){this._handleToggle(false);},render:function(){var z=g.messengerdotcom,aa=z?270:250,ba=t.createElement(h,null,t.createElement("div",null),t.createElement(o,{onClick:this._handleCloseClick}));return (t.createElement(l,{className:(("_45c8")+(z?' '+"_45c9":'')),layerHideOnBlur:false,onToggle:this._handleToggle,shown:true,width:aa},t.createElement(m,null,!z?ba:null,t.createElement("div",{className:"_45ca"},t.createElement(k,{amount:i.sanitizeAmount(this.props.amount)})),t.createElement(s,{className:"_45cc",size:"small",type:"secondary"},v._("{sender name} sent {amount} to {receiver name}",[v.param("sender name",this.props.senderName),v.param("amount",this.props.amount),v.param("receiver name",this.props.receiverName)]),".")),t.createElement(n,null,t.createElement(j,{use:"confirm",size:"medium",label:v._("OK"),type:"primary",onClick:this._handleOKClick}))));}});e.exports=y;},null);
__d("P2PMercuryLogMessage.react",["CurrentEnvironment","CurrentUser","Link.react","MercuryIDs","P2PActions","P2PGKValues","P2PNonEnabledGroupReceiptDialog.react","P2PPaymentLogMessageSubtype","React","ReactLayeredComponentMixin","XP2PTransactionDetailController","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();'use strict';var t=o,u=t.PropTypes,v=o.createClass({displayName:"P2PMercuryLogMessage",mixins:[p],propTypes:{amount:u.string,receiver:u.object.isRequired,sender:u.object.isRequired,subtype:u.oneOf(Object.keys(n).map(function(w){return n[w];})),transferID:u.string.isRequired,threadFBID:u.string,threadID:u.string},getDefaultProps:function(){return {amount:'',sender:null,receiver:null,subtype:null};},getInitialState:function(){return {nonEnabledGroupReceiptDialogShown:false};},handleGroupDetailsLinkClicked:function(){k.chatSendViewOpened({threadID:this.props.threadID,groupThreadFBID:this.props.threadFBID,groupSendReceiptDetails:{amount:this.props.amount,receiverName:this.props.receiver.short_name,senderName:this.props.sender.short_name}});},handleNonEnabledGroupDetailsLinkClicked:function(){this.setState({nonEnabledGroupReceiptDialogShown:true});},_handleNonEnabledGroupDetailsDialogClosed:function(){this.setState({nonEnabledGroupReceiptDialogShown:false});},isViewerSender:function(){return (j.getUserIDFromParticipantID(this.props.sender.id)===h.getID());},isViewerReceiver:function(){return (j.getUserIDFromParticipantID(this.props.receiver.id)===h.getID());},renderTransferDetailsLink:function(){var w=(q.getURIBuilder()).setString('id',this.props.transferID).getURI();return (o.createElement(i,{className:"_kiq",href:w,target:"_blank"},s._("See details")));},renderGroupDetailsLink:function(){return (o.createElement(i,{className:"_kiq",href:"#",onClick:this.handleGroupDetailsLinkClicked},s._("See details")));},renderNonEnabledGroupDetailsLink:function(){return (o.createElement(i,{className:"_kiq",href:"#",onClick:this.handleNonEnabledGroupDetailsLinkClicked},s._("See details")));},renderLayers:function(){var w={};if(this.state.nonEnabledGroupReceiptDialogShown)w.nonEnabledGroupReceiptDialog=o.createElement(m,{amount:this.props.amount,onClose:this._handleNonEnabledGroupDetailsDialogClosed,receiverName:this.props.receiver.short_name,senderName:this.props.sender.short_name});return w;},render:function(){var w=null,x=this.props.amount,y=this.props.subtype,z=this.isViewerSender(),aa=this.isViewerReceiver(),ba,ca=g.messengerdotcom?l.P2PGroupSendMessengerDotCom:l.P2PGroupSendWWW;if(!z&&!aa){if(ca){ba=this.renderGroupDetailsLink();}else ba=this.renderNonEnabledGroupDetailsLink();}else ba=this.renderTransferDetailsLink();switch(y){case n.SENT_IN_GROUP:w=(s._("{sendername} sent {amount} to {receivername}. {details}.",[s.param("sendername",this.props.sender.short_name),s.param("amount",x),s.param("receivername",this.props.receiver.short_name),s.param("details",ba)]));break;case n.CANCELED_EXPIRED:case n.CANCELED_SAME_CARD:case n.CANCELED_SENDER_RISK:case n.CANCELED_RECIPIENT_RISK:case n.CANCELED_CUSTOMER_SERVICE:if(z){w=(s._("Your {amount} payment was canceled. {details}.",[s.param("amount",x),s.param("details",this.renderTransferDetailsLink())]));}else w=(s._("{firstname}'s {amount} payment was canceled. {details}.",[s.param("firstname",this.props.sender.short_name),s.param("amount",x),s.param("details",this.renderTransferDetailsLink())]));break;case n.CANCELED_DECLINED:if(z){w=(s._("{firstname} didn't accept your {amount} payment. {details}.",[s.param("firstname",this.props.receiver.short_name),s.param("amount",x),s.param("details",this.renderTransferDetailsLink())]));}else w=(s._("You didn't accept {firstname}'s {amount} payment. {details}.",[s.param("firstname",this.props.sender.short_name),s.param("amount",x),s.param("details",this.renderTransferDetailsLink())]));break;}return o.createElement("div",null,w);}});e.exports=v;},null);
__d("MercuryLogMessageRenderer",["MercuryAttachmentRenderer","MercuryCallLogMessage.react","CSS","DOM","HovercardLink","MercuryIDs","MercuryViewer","MercuryLogMessageType","MNCommerceLogMessageUtils","P2PMercuryLogMessage.react","MercuryParticipants","React","Image.react","TextWithEntities.react","TooltipLink.react","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y={renderText:function(qa,ra){switch(qa.log_message_type){case n.SUBSCRIBE:aa(qa,ra);break;case n.UNSUBSCRIBE:fa(qa,ra);break;case n.VIDEO_CALL:case n.PHONE_CALL:ha(qa,ra);break;case n.THREAD_NAME:ia(qa,ra);break;case n.THREAD_IMAGE:ja(qa,ra);break;case n.WALLPAPER:ka(qa,ra);break;case n.SERVER_ERROR:la(qa,ra);break;case n.ORION:ma(qa,ra);break;case n.PAGE_REPLY:ga(qa,ra);break;case n.GENERIC_ADMIN_TEXT:na(qa,ra);break;}},renderIcon:function(qa){return (r.createElement(s,{className:z(qa),src:x('images/spacer.gif')}));},renderLegacy:function(qa,ra,sa,ta){z(ta).split(' ').forEach(function(ua){return ua&&i.addClass(qa,ua);});this.renderText(ta,function(ua){r.render(r.createElement("span",null,ua),ra);});this.renderAttachmentLegacy(sa,ta);},renderAttachmentLegacy:function(qa,ra){if(ra.log_message_type==n.THREAD_IMAGE){var sa=ra.log_message_data.image;if(sa){var ta=g.renderPreview(sa.preview_url?sa:null);j.setContent(qa,ta);i.addClass(ta,"_z6a");i.show(qa);}}}};e.exports=y;function z(qa){var ra=qa.log_message_type,sa=qa.log_message_data;return (("_5wzu")+(ra==n.SUBSCRIBE?' '+"_5wzj":'')+(ra==n.UNSUBSCRIBE?' '+"_5wzk":'')+(ra==n.THREAD_NAME?' '+"_5wzl":'')+(ra==n.THREAD_IMAGE?' '+"_5wzm":'')+(ra==n.VIDEO_CALL&&sa.answered?' '+"_5wzn":'')+(ra==n.VIDEO_CALL&&!sa.answered?' '+"_5wzo":'')+(ra==n.PHONE_CALL&&sa.answered?' '+"_5wzp":'')+(ra==n.PHONE_CALL&&!sa.answered?' '+"_5wzq":'')+(ra==n.SERVER_ERROR?' '+"_5wzr":''));}function aa(qa,ra){var sa=pa(qa.log_message_data.added_participants);switch(sa.length){case 1:ba(qa,ra,sa);break;case 2:ca(qa,ra,sa);break;case 3:da(qa,ra,sa);break;default:ea(qa,ra,sa);break;}}function ba(qa,ra,sa){var ta=[qa.author,sa[0]];q.getMulti(ta,function(ua){if(qa.author==m.getID()){ra(w._("You added {subscriber1}.",[w.param("subscriber1",oa(ua[sa[0]]))]));}else if(sa[0]==m.getID()){ra(w._("{actor} added you.",[w.param("actor",oa(ua[qa.author]))]));}else ra(w._("{actor} added {subscriber1}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber1",oa(ua[sa[0]]))]));});}function ca(qa,ra,sa){var ta=[qa.author].concat(sa);q.getMulti(ta,function(ua){if(qa.author==m.getID()){ra(w._("You added {subscriber1} and {subscriber2}.",[w.param("subscriber1",oa(ua[sa[0]])),w.param("subscriber2",oa(ua[sa[1]]))]));}else if(sa[0]==m.getID()){ra(w._("{actor} added you and {subscriber2}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber2",oa(ua[sa[1]]))]));}else ra(w._("{actor} added {subscriber1} and {subscriber2}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber1",oa(ua[sa[0]])),w.param("subscriber2",oa(ua[sa[1]]))]));});}function da(qa,ra,sa){var ta=[qa.author].concat(sa);q.getMulti(ta,function(ua){if(qa.author==m.getID()){ra(w._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param("subscriber1",oa(ua[sa[0]])),w.param("subscriber2",oa(ua[sa[1]])),w.param("subscriber3",oa(ua[sa[2]]))]));}else if(sa[0]==m.getID()){ra(w._("{actor} added you, {subscriber2} and {subscriber3}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber2",oa(ua[sa[1]])),w.param("subscriber3",oa(ua[sa[2]]))]));}else ra(w._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber1",oa(ua[sa[0]])),w.param("subscriber2",oa(ua[sa[1]])),w.param("subscriber3",oa(ua[sa[2]]))]));});}function ea(qa,ra,sa){var ta=[qa.author].concat(sa);q.getMulti(ta,function(ua){function va(xa){var ya=r.createElement("div",null,xa.map(function(za){return r.createElement("div",null,za.name);}));return (r.createElement(u,{alignH:"center",position:"above",tooltip:ya},w._({"*":"{num} more"},[w.param("num",xa.length,[0])])));}var wa=sa.map(function(xa){return ua[xa];});if(qa.author==m.getID()){ra(w._("You added {subscriber1}, {subscriber2} and {more_people}.",[w.param("subscriber1",oa(wa[0])),w.param("subscriber2",oa(wa[1])),w.param("more_people",va(wa.slice(2)))]));}else if(sa[0]==m.getID()){ra(w._("{actor} added you, {subscriber2} and {more_people}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber2",oa(wa[1])),w.param("more_people",va(wa.slice(2)))]));}else ra(w._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[w.param("actor",oa(ua[qa.author])),w.param("subscriber1",oa(wa[0])),w.param("subscriber2",oa(wa[1])),w.param("more_people",va(wa.slice(2)))]));});}function fa(qa,ra){var sa=[qa.author],ta=qa.log_message_data.removed_participants,ua;if(ta.length===1){ua=ta[0];sa.push(ua);}q.getMulti(sa,function(va){var wa=va[qa.author],xa=va[ua];if(qa.author==m.getID()){if(!ua||ua==qa.author){ra(w._("You left the conversation."));}else ra(w._("You removed {name} from the conversation.",[w.param("name",oa(xa))]));}else if(!ua||ua==qa.author){ra(w._("{actor} left the conversation.",[w.param("actor",oa(wa))]));}else if(ua==m.getID()){ra(w._("{actor} removed you from the conversation.",[w.param("actor",oa(wa))]));}else ra(w._("{actor} removed {name} from the conversation.",[w.param("actor",oa(wa)),w.param("name",oa(xa))]));});}function ga(qa,ra){if(o.isCommercePageAdminMessage(qa)){ra(o.getCommercePageUnlink(qa));}else ra(qa.log_message_body);}function ha(qa,ra){var sa=qa.log_message_data.caller,ta=qa.log_message_data.callee,ua=qa.log_message_data.answered,va=sa===m.getID(),wa=va?ta:sa;q.get(wa,function(xa){var ya=l.getUserIDFromParticipantID(xa.id),za=xa.short_name?xa.short_name:xa.name;ra(r.createElement(h,{peerFBID:ya,peerName:za,isAnswered:ua,isOutgoingCall:va}));});}function ia(qa,ra){var sa=qa.log_message_data.name;if(qa.author==m.getID()){if(sa){ra(w._("You named the conversation: {name}.",[w.param("name",r.createElement("span",{className:"_5wzs"},r.createElement(t,{renderEmoticons:true,renderEmoji:true,text:sa})))]));}else ra(w._("You removed the conversation name."));}else q.get(qa.author,function(ta){var ua=oa(ta);if(sa){ra(w._("{actor} named the conversation: {name}.",[w.param("actor",ua),w.param("name",r.createElement("span",{className:"_5wzs"},sa))]));}else ra(w._("{actor} removed the conversation name.",[w.param("actor",ua)]));});}function ja(qa,ra){if(qa.author==m.getID()){if(qa.log_message_data.image){ra(w._("You changed the conversation picture."));}else ra(w._("You removed the conversation picture."));}else q.get(qa.author,function(sa){var ta=oa(sa);if(qa.log_message_data.image){ra(w._("{actor} changed the conversation picture.",[w.param("actor",ta)]));}else ra(w._("{actor} removed the conversation picture.",[w.param("actor",ta)]));});}function ka(qa,ra){if(qa.author==m.getID()){ra(w._("You changed the wallpaper."));}else q.get(qa.author,function(sa){var ta=oa(sa);ra(w._("{actor} changed the wallpaper.",[w.param("actor",ta)]));});}function la(qa,ra){ra(w._("Couldn't find previous messages."));}function ma(qa,ra){var sa=qa.log_message_data,ta=sa.senderId,ua=sa.receiverId;q.getMulti([ta,ua],function(va){ra(r.createElement(p,{amount:sa.formattedAmount,receiver:va[ua],sender:va[ta],subtype:sa.subtype,threadFBID:qa.thread_fbid,threadID:qa.thread_id,transferID:sa.transfer_id}));});}function na(qa,ra){ra(qa.log_message_body);}function oa(qa,ra){var sa=qa.fbid,ta=k.constructEndpoint({id:sa});if(qa.href)return (r.createElement("a",{className:"_5wzt",href:qa.href,"data-hovercard":ta},ra?qa.short_name:qa.name));return qa.name;}function pa(qa){var ra=qa.indexOf(m.getID());if(ra>0){var sa=qa.filter(function(ta){return ta!==m.getID();});return [m.getID()].concat(sa);}return qa;}},null);
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.createElement("a",{href:"/help/224049364288051"},h._("Learn more")))]));}else return (h._("You cannot reply to this conversation."));}};e.exports=i;},null);
__d("MercurySeenByAll",["CSS","DataStore","MercuryDelayedRoger","DOM","MercuryIDs","MercuryViewer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreads').get(),n={},o={updateOnSeenChange:function(q,r,s){n[q.tagName]=true;h.set(q,'thread-id',r.thread_id);g.addClass(q,'seenByListener');p(q,r,s);}};function p(q,r,s){var t=null;if(s){t=k.getParticipantIDFromUserID(s);}else t=l.getID();var u=r.participants.filter(function(w){return w!==t;}),v=r.participants.length>0&&r.participants[0]===t;g.conditionClass(q,'repliedLast',v);g.conditionClass(q,'seenByAll',v&&i.getSeenBy(r.thread_id).length===u.length);}i.subscribe('state-changed',function(q,r){for(var s in n){var t=j.scry(document.body,s+'.seenByListener');for(var u=0;u<t.length;u++){var v=t[u],w=h.get(v,'thread-id');if(r[w])m.getThreadMeta(w,function(x){p(v,x);});}}});e.exports=o;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachmentType","MercuryIDs","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","Style","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFromMixed","copyProperties","cx","formatDate","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){b.__markCompiled&&b.__markCompiled();var ha=k.create('wm_timestamp');function ia(na){this._fbid=na;this._serverRequests=v.getForFBID(na);this._threads=x.getForFBID(na);}da(ia,o);da(ia.prototype,{renderTimestamp:function(na,oa,pa,qa){if(qa){if(!oa){ha.warn('no_title');oa=(new Date(qa)).toLocaleDateString();}na.setAttribute('title',oa);na.setAttribute('data-utime',qa/1000);if(!pa){ha.warn('no_display');pa=fa(new Date(qa),'g:ia');}h.setContent(na,pa);g.show(na);}},renderMessageSourceTags:function(na,oa,pa,qa){var ra='',sa='',ta='';if(ba(pa,n.MESSENGER)){ra=ga._("Sent from Messenger");sa=new z('/mobile/messenger');ta="_9g";}else if(ba(pa,n.MOBILE)){ra=ga._("Sent from Mobile");sa=new z('/mobile/');ta="_9j";}else if(ba(pa,n.CHAT)){ra=ga._("Sent from chat");ta="_9h";}else if(ba(pa,n.EMAIL)){if(qa){ra=ga._("Sent from {email}",[ga.param("email",qa)]);}else ra=ga._("Sent from email");ta="_9i";}if(ta){y.set(na,ra);g.addClass(oa,ta);if(sa){na.setAttribute('href',sa);}else na.removeAttribute('href');}else g.hide(na);},renderMessageLocation:function(na,oa,pa){var qa=new z('/ajax/messaging/hovercard/map.php').setQueryData(pa);na.setAttribute('data-hovercard',qa);g.removeClass(na,"_b9");g.show(oa);},renderSpoofWarning:function(na,oa,pa){if(oa){g.addClass(na,"_sa");y.set(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));}},renderChatSpoofWarning:function(na,oa,pa){if(oa)h.appendContent(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));},renderCoreThreadlist:function(na,oa,pa,qa,ra){qa=qa||{};this.renderThreadImage(na,oa.getNode('image'));var sa=oa.getNode('accessibleName'),ta=[oa.getNode('name')];if(sa)ta.push(sa);ma(this,na,ta,qa);if(na.folder&&ra)la(oa.getNode('folderBadge'),na.folder);var ua=oa.getNode('timestamp');this.renderTimestamp(ua,na.timestamp_absolute,na.timestamp_relative,na.timestamp);this.renderSnippet(na,oa.getNode('snippet'));ka(oa,na);pa(oa,na);},renderAndSeparatedParticipantList:function(na,oa,pa){pa=pa||{};pa.last_separator_uses_and=true;this._threads.getThreadMeta(na,function(qa){ma(this,qa,oa,pa);}.bind(this));},renderSnippet:function(na,oa){var pa=false,qa=h.create('span');g.addClass(qa,'MercuryRepliedIndicator');h.appendContent(oa,qa);u.updateOnSeenChange(qa,na,this._fbid);var ra=na.snippet;if(ra){if(na.snippet_has_attachment)h.appendContent(oa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},ga._("Forwarded Message:")));if(ra.substr(0,4)=='?OTR'){ra=ga._("[encrypted message]");}else ra=ra.replace(/\r\n|[\r\n]/g," ");ra=j(i.htmlEmojiAndEmote(ra));}else{if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},ga._("Forwarded Message")));if(na.snippet_has_attachment&&na.snippet_attachments&&na.snippet_attachments.length){pa=true;ra=h.create('span');d(['MercuryAttachmentSnippet.react'],function(ua){t.render(t.createElement(ua,{thread:na,viewer:this._fbid}),ra);}.bind(this));}}var sa=na.participants.length;if(na.is_subscribed)sa--;var ta=na.snippet_sender;if(!pa&&ta&&m.getParticipantIDFromUserID(this._fbid)!=ta&&sa>1){s.get(ta,function(ua){if(ua.short_name){h.appendContent(oa,ga._("{name}: {conversation_snippet}",[ga.param("name",ua.short_name),ga.param("conversation_snippet",ra)]));}else h.appendContent(oa,ra);});}else h.appendContent(oa,ra);},renderWebMessengerLink:function(na,oa,pa,qa){aa.getThreadURI(na,function(ra){oa.setAttribute('href',ra);pa&&pa();},qa);},renderThreadImage:function(na,oa){t.render(t.createElement(p,{thread:na,viewer:this._fbid}),oa);},renderParticipantList:function(na,oa,pa,qa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa);},renderThreadNameAndParticipantList:function(na,oa,pa,qa){var ra=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa),sa=this._threads.getThreadMetaNow(na);if(!sa.name)return ra;return ga._("{conversation_name} [with {participant_list}]",[ga.param("conversation_name",sa.name),ga.param("participant_list",ra)]);},renderParticipantCount:function(na,oa){return q.renderRawParticipantCount(oa);}});function ja(na){if(!na.snippet_attachments)return [];return na.snippet_attachments.filter(function(oa){return oa.attach_type===l.PHOTO;});}function ka(na,oa){var pa=ja(oa);if(pa.length===0)return;var qa=pa[0].thumbnail_url;if(!qa)return;var ra=(pa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',sa=na.getNode(ra);if(!sa)return;var ta=h.find(sa,'i');w.set(ta,'background-image','url('+qa+')');g.show(sa);}function la(na,oa){ca(na).forEach(function(pa){h.setContent(pa,oa);});}function ma(na,oa,pa,qa){pa=ca(pa);var ra=na._fbid;if(oa.name){pa.forEach(function(ta){t.render(t.createElement(r,{thread:oa,viewer:ra,showUnreadCount:!!qa.show_unread_count}),ta);});return;}var sa=oa.participants;if(oa.participants.length>1)sa=oa.participants.filter(function(ta){return ta!=m.getParticipantIDFromUserID(ra);});s.getMulti(sa,function(ta){q.renderParticipantListWithNoThreadName(na._serverRequests.getServerThreadIDNow(oa.thread_id),oa,sa,ta,pa,qa);});}e.exports=ia;},null);
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={canReplaceOpenSheet:function(h,i){if(h.isSheetWithInput&&h.isSheetWithInput())return i.getType()!=h.getType()&&i.isSheetWithInput&&i.isSheetWithInput();if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;},null);
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;},null);
__d("Token",["CSS","DataStore","DOM","Locale","UnicodeBidi","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this.info=n;this.paramName=o;}m.prototype.getInfo=function(){"use strict";return this.info;};m.prototype.getText=function(){"use strict";return this.info.text;};m.prototype.getValue=function(){"use strict";return this.info.uid;};m.prototype.isFreeform=function(){"use strict";return !!this.info.freeform;};m.prototype.setSelected=function(n){"use strict";g.conditionClass(this.getElement(),'uiTokenSelected',n);return this;};m.prototype.getElement=function(){"use strict";if(!this.element)this.setElement(this.createElement());return this.element;};m.prototype.setElement=function(n){"use strict";h.set(n,'Token',this);this.element=n;return this;};m.prototype.isRemovable=function(){"use strict";return g.hasClass(this.element,'removable');};m.prototype.getTextDirection=function(){"use strict";var n=k.isDirectionRTL(this.getText()),o=j.isRTL();if(n&&!o)return 'rtl';if(!n&&o)return 'ltr';return null;};m.prototype.createElement=function(n,o){"use strict";var p=this.paramName,q=this.getValue(),r=this.getText(),s=i.create('span',{className:'uiTokenText'},r),t=i.create('a',{href:'#','aria-label':l._("Remove {item}",[l.param("item",r)]),className:'remove uiCloseButton uiCloseButtonSmall'});if(n)g.addClass(t,'uiCloseButtonSmallGray');var u=i.create('input',{type:'hidden',value:q,name:p+'[]',autocomplete:'off'}),v=i.create('input',{type:'hidden',value:r,name:'text_'+p+'[]',autocomplete:'off'}),w={className:'removable uiToken'},x=this.getTextDirection();if(x!==null)w.dir=x;var y=i.create('span',w,[s,u,v,t]);if(n)g.addClass(y,'uiTokenGray');if(o){var z=i.create('i',{className:o});i.prependContent(y,z);}return y;};e.exports=m;},null);
__d("WeakToken",["CSS","Token"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){"use strict";if(h!==null)h.apply(this,arguments);}k.prototype.createElement=function(){"use strict";var l=j.createElement.call(this,true,'UFIWeakReferenceIcon');g.addClass(l,'uiTokenWeakReference');return l;};e.exports=k;},null);
__d("Tokenizer",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","DOMQuery","Event","Focus","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent_DEPRECATED","WeakToken","copyProperties","createObjectFrom","emptyFunction","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();var ba=20,ca=aa(h);for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){"use strict";this.element=ga;this.typeahead=ha;this.input=ha.getCore().getElement();if(ia)this.init(ia.tokenarea,ia.param_name,ia.initial_info,ia.options);j.set(this.element,'Tokenizer',this);}fa.prototype.init=function(ga,ha,ia,ja){"use strict";this._handleEvents=this.handleEvents.bind(this);this.init=z;this.setTokenarea(ga);this.paramName=ha;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||this.input.getAttribute('placeholder')||'';x(this,ja||{});this.initEvents();this.initTypeahead();this.reset(ia);this.initBehaviors();setTimeout(this.adjustWidth.bind(this),0);g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);this.inform('init',{tokens:this.getTokens()});};fa.prototype.reset=function(ga){"use strict";this.tokens=[];this.unique={};if(ga){this.populate(ga);}else k.empty(this.tokenarea);this.updateTokenarea();};fa.prototype.populate=function(ga){"use strict";var ha=[];this.tokens=this.getTokenElements().map(function(ia,ja){var ka=ga[ja];ha.push(this._tokenKey(ka));return this.createToken(ka,ia);},this);this.unique=y(ha,this.tokens);};fa.prototype.setTokenarea=function(ga){"use strict";var ha=!this.tokenarea;if(ga!==this.tokenarea){if(this.tokenarea){k.remove(this.tokenarea);for(var ia in this._tokenareaListeners)this._tokenareaListeners[ia].remove();}this._tokenareaListeners=m.listen(ga,{click:this._handleEvents,keydown:this._handleEvents});this.tokenarea=ga;}if(!ha)this.reset();};fa.prototype.getElement=function(){"use strict";return this.element;};fa.prototype.getTypeahead=function(){"use strict";return this.typeahead;};fa.prototype.getInput=function(){"use strict";return this.input;};fa.prototype.initBehaviors=function(){"use strict";this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(ia){ia.behavior(this,ia.config);}.bind(this));}else for(var ga in (this.behaviors||{})){var ha=window.TokenizerBehaviors&&window.TokenizerBehaviors[ga];ha.call(null,this,this.behaviors[ga]);}};fa.prototype.initTypeahead=function(){"use strict";var ga=this.typeahead.getCore();ga.resetOnSelect=true;ga.setValueOnSelect=false;ga.preventFocusChangeOnTab=true;if(this.inline){var ha=this.typeahead.getView();i.addClass(ha.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(ia,ja){return this.handleSelect(ja);}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));};fa.prototype.handleBlur=function(event){"use strict";this.inform('blur',{event:event});this.updatePlaceholder();};fa.prototype.handleSelect=function(ga){"use strict";var ha=ga.selected;if('uid' in ha){this.updateInput();this.addToken(this.createToken(ha));}};fa.prototype.initEvents=function(){"use strict";var ga=v.firefox()<4?'keypress':'keydown';m.listen(this.input,'paste',this.paste.bind(this));m.listen(this.input,ga,this.keydown.bind(this));};fa.prototype.handleEvents=function(event){"use strict";var ga=event.getTarget(),ha=ga&&this.getTokenElementFromTarget(ga);if(!ha)return;if(event.type!='keydown'||m.getKeyCode(event)==p.RETURN)this.processEvents(event,ga,ha);};fa.prototype.processEvents=function(event,ga,ha){"use strict";if(q.byClass(ga,'remove')){var ia=ha.nextSibling;ia=ia&&l.scry(ha.nextSibling,'.remove')[0];var ja=this.getTokenFromElement(ha);ja=this.addTokenData(ja,ga);this.removeToken(ja);this.focusOnTokenRemoval(event,ia);event.kill();}};fa.prototype.focusOnTokenRemoval=function(event,ga){"use strict";n.set(event.type=='keydown'&&ga||this.input);};fa.prototype.addTokenData=function(ga,ha){"use strict";return ga;};fa.prototype.keydown=function(event){"use strict";this.inform('keydown',{event:event});var ga=m.getKeyCode(event),ha=this.input;if(this.inline&&ga==p.BACKSPACE&&o.isEmpty(ha)){var ia=this.getLastToken();if(ia&&ia.isRemovable())this.removeToken(ia);}this.updateInput();};fa.prototype.paste=function(event){"use strict";this.inform('paste',{event:event});this.updateInput(true);};fa.prototype.focusInput=function(){"use strict";n.set(this.input);};fa.prototype.updateInput=function(ga){"use strict";if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(ga)this.input.value=this.input.value;}.bind(this),20);r.setPlaceholderText(this.input,'');this.inform('resize');};fa.prototype.setPlaceholder=function(ga){"use strict";this.placeholder=ga;if(this.stickyPlaceholder)r.setPlaceholderText(this.input,ga);this.updatePlaceholder();};fa.prototype.updatePlaceholder=function(){"use strict";if(!this.inline||this.input.value)return;var ga=!this.tokens.length,ha='';if(ga||this.stickyPlaceholder){this.adjustWidth(this.placeholder);ha=this.placeholder;}else this.adjustWidth(this.input.value);r.setPlaceholderText(this.input,ha);};fa.prototype.adjustWidth=function(ga){"use strict";if(!this.inline||!this._getIsInDOM())return;if(!ga&&this.input.value==='')ga=this.placeholder;var ha=ba;if(ga!==this.placeholder||!this.getTokens().length||this.stickyPlaceholder){var ia=s.getFloat(this.getElement(),'width'),ja=this._getMetrics().measure(ga);ha=ja.width+this._getWidthOffset()+10;ha=(ha>=ia)?ia:ha;}s.set(this.input,'width',ha+'px');this.inform('resize');g.inform('reflow');};fa.prototype.getToken=function(ga){"use strict";return this.unique[ga]||null;};fa.prototype.getTokens=function(){"use strict";return this.tokens||[];};fa.prototype.getTokenElements=function(){"use strict";return l.scry(this.tokenarea,'span.uiToken');};fa.prototype.getTokenElementFromTarget=function(ga){"use strict";return q.byClass(ga,'uiToken');};fa.prototype.getTokenFromElement=function(ga){"use strict";return j.get(ga,'Token');};fa.prototype.getTokenValues=function(){"use strict";if(!this.tokens)return [];return this.tokens.map(function(ga){return ga.getValue();});};fa.prototype.getFirstToken=function(){"use strict";return this.tokens[0]||null;};fa.prototype.getLastToken=function(){"use strict";return this.tokens[this.tokens.length-1]||null;};fa.prototype.hasMaxTokens=function(){"use strict";return this.maxTokens&&this.maxTokens<=this.tokens.length;};fa.prototype.createToken=function(ga,ha){"use strict";var ia=this.getToken(this._tokenKey(ga));if(!ia)ia=ga.weak_reference?new w(ga,this.paramName):new u(ga,this.paramName);ha&&ia.setElement(ha);return ia;};fa.prototype.addToken=function(ga){"use strict";if(this.hasMaxTokens())return;var ha=this._tokenKey(ga.getInfo());if(ha in this.unique)return;this.unique[ha]=ga;this.tokens.push(ga);this.insertToken(ga);this.updateTokenarea();this.inform('addToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.insertToken=function(ga){"use strict";k.appendContent(this.tokenarea,ga.getElement());};fa.prototype.removeToken=function(ga){"use strict";if(!ga)return;var ha=this.tokens.indexOf(ga);if(ha<0)return;this.tokens.splice(this.tokens.indexOf(ga),1);delete this.unique[this._tokenKey(ga.getInfo())];k.remove(ga.getElement());this.updateTokenarea();this.inform('removeToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.removeAllTokens=function(){"use strict";this.reset();this.inform('changeTokens');this.inform('removeAllTokens');};fa.prototype.updateTokenarea=function(){"use strict";var ga=this.typeahead.getCore(),ha=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=ga.getExclusions());ga.setExclusions(ha.concat(this._exclusions));}ga.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();this.inform('resize');g.inform('reflow');};fa.prototype.updateTokenareaVisibility=function(){"use strict";i.conditionShow(this.tokenarea,this.tokens.length!==0);};fa.prototype._tokenKey=function(ga){"use strict";return ga.uid+(ga.freeform?':':'');};fa.prototype._getWidthOffset=function(){"use strict";if(this._widthOffset===null){var ga=this.input.clientWidth,ha=s.getFloat(this.input,'width');if(ga==ha){this._widthOffset=s.getFloat(this.input,'paddingLeft')+s.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;};fa.prototype._getMetrics=function(){"use strict";if(!this._metrics)this._metrics=new t(this.input,this.inline);return this._metrics;};fa.prototype._getIsInDOM=function(){"use strict";return this._isInDOM||(this._isInDOM=l.contains(document.body,this.input));};fa.getInstance=function(ga){"use strict";var ha=q.byClass(ga,'uiTokenizer');return ha?j.get(ha,'Tokenizer'):null;};fa.init=function(ga,ha){"use strict";ga.init(ha.tokenarea,ha.param_name,ha.initial_info,ha.options);};x(fa.prototype,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',_widthOffset:null,_metrics:null});e.exports=fa;},null);
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){event.stopPropagation();if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable()){this._tokenizer.removeToken(t);return;}}else{this._typeahead.getCore().reset();return;}this.inform('esc-pressed');return;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;},null);
__d("StickersDispatcher",["Dispatcher","StickerConstants","copyProperties","merge"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i(new g(),{_handleUpdate:function(l,m){var n=j({payloadSource:l},m);this.dispatch(n);},handleUpdateFromViewActions:function(l){this._handleUpdate(h.PayloadSource.VIEW_ACTION,l);}});e.exports=k;},null);
__d("StickerActions",["BanzaiLogger","StickerConstants","StickersDispatcher"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={addPack:function(k){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.ADD_PACK,packID:k}]});},removePack:function(k){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.REMOVE_PACK,packID:k}]});},selectPack:function(k,l){if(!l)g.log('StickersLoggerConfig',{event:'select_pack',packid:k});i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.SELECT_PACK,packID:k}]});},resetNumNewPacks:function(){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.RESET_NUM_NEW_PACKS}]});}};e.exports=j;},null);
__d("StickerSearch",["StickerServerRequests"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h,i,j={},k={requestStickersForQuery:function(l,m){h=l;g.getStickersForQuery(l,function(n){return h===l&&m(n.payload);});},prepareTagsData:function(){if(!i)i=g.fetchTagData(function(l){j=l;});return i;},getTagByName:function(l){return j[l];},getTagsIndex:function(){return j;}};e.exports=k;},null);
__d("StickerState",["ImmutableObject","StickerConfig","PresenceState","StickerConstants","StickerImages","StickersDispatcher","StickerServerRequests","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=i.get();if(z)y=z.tray_pack_id;var aa=h.ShowStickerReplyNUX,ba=h.ShowStickerSearchNUX,ca={onTrayDataReady:function(fa){if(!q)q=m.fetchTrayData(function(ga){v=ga.packs.map(function(ha){return da(ha);});r=ga.mru;t=ga.num_new_packs;x=ga.tags;});q.then(fa);},onStoreDataReady:function(fa){if(!p)p=m.fetchStoreData(function(ga){w=ga.packs.map(function(ha){return da(ha);});});p.then(fa);},onPackDataReady:function(fa,ga){if(!o[fa])o[fa]=m.fetchPackData(fa,function(ha){da(ha);});o[fa].then(ga);},getPacksInTray:function(){var fa=[],ga;for(var ha=0;ha<v.length;ha++)if(v[ha].id==j.EMOTICON_PACK_ID){ga=v[ha];}else if(v[ha].isMessengerCapable)fa.push(v[ha]);ga&&fa.push(ga);return fa;},getPacksInCommentsTray:function(){var fa=[],ga=[],ha;for(var ia=0;ia<v.length;ia++)if(v[ia].id==j.EMOTICON_PACK_ID){ha=v[ia];}else if(v[ia].isCommentsCapable){fa.push(v[ia]);}else ga.push(v[ia]);var ja=fa.concat(ga);if(ha)ja.push(ha);return ja;},getPacksInComposerTray:function(){return v.filter(function(fa){return fa.isComposerCapable;});},getPackIDsInTray:function(){return v.map(function(fa){return fa.id;});},getPacksInStore:function(){return w.filter(function(fa){return fa.isMessengerCapable;});},getComposerPacksInStore:function(){return w.filter(function(fa){return fa.isComposerCapable;});},getPack:function(fa){return u[fa];},getNumNewPacks:function(){return t;},getFeaturedTags:function(){return x;},resetNumNewPacks:function(){if(t){t=0;this.emit(this.NUM_NEW_PACKS_CHANGED,0);}},addMRUPack:function(){if(r){this._addPackToTray(r);r=null;}},addPack:function(fa){var ga=false;if(u[fa])ga=u[fa].isPromoted;m.addPack(fa,ga,function(ha){this._addPackToTray(ha);}.bind(this));},removePack:function(fa){m.removePack(fa,function(ga){v=v.filter(function(ha){return ha.id!==ga;});u[ga]=g.set(u[ga],{isInTray:false});w=w.map(function(ha){return u[ha.id];});this.emit(this.PACKS_CHANGED,ga);}.bind(this));},setTrayPackID:function(fa){y=fa;i.doSync();this.emit(ca.PACK_SELECTED,fa);},getTrayPackID:function(){return y;},shouldShowStickerReplyNUX:function(){return aa;},clearShowStickerReplyNUX:function(){aa=false;},shouldShowStickerSearchNUX:function(){return ba;},clearShowStickerSearchNUX:function(){m.markSeenSearchNUX();ba=false;},_addPackToTray:function(fa,ga){da(fa);u[fa.id]=g.set(u[fa.id],{isPurchased:!ga,isInTray:true});var ha=v.filter(function(ja){return ja.id===fa.id;}).length>0;if(!ha){var ia;if(!ga){ia=v.filter(function(ja){return ja.isMRU||ja.isSearch;}).length;}else ia=v.filter(function(ja){return ja.id!==j.EMOTICON_PACK_ID;}).length;v.splice(ia,0,u[fa.id]);}w=w.map(function(ja){return u[ja.id];});this.emit(this.PACKS_CHANGED,fa.id);},_addRecentlyUsedSticker:function(fa){for(var ga=0;ga<s.length;++ga)if(s[ga].id===fa.id){s.splice(ga,1);break;}s.unshift(fa);},getMRUStickerPack:function(fa){if(!s)s=fa;return s;},updateRecentlyUsed:function(fa){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(k.getSticker(fa));},promotePackSentFromSearch:function(fa){m.promotePackSentFromSearch(fa,function(ga){return ga&&this._addPackToTray(ga,true);}.bind(this));}};l.register(function(fa){if(fa.actions&&fa.actions.length){var ga=j.ActionTypes;fa.actions.forEach(function(ha){switch(ha.actionType){case ga.ADD_PACK:ca.addPack(ha.packID);break;case ga.REMOVE_PACK:ca.removePack(ha.packID);break;case ga.SELECT_PACK:ca.setTrayPackID(ha.packID);break;case ga.RESET_NUM_NEW_PACKS:ca.resetNumNewPacks();break;}});}});ca.PACKS_CHANGED='StickerState/packsChanged';ca.PACK_SELECTED='StickerState/packSelected';ca.NUM_NEW_PACKS_CHANGED='StickerState/numNewPacksChanged';i.registerStateStorer(function(fa){fa.tray_pack_id=y;});function da(fa){var ga=fa.id;if(!u[ga]){return (u[ga]=new g(fa));}else return (u[ga]=g.set(u[ga],fa));}var ea={};ea[ca.PACK_SELECTED]=true;ea[ca.PACKS_CHANGED]=true;ea[ca.NUM_NEW_PACKS_CHANGED]=true;n(ca,ea);e.exports=ca;},null);
__d("AbstractDialogFitHeight",["CSS","DOM","Event","Style","SubscriptionsHandler","Vector","csx","cx","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=450,q=100,r=67,s=67;function t(u){"use strict";this.$AbstractDialogFitHeight0=u;}t.prototype.enable=function(){"use strict";this.$AbstractDialogFitHeight1=new k();this.$AbstractDialogFitHeight1.addSubscriptions(this.$AbstractDialogFitHeight0.subscribe('beforeshow',this.$AbstractDialogFitHeight2.bind(this)),i.listen(window,'resize',o(this.$AbstractDialogFitHeight2.bind(this))));this.$AbstractDialogFitHeight3=h.find(this.$AbstractDialogFitHeight0.getRoot(),"._4-i2");g.addClass(this.$AbstractDialogFitHeight3,"_5pfh");this.$AbstractDialogFitHeight4=q;if(h.scry(this.$AbstractDialogFitHeight0.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight4+=r;if(h.scry(this.$AbstractDialogFitHeight0.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight4+=s;};t.prototype.disable=function(){"use strict";this.$AbstractDialogFitHeight1.release();this.$AbstractDialogFitHeight1=null;g.removeClass(this.$AbstractDialogFitHeight3,"_5pfh");};t.prototype.$AbstractDialogFitHeight2=function(){"use strict";var u=l.getViewportDimensions().y,v=u-this.$AbstractDialogFitHeight4;j.set(this.$AbstractDialogFitHeight3,this.getHeightProperty(),Math.max(p,v)+'px');this.$AbstractDialogFitHeight0.updatePosition();};e.exports=t;},null);
__d("DialogFitHeight",["AbstractDialogFitHeight"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(){"use strict";if(g!==null)g.apply(this,arguments);}j.prototype.getHeightProperty=function(){"use strict";return 'height';};e.exports=j;},null);
__d("StickerStoreController",["Bootloader","DialogFitHeight","DOM","LayerAutoFocus","LayerFadeOnHide","LayerHideOnEscape","React","XUIDialog.react","XUIDialogBody.react","XUISpinner.react","cx","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=m,t=s.PropTypes,u=688,v=null,w=m.createClass({displayName:"StoreLayer",propTypes:{isComposer:t.bool,packID:t.string,shown:t.bool},getDefaultProps:function(){return {isComposer:false,packID:null,shown:false};},getInitialState:function(){return {renderStore:function(){return (m.createElement("div",{className:"_5r5e"},m.createElement(p,{background:"light",size:"large"})));}};},componentDidMount:function(){g.loadModules(["StickerStore.react"],function(z){this.setState({renderStore:function(){return (m.createElement(z,{currentPackID:this.props.packID,isComposer:this.props.isComposer,onPackSelect:this._packSelected,shown:this.props.shown}));}.bind(this)});}.bind(this));},_packSelected:function(z){this.setProps({packID:z});},_onToggle:function(z){r(this.setProps.bind(this,{shown:z},null));},render:function(){return (m.createElement(n,{behaviors:{DialogFitHeight:h,LayerAutoFocus:j,LayerFadeOnHide:k,LayerHideOnEscape:l},onToggle:this._onToggle,shown:this.props.shown,width:u},m.createElement(o,{className:"_5rq- autofocus"},this.state.renderStore())));}});function x(z,aa){var ba=i.create('div');i.appendContent(document.body,ba);v=m.render(m.createElement(w,{isComposer:aa,packID:z,shown:true}),ba);}var y={showStore:function(z,aa){if(!v){x(z,!!aa);}else v.setProps({shown:true,packID:z,isComposer:!!aa});}};e.exports=y;},null);
__d("StickersFlyoutPackSelector.react",["Animation","ImmutableObject","Locale","React","Image.react","StickerActions","StickerConfig","StickerConstants","StickerInterfaces","StickerState","StickerStoreController","XUIBadge.react","cx","emptyFunction","fbt","ix","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=j,y=x.PropTypes,z=4,aa=200,ba=u._("Sticker Store"),ca=j.createClass({displayName:"StickersFlyoutPackSelector",propTypes:{stickerInterface:y.oneOf(w(o)),numNewPacks:y.number,packs:y.arrayOf(y.instanceOf(h)).isRequired,onPackClick:y.func,selectedPackID:y.string,resetTagSelectorFunc:y.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {stickerInterface:o.MESSAGES,numNewPacks:0};},shouldComponentUpdate:function(ea,fa){return !fa.animating;},onFlyoutShown:function(){if(this.props.packs.length>0){var ea=this._calculatePageForPack(this.props.selectedPackID);if(this.state.page!==ea)this._setPage(ea,0);}},_calculatePageForPack:function(ea){for(var fa=0;fa<this.props.packs.length;fa++)if(this.props.packs[fa].id==ea)return fa<=z?0:Math.floor((fa-1)/z);return 0;},_setPage:function(ea,fa){if(this.state.animating)return;this.setState({animating:true,page:ea},function(){var ga=j.findDOMNode(this.refs.positioner),ha=this._calculatePosition(ea);new g(ga).to(ha.reference,ha.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(fa).go();});},_calculatePosition:function(ea){var fa=j.findDOMNode(this.refs.positioner),ga=fa.childNodes[ea].offsetLeft;if(i.isRTL()){var ha=fa.offsetWidth,ia=fa.childNodes[ea].offsetWidth;return {reference:'right',offset:ga+ia-ha};}return {reference:'left',offset:-ga};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/z));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1,aa);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1,aa);},_openStore:function(){l.resetNumNewPacks();var ea=this.props.stickerInterface==o.COMPOSER;q.showStore(null,ea);},render:function(){return (j.createElement("div",{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),j.createElement("div",{className:"_5r88"},j.createElement("div",{className:"_5r89",ref:"positioner"},this._renderPages()))));},_selectPack:function(ea){var fa=p.getPack(ea);if(fa&&fa.isPromoted)l.addPack(ea);if(ea===n.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();if(this.props.onPackClick){this.props.onPackClick(ea);}else l.selectPack(ea);},_renderPages:function(){var ea=this.props.packs.map(function(ia,ja){return j.createElement(da,{key:ia.id,onClick:function(){return this._selectPack(ia.id);}.bind(this),pack:ia,selected:this.props.selectedPackID===ia.id,index:ja,isComments:this.props.stickerInterface==o.COMMENTS});}.bind(this)),fa=[];for(var ga=0;ga<ea.length;ga+=z){var ha=ga;ga===0&&ga++;fa.push(j.createElement("div",{className:"_5r81",key:ga},ea.slice(ha,ga+z)));}return fa;},_renderStoreButton:function(){return (j.createElement("a",{"aria-label":ba,className:"_5r86 rfloat","data-hover":"tooltip",onClick:this._openStore},j.createElement(k,{className:"_5r87",src:v('/images/messaging/stickers/selector/sticker_store.png')}),this._renderJewel()));},_renderJewel:function(){var ea=this.props.numNewPacks;if(!ea)return null;return (j.createElement(r,{className:"rfloat _3fhs",count:ea,maxcount:9,type:"special"}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;var ea=i.isRTL()?v('/images/messaging/stickers/selector/right.png'):v('/images/messaging/stickers/selector/left.png');return (j.createElement("a",{className:(("_37wu")+(' '+"lfloat")),onClick:this._goPrev},j.createElement(k,{className:"_5r84",src:ea})));},_renderNextArrow:function(){if(!this._canGoNext())return null;var ea=i.isRTL()?v('/images/messaging/stickers/selector/left.png'):v('/images/messaging/stickers/selector/right.png');return (j.createElement("a",{className:(("_37wv")+(' '+"rfloat")),onClick:this._goNext},j.createElement(k,{className:"_5r84",src:ea})));}}),da=j.createClass({displayName:"PackIcon",propTypes:{index:y.number,isComments:y.bool,onClick:y.func,pack:y.instanceOf(h).isRequired,selected:y.bool},getDefaultProps:function(){return {isComments:false,onClick:t};},_getPackIcon:function(ea){if(ea.id==n.SEARCH_PACK_ID)return v('/images/messaging/stickers/icons/search.png');if(ea.id==n.MRU_STICKER_PACK)return v('/images/messaging/stickers/icons/recent.png');if(ea.id==n.EMOTICON_PACK_ID)return v('/images/messaging/stickers/icons/emoji.png');return ea.icon;},render:function(){var ea=this.props.pack,fa=m.WebStickerSearch&&!m.StickerSearchInRecent?this.props.index===1||this.props.index===2:this.props.index===1,ga=(("_5r8a")+(this.props.selected?' '+"_5r8b":'')+(ea.id==n.MRU_STICKER_PACK?' '+"_5qcj":'')+(ea.id==n.SEARCH_PACK_ID?' '+"_5qck":'')+(fa?' '+"_eb3":'')),ha=this.props.isComments&&!ea.isCommentsCapable,ia=u._("This pack is only available in photos"),ja=u._("This pack is only available in messages"),ka=ha?t:function(){return this.props.onClick(ea.id);}.bind(this),la=this._getPackIcon(ea);if(la===null)return null;var ma=ja;if(!ea.isMessengerCapable&&ea.isComposerCapable)ma=ia;return (j.createElement("a",{"aria-label":ha?ma:ea.name,className:ga,"data-id":ea.id,"data-hover":"tooltip",ref:"search_icon",onClick:ka,tabIndex:"0"},j.createElement(k,{className:((ha?"_2ji6":'')+(' '+"_5r8c")+(m.WebStickerSearch?' '+"_1viy":'')),src:la})));}});e.exports=ca;},null);
__d("StickersFlyoutStickerSelector.react",["BanzaiLogger","Grid.react","Image.react","ScrollableArea.react","React","Sticker.react","StickerConstants","StickerConfig","StickerImages","StickerInterfaces","StickerSearch","StickerState","StickerUtils","XUISpinner.react","cx","debounce","emptyFunction","fbt","getObjectValues","ix","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=h.GridItem,ca=k,da=ca.PropTypes,ea=320,fa=278,ga=m.MRU_STICKER_PACK,ha=44,ia=112,ja=v(function(la,ma){if(!la)return;g.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:la,numsearchresults:ma.length});},1000),ka=k.createClass({displayName:"StickersFlyoutStickerSelector",propTypes:{height:da.number,stickerInterface:da.oneOf(y(p)),onQueryResultsFound:da.func,onScroll:da.func,packID:da.string,singleWordTags:da.array,typeaheadTags:da.array,userInput:da.string},getDefaultProps:function(){return {stickerInterface:p.MESSAGES,onScroll:w};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.packID){this.requestStickersForPack(this.props.packID);return;}if(this.props.userInput)this.requestStickersForQuery(this.props.userInput);},componentWillReceiveProps:function(la){if(la.packID&&la.packID!==this.props.packID){this.requestStickersForPack(la.packID);}else if(la.userInput!==this.props.userInput)this.requestStickersForQuery(la.userInput);},requestStickersForQuery:function(la){this.setState({loading:true});q.requestStickersForQuery(la,function(ma){ma.map(function(na){return o.cacheSticker(na);});if(!this.props.tagChosen)ja(la,ma);if(this.props.stickerInterface==p.COMPOSER)ma=ma.filter(function(na){return na.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)ma=ma.filter(function(na){return na.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)ma=ma.filter(function(na){return na.isMessengerCapable;});if(this.isMounted()){this.setState({loading:false,stickers:ma});if(n.EnterToSendSticker)this.props.onQueryResultsFound&&this.props.onQueryResultsFound(ma);}}.bind(this));},requestStickersForPack:function(la){this.setState({loading:true});o.requestStickersForPack(la,m.TRAY_SIZE,function(ma){if(la==ga){ma=r.getMRUStickerPack(ma);if(this.props.stickerInterface==p.COMPOSER)ma=ma.filter(function(na){return na.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)ma=ma.filter(function(na){return na.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)ma=ma.filter(function(na){return na.isMessengerCapable;});}this.setState({loading:false,stickers:ma});}.bind(this));},renderStickers:function(){return this.state.stickers.map(function(la){var ma=s.getScaledDimensions(la.height,la.width,m.TRAY_SIZE);return (k.createElement(ba,{key:la.id},k.createElement("div",{className:"_5r8h","data-id":la.id},k.createElement(l,{animationTrigger:"hover",className:"_5r8i",frameCount:la.frameCount,frameRate:la.frameRate||83,framesPerCol:la.framesPerCol,framesPerRow:la.framesPerRow,sourceHeight:ma.height,sourceURI:la.sourceURI,sourceWidth:ma.width,spriteURI:la.spriteURI,paddedSpriteURI:la.paddedSpriteURI,stickerID:la.id,style:{cursor:'pointer'}}))));});},_onScroll:function(){var la=this.refs.stickerScrollable;if(la){var ma=la.getArea().getScrollTop();this.props.onScroll(ma);}},render:function(){if(this.state.loading){return (k.createElement("div",{className:"_e0r"},k.createElement(t,{size:"large"})));}else if(this.state.stickers.length===0){var la=(ea-ha*2-ia)/2+"px";return (k.createElement("div",{className:"_5jdt",style:{marginTop:la}},k.createElement(i,{src:z("/images/messaging/stickers/icons/sad_face.png")}),k.createElement("p",null,x._("No Stickers to Show"))));}return (k.createElement(j,{ref:"stickerScrollable",height:this.props.height||ea,onScroll:aa(this._onScroll,200),width:fa,fade:true},k.createElement("div",{className:"_5r8k"},k.createElement(h,{cols:4,fixed:true},this.renderStickers()))));}});e.exports=ka;},null);
__d("StickersFlyoutTagSelector.react",["BanzaiLogger","Grid.react","ScrollableArea.react","Parent","React","Image.react","StickerConfig","StickerConstants","StickersFlyoutStickerSelector.react","StickerInterfaces","StickerSearch","StickerState","StickerUtils","Toggler","XUIButton.react","XUICloseButton.react","XUITextInput.react","cx","emptyFunction","fbt","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=h.GridItem,ca=k,da=ca.PropTypes,ea=320,fa=278,ga=44,ha=k.createClass({displayName:"StickersFlyoutTagSelector",propTypes:{trigger:da.string,stickerInterface:da.oneOf(aa(p)),resetTrigger:da.func,onSelectSticker:da.func},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false,matchedStickers:[]};},getDefaultProps:function(){return {trigger:null,stickerInterface:p.MESSAGES,resetTrigger:y,onSelectSticker:y};},componentDidMount:function(){var ia=j.byClass(k.findDOMNode(this),'uiToggle');if(ia)this._togglerSub=t.listen('show',ia,function(){this.isMounted()&&this.focusInput();}.bind(this));this.focusInput();this.selectTrigger(this.props.trigger);},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},componentWillReceiveProps:function(ia){this.selectTrigger(ia.trigger);},focusInput:function(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();},_setMatchedStickers:function(ia){this.setState({matchedStickers:ia?ia:[]});},_onEnter:function(ia){ia.preventDefault();ia.stopPropagation();if(!m.EnterToSendSticker)return;var ja=this.state.matchedStickers;if(ja&&ja.length===1){this.props.onSelectSticker(ja[0].id,ia);this.setState({matchedStickers:[]});}},_inputChanged:function(ia){this.setState({input:ia.target.value,tagChosen:false,isScrolling:false});},_normalizeInput:function(ia){return ia.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function(ia){ia.preventDefault();this.reset();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return m.StickerSearchInRecent?this.renderRecentStickers():this.renderTags();},render:function(){return (k.createElement("div",{className:(("_217a")+(this.state.isScrolling?' '+"_1hg1":''))},k.createElement("div",{className:"_5jdr"},k.createElement("span",{className:"_5jds"}),k.createElement(w,{onEnter:this._onEnter,onChange:this._inputChanged,ref:"inputField",placeholder:z._("Search stickers"),value:this.state.input}),k.createElement(v,{size:"small",onClick:this._handleResetButtonClick,className:((this.state.input.length===0?"hidden_elem":''))})),this.renderContentArea()));},selectTag:function(ia){g.log('StickersLoggerConfig',{event:'select_tag',tagid:ia.id});this.setState({tagChosen:true,input:s.capitalizeWords(ia.name)});this.focusInput();},selectTrigger:function(ia){if(ia!==null){var ja=q.getTagByName(ia);this.setState({tagChosen:true,input:s.capitalizeWords(ja.name)});this.props.resetTrigger();}},_onScroll:function(ia){this.setState({isScrolling:!!ia});},renderStickers:function(){var ia=this._normalizeInput(this.state.input);return (k.createElement(o,{ref:"selector",height:ea-ga,userInput:ia,onScroll:this._onScroll,stickerInterface:this.props.stickerInterface,tagChosen:this.state.tagChosen,onQueryResultsFound:this._setMatchedStickers}));},renderRecentStickers:function(){if(this._normalizeInput(this.state.input).length===1)return k.createElement("div",null);return (k.createElement(o,{ref:"selector",height:ea-ga,packID:n.MRU_STICKER_PACK,onScroll:this._onScroll,stickerInterface:this.props.stickerInterface}));},renderTags:function(){var ia=r.getFeaturedTags().filter(function(ja){return ja.sourceURI!==null;}).sort(function(ja,ka){return ja.order-ka.order;}).map(function(ja,ka){return k.createElement(ba,{key:ka},k.createElement("div",{className:(("_t5c")+(ka<2?' '+"_1b27":'')+(ka%2===0?' '+"_t5d":'')+(ka%2!==0?' '+"_t5e":''))},k.createElement(u,{image:k.createElement(l,{src:ja.sourceURI}),label:ja.name,onClick:this.selectTag.bind(this,ja),className:"_5jdu",style:{background:'#'+ja.color_code},disabled:this._normalizeInput(this.state.input).length===1})));}.bind(this));return (k.createElement(i,{height:ea-ga,width:fa-16,shadow:true,fade:true,className:"_5jei"},k.createElement(h,{spacing:"pas",cols:2,fixed:true,ref:"grid"},ia)));}});e.exports=ha;},null);
__d("StickersFlyout.react",["BanzaiLogger","Event","Keys","MessagesEmoticons.react","Parent","ReactComponentWithPureRenderMixin","React","StickerActions","StickerConstants","StickerConfig","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickersFlyoutTagSelector.react","StickerInterfaces","StickerState","SubscriptionsHandler","Toggler","XUISpinner.react","arrayContains","cx","getObjectValues","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=m,da=ca.PropTypes,ea=o.SEARCH_PACK_ID,fa=m.createClass({displayName:"StickersFlyout",mixins:[l],propTypes:{stickerInterface:da.oneOf(aa(t)),onStickerSelect:da.func.isRequired,onEmoticonSelect:da.func,onShown:da.func,onHidden:da.func,onEscKeyDown:da.func,onPackSelect:da.func,packID:da.string,shown:da.bool,trigger:da.string},getDefaultProps:function(){return {stickerInterface:t.MESSAGES,packID:u.getTrayPackID(),shown:false,trigger:null,packSelectorClass:q,tagSelectorClass:s,glyphProvider:null};},getInitialState:function(){return {dataReady:false,numNewPacks:0};},componentDidMount:function(){if(p.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();this._toggle=k.byClass(m.findDOMNode(this),'uiToggle');this._subscriptions=new v();if(this._toggle){this._subscriptions.addSubscriptions(w.listen('show',this._toggle,this._onShownWrapper),w.listen('hide',this._toggle,this._onHidden));}else if(!p.LoadStickerEarly&&this.props.shown&&!this.state.dataReady)this.loadTrayData();this._subscriptions.addSubscriptions(h.listen(m.findDOMNode(this),'keydown',this._onKeyDown),u.addListener(u.PACKS_CHANGED,this.packsUpdated),u.addListener(u.NUM_NEW_PACKS_CHANGED,function(ga){this.setState({numNewPacks:ga});}.bind(this)));},_onShownWrapper:function(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function(){g.log('StickersLoggerConfig',{event:'open_tray'});if(!p.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();if(this.props.packID===ea)this.refs.tagSelector&&this.refs.tagSelector.focusInput();this.refs.packSelector.onFlyoutShown();},_onHidden:function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(ga){if(!this.state.dataReady&&ga.shown)this.loadTrayData();},componentDidUpdate:function(ga){if(!ga.shown&&this.props.shown){this._onShown();}else if(ga.shown&&!this.props.shown)this._onHidden();},_onKeyDown:function(event){if(event.keyCode===i.ESC&&this.props.onEscKeyDown){this.props.onEscKeyDown();event.kill();}},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){u.onTrayDataReady(function(){var ga=u.getNumNewPacks();this.setState({dataReady:true,numNewPacks:ga});var ha=u.getPacksInTray()[0].id,ia=this.props.packID;if(!ia||!y(u.getPackIDsInTray(),ia)){n.selectPack(ha,true);this.props.onPackSelect&&this.props.onPackSelect(ha);}}.bind(this));},loadPack:function(){if(!this.state.dataReady)return (m.createElement("div",{className:"_e0r"},m.createElement(x,{size:"large"})));if(this.props.packID===o.EMOTICON_PACK_ID)return (m.createElement("div",{className:"_5r8l","data-id":this.props.packID},m.createElement(j,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.props.packID===ea&&p.WebStickerSearch){var ga=this.props.tagSelectorClass;return (m.createElement("div",{className:"_5r8l"},m.createElement(ga,{ref:"tagSelector",className:"fbStickersFlyoutTagSelector",trigger:this.props.trigger,resetTrigger:function(){return this.setProps({trigger:null});}.bind(this),stickerInterface:this.props.stickerInterface,onSelectSticker:this.onSelectSticker})));}return (m.createElement("div",{className:"_5r8l","data-id":this.props.packID},m.createElement(r,{ref:"selector",packID:this.props.packID,stickerInterface:this.props.stickerInterface})));},packsUpdated:function(){var ga=u.getPackIDsInTray();if(!y(ga,this.props.packID)){n.selectPack(ga[0]);return;}this.forceUpdate(null);},onSelectSticker:function(ga,event){if(ga){u.updateRecentlyUsed(ga);this.props.onStickerSelect(ga,event);if(p.PromotePackFromSearch&&this.props.packID===o.SEARCH_PACK_ID)u.promotePackSentFromSearch(ga);u.clearShowStickerReplyNUX();}},selectedSticker:function(event){var ga=k.byClass(event.target,"_5r8h");if(ga){var ha=ga.getAttribute('data-id');this.onSelectSticker(ha,event);}},render:function(){var ga;if(this.props.stickerInterface==t.COMPOSER){ga=u.getPacksInComposerTray();}else if(this.props.stickerInterface==t.COMMENTS){ga=u.getPacksInCommentsTray();}else if(this.props.stickerInterface==t.MESSAGES)ga=u.getPacksInTray();var ha=this.props.packSelectorClass;return (m.createElement("div",{className:ba(this.props.className,"_5r8f")},m.createElement("div",{className:"_5r8e"},m.createElement(ha,{ref:"packSelector",numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.props.packID,packs:ga,stickerInterface:this.props.stickerInterface,resetTagSelectorFunc:this.resetTagSelector,glyphProvider:this.props.glyphProvider})),m.createElement("div",{className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=fa;},null);
__d("XNFXStartForMessageThreadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/nfx\/start_message_thread\/",{thread_fbid:{type:"String",required:true},responsible_fbid:{type:"Int"},av:{type:"Int"},location:{type:"Enum",enumType:1},__asyncDialog:{type:"Int"}});},null);