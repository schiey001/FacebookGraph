/*!CK:3130991410!*//*1432609533,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["aB4nd"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("MessengerView",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent"}};},null);
__d("P2PTransferRiskResult",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SUCCESS:"SUCCESS",UNDER_MANUAL_REVIEW:"UNDER_MANUAL_REVIEW",REQUIRE_VERIFICATION:"REQUIRE_VERIFICATION"};},null);
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;},null);
__d("P2PTriggersUtils",["CurrentEnvironment","MercuryIDs","P2PGKValues","P2PQEValues"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,l={canSeeTriggers:function(m){if(!j.P2PMessageTriggersEnabled)return false;if(h.isMultichat(m))if(g.messengerdotcom&&!i.P2PGroupSendMessengerDotCom){return false;}else if(g.facebookdotcom&&!i.P2PGroupSendWWW)return false;return true;},getMatches:function(m){return m.match(k);}};e.exports=l;},null);
__d("DOMP2PTrigger",["CurrentEnvironment","JSXDOM","P2PAmountUtils","P2PTriggersUtils","TransformTextToDOMMixin","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={MAX_ITEMS:40,match:function(o){var p=j.getMatches(o);if(!p||!p.length)return false;var q=p[0];if(i.isAmountOverLegalLimit(q))return false;var r=p.index;return {startIndex:r,endIndex:r+q.length,element:this._element(q)};},_element:function(o){return (h.a({href:"#",className:(("_35i0")+(g.facebookdotcom?' '+"_4g4e":'')),"data-p2p-trigger":o},o));}};e.exports=l(n,k);},null);
__d("p2pTriggerJSXDOMToString",["DOMEmoji","DOMEmote","DOMP2PTrigger","JSXDOM","transformTextToDOM"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=function(m,n,o){var p=[];p.push(i);if(n)p.push(g);if(o)p.push(h);return (j.span(null,k(m,p))).innerHTML;};e.exports=l;},null);
__d("P2PTriggers.react",["DOM","Event","P2PActions","React","nullthrows","p2pTriggerJSXDOMToString"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"P2PTriggers",propTypes:{renderEmoji:n.bool,renderEmoticons:n.bool,text:n.string.isRequired,threadID:n.string.isRequired},getInitialState:function(){return {amount:''};},_clickListeners:(null),componentDidMount:function(){this._clickListeners=[];var p=g.scry(j.findDOMNode(this),'[data-p2p-trigger]');for(var q=0,r=p.length;q<r;q++)k(this._clickListeners).push(h.listen(p[q],'click',this.handleTriggerClick));},componentWillUnmount:function(){var p;if(this._clickListeners){for(var q=0,r=this._clickListeners.length;q<r;q++){p=this._clickListeners[q];if(p)p.remove();}this._clickListeners=[];}},getAmountFromTriggerClickEvent:function(p){var q=p.target.getAttribute('data-p2p-trigger')||'';return q.replace(/[^0-9\.]+/g,'');},handleTriggerClick:function(p){p.preventDefault();var q=this.getAmountFromTriggerClickEvent(p);this.setState({amount:q});this.openSendView();},openSendView:function(){i.chatSendViewOpened({threadID:this.props.threadID,amount:this.state.amount});},render:function(){var p=l(this.props.text,this.props.renderEmoji,this.props.renderEmoticons);return (j.createElement("span",{dangerouslySetInnerHTML:{__html:p}}));}});e.exports=o;},null);
__d("TextWithEntitiesAndP2P.react",["BaseTextWithEntities.react","Link.react","P2PTriggers.react","React"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=j.createClass({displayName:"TextWithEntitiesAndP2P",_renderText:function(l){return (j.createElement(i,{text:l,renderEmoticons:this.props.renderEmoticons,renderEmoji:this.props.renderEmoji,threadID:this.props.threadID}));},_renderRange:function(l,m){if(this.props.interpolator){return this.props.interpolator(l,m);}else return (j.createElement(h,{href:m.entity},l));},render:function(){return (j.createElement(g,j.__spread({},this.props,{textRenderer:this._renderText,rangeRenderer:this._renderRange,ranges:this.props.ranges,imageRanges:this.props.imageRanges,aggregatedRanges:this.props.aggregatedRanges,text:this.props.text})));}});e.exports=k;},null);
__d("getURLRanges",["URI","URLScraper"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';function i(j,k){k=k||0;var l=h.match(j);if(!l)return [];var m=l;if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(l)))m='http://'+l;if(!g.isValidURI(m))return [];k+=j.indexOf(l);var n=l.length,o=[{offset:k,length:l.length,entity:{url:m}}];return o.concat(i(j.substr(k+n),k+n));}e.exports=i;},null);
__d("MercuryMessageBody.react",["EmoticonsList","React","Link.react","P2PTriggersUtils","ReactComponentWithPureRenderMixin","SupportedEmoji","TextWithEntities.react","TextWithEntitiesAndP2P.react","URI","URLMatcher","cancelAnimationFrame","cx","fbt","getURLRanges","isFacebookURI","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=h,x=w.PropTypes,y=h.createClass({displayName:"MercuryMessageBody",mixins:[k],propTypes:{body:x.string,ranges:x.array,threadID:x.string},getInitialState:function(){return {richText:false};},_shouldRenderP2PTriggers:false,componentDidMount:function(){this._raf=v(this.setIsRichText);},targetBlankLinkInterpolator:function(z,aa){if(aa.entity&&aa.entity.url){var ba=new o(aa.entity.url);if(u(ba)&&!ba.getFragment())aa.entity.url=ba.addQueryData({__mref:'message_bubble'}).toString();}return (h.createElement(i,{target:"_blank",href:aa.entity},z));},setIsRichText:function(){delete this._raf;var z=this.props,aa=z.body,ba=z.ranges;this._shouldRenderP2PTriggers=!!(j.canSeeTriggers(this.props.threadID)&&j.getMatches(aa));if((ba&&ba.length)||g.noncapturingRegexp.test(aa)||l.findEmoji(aa||'')||p.match(aa)||this._shouldRenderP2PTriggers)this.setState({richText:true});},componentWillUnmount:function(){this._raf&&q(this._raf);},render:function(){var z=this.props.body||'',aa;if(z.startsWith('?OTR'))return (h.createElement("span",{className:"_89h"},s._("[encrypted message]")));z=z.replace(/\s+$/,'');if(z.length===0)return null;if(!this.state.richText)return h.createElement("span",{className:this.props.className},z);var ba=this.props.ranges;if(ba==undefined)ba=t(z);aa={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,text:z,ranges:ba,renderEmoticons:true,renderEmoji:true};if(this._shouldRenderP2PTriggers){return (h.createElement(n,h.__spread({},aa,{threadID:this.props.threadID})));}else return (h.createElement(m,h.__spread({},aa)));}});e.exports=y;},null);
__d("DataViewPolyfill",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';function g(h,i,j){if(i===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h);}else if(j===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h,i);}else this.$DataViewPolyfill0=new Uint8Array(h,i,j);this.byteLength=this.$DataViewPolyfill0.byteLength;}g.prototype.getUint8=function(h){if(h>=this.$DataViewPolyfill0.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill0[h];};g.prototype.getUint16=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1);return i?(k*256)+j:(j*256)+k;};g.prototype.getUint32=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1),l=this.getUint8(h+2),m=this.getUint8(h+3);return i?(((m*256+l)*256+k)*256)+j:(((j*256+k)*256+l)*256)+m;};g.isSupported=function(){return !!a.Uint8Array;};e.exports=g;},null);
__d("FBRTCCallabilityActions",["keyMirror"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h=g({CALLABILITY_FETCHED:null,CALLABILITY_FETCH_ERROR:null});function i(j){this.$FBRTCCallabilityActions0=j;}i.prototype.callabilityFetched=function(j,k){this.$FBRTCCallabilityActions0.dispatch({type:h.CALLABILITY_FETCHED,userID:j,callability:k});};i.prototype.callabilityFetchError=function(j){this.$FBRTCCallabilityActions0.dispatch({type:h.CALLABILITY_FETCH_ERROR,userID:j});};i.Types=h;e.exports=i;},null);
__d("XRTCCallabilityController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/rtc\/callability\/",{user_id:{type:"Int",required:true}});},null);
__d("RTCCallabilityStore",["Cache","FBRTCAvailability","FluxStore","FBRTCCallabilityActions","FBRTCCallabilityDataManager","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=.5,n=5;for(var o in i)if(i.hasOwnProperty(o))q[o]=i[o];var p=i===null?null:i.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=i;function q(r){i.call(this,r);this.$RTCCallabilityStore0=new k(r);this.$RTCCallabilityStore1=new g();}q.prototype.__onDispatch=function(r){var s=r.type;switch(s){case j.Types.CALLABILITY_FETCHED:var t=r,u=t.userID,v=t.callability;this.$RTCCallabilityStore1.set(u,v.is_callable,null,(v.is_callable?n:m));this.__emitChange();break;case j.Types.CALLABILITY_FETCH_ERROR:this.$RTCCallabilityStore1.set(r.userID,false,null,m);this.__emitChange();break;}};q.prototype.isCallable=function(r){if(h.isCallable(r))return true;if(!this.$RTCCallabilityStore1.has(r)){this.$RTCCallabilityStore0.fetchCallability(r);this.$RTCCallabilityStore1.set(r,false,null,m);}return !!(this.$RTCCallabilityStore1.get(r));};q.prototype.callButtonTooltip=function(r,s){if(this.isCallable(r))return l._("Start a video call with {shortname}",[l.param("shortname",s)]);return l._("{shortname} is currently unavailable for video calling",[l.param("shortname",s)]);};e.exports=q;},null);
__d("FBRTCCallabilityStore",["FBRTCDispatcher","RTCCallabilityStore"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new h(g);},null);
__d("ChatPerfInstrumentation",["BanzaiLogger","ChatPerfEvent","Promise","emptyFunction","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l={_startTime:(Number),init:function(){this._startTime=k();return new i(function(m){return m();});},_log:function(event){g.log('ChatPerfLoggerConfig',{event:event,duration:k()-this._startTime});},logTTI:function(){this.logTTI=j;this._log(h.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=j;this._log(h.CHAT_CONVERSATION_TTI);}};e.exports=l;},null);
__d("ChatCookieInterface",["ChatConfig","InitialServerTime","LogHistory","PresenceState","PresenceUtil"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i.getInstance('chat_cookie'),m=h.serverTime,n=g.get('tab_max_load_age')||3600000,o=m-n,p={store:function(r,s){if(r.uct2==s.lastChangeTime)return r;var t=q(r,s),u={};if(!t){u.old_tabs=r&&r.t2&&JSON.stringify(r.t2);u.old_promoted=r&&r.lm2;u.old_time=r&&r.uct2;u.old_reason=r&&r.tr;u.old_window=r&&r.tw;var v=[];s.tabs.forEach(function(w){if(!w.fragile){var x={i:w.id,si:w.server_id};if(w.raised)x.r=1;v.push(x);}});r.t2=v;r.lm2=s.promotedTab;r.uct2=s.lastChangeTime;r.tr=s.lastChangeReason;r.tw=k.getSessionID();u.new_tabs=JSON.stringify(r.t2);u.new_promoted=r.lm2;u.new_time=r.uct2;u.new_reason=r.tr;u.new_window=r.tw;l.debug('store',u);}else{u.tabs=r&&r.t2&&JSON.stringify(r.t2);u.promoted=r&&r.lm2;u.time=r&&r.uct2;u.reason=r&&r.tr;u.window=r&&r.tw;u.last_change_time=s.lastChangeTime;u.last_change_reason=s.lastChangeReason;u.min_change_time=o;l.warn('store_bad_state',u);}return r;}};function q(r,s){var t=j.verifyNumber(r.uct2);if(!t||typeof t!=='number'){l.warn('bad_cookie_version',r);return null;}if(t<s.lastChangeTime||t<o)return null;return t;}e.exports=p;},null);
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatDispatcher","ChatConfig","ChatCookieInterface","ChatTabActions","InitialServerTime","LogHistory","JSLogger","MercuryAssert","MercuryLocalIDs","PresenceState","PresenceUtil","areJSONRepresentationsEqual","copyProperties","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=b('MercuryServerRequests').get(),x=b('MercuryThreads').get(),y=b('MercuryTimestampTracker').get(),z=[],aa=null,ba=null,ca=null,da=n.serverTime,ea=k.get('tab_max_load_age')||3600000,fa=da-ea,ga=0,ha=20,ia=o.getInstance('chat_tab_model'),ja=false;function ka(hb){var ib=s.verifyNumber(hb.uct2);if(!ib||typeof ib!=='number'){ia.warn('bad_cookie_version',hb);return null;}if(ib<ga||ib<fa)return null;return ib;}function la(hb){if(hb){var ib=ka(hb);if(ib&&ib!==ga){var jb={};jb.old_tabs=JSON.stringify(z);jb.old_promoted=aa;jb.old_time=ga;jb.old_reason=ca;jb.window_id=t.getSessionID();jb.cookie_tabs=hb&&hb.t2&&JSON.stringify(hb.t2);jb.cookie_promoted=hb&&hb.lm2;jb.cookie_time=hb&&hb.uct2;jb.cookie_reason=hb&&hb.tr;jb.cookie_window=hb&&hb.tw;ga=ib;ca='load';var kb=ma(hb.t2,hb.lm2||null);jb.load_result=kb;jb.new_tabs=JSON.stringify(z);jb.new_promoted=aa;jb.new_time=ga;jb.new_reason=ca;var event='load';if(!ja)event+='_init';ia.log(event,jb);return kb;}}else ia.warn('load_bad_state',hb);return false;}function ma(hb,ib){if(na(hb,ib)){var jb=z.filter(function(mb){return mb.fragile;}),kb={};aa=null;z=hb.map(function(mb){var nb={id:mb.i,server_id:mb.si};if(nb.id==ib)aa=nb.id;if(mb.r)nb.raised=true;kb[nb.id]=nb;return nb;});z=z.filter(function(mb){return mb!=null;});if(ba)for(var lb in ba)if(!kb[lb]||!kb[lb].raised)delete ba[lb];jb=jb.filter(function(mb){return !kb[mb.id];});z=z.concat(jb);ra();return true;}return false;}function na(hb,ib){if(ib!=aa)return true;var jb=z.filter(function(mb){return !mb.fragile;});if(hb.length!=jb.length)return true;for(var kb=0,lb=hb.length;kb<lb;kb++)if(!u(hb[kb],jb[kb]))return true;return false;}function oa(hb,ib,jb){var kb=la(s.get());if(ib===(void 0)||ib>ga){if(hb()){kb=true;ca=jb||null;qa(ib);}}else ia.error('rejected',{change_time:ib,state_time:ga});kb&&pa();}function pa(){if(ja)fb.inform('chat/tabs-changed',fb.get());}function qa(hb){if(hb===(void 0))hb=Math.max(y.getLastUserMessageTimestamp()||1,ga+1);ga=hb;s.doSync();}function ra(hb){var ib=z.length-ha;if(ib>0)z=z.filter(function(jb){return jb.raised||jb.id==hb||ib--<=0;});if(ib>0)z=z.filter(function(jb){return jb.id==aa||jb.id==hb||ib--<=0;});}function sa(hb){for(var ib=0;ib<z.length;ib++)if(z[ib].id==hb)return ib;return -1;}function ta(hb,ib){var jb=x.getThreadMetaNow(hb);if(!jb)return false;if(jb.is_canonical_user){return va(hb,ib);}else{var kb=ua(hb);if(kb)w.getServerThreadID(hb,function(lb){if(ya(hb,lb)){qa();pa();}});return kb;}}function ua(hb){if(sa(hb)===-1){z.push({id:hb,fragile:true});ia.log('open_fragile_tab',{tabs:JSON.stringify(z),opened:hb,window_id:t.getSessionID()});return true;}return false;}function va(hb,ib){var jb=sa(hb);if(jb!=-1)if(z[jb].fragile){z.splice(jb,1);}else{ib&&(z[jb].signatureID=ib);return true;}for(var kb=0;kb<=z.length;kb++)if(kb==z.length||z[kb].fragile){z.splice(kb,0,{id:hb,signatureID:ib});ra(hb);ia.log('open_tab',{tabs:JSON.stringify(z),opened:hb,window_id:t.getSessionID()});return true;}}function wa(hb,ib,jb){q.isThreadID(hb);var kb=false;if(ba&&ib){ba[hb]=true;kb=true;}oa(function(){if(ta(hb,jb))kb=true;var lb=sa(hb);if(lb!=-1&&!z[lb].raised){z[lb].raised=true;kb=true;ia.log('raise_tab',{tabs:JSON.stringify(z),raised:hb,window_id:t.getSessionID()});}return kb;});}function xa(hb){var ib=sa(hb);if(ib!=-1&&(!z[ib].raised||aa!==hb)){z[ib].raised=true;aa=hb;return true;}return false;}function ya(hb,ib){var jb=sa(hb);if(jb!=-1&&z[jb].fragile){var kb=z[jb];kb.fragile=false;kb.server_id=ib;var lb=[];z.forEach(function(mb){if(mb.id!=hb){if(kb&&mb.fragile){lb.push(kb);kb=null;}lb.push(mb);}});if(kb)lb.push(kb);z=lb;ia.log('make_permanent',{tabs:JSON.stringify(z),tab_id:hb,window_id:t.getSessionID()});return true;}return false;}function za(hb,ib){q.isThreadID(hb);var jb=false;if(ba){delete ba[hb];jb=true;}oa(function(){if(ab(hb))jb=true;return jb;},(void 0),ib);}function ab(hb){var ib=sa(hb);if(hb==aa)aa=null;if(ib!=-1){z.splice(ib,1);ia.log('close_tab',{tabs:JSON.stringify(z),closed:hb,window_id:t.getSessionID()});return true;}return false;}function bb(){if(z.length){ia.log('close_all_tabs',{closed_tabs:JSON.stringify(z),window_id:t.getSessionID()});z=[];aa=null;if(ba)ba={};qa();pa();}}function cb(){var hb=[];for(var ib=0;ib<z.length;ib++)if(z[ib].fragile&&!x.isNewEmptyLocalThread(z[ib].id)){hb.push(z[ib]);z.splice(ib);pa();break;}ia.log('close_fragile_tabs',{tabs:JSON.stringify(z),fragile_closed:hb,window_id:t.getSessionID()});}function db(hb){q.isThreadID(hb);var ib=false;if(ba){delete ba[hb];ib=true;}oa(function(){var jb=sa(hb);if(jb!=-1&&z[jb].raised){delete z[jb].raised;ia.log('lower_tab',{tabs:JSON.stringify(z),lowered:hb,window_id:t.getSessionID()});ib=true;}return ib;});}function eb(){if(ba){oa(function(){var hb=false;z.forEach(function(ib){if(ib.raised!=ba[ib.id]){hb=true;if(ba[ib.id]){ib.raised=true;}else delete ib.raised;}});return hb;});ia.log('persist_local_raise',{tabs:JSON.stringify(z),window_id:t.getSessionID()});}}s.registerStateStorer(function(hb){return l.store(hb,{tabs:z,promotedTab:aa,lastChangeTime:ga,lastChangeReason:ca});});s.registerStateLoader(function(hb){if(la(hb))pa();});function fb(){}v(fb,h,{isTabPromoted:function(hb){if(hb)return hb==aa;return false;},indexOf:function(hb){return sa(hb);},getTab:function(hb){q.isThreadID(hb);var ib=this.indexOf(hb);if(ib>-1){var jb=z[ib];return v({},jb);}return null;},getEmptyTab:function(){var hb;for(var ib=0;ib<z.length;ib++){hb=z[ib].id;if(x.isNewEmptyLocalThread(hb))return hb;}hb=r.generateThreadID();x.createNewLocalThread(hb,[]);return hb;},get:function(){var hb=z.map(function(ib){var jb=v({},ib);delete jb.fragile;if(ba)jb.raised=ba[jb.id];return jb;});return {tabs:hb,promoted:aa};},openFragileTab:function(hb){q.isThreadID(hb);if(ua(hb))pa();},openTab:function(hb){q.isThreadID(hb);oa(ta.bind(null,hb));},raiseAndPromoteTab:function(hb,ib,jb,kb,lb){q.isThreadID(hb);var mb=false;if(ba&&ib){ba[hb]=true;mb=true;}oa(function(){if(ta(hb,jb))mb=true;if(xa(hb)){mb=true;ia.log('raise_and_promote_tab',{tabs:JSON.stringify(z),promoted:hb,window_id:t.getSessionID()});}return mb;},kb,lb);},promoteThreadInPlaceOfThread:function(hb,ib,jb,kb){q.isThreadID(hb);q.isThreadID(ib);oa(function(){var lb=sa(hb),mb=sa(ib);if(kb){aa=hb;}else if(aa===ib)return true;var nb=z[lb];if(jb){q.isThreadID(jb);var ob=sa(jb),pb=z[mb];z[mb]=nb;z.splice(lb,1);z.splice(ob,0,pb);}else{z[lb]=z[mb];z[mb]=nb;}return true;});}});g.subscribe(p.DUMP_EVENT,function(hb,ib){ib.chat_tabs={promoted:aa,tabs:z.map(function(jb){return v({},jb);}),time:ga,max_load_age:ea};});function gb(){var hb=i.ignoresRemoteTabRaise();if(hb&&!ba){ia.log('start_ignore_remote_raise');ba={};pa();}else if(!hb&&ba){ia.log('stop_ignore_remote_raise');ba=null;pa();}}j.register(function(hb){switch(hb.actionType){case m.Types.CLOSE_TAB:za(hb.threadID,hb.reason);break;case m.Types.CLOSE_ALL_TABS:bb();break;case m.Types.CLOSE_FRAGILE_TABS:cb();break;case m.Types.LOWER_TAB:db(hb.threadID);break;case m.Types.PERSIST_LOCAL_STATE:eb();break;case m.Types.PROMOTE_TAB:q.isThreadID(hb.threadID);oa(xa.bind(null,hb.threadID));break;case m.Types.RAISE_TAB:wa(hb.threadID,hb.userAction,hb.signatureID);break;}});i.subscribe(i.ON_CHANGED,gb);gb();la(s.getInitial(),true);if(ga===0)ga=da-600000;ja=true;e.exports=fb;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryIDs"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={};function k(l){var m=i.getUserIDFromThreadID(l);if(m&&g.shouldUpdateForID(m))g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification(g._("You were tagged in a message!"),{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("ChatTabViewInstances",["Map"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatNewMessageHandler",["ChatActivity","ChatMentionsNotifications","ChatTabModel","ChatTabViewInstances","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","MercuryConfig","MercuryThreadlistConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.create('chat_new_message'),r={_notify:function(s,t,u){if(o.DesktopNotificationsGK)h.notifyIfMessageToMe(t);var v=j.get(s);u.view_is_visible=v&&v.isVisible();u.view_is_focused=v&&v.isFocused();if(!u.view_is_visible)q.log('message_to_hidden');u.is_active=g.isActive();m.messageReceived(t);},newMessage:function(s,t){l.isThreadID(s);var u=i.getTab(s),v={thread_id:s,message_id:t.message_id,to_new_tab:!u,to_raised_tab:u?!!u.raised:true};this._notify(s,t,v);q.log('message',v);}};m.subscribe('before-alert',function(s,event){var t=event.threadID,u=j.get(t),v=i.getTab(t),w=p.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(v&&v.raised&&u&&u.isVisible()&&u.isFocused()&&n.isActive(w)){u.tryMarkAsRead();event.cancelAlert();}});e.exports=r;},null);
__d("ChatTabLRUManager",["ChatTabViewInstances","ChatTabModel","InitialServerTime","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryThreads').get(),k={getLRUVisibleTab:function(l){if(l.hasRoomForRaisedTab())return (void 0);var m=Object.keys(l.getTabsToShow()||{}),n=1*60,o=null,p=Infinity;for(var q=0;q<m.length;q++){var r=m[q],s=j.getThreadMetaNow(r);if(h.isTabPromoted(r))continue;if(!g.get(r).hasEmptyInput()||!s)continue;var t=(i.serverTime-s.timestamp)/1000;if(!s.timestamp||(s.timestamp&&s.timestamp<p&&t>n)){o=s.thread_id;p=s.timestamp;}}return o;}};e.exports=k;},null);
__d("ChatTabPolicy",["ChatBehavior","JSLogger","MercuryActionType","MercuryLogMessageType","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercurySourceType","MercuryThreadInfo","MercuryThreadMode","MercuryViewer","MessagingTag","PresencePrivacy","ShortProfiles","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryThreadActions').get(),v=h.create('tab_policy');e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(o.isMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};v.log('message_thread_muted',ba);return;}if(w.mode==p.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};v.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};v.log('message_source_not_allowed',ba);return;}var ca=l.getUserIDFromParticipantID(x.author);if(!ca){v.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=i.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(x,w)){ba={thread_id:z,message_id:aa,type:x.action_type};v.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){v.log('message_jabber',{thread_id:z,message_id:aa});u.markSeen(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){v.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(w.folder!=r.INBOX){v.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserIDFromParticipantID(q.getID());t.getMulti([ca,da],function(ea){if(!s.allows(ca)){v.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&!ea[ca].isCommercePage&&ea[ca].type!==m.FRIEND){v.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});},_messageIsNewlyCreatedGroup:function(w,x){return w.action_type===i.LOG_MESSAGE&&w.log_message_type===j.THREAD_NAME&&x.message_count===1;}};},null);
__d("ChatTabViewEvents",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatTabViewSelector",["Event","Arbiter","ChatTabActions","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=b('MercuryThreadInformer').get(),s=b('MercuryThreads').get(),t=b('MercuryThreadMetadataRenderer').get();function u(v){var w=o[':fb:chat:tab:selector'].build(),x=w.getRoot(),y=w.getNode('menu'),z=l.find(y,'.uiMenuInner'),aa={},ba=new n().init(x);j.hide(x);l.insertBefore(v,x);function ca(fa){var ga=0;for(var ha in aa){var ia=aa[ha],ja=s.getThreadMetaNow(ha),ka=ia.getNode('unreadCount'),la=(ja&&ja.unread_count)||0;ga+=la;if(la>9)la='+';j.conditionClass(ka,'invisible_elem',!la);l.setContent(ka,la);}var ma=w.getNode('numMessages');j.conditionShow(ma,ga);l.setContent(ma,ga);}this.setTabData=function(fa){aa={};if(fa.length<1){j.hide(x);return;}j.show(x);l.empty(z);fa.forEach(function(ga){var ha=o[':fb:chat:tab:selector:item'].build();aa[ga.id]=ha;var ia=ha.getNode('content');t.renderAndSeparatedParticipantList(ga.id,ia);l.prependContent(z,ha.getRoot());k.set(ha.getRoot(),'threadID',ga.id);var ja=ha.getNode('closeButton');g.listen(ja,'click',function(event){i.closeTab(ga.id,'selector/close-tab');event.kill();});});ba.flyoutContentChanged();l.setContent(w.getNode('numTabs'),fa.length);ca();};function da(event,fa){if(fa.menu!=y)return;var ga=k.get(fa.item,'threadID');u.inform('selected',ga);p.hide(x);}function ea(event,fa){m.register(y);}m.subscribe('select',da.bind(this));p.listen('show',x,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ea();});p.listen('hide',x,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});r.subscribe('threads-updated',ca);}q(u,new h());e.exports=u;},null);
__d("ChatTabController",["Arbiter","BanzaiLogger","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabActions","ChatTabLRUManager","ChatTabModel","ChatTabPolicy","ChatTabViewEvents","ChatTabViewInstances","ChatTabViewSelector","JSLogger","MercuryViewer","Style","UserAgent_DEPRECATED","VideoCallCore","ChatTabPresence","ChatTypeaheadBehavior","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();b('ChatTabPresence');b('ChatTypeaheadBehavior');var x=b('MercuryThreadInformer').get(),y=b('MercuryThreadActions').get(),z=b('MercuryThreads').get(),aa=j.get('tab_auto_close_timeout')||7200000,ba=s.create('tab_controller');function ca(na,oa,pa){var qa=n.get().tabs,ra=qa[na],sa,ta;if(qa.length===0)return false;var ua=qa.slice(na+1),va=qa.slice(0,na),wa=ua.concat(va);if(!oa)wa.reverse();if(ra)wa.push(ra);for(var xa=0;xa<wa.length;xa++){sa=wa[xa];ta=q.get(sa.id);if(ta&&ta.isVisible()&&(!pa||sa.raised)){ta.focus();return true;}}return false;}function da(na,oa){var pa=oa&&oa.getRightmostHiddenTab();if(pa===na)return null;return pa;}function ea(){return Math.floor(Math.random()*2147483648).toString(16);}function fa(na,oa,pa,qa){l.raiseTab(na,true,pa);var ra=oa&&oa.getLeftmostVisibleTab(),sa=oa&&oa.getTabsToShow();if(sa&&!sa[na]&&ra){n.promoteThreadInPlaceOfThread(na,ra,da(na,oa),true);}else l.promoteTab(na);g.inform('chat/open-tab',na);var ta=q.get(na);ta&&ta.focus();}function ga(na,oa){if(!n.getTab(na))l.raiseTab(na,false);var pa=oa&&m.getLRUVisibleTab(oa),qa=oa&&oa.getTabsToShow();if(qa&&!qa[na]&&pa)n.promoteThreadInPlaceOfThread(na,pa,da(na,oa));}function ha(na){r.subscribe('selected',function(pa,qa){fa(qa,na);});g.subscribe('page_transition',function(pa,qa){l.closeFragileTabs();});g.subscribe('chat-visibility/go-offline',function(){l.closeAllTabs();});i.subscribe('idle',function(pa,qa){if(qa>aa){var ra=n.get().tabs;ra.forEach(function(sa){var ta=sa.id;z.getThreadMeta(ta,function(ua){if(!ua.unread_count){ba.log('autoclose_idle_seen',{thread_id:ta,idleness:qa});l.closeTab(ta,'autoclose_idle_seen');}});});}});p.subscribe('nub-activated',function(pa,qa){fa(qa,na);});p.subscribe('focus-tab',function(pa,qa){var ra=n.getTab(qa);if(ra&&ra.raised)fa(qa,na,ra.signatureID,true);});function oa(pa,qa){h.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});w.showOutgoingCallDialog(qa.userID,qa.clickSource);}p.subscribe('video-call-clicked',oa);p.subscribe('interaction-with-tab',function(pa,qa){var ra=n.getTab(qa);ra&&ra.raised&&y.markSeen(qa);});p.subscribe('esc-pressed',function(pa,qa){ba.log('close_esc',{thread_id:qa});var ra=n.indexOf(qa);l.closeTab(qa,'close_esc');setTimeout(function(){ca(ra-1,true,true);},0);});x.subscribe('messages-received',function(pa,qa){for(var ra in qa){var sa=qa[ra];for(var ta=0;ta<sa.length;ta++){var ua=sa[ta];if(ua.author!=t.getID()){if(!ua.is_unread){ba.log('message_already_read',{action_id:ua.action_id,thread_id:ua.thread_id});continue;}z.getThreadMeta(ra,function(va){o.messageIsAllowed(va,ua,function(){ga(ra,na);k.newMessage(ra,ua);});});}}}});x.subscribe('thread-read-changed',function(pa,qa){for(var ra in qa)if(!qa[ra].mark_as_read){ba.log('autoclose_marked_unread',{thread_id:ra});l.closeTab(ra,'autoclose_marked_unread');}});p.subscribe('tab-pressed',function(pa,qa){return !ca(n.indexOf(qa.id),qa.shiftPressed);});g.subscribe(s.DUMP_EVENT,function(pa,qa){qa.chat_controller={auto_close_timeout:aa};});this.openTab=function(pa,qa,ra){fa(pa,qa,ea());if(ra)ra(q.get(pa));};}if(v.firefox()){var ia=function(){return u.get(document.body,'overflowX')+' '+u.get(document.body,'overflowY');},ja=ia(),ka=function(){var na=ia();if(na!==ja){ja=na;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var la=new MutationObserver(ka),ma={attributes:true,attributeFilter:['class','style']};la.observe(document.documentElement,ma);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ka();},false);}e.exports=ha;},null);
__d("ChatAddToThreadButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i,n=m.PropTypes,o=i.createClass({displayName:"ChatAddToThreadButton",mixins:[h],propTypes:{isFBAtWork:n.bool,onClick:n.func,shown:n.bool},render:function(){var p=this.props.isFBAtWork?l._("Add more co-workers to chat"):l._("Add more friends to chat"),q=j.getTrackingInfo(j.types.ADD_TO_THREAD);return (i.createElement(g,{"aria-label":p,className:(("addToThread")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":q,"data-hover":"tooltip","data-tooltip-alignv":"top",onClick:this.props.onClick}));}});e.exports=o;},null);
__d("ChatArchiveWarning.react",["Image.react","ReactComponentWithPureRenderMixin","React","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatArchiveWarning",mixins:[h],propTypes:{isFBAtWork:m.bool,shown:m.bool},render:function(){var o=this.props.isFBAtWork?k('images/chat/tab/archive-grey.png'):k('images/chat/tab/archive.png');return (i.createElement(g,{src:o,className:(("titanArchiveWarning")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-hover":"tooltip","data-tooltip-alignh":"center","aria-label":"All employee-to-employee conversations will be archived"}));}});e.exports=n;},null);
__d("ChatCloseButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatCloseButton",mixins:[h],propTypes:{onClick:m.func,onKeyUp:m.func,onMouseDown:m.func,active:m.bool},getDefaultProps:function(){return {active:false};},render:function(){var o=j.getTrackingInfo(j.types.CLOSE_BUTTON),p=k._("Press Esc to close"),q=k._("Close tab");return (i.createElement(g,{"aria-label":this.props.active?p:q,className:"close button","data-ft":o,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp,onMouseDown:this.props.onMouseDown}));}});e.exports=n;},null);
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryIDs","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getUserIDFromThreadID(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;},null);
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=60000,o=false,p=function(w,x){this._videoCallTour=new k();this._threadID=w;this._tabMainElement=x;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function q(w,event,x){if(w._openDialog)w._openDialog.updatePosition();}function r(w){if(w._openDialog)w._openDialog.updatePosition();}function s(w){if(w._openDialog){w._openDialog.hide();w._openDialog=null;}if(w._timeout){clearTimeout(w._timeout);w._timeout=null;}while(w._subscriptionTokens.length)w._subscriptionTokens.pop().unsubscribe();if(w._scrollListener){w._scrollListener.remove();w._scrollListener=null;}}function t(w,event,x){if(x.thread_id===w._threadID){w._openDialog=x.dialog;v(w);w._timeout=m(w.destroy.bind(w,w._threadID),n);w._scrollListener=g.listen(window,'scroll',r.bind(null,w));}}function u(w,x){if(!w._openDialog){w._subscriptionTokens.push(x.subscribe('chat/dialog-rendered',t.bind(null,w)));x.render(w._tabMainElement,w._threadID);}}function v(w){w._subscriptionTokens.push(i.subscribe('chat/tabs-changed',q.bind(null,w)),p.subscribe('dialog/close-all',s.bind(null,w)));}l(p,h);l(p.prototype,{destroy:function(){s(this);},tabFocused:function(){if(o){u(this,this._videoCallTour);return;}},tabNotActive:function(){s(this);},hideVideoCallouts:function(){s(this);}});j.subscribe('videocallingtour/start',function(){o=true;p.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){o=false;});e.exports=p;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","ModulePerformanceGating","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';function ba(){return 'upload_'+s.getNewID();}var ca=aa(g);for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){this.$ChatAutoSendPhotoUploader0=ia;this.$ChatAutoSendPhotoUploader1=ha;this.$ChatAutoSendPhotoUploader2=new t();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=false;this.$ChatAutoSendPhotoUploader6=ga.getAttribute('action');this.$ChatAutoSendPhotoUploader7=new k(ga,[n,l]);this.$ChatAutoSendPhotoUploader7.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader7.setUploadInParallel(true);var ja=i.find(ga,"._4q60"),ka=i.find(ja,"._4q61");this.$ChatAutoSendPhotoUploader8=new m(ja,ka,ha);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader7.subscribe('submit',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('success',this.$ChatAutoSendPhotoUploadera.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('failure',this.$ChatAutoSendPhotoUploaderb.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('progress',this.$ChatAutoSendPhotoUploaderc.bind(this)),j.listen(ka,'click',function(){if(this.$ChatAutoSendPhotoUploaderd===(void 0))this.$ChatAutoSendPhotoUploadere();if(this.$ChatAutoSendPhotoUploaderd)if(o.prepareResource)o.prepareResource();this.inform('open');}.bind(this)));if(!q.js_module_defer_blob_creation)this.$ChatAutoSendPhotoUploadere();}fa.prototype.$ChatAutoSendPhotoUploadere=function(){this.$ChatAutoSendPhotoUploaderd=o.isSupported();if(this.$ChatAutoSendPhotoUploaderd)this.$ChatAutoSendPhotoUploader7.setPreprocessHandler(this.$ChatAutoSendPhotoUploaderf.bind(this));};fa.prototype.isUploading=function(){return !z(this.$ChatAutoSendPhotoUploader3);};fa.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader7.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};fa.prototype.$ChatAutoSendPhotoUploaderg=function(ga,ha){var ia=this.$ChatAutoSendPhotoUploaderh(ga);if(ha){ia.preview_width=ha.width;ia.preview_height=ha.height;}return ia;};fa.prototype.$ChatAutoSendPhotoUploaderh=function(ga){var ha={upload_id:ga,on_progress:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ia));}.bind(this),on_resizing_progress:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ia));}.bind(this),on_success:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ia));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderi.bind(this),attach_type:p.PHOTO,preview_uploading:true};return ha;};fa.prototype.$ChatAutoSendPhotoUploaderf=function(ga,ha){var ia=ga.getFile();if(!r(ia.type).isJpeg())return ha(ga);o.getSingleton().resizeBlob(ia,function(ja,ka,la){if(ka)ga.setFile(ka);ha(ga);},this.$ChatAutoSendPhotoUploaderj.bind(this,ga));};fa.prototype.$ChatAutoSendPhotoUploader9=function(){var ga=ba();this.$ChatAutoSendPhotoUploaderk(ga,this.$ChatAutoSendPhotoUploader1.files);};fa.prototype.$ChatAutoSendPhotoUploaderk=function(ga,ha){var ia={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ha&&ha.length===1){this.$ChatAutoSendPhotoUploader3[ga]=ga;ia[ga]=ha[0];var ja=new FileReader();ja.onload=function(){this.inform('submit',{upload_id:ga,preview_attachments:[this.$ChatAutoSendPhotoUploaderg(ga,w(ja.result))]});}.bind(this);ja.onerror=function(){this.inform('submit',{upload_id:ga,preview_attachments:[this.$ChatAutoSendPhotoUploaderh(ga)]});}.bind(this);ja.readAsArrayBuffer(ha[0]);}else{var ka=[];if(!ha){this.$ChatAutoSendPhotoUploader3[ga]=ga;this.$ChatAutoSendPhotoUploader0.value=ga;ka.push(this.$ChatAutoSendPhotoUploaderh(ga));}else for(var la=0;la<ha.length;++la){var ma=ba();ia[ma]=ha[la];this.$ChatAutoSendPhotoUploader3[ma]=ga;ka.push(this.$ChatAutoSendPhotoUploaderh(ma));}this.inform('submit',{upload_id:ga,preview_attachments:ka});}if(Object.keys(ia).length>0)this.$ChatAutoSendPhotoUploader7.setFiles(ia);};fa.prototype.$ChatAutoSendPhotoUploadera=function(event,ga){var ha=this.$ChatAutoSendPhotoUploaderl(ga);if(this.$ChatAutoSendPhotoUploader3[ha]){var ia=this.$ChatAutoSendPhotoUploader3[ha];delete this.$ChatAutoSendPhotoUploader3[ha];var ja=ga.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ia])this.$ChatAutoSendPhotoUploader4[ia]=[];this.$ChatAutoSendPhotoUploader4[ia].push({id:ha,audio_id:ja.metadata[0].audio_id,image_id:ja.metadata[0].image_id,file_id:ja.metadata[0].file_id,gif_id:ja.metadata[0].gif_id});this.inform('success',{upload_id:ha});if(!this.$ChatAutoSendPhotoUploaderm(ia))this.$ChatAutoSendPhotoUploadern(ia);this.$ChatAutoSendPhotoUploader8.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader8.getInput();}};fa.prototype.$ChatAutoSendPhotoUploadern=function(ga){y(!this.$ChatAutoSendPhotoUploaderm(ga));this.$ChatAutoSendPhotoUploader4[ga].sort(function(ha,ia){return ha.id<ia.id?-1:1;});this.inform('all-uploads-completed',{upload_id:ga,audio_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.audio_id;}),image_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.image_id;}),file_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.file_id;}),gif_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.gif_id;})});delete this.$ChatAutoSendPhotoUploader4[ga];};fa.prototype.$ChatAutoSendPhotoUploaderc=function(event,ga){this.inform('progress',{upload_id:ga.upload.getName(),event:ga.event});};fa.prototype.$ChatAutoSendPhotoUploaderj=function(ga,event){this.inform('resize_progress',{upload_id:ga.getName(),event:event});};fa.prototype.$ChatAutoSendPhotoUploaderm=function(ga){return u(x(this.$ChatAutoSendPhotoUploader3),ga);};fa.prototype.$ChatAutoSendPhotoUploaderb=function(event,ga){var ha=this.$ChatAutoSendPhotoUploaderl(ga);this.$ChatAutoSendPhotoUploadero(ha,'last-upload-failed');this.$ChatAutoSendPhotoUploader8.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader8.getInput();return false;};fa.prototype.$ChatAutoSendPhotoUploaderi=function(ga){this.$ChatAutoSendPhotoUploadero(ga,'last-upload-canceled');};fa.prototype.$ChatAutoSendPhotoUploadero=function(ga,ha){if(!this.$ChatAutoSendPhotoUploader3[ga])return;var ia=this.$ChatAutoSendPhotoUploader3[ga];delete this.$ChatAutoSendPhotoUploader3[ga];if(!this.$ChatAutoSendPhotoUploaderm(ia))if(this.$ChatAutoSendPhotoUploader4[ia]){this.$ChatAutoSendPhotoUploadern(ia);}else this.inform(ha,{upload_id:ia});};fa.prototype.$ChatAutoSendPhotoUploaderl=function(ga){if(ga.upload){return ga.upload.getName();}else return ga.response.getPayload().uploadID;};fa.prototype.uploadFile=function(ga){var ha=ba(),ia={};ia[ha]=ga;var ja=new h(this.$ChatAutoSendPhotoUploader6).setAllowCrossOrigin(true).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader5).setRelativeTo(this.$ChatAutoSendPhotoUploader7.getRoot()).setFiles(ia);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ja.subscribe('success',function(event,ka){this.$ChatAutoSendPhotoUploadera(event,{upload:ka,response:ka.getResponse()});}.bind(this)),ja.subscribe('failure',this.$ChatAutoSendPhotoUploaderb.bind(this)));ja.send();this.$ChatAutoSendPhotoUploaderk(ha,[ga]);};fa.prototype.setAllowCrossPage=function(ga){this.$ChatAutoSendPhotoUploader5=ga;this.$ChatAutoSendPhotoUploader7.setAllowCrossPageTransition(ga);};e.exports=fa;},null);
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=l,t=s.PropTypes,u=l.createClass({displayName:"ChatPhotoUploader",propTypes:{actionURI:t.string,allowCrossPage:t.bool,disabled:t.bool,imageClassName:t.string,imagesOnly:t.bool,linkClassName:t.string,onSubmit:t.func,onAllUploadsComplete:t.func,onLastUploadFail:t.func,onLastUploadCancel:t.func},getDefaultProps:function(){return {actionURI:k.upload_url,allowCrossPage:true,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(l.findDOMNode(this.refs.form),l.findDOMNode(this.refs.input),l.findDOMNode(this.refs.attachID));this._uploader.setAllowCrossPage(this.props.allowCrossPage);this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(v,w){return v.actionURI!=this.props.actionURI||v.disabled!==this.props.disabled;},componentDidUpdate:function(v,w){this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function(){return (l.createElement("form",{action:this.props.actionURI,title:this.props.imagesOnly?p._("Add Photos"):p._("Add Files"),method:"post",onClick:function(v){v.stopPropagation();if(this.props.disabled)v.preventDefault();}.bind(this),ref:"form"},l.createElement("input",{type:"hidden",name:"attach_id",ref:"attachID"}),l.createElement("input",{type:"hidden",name:"images_only",value:this.props.imagesOnly}),l.createElement(i,{className:"_m _4q60 _3rzn"},l.createElement(j,{className:r("_4q61 _5f0v _509v",this.props.linkClassName)},l.createElement(h,{className:this.props.imageClassName,src:q('/images/chat/chat_camera_icon.png'),alt:p._("Camera")})),l.createElement("input",{disabled:this.props.disabled,type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:this.props.imagesOnly?'image/*':'*',ref:"input"}))));},_handleSubmit:function(v,w){this.props.onSubmit(v,w);},_handleAllUploadsCompleted:function(v,w){this.props.onAllUploadsComplete(v,w);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function(v,w){this.props.onLastUploadFail(v,w);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function(v,w){this.props.onLastUploadCancel(v,w);if(!this.isMounted())this._cleanup();},isUploading:function(){return this._uploader&&this._uploader.isUploading();},uploadFile:function(v){this._uploader.uploadFile(v);},_cleanup:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});e.exports=u;},null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&i.unsubscribe(this._subscribeToken);}});e.exports=k;},null);
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s,t,u){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=t;this.$ChatShareLinkUploader6=u;this.$ChatShareLinkUploader7=false;m.listen(r,'keyup',function(){!this.getInputValue().length&&this.$ChatShareLinkUploader8.enable();}.bind(this));this.$ChatShareLinkUploader8=new j(r,t);this.$ChatShareLinkUploader8.subscribe('match',function(v,w){this.loadShare(w&&w.url);}.bind(this));this.$ChatShareLinkUploader9=1337;this.$ChatShareLinkUploadera=null;}p.prototype.getInputValue=function(){"use strict";return this.$ChatShareLinkUploader5?this.$ChatShareLinkUploader5():this.$ChatShareLinkUploader1.value;};p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1,this.$ChatShareLinkUploader5);};p.prototype.getShareData=function(){"use strict";if(!this.$ChatShareLinkUploader3)return null;return this.getShareDataFromStage(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploaderb();this.$ChatShareLinkUploader8.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploaderb();this.$ChatShareLinkUploader8.enable();};p.prototype.$ChatShareLinkUploaderb=function(){"use strict";var q=this.$ChatShareLinkUploadera;delete this.$ChatShareLinkUploadera;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploaderc();this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader7=false;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader8&&this.$ChatShareLinkUploader8.reset();};p.prototype.loadShareFromParams=function(q,r){"use strict";this.$ChatShareLinkUploader7=true;this.$ChatShareLinkUploaderd(new g().setMethod('POST').setURI('/ajax/share_params.php').setData({chat:true,share_type:q,share_params:r}));};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploaderd(new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData({chat:true,extra_params:JSON.stringify(r),u:q}),q);};p.prototype.loadedFromFeed=function(){"use strict";return this.$ChatShareLinkUploader7;};p.prototype.$ChatShareLinkUploaderc=function(){"use strict";return (++this.$ChatShareLinkUploader9);};p.prototype.$ChatShareLinkUploadere=function(){"use strict";return this.$ChatShareLinkUploader9;};p.prototype.$ChatShareLinkUploaderd=function(q,r){"use strict";this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploadera)i.remove(this.$ChatShareLinkUploadera);this.$ChatShareLinkUploadera=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploadera);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');var t=this.$ChatShareLinkUploaderc();this.$ChatShareLinkUploader4=q.setHandler(function(u){return this.$ChatShareLinkUploaderf(t,u,r);}.bind(this));this.$ChatShareLinkUploader4.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploaderf=function(q,r,s){"use strict";if(this.$ChatShareLinkUploadere()!==q)return;this.$ChatShareLinkUploader4=null;i.appendContent(this.$ChatShareLinkUploadera,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();if(s&&this.getInputValue().indexOf(s)===-1)this.$ChatShareLinkUploader6(s);return;}h.addClass(this.$ChatShareLinkUploadera,'done');};e.exports=p;},null);
__d("StickerContextualDialog.react",["ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=47,k=h.createClass(g.createSpec({displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:j,length:16}}}));k.WIDTH={NORMAL:312,WIDE:400};e.exports=k;},null);
__d("ChatStickerButton.react",["BanzaiODS","React","ReactLayeredComponentMixin","StickerContextualDialog.react","StickersFlyout.react","StickerState","cx","emptyFunction","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=h,r=q.PropTypes,s=278,t=h.createClass({displayName:"ChatStickerButton",propTypes:{className:r.string,flyoutClassName:r.string,flyoutWidth:r.number,wrapperClass:r.func,onStickerSelect:r.func,onEmoticonSelect:r.func,onFlyoutShown:r.func,onFlyoutHidden:r.func},getInitialState:function(){return {shown:false,packID:l.getTrayPackID()};},mixins:[i],getDefaultProps:function(){return {flyoutWidth:s,onStickerSelect:n,onEmoticonSelect:n};},componentDidMount:function(){g.bumpEntityKey('chat.web','sticker_button.mounted');this._subscription=l.addListener(l.PACK_SELECTED,function(u){return this.setState({packID:u});}.bind(this));},shouldComponentUpdate:function(u,v){return (v.packID!=this.state.packID||v.shown!=this.state.shown);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (h.createElement("a",{onClick:this.showFlyout,onMouseDown:this._prepareForClick,title:o._("Choose a sticker or emoticon"),ref:"link"},h.createElement("span",{className:p(this.props.className,((this.state.shown?"open":'')))})));},renderLayers:function(){var u=this.props.wrapperClass||j;return {contextualDialog:h.createElement(u,{alignment:this.props.flyoutAlignment,className:"_5e-r",contextRef:function(){return this.refs.link;}.bind(this),onBlur:this._hideFlyout,position:"above",shown:this.state.shown,width:this.props.flyoutWidth},h.createElement("div",null,h.createElement(k,{className:this.props.flyoutClassName,onShown:function(v){return this.props.onFlyoutShown&&this.props.onFlyoutShown(v);}.bind(this),onHidden:function(){return this.props.onFlyoutHidden&&this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.state.packID,shown:this.state.shown})))};},_prepareForClick:function(){this._clickGuard=this.state.shown;},showFlyout:function(){!this._clickGuard&&this.setState({shown:true});},_hideFlyout:function(){this.setState({shown:false});},_handleStickerSelected:function(u){this.props.onStickerSelect(u);},_handleEmoticonSelected:function(u){this._hideFlyout();this.props.onEmoticonSelect(u);}});e.exports=t;},null);
__d("StickersFlyoutTriggerSelector.react",["React","Sticker.react","StickerConstants","StickerUtils","XUIContextualDialog.react","XUICloseButton.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=g,o=n.PropTypes,p=84,q=g.createClass({displayName:"StickersFlyoutTriggerSelector",getDefaultProps:function(){return {stickers:[]};},propTypes:{context:o.object.isRequired,stickers:o.array,onStickerSelect:o.func.isRequired},shouldComponentUpdate:function(r){if(this.props.stickers.length!==r.stickers.length)return true;for(var s=0;s<Math.min(this.props.stickers.length,5);s++)if(this.props.stickers[s].id!==r.stickers[s].id)return true;return false;},_renderStickers:function(){if(!this.props.stickers||this.props.stickers.length===0)return null;var r=Math.floor(Math.random()*Math.min(this.props.stickers.length,5)),s=this.props.stickers[r],t=j.getScaledDimensions(s.height,s.width,i.TRAY_SIZE);return (g.createElement("div",null,g.createElement(l,{size:"small",className:"_2ohj",onClick:this.props.onDismissTrigger}),g.createElement("div",{className:"_5r8h _onc","data-id":s.id,onClick:function(){return this.props.onStickerSelect(s.id);}.bind(this)},g.createElement(h,{animationTrigger:"hover",className:"_5r8i",frameCount:s.frameCount,frameRate:s.frameRate||83,framesPerCol:s.framesPerCol,framesPerRow:s.framesPerRow,sourceHeight:t.height,sourceURI:s.sourceURI,sourceWidth:t.width,spriteURI:s.spriteURI,paddedSpriteURI:s.paddedSpriteURI,stickerID:s.id,style:{cursor:'pointer',height:'64px'}}))));},render:function(){return (g.createElement(k,{alignment:"left",autoFocus:false,context:this.props.context,onBlur:this._resetFlyout,offsetY:11,position:"above",shown:this.props.stickers&&this.props.stickers.length>0,width:p},this._renderStickers()));}});e.exports=q;},null);
__d("StickerTrigger",["EmoticonsList","Map","StickerConfig","StickerSearch","StickerServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=new h(),m={findTriggerForInput:function(n,o){if(n===null){o([],null);return;}j.prepareTagsData().then(function(){return this.findTagForInput(n,function(p,q){return o(p,q);});}.bind(this));},findTagForInput:function(n,o){var p=this.findTriggeredWord(n);if(p){if(l.has(p)){o(l.get(p),p);}else k.getStickersForQuery(p,function(q){var r=q.getPayload();l.set(p,r);o(r,p);});}else o([],null);},_getRegex:function(){if(i.TriggerConfidence==='emoji_only'){return g.noncapturingRegexp;}else if(i.TriggerConfidence==='high')return (/^(?:\w+\s?){1,4}$/);return null;},findTriggeredWord:function(n){var o=j.getTagsIndex();if(!o)return null;n=n.toLowerCase();var p=n.match(this._getRegex()),q=null;for(var r=0;p!==null&&r<p.length;r++)if(o[p[r]])q=p[r];return q;}};e.exports=m;},null);
__d("StickerTriggerIndicator.react",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=g,j=i.PropTypes,k=g.createClass({displayName:"StickerTriggerIndicator",getDefaultProps:function(){return {stickers:[]};},propTypes:{stickers:j.array},shouldComponentUpdate:function(l){var m=this.props.stickers.length>0,n=l.stickers.length>0;return m!==n;},render:function(){var l=this.props.stickers&&this.props.stickers.length>0;return g.createElement("span",{className:((l?"emoticonIndicator":''))});}});e.exports=k;},null);
__d("ChatStickerTriggerController",["BanzaiLogger","React","StickerConfig","StickersFlyoutTriggerSelector.react","StickerTrigger","StickerTriggerIndicator.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n,o,p,q,r){this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerController1=null;this.$ChatStickerTriggerController2=null;this.$ChatStickerTriggerController3=r;this.$ChatStickerTriggerController4=q;this.$ChatStickerTriggerController5=null;if(i.TriggerInterface==='one_tap'){this.$ChatStickerTriggerController1=h.render(h.createElement(j,{context:p,onStickerSelect:this.$ChatStickerTriggerController6.bind(this),onDismissTrigger:this.$ChatStickerTriggerController7.bind(this)}),n);this.$ChatStickerTriggerController2=n;}else if(i.TriggerInterface==='hyperlink'){this.$ChatStickerTriggerController1=h.render(h.createElement(l,null),o);this.$ChatStickerTriggerController2=o;}}m.prototype.setInput=function(n){this.$ChatStickerTriggerController8=n;};m.prototype.activateAfterparty=function(){this.$ChatStickerTriggerController9=true;clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerControllera=setTimeout(this.$ChatStickerTriggerControllerb.bind(this),5000);};m.prototype.updateInput=function(n){if(this.$ChatStickerTriggerController9)this.$ChatStickerTriggerControllerb();this.$ChatStickerTriggerControllerc(n);};m.prototype.onFlyoutShown=function(n){if(this.$ChatStickerTriggerController0&&!this.$ChatStickerTriggerControllerd){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController3(this.$ChatStickerTriggerController0,n);this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});}else n();};m.prototype.getTriggeredWord=function(){return this.$ChatStickerTriggerController0;};m.prototype.$ChatStickerTriggerController6=function(n){this.$ChatStickerTriggerController4(n);this.$ChatStickerTriggerController7();};m.prototype.$ChatStickerTriggerController7=function(){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});};m.prototype.$ChatStickerTriggerControllere=function(n,o){if(this.$ChatStickerTriggerController5===null||this.$ChatStickerTriggerController5&&this.$ChatStickerTriggerController5.toLowerCase().indexOf(o)===-1){this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:null});this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});return;}if(o)g.log('StickersLoggerConfig',{event:'sticker_trigger_activated',numsearchresults:n.length,triggeredword:o,triggerused:false});this.$ChatStickerTriggerController0=o;this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:o});if(!this.$ChatStickerTriggerControllerd)this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:n});};m.prototype.$ChatStickerTriggerControllerb=function(){clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerController9=false;this.$ChatStickerTriggerControllerd=false;this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerControllerc(null);};m.prototype.$ChatStickerTriggerControllerc=function(n){if(this.$ChatStickerTriggerController5!==n){this.$ChatStickerTriggerController5=n;k.findTriggerForInput(this.$ChatStickerTriggerController5,this.$ChatStickerTriggerControllere.bind(this));}};m.prototype.destroy=function(){h.unmountComponentAtNode(this.$ChatStickerTriggerController2);clearTimeout(this.$ChatStickerTriggerControllera);};e.exports=m;},null);
__d("ChatFileUploaderMixin",["SubscriptionsHandler","React"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h,j=i.PropTypes,k={propTypes:{attachmentsShelf:j.object,onFileUploaderMounted:j.func,onUploadFinished:j.func,onUpdateAttachmentsShelf:j.func,onSubmit:j.func},setUpSubscriptionsHandler:function(l){this._uploader=l;this._subscriptions=new g();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();if(!this.props.uploaderIsFromHigherLevel)this._uploader&&this._uploader.destroy();},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},getAudioFiles:function(){return this._uploader.getAudioFiles();},getFiles:function(){return this._uploader.getFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){if(this.props.onUploadFinished)this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){if(this.props.onUpdateAttachmentsShelf)this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){if(this.props.onSubmit)this.props.onSubmit();}};e.exports=k;},null);
__d("ChatFileUploader.react",["ChatFileUploaderMixin","InlineBlock.react","MercuryConfig","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j.createClass({displayName:"ChatFileUploader",mixins:[g],getDefaultProps:function(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function(){return false;},componentDidMount:function(){var n=this.props.initFileUploaderFn(j.findDOMNode(this.refs.form),j.findDOMNode(this.refs.input),j.findDOMNode(this.refs.attachID));this.setUpSubscriptionsHandler(n);},render:function(){return (j.createElement("form",{ref:"form",action:i.upload_url,method:"post"},j.createElement("input",{type:"hidden",ref:"attachID",name:"attach_id"}),j.createElement(h,{className:"_m _4q60 itemLabel"},j.createElement("input",{type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),j.createElement("span",{className:"_4q61 itemAnchor"},l._("Add Files...")))));}});e.exports=m;},null);
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryThreadMuter","ReactComponentWithPureRenderMixin","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","WebMessengerThreadPermalinks","cx","fbt","goURI","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=b('MercuryThreadActions').get(),y=p.Item,z=n,aa=z.PropTypes,ba=n.createClass({displayName:"ChatTabMenu",mixins:[m],propTypes:{onFileUploaderMounted:aa.func,updatePrivacyLinkFunc:aa.func,nameConversationFunc:aa.func,leaveConversationFunc:aa.func,showParticipantsFunc:aa.func,deleteConversationFunc:aa.func,reportSpamFunc:aa.func,createGroupFunc:aa.func,switchToWorkFunc:aa.func,isMultichat:aa.bool,isEmptyChat:aa.bool,hasSwitchToWork:aa.bool,showAddFriend:aa.func,threadID:aa.string,attachmentsShelf:aa.object,onUploadFinished:aa.func,onUpdateAttachmentsShelf:aa.func,onSubmit:aa.func,enableDesktopNotif:aa.func},getInitialState:function(){return {url:null};},getDefaultProps:function(){return {show:true};},componentDidMount:function(){t.getThreadURI(this.props.threadID,function(ca){this.isMounted()&&this.setState({url:ca});}.bind(this));if(!this.props.isMultiChat)this._privacyActionController=new h(j.getUserIDFromThreadID(this.props.threadID),this.props.updatePrivacyLinkFunc);},_initFileUploader:function(ca,da,ea){if(this._fileUploader){this._fileUploader.updateElements(ca,da,ea);}else this._fileUploader=new k(this.props.attachmentsShelf,ca,da,ea);return this._fileUploader;},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploader&&this._fileUploader.destroy();},_unmuteThread:function(){x.unmute(this.props.threadID);r.hide();},_togglePrivacyFunc:function(){this._privacyActionController.togglePrivacy();},getURL:function(){return this.state.url;},_renderFileUploader:function(){return (n.createElement(y,{className:"_37_x"},n.createElement(g,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.state.url)return (n.createElement(y,{onclick:function(){return w(this.state.url);}.bind(this)},v._("See Full Conversation")));return null;},_renderAddFriend:function(){if(!this.props.showAddFriend)return null;return (n.createElement(y,{onclick:this.props.showAddFriend},v._("Add Friends to Chat...")));},_renderTogglePrivacy:function(){if(!this.props.isMultichat&&this.props.privacyText)return (n.createElement(y,{onclick:this._togglePrivacyFunc},this.props.privacyText));return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var ca=l.showMuteChangeDialog.bind(null,this.props.threadID,null);return (n.createElement(y,{onclick:ca},v._("Mute Conversation...")));}else return (n.createElement(y,{onclick:this._unmuteThread},v._("Unmute Conversation")));},_renderDeleteConversation:function(){return (n.createElement(y,{onclick:this.props.deleteConversationFunc},v._("Delete Conversation...")));},_renderReportSpam:function(){if(!this.props.isMultichat)return (n.createElement(y,{onclick:this.props.reportSpamFunc},v._("Report as Spam or Abuse...")));return null;},_renderCreateGroup:function(){if(this.props.isMultichat)return (n.createElement(y,{onclick:this.props.createGroupFunc},v._("Create Group")));return null;},_renderSwitchToWork:function(){if(this.props.hasSwitchToWork)return (n.createElement(y,{onclick:this.props.switchToWorkFunc},v._("Move to Work Account")));},_renderConversationName:function(){if(this.props.isMultichat&&this.state.url)return (n.createElement(y,{onclick:this.props.nameConversationFunc},v._("Edit Conversation Name")));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (n.createElement(y,{onclick:this.props.leaveConversationFunc},v._("Leave Conversation...")));return null;},_renderEnableDesktopNotifications:function(){if(i.DesktopNotificationsGK&&"Notification" in window&&Notification.permission!=="granted")return (n.createElement(y,{onclick:this.props.enableDesktopNotif},v._("Enable Desktop Notifications")));return null;},_renderPeopleList:function(){if(this.props.isMultichat&&this.state.url)return (n.createElement(y,{onclick:this.props.showParticipantsFunc},v._("Edit Participants...")));return null;},render:function(){var ca=this._renderReportSpam(),da=this._renderCreateGroup(),ea=n.createElement(p,{className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),n.createElement(q,null),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderDeleteConversation(),this._renderLeaveConversation(),ca?(n.createElement(q,null)):null,ca,da?(n.createElement(q,null)):null,da,this._renderEnableDesktopNotifications()),fa=v._("Options"),ga=s.getTrackingInfo(s.types.DROPDOWN_BUTTON);return (n.createElement(o,{menu:ea},n.createElement("a",{"data-ft":ga,"data-hover":"tooltip","aria-label":fa,"data-tooltip-alignh":"center",className:(("button")+(this.props.isEmptyChat?' '+"hidden_elem":''))})));}});e.exports=ba;},null);
__d("ChatDateBreak.react",["React","Timestamp.react","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g,m=l.PropTypes,n=g.createClass({displayName:"ChatDateBreak",propTypes:{date:m.instanceOf(Date).isRequired},shouldComponentUpdate:function(o){return this.props.date.getTime()!==o.date.getTime();},render:function(){var o=this.props.date,p=j(o,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),q=Math.round(o.getTime()/1000);return (g.createElement("div",g.__spread({},this.props,{className:k(this.props.className,"_5w-5")}),g.createElement("div",{className:"_5w-6"},g.createElement(h,{time:q,verbose:p,text:p}))));}});e.exports=n;},null);
__d("ChatAuthorPhotoBlock.react",["MercuryParticipants","React","cx","fbt","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=h,n=m.PropTypes,o=86400000,p=h.createClass({displayName:"ChatAuthorPhotoBlock",propTypes:{authorID:n.string.isRequired,hideName:n.bool,hidePhoto:n.bool,timestamp:n.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.updateAuthor(this.props.authorID);},componentWillReceiveProps:function(q){if(q.authorID!=this.state.author.id)this.updateAuthor(q.authorID);},render:function(){return (h.createElement("div",h.__spread({},this.props,{className:l(this.props.className,"_5yt9")}),this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (h.createElement("div",{className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto){var q=null;if(this.props.timestamp){var r=(Date.now()-this.props.timestamp>o)?'M jS, g:ia':'g:ia';q=k(new Date(this.props.timestamp),r);}var s=j._("{name} {time}",[j.param("name",this.state.author.name),j.param("time",q)]);return (h.createElement("a",{"aria-label":s,className:"_5ys_","data-hover":"tooltip","data-tooltip-position":"left",href:this.state.author.href||'#',ref:"link"},h.createElement("img",{src:this.state.author.image_src,ref:"image"})));}},updateAuthor:function(q){g.get(q,function(r){this.isMounted()&&this.setState({author:r});}.bind(this));}});e.exports=p;},null);
__d("MessageBubbleMixin",["DOMDimensions","MercuryConfig","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=2,k={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(l){if(l.maxWidth!==this.props.maxWidth||l.body!==this.props.body||(!l.attachments&&this.props.attachments))this._restyleBubble(l);},_restyleBubble:function(l){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var m=i.findDOMNode(this.refs.bubble);if(l.maxWidth!==this.props.maxWidth||g.getElementDimensions(m).width>this.props.maxWidth){var n=this.props.maxWidth;this.setState({bubbleWidth:n},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var l=i.findDOMNode(this.refs.bubble),m=g.getElementDimensions(l).width,n=0,o=i.findDOMNode(this.refs.content);if(o){n=g.getElementDimensions(o).width;if(h.MercuryStoryAttachmentsGK)n+=g.measureElementBox(i.findDOMNode(this.refs.contentWrapper),'width',true,false,false);}var p=n+j;if(n>0&&p<this.props.maxWidth&&m-p-this.getBoxWidth()>0)this.setState({bubbleWidth:p});}};e.exports=k;},null);
__d("ChatBubble.react",["DOMDimensions","MercuryConfig","MercuryMessageBody.react","MessageBubbleMixin","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=k,o=n.PropTypes,p=null,q=h.MercuryStoryAttachmentsGK,r=k.createClass({displayName:"ChatBubble",mixins:[j],propTypes:{attachments:o.node,body:o.string,maxWidth:o.number.isRequired,threadID:o.string},_renderContent:function(){if(!this.props.body)return null;return (k.createElement("div",{className:((q?"_d97":'')),ref:"contentWrapper"},k.createElement("span",{className:"_5yl5",ref:"content"},k.createElement(i,{body:this.props.body,ranges:this.props.ranges,threadID:this.props.threadID}))));},render:function(){return (k.createElement("div",k.__spread({},this.props,{className:m((("_5w1r")+(!q?' '+"_d98":'')),this.props.className),ref:"bubble",style:{maxWidth:this.props.maxWidth,width:this.state.bubbleWidth}}),this._renderContent(),this.props.attachments));},contentWraps:function(){var s=k.findDOMNode(this.refs.content),t=s.getClientRects(),u=g.getElementDimensions(s).height;return (t&&t.length>1&&t[0].height<u);},getBoxWidth:function(){if(!p)p=g.measureElementBox(k.findDOMNode(this.refs.bubble),'width',true,true,false);return p;}});e.exports=r;},null);
__d("MessengerHotLikePreviewEvents",["mixInEventEmitter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h={START:'start',STOP:'stop',POP:'pop'};g(h,{start:true,stop:true,pop:true});e.exports=h;},null);
__d("MessengerHotLikePreview.react",["MessengerHotLikePreviewEvents","MessengerHotLikeUtils","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i,l=k.PropTypes,m=3,n=i.createClass({displayName:"MessengerHotLikePreview",propTypes:{since:l.number},getInitialState:function(){return {snapped:false};},componentDidMount:function(){g.addListener(g.STOP,this._snap);},getStyle:function(){var o=h.getPreviewURI();return Object.assign({backgroundImage:'url('+o+')',backgroundSize:'contain'},this._getSize());},render:function(){return (i.createElement("div",{className:(("_3w5x")+(this.state.snapped?' '+"_3w5y":'')+(this.props.isChat?' '+"mvs":'')),style:this.state.snapped?Object.assign({},this._getSize()):null},i.createElement("div",i.__spread({className:"_3w5-"},this.props,{style:Object.assign({},(this.props.style||{}),this.getStyle())}))));},_getSize:function(){var o=this._getGrowth();return this.state.snapped?h.getMetadataForHotLike(this.state.snapped):{height:o,width:o};},_getGrowth:function(){var o=h.getGrowCoefficientForSince(this.props.since);return 35*Math.max(1,o*m);},_snap:function(){if(this.state.snapped)return;var o=Date.now()-this.props.since,p=h.getStickerIDForTime(o);if(p)this.setState({snapped:p});}});e.exports=n;},null);
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","DOM","Event","ImmutableObject","MessengerHotLikePreview.react","React","SubscriptionsHandler","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=l,r=q.PropTypes,s=176,t=4,u=l.createClass({displayName:"MercuryAttachments",_fullReact:false,propTypes:{attachments:r.array.isRequired,customPhotoWidth:r.number,maxWidth:r.number,message:r.instanceOf(j).isRequired,isChat:r.bool,onImageLoad:r.func,onStickerClick:r.func},getDefaultProps:function(){return {isChat:false,onImageLoad:o,onStickerClick:o};},componentDidMount:function(){this._subscriptionsHandler=new m();this.renderAttachments();},componentDidUpdate:function(){this.renderAttachments();},componentWillUnmount:function(){this._subscriptionsHandler.release();},render:function(){if(this.props.attachments.length===1&&g.isStoryBasedShare(this.props.attachments[0])){this._fullReact=true;return g.constructStoryBasedShareAttachment(this.props.message,this.props.attachments[0],this.props.isChat,this.props.onImageLoad,this.props.maxWidth);}if(this.props.message.is_like_preview)return (l.createElement(k,{isChat:this.props.isChat,key:'hlp:'+this.props.message.like_preview_since,since:this.props.message.like_preview_since}));if(this._isStickerAttachment())return g.constructStickerComponent(this.props.message,this.props.attachments[0].metadata,this.props.onStickerClick,this.props.isChat);var v=this.props.attachments.filter(g.isPhotoAttachment).length>0;return (l.createElement("div",l.__spread({},this.props,{className:p(this.props.className,(("_5h9y")+(v?' '+"_zl6":'')))})));},renderAttachments:function(){if(this._isStickerAttachment())return;var v=l.findDOMNode(this);if(!this._fullReact){h.empty(v);var w=this.props.message,x=g.sortAttachmentsStablyByType(this.props.attachments),y=this.props.customPhotoWidth||s,z=g.renderPhotoAttachments(x.filter(g.isPhotoAttachment),w,y,t,this.props.isChat);z&&h.appendContent(v,z);for(var aa=0;aa<x.length;aa++){var ba=x[aa];if(g.isPhotoAttachment(ba))continue;var ca=g.renderAttachment(this.props.isChat,ba,w,this.props.maxWidth,null,this.props.onStickerClick);ca.error&&h.appendContent(v,ca.error);ca.content&&h.appendContent(v,ca.content);}}h.scry(v,'img').forEach(function(da){this._subscriptionsHandler.addSubscriptions(i.listen(da,'load',function(){this.props.onImageLoad(da);}.bind(this)));}.bind(this));},_isStickerAttachment:function(){return (this.props.attachments.length===1&&g.isStickerAttachment(this.props.attachments[0]));}});e.exports=u;},null);
__d("ChatMessage.react",["Bootloader","BootloadedComponent.react","ChatAnimatedGifs","ChatAuthorPhotoBlock.react","ChatBubble.react","ChatConfig","CSS","ImmutableObject","MercuryAttachment","MercuryAttachments.react","MercuryAttachmentRenderer","MercuryConfig","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercuryMessageInfo","React","cx","fbt","formatDate","isRTL","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=w,da=ca.PropTypes,ea=w.createClass({displayName:"ChatMessage",propTypes:{message:da.instanceOf(n).isRequired,maxBubbleWidth:da.number.isRequired,onImageLoad:da.func,onStickerClick:da.func},componentDidMount:function(){m.conditionClass(w.findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var fa=this.props.message;return (v.isInbound(fa)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(fa,ga){return fa.message!==this.props.message;},render:function(){var fa=this.props.message,ga=v.isInbound(fa),ha=t.isMultichat(fa.thread_id),ia=aa(fa.body),ja=l.get('chat_fading_bubbles')&&!ga&&v.isSending(fa),ka=s.hasErrorStatus(fa),la=(("_5wd4")+(ga?' '+"_1nc7":'')+(!ga?' '+"_1nc6":'')+(ga&&ha?' '+"_5ysy":'')+(ja?' '+"_4oe5":'')+(ka?' '+"_1zcs":'')+(ia?' '+"direction_rtl":'')+(!ia?' '+"direction_ltr":'')),ma=new Date(fa.timestamp);return (w.createElement(j,w.__spread({},this.props,{authorID:fa.author,className:ba(this.props.className,la),hideName:!ga||!ha,hidePhoto:!ga,timestamp:fa.timestamp,title:ga?null:z(ma,'g:ia')}),this._renderInner(),this._renderUndertext()));},_renderInner:function(){if(this.props.message.is_filtered_content)return (w.createElement("div",{className:"_5wd9",ref:"inner"},this._renderFilteredContent()));return (w.createElement("div",{className:"_5wd9",ref:"inner"},this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (w.createElement("div",{className:"_3ry4",ref:"undertext"},w.createElement(u,{className:"_5wda clearfix",message:this.props.message,ref:"status"}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?w.createElement(h,{bootloadPlaceholder:w.createElement("span",null),bootloadComponent:function(fa){g.loadModules(["MercurySpoofWarning.react"],fa);},authorID:this.props.message.author,className:"_5wdb"}):null);},_renderFilteredContent:function(){return w.createElement("div",{className:"_5wdc uiBoxYellow clearfix"},y._("This message is no longer available because it was identified as abusive or marked as spam."));},_renderAttachments:function(fa){var ga=this.props.message,ha=fa=='inside'?'attachmentsInside':'attachmentsOutside',ia=o.get(ga).filter(function(ja){var ka=q.isBubblePreferred(ja)&&!(r.MercuryImageBubblesGK&&(q.isPhotoAttachment(ja)||q.isVideoAttachment(ja))&&!ga.body);return (ka&&fa==='inside')||(!ka&&fa==='outside');});if(ia.length>0)return w.createElement(p,{className:"_5wdd clearfix",isChat:true,message:ga,attachments:ia,ref:ha,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick,maxWidth:this.props.maxBubbleWidth});},_renderBubble:function(){var fa=this.props.message,ga=fa.body,ha=this._renderAttachments('inside'),ia=v.isInbound(fa);if(i.shouldHideBody(fa))ga='';if(ga||ha)return (w.createElement("div",{className:"_5wde"},w.createElement(k,{attachments:ha,body:ga,className:(("_5wdf")+(o.hasBubbleTail(fa,ia)?' '+"_3okg":'')),maxWidth:this.props.maxBubbleWidth,ranges:fa.ranges,ref:"bubble",threadID:fa.thread_id})));}});e.exports=ea;},null);
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryViewer","PresencePrivacy","React","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=k,q=p.PropTypes,r=k.createClass({displayName:"ChatVideoCallLink",propTypes:{message:q.object.isRequired,onClick:q.func.isRequired},componentDidMount:function(){this._subscriptions=new l();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.createElement("a",{className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),"data-gt":JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return (o._("Retry setup and call back."));}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)return (o._("Call back."));},shouldHideLink:function(){return !h.isOnline()||!m.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var s;if(this.props.message.log_message_data.event_name=='install_canceled'){s='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)s='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,s);},availabilityChanged:function(){this.forceUpdate();}});e.exports=r;},null);
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","VideoCallSupport","cx","emptyFunction","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=m,t=s.PropTypes,u=m.createClass({displayName:"MercuryLogMessage",propTypes:{maxWidth:t.number,message:t.instanceOf(j).isRequired,onImageLoad:t.func,onVideoCallLinkClick:t.func},getDefaultProps:function(){return {onImageLoad:p};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(v){k.renderText(v.message,function(w){this.setState({messageText:w});}.bind(this));},shouldComponentUpdate:function(v,w){return (this.state.messageText!=w.messageText||v.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){var v=m.findDOMNode(this.refs.attachment);k.renderAttachmentLegacy(v,this.props.message);g.scry(v,'img').forEach(function(w){var x=h.listen(w,'load',function(){this.props.onImageLoad(w);x.remove();}.bind(this));}.bind(this));},render:function(){return (m.createElement("div",m.__spread({},this.props,{className:r(this.props.className,"_5ye6"),style:Object.assign({},this.props.style,this._getStyle()),title:q(new Date(this.props.message.timestamp),'g:ia')}),k.renderIcon(this.props.message),m.createElement("div",{className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.createElement("div",{className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!n.isVideoCallSupported())return null;return (m.createElement(i,{message:this.props.message,onClick:this.props.onVideoCallLinkClick}));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;}});e.exports=u;},null);
__d("ChatConversation.react",["ChatDateBreak.react","ChatMessage.react","ImmutableObject","MercuryActionType","MercuryLogMessage.react","React","cx","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=l,p=o.PropTypes,q=1000*60*60,r=l.createClass({displayName:"ChatConversation",propTypes:{maxBubbleWidth:p.number.isRequired,messages:p.arrayOf(p.instanceOf(i)).isRequired,onCallLinkClick:p.func,onImageLoad:p.func,onStickerClick:p.func},componentWillReceiveProps:function(s){n(s.maxBubbleWidth===this.props.maxBubbleWidth);},render:function(){var s=this.props.messages,t=[];for(var u=0;u<s.length;u++){var v=s[u],w=(u>0)?s[u-1]:null;if(!w||v.timestamp-w.timestamp>q)t.push(l.createElement(g,{date:new Date(v.timestamp),key:'db:'+v.message_id}));if(v.action_type==j.LOG_MESSAGE){t.push(l.createElement(k,{className:"_5w0o",key:v.message_id,message:v,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else t.push(l.createElement(h,{key:v.message_id,message:v,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));}return l.createElement("div",null,t);}});e.exports=r;},null);
__d("MercuryMessageList",["immutable","LogHistory","Map","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h.getInstance('mercury_message_list');function l(n){this.$MercuryMessageList0=g.List(n||[]);this.$MercuryMessageList1();}l.prototype.append=function(n){var o;this.$MercuryMessageList0=(o=this.$MercuryMessageList0).push.apply(o,n);this.$MercuryMessageList1();m('append',n);};l.prototype.prepend=function(n){var o;this.$MercuryMessageList0=(o=this.$MercuryMessageList0).unshift.apply(o,n);this.$MercuryMessageList1();m('prepend',n);};l.prototype.update=function(n){var o=n.filter(function(p){return this.contains(p);}.bind(this));if(o.length===0)return;this.$MercuryMessageList0=this.$MercuryMessageList0.withMutations(function(p){o.forEach(function(q){var r=this.$MercuryMessageList2.get(q.message_id);if(r!==(void 0))p.set(r,q);}.bind(this));}.bind(this));m('update',o);};l.prototype.reorder=function(n){this.$MercuryMessageList0=g.List(n);this.$MercuryMessageList1();m('reorder',n);};l.prototype.at=function(n){return this.$MercuryMessageList0.get(n);};l.prototype.contains=function(n){return this.$MercuryMessageList2.has(n.message_id);};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toMap=function(){return new i(g.Seq(this.$MercuryMessageList0).map(function(n){return [n.message_id,n];}));};l.prototype.$MercuryMessageList1=function(){this.$MercuryMessageList2=new i(g.Seq(this.$MercuryMessageList0).map(function(n,o){return [n.message_id,o];}));};function m(event,n){j(function(){k.debug(event,{messageIDs:n.map(function(o){return o.message_id;})});},0);}e.exports=l;},null);
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryViewer","MercuryMessageList","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","merge","mixInEventEmitter","setImmediate","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();'use strict';var r=b('MercuryMessages').get(),s=b('MercuryThreadInformer').get(),t=b('MercuryThreads').get(),u=h.getInstance('mercury_message_store');function v(x,y){this.$MercuryMessageStore0=x;this.$MercuryMessageStore1=new j();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=y||l.RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore6=new k();this.$MercuryMessageStore6.addSubscriptions(s.subscribe('messages-received',function(z,aa){return this.$MercuryMessageStore8(aa);}.bind(this)),s.subscribe('messages-updated',function(z,aa){return aa[this.$MercuryMessageStore0]&&this.$MercuryMessageStore9(aa[this.$MercuryMessageStore0]);}.bind(this)),s.subscribe('messages-reordered',function(z,aa){return aa[this.$MercuryMessageStore0]&&this.$MercuryMessageStorea();}.bind(this)));u.debug('constructed',{threadID:this.$MercuryMessageStore0});this.$MercuryMessageStoreb();}v.prototype.setNewThreadID=function(x){this.$MercuryMessageStorec=x;};v.prototype.destroy=function(){this.$MercuryMessageStore6&&this.$MercuryMessageStore6.release();u.debug('destroyed',{threadID:this.$MercuryMessageStore0});};v.prototype.subscribe=function(x){return this.addRetroactiveListener('updated',x);};v.prototype.fetchMoreMessages=function(){if(r.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&r.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(t.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;this.$MercuryMessageStoreb();return true;};v.prototype.$MercuryMessageStoreb=function(){var x=this.$MercuryMessageStore4+this.$MercuryMessageStore5*this.$MercuryMessageStore2;u.debug('fetching',{threadID:this.$MercuryMessageStore0,limit:x});r.getThreadMessagesRange(this.$MercuryMessageStore0,0,x,this.$MercuryMessageStored.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(r.hasLoadedNMessages(this.$MercuryMessageStore0,x))p(function(){this.$MercuryMessageStorea();}.bind(this));};v.prototype.$MercuryMessageStored=function(x){if(x&&x.length){this.$MercuryMessageStore3=x[0].timestamp;this.$MercuryMessageStore4=x.length;u.debug('fetched',{threadID:this.$MercuryMessageStore0,earliestMessageTimestamp:this.$MercuryMessageStore3,count:this.$MercuryMessageStore4});}else if(x&&!x.length&&!this.$MercuryMessageStore4)this.$MercuryMessageStoree(v.THREAD_IS_EMPTY);};v.prototype.$MercuryMessageStore8=function(x){var y=[],z=x[this.$MercuryMessageStore0];if(z&&z.length)y=y.concat(z);if(this.$MercuryMessageStorec){var aa=x[this.$MercuryMessageStorec];if(aa&&aa.length){y=y.concat(aa);this.$MercuryMessageStorec=null;}}if(y.length){this.$MercuryMessageStore1.append(y);this.$MercuryMessageStore4+=y.length;var ba=y.every(function(ca){return ca.author!=i.getID();});this.$MercuryMessageStoree(v.MESSAGES_RECEIVED,{allFromOthers:ba});}};v.prototype.$MercuryMessageStore9=function(x){this.$MercuryMessageStore1.update(r.getMessagesFromIDs(Object.keys(x)));this.$MercuryMessageStoref();this.$MercuryMessageStoree(v.MESSAGES_CHANGED);};v.prototype.$MercuryMessageStorea=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(r.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStoref();this.$MercuryMessageStoree(v.MESSAGES_REORDERED);};v.prototype.$MercuryMessageStoree=function(x,y){var z=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',n({messages:z,eventType:x},y));w(this.$MercuryMessageStore0,x,z);};v.prototype.$MercuryMessageStoref=function(){var x=this.$MercuryMessageStore1.at(0);if(x)this.$MercuryMessageStore3=x.timestamp;};function w(x,y,z){q(function(){u.debug('update:'+y,{threadID:x,messageIDs:z.map(function(aa){return aa.message_id;})});},0);}m(v,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});o(v,{updated:true});e.exports=v;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","BanzaiLogger","BootloadedComponent.react","Bootloader","ChatConfig","ChatConversation.react","ChatPerfInstrumentation","ChatTabViewEvents","ChatWelcomeMessage","CSS","DOM","Event","MercuryLastMessageIndicator.react","LiveTimer","MessengerHotLikePreviewEvents","MercuryViewer","MercuryMessageStore","React","Scroll","ServerTime","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","UserAgent_DEPRECATED","arrayContains","copyProperties","getElementPosition","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){b.__markCompiled&&b.__markCompiled();'use strict';var la=70,ma=null,na=20;function oa(qa){if(ma===null){var ra=qa.childNodes[0];ea.set(qa,'overflow','scroll');ma=ra.clientWidth-la;ea.set(qa,'overflow','');}return ma;}function pa(qa,ra,sa,ta,ua,va,wa,xa){this.loadingIcon=ua;this.threadID=qa;this.sheetController=ra;this.scrollContainer=sa;this.conversationElem=ta;this.tabView=xa;u.restart(aa.get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function ya(){o.inform('interaction-with-tab',qa);}this._subscriptions=new fa();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),s.listen(this.scrollContainer,'mousedown',ya));if(ga.firefox()){var za=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(za,ya,false);}else this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'mousewheel',ya));this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'scroll',ka(this.scrolling,50,this)));if(l.get('chat_react')){var ab;y.render(y.createElement(j,{bootloadPlaceholder:y.createElement("span",null),bootloadComponent:function(cb){k.loadModules(["ChatTypingIndicators.react"],cb);},threadID:this.threadID,indicatorsWillShow:function(){return ab=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return ab&&this.scrollToBottom(true);}.bind(this)}),wa);}else k.loadModules(["MercuryTypingIndicator"],function(cb){this.typingIndicator=new cb(this.threadID,wa,this);}.bind(this));var bb;this.lastMessageIndicatorNode=va;this.lastMessageIndicator=y.render(y.createElement(t,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return bb=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return bb&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);this.initializeConversation();}ia(pa.prototype,{initializeConversation:function(){this._store=new x(this.threadID);this._conversation=y.render(y.createElement(m,{maxBubbleWidth:oa(this.scrollContainer),messages:[],onImageLoad:function(qa){var ra=this.scrollContainer,sa=z.getTop(ra)+ra.clientHeight;if(sa+qa.offsetHeight>=ra.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(qa,ra,sa){o.inform('video-call-clicked',{userID:qa,threadID:ra,clickSource:sa});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),v.addListener(v.START,function(qa,ra){if(this.threadID!==ra)return;this._likePreview=qa;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),v.addListener(v.STOP,function(qa){if(this.threadID!==qa)return;this._likePreview=null;clearInterval(this._scrollToBottomInterval);}.bind(this)),v.addListener(v.POP,function(qa){if(this.threadID!==qa)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_updateMessageFromStore:function(qa){if(qa.eventType==x.MESSAGES_RECEIVED&&qa.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(qa.eventType==x.MESSAGES_REORDERED){this._loadingMoreMessages=false;q.hide(this.loadingIcon);}var ra=this.isScrolledToBottom(),sa=this._getLoadingHeight(),ta=this.scrollContainer.scrollHeight,ua=z.getTop(this.scrollContainer);this._messages=qa.messages;var va=p.getWelcomeMessage(this.threadID);if(va)this._messages.push(va);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(ra||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(qa.eventType==x.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-ta-sa+ua);if(!this._initialLoadFinished){this._initialLoadFinished=true;n.logCHAT_CONVERSATION_TTI();}}.bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(qa.eventType==x.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(this._messages)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(qa.eventType==x.MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(qa){this._shouldScrollToBottom=qa;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){q.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&z.getTop(this.scrollContainer);},destroy:function(){r.scry(this.conversationElem,'.stickerContainer').forEach(function(qa){return y.unmountComponentAtNode(qa);});y.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();y.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(qa){if(!ca.shouldShowStickerReplyNUX()||!qa.length)return false;var ra=qa[qa.length-1];if(ra.author===w.getID())return false;if(ra.has_attachment)return ra.attachments.some(function(sa){return sa.attach_type==='sticker';});return false;},isScrolledToBottom:function(qa){var ra=this.scrollContainer;qa=qa||na;return z.getTop(ra)+ra.clientHeight>=ra.scrollHeight-qa;},isScrolledNearTop:function(){return z.getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(qa){this.scrollToPosition(this.scrollContainer.scrollHeight,qa);},scrollToPosition:function(qa,ra){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(ra===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',qa).ease(g.ease.end).duration(400).go();}else z.setTop(this.scrollContainer,qa);},_onStickerClick:function(qa,ra){if(!qa)return;i.log('StickersLoggerConfig',{event:'click_sticker',packid:qa,stickerid:ra});var sa=this.tabView;ca.onTrayDataReady(function(){if(ha(ca.getPackIDsInTray(),qa)){var ta=ca.getPack(qa);if(ta&&ta.isPromoted)ba.addPack(qa);sa.setStickersFlyoutPackID(qa);}else da.showStore(qa);});},_checkToAnimateSticker:function(){var qa=ja(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:z.getTop(this.scrollContainer),top:qa.y,viewHeight:qa.height});},setNewThreadID:function(qa){this._store.setNewThreadID(qa);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(qa){return !qa.is_like_preview;});return this._messages;}});e.exports=pa;},null);
__d("ChatTabOfficeStatus",["fbt","formatDate","CSS"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=1,k=2,l=3,m={update:function(n,o){if(!n||!o||!o.officeStatus)return;this._updateIcon(n,o);this._updateTooltip(n,o);},_updateIcon:function(n,o){i.removeClass(n,'officeStatusNone');i.removeClass(n,'officeStatusAvailable');i.removeClass(n,'officeStatusSporadic');i.removeClass(n,'officeStatusOutOfOffice');switch(o.officeStatus){case j:i.addClass(n,'officeStatusAvailable');break;case k:i.addClass(n,'officeStatusSporadic');break;case l:i.addClass(n,'officeStatusOutOfOffice');break;default:i.addClass(n,'officeStatusNone');break;}},_updateTooltip:function(n,o){var p='';switch(o.officeStatus){case j:p+=g._("AVAILABLE");p+='\n';break;case k:p+=g._("SPORADIC");p+='\n';break;case l:p+=g._("OFF THE GRID");p+='\n';break;default:p+=g._("UNKNOWN");p+='\n';break;}if(o.officeStatusComment)p+=o.officeStatusComment;if(o.officeStatusLocation)p+=' ('+o.officeStatusLocation+')';if(o.officeStatusComment||o.officeStatusLocation)p+='\n';if(o.officeStatusEndDate){var q=h(o.officeStatusEndDate,'M d, Y');p+=g._("Until {date}",[g.param("date",q)]);}n.setAttribute('aria-label',p);n.setAttribute('data-hover','tooltip');}};e.exports=m;},null);
__d("ChatTabTypeaheadRenderer",["DOM","CompactTypeaheadRenderer","MercuryTypeaheadConstants","MercuryThreadMetadataRawRenderer","TypeaheadFacepile"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(n,o){switch(n.type){case i.USER_TYPE:case i.PAGE_TYPE:return h(n,o);case i.THREAD_TYPE:return m(n,o);default:return g.create('div');}}function m(n,o){var p=[],q=n.mercury_thread;if(q.image_src){p.push(g.create('img',{alt:'',src:q.image_src}));}else{var r=n.participants_to_render.map(function(u){return u.big_image_src||u.image_src;});if(r){if(r instanceof Array){r=k.render(r);}else r=g.create('img',{alt:'',src:r});p.push(r);}}var s=q.name,t=j.renderRawParticipantList(q.thread_id,n.participants_to_render,q.participants.length,{names_renderer:j.renderShortNames});p.push(g.create('span',{className:'timestamp'},q.timestamp_relative));p.push(g.create('span',{className:'text'},s));p.push(g.create('span',{className:'subtext'},t));return g.create('li',{className:'node'},p);}l.className='compact';e.exports=l;},null);
__d("ChatAddFriendsTabSheetRawRenderer",["ChatConfig","ChatTabTypeaheadRenderer","ContextualTypeaheadView","DOM","Event","MercuryDataSourceWrapper","MercuryTypeahead","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={render:function(q,r,s,t,u,v){var w=v?n[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():n[':fb:mercury:chat:tab-sheet:add-friends'].build(),x=v?l.chat_typeahead_source:l.chat_add_people_source;x.setShowThreads(v);var y=new m(x,i);y.setViewOption('renderer',h);y.setExcludedParticipantsFromThreadMeta(t);if(!v){var z=g.get('IsWorkUser',false)?o._("Add co-workers to this chat"):o._("Add friends to this chat");y.setPlaceholder(z);}y.build();j.replace(w.getNode('participantsTypeahead'),y.getElement());j.setContent(s,w.getRoot());y.getTokenizer().adjustWidth();var aa=w.getNode('participantsTypeahead').getAttribute('data-labelid'),ba=j.scry(y.getElement(),'input[type="text"]')[0];if(ba)if(aa){ba.setAttribute('aria-labelledby',aa);}else ba.setAttribute('aria-label',o._("To"));y.focus();if(!v){var ca=function(){var da=y.getSelectedParticipantIDs();if(da.length)u(da);r.close(q);};k.listen(w.getNode('doneButton'),'click',ca);y.subscribe('tokens-return',function(){if(y.getTokens().length)ca();});}return y;}};e.exports=p;},null);
__d("XAssociateGroupThreadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/groups\/messenger\/associate_group_thread\/",{});},null);
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryIDs","MercuryLocalIDs","MercuryViewer","MercuryServerDispatcher","XAssociateGroupThreadController","MercuryThreads","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=b('MercuryThreads').get(),q=b('MercuryServerRequests').get(),r=o.getURIBuilder().getURI().toString();function s(){}i(s,{subscribe:function(u,v){u.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(u,v);}.bind(this));},createGroupThreadFromChooserDialog:function(u,v){var w=j.serialize(u.getRoot()),x=JSON.parse(w.profileChooserItems),y=[];for(var z in x)if(x[z])y.push(z);var aa=s.createThreadForFBIDs(y),ba=q.subscribe('update-thread-ids',function(ca,da){for(var ea in da)if(da[ea]==aa){var fa=p.getThreadMetaNow(aa),ga=q.getServerThreadIDNow(aa);if(fa&&!fa.is_canonical&&ga)n.trySend(r,{group_id:v,thread_id:ga});new g('/ajax/groups/chat/log',{group_id:v,message_id:ea}).send();q.unsubscribe(ba);break;}});u.hide();},createThreadForTokens:function(u){var v=m.getID();if(!u.length)return;u=u.filter(function(x){return x!==v;});var w;if(u.length===0){return;}else if(u.length===1){w=k.getThreadIDFromParticipantID(u[0]);h.openThread(w,'ChatTabView');}else{w=l.generateThreadID();u.unshift(v);p.createNewLocalThread(w,u);h.openThread(w,'MultiChatController');}return w;},createThreadForFBIDs:function(u){var v=[];for(var w=0;w<u.length;w++)v.push("fbid:"+u[w]);return s.createThreadForTokens(v);}});var t={};t[r]={mode:n.IMMEDIATE};n.registerEndpoints(t);e.exports=s;},null);
__d("ChatAddFriendsTabSheet",["ArbiterMixin","BanzaiLogger","ChatAddFriendsTabSheetRawRenderer","ChatConfig","ChatOpenTab","ChatTabActions","MercuryLogMessageType","MercurySourceType","MercuryTypeaheadConstants","MultiChatController","Style","copyProperties","MercuryMessageObject","MercuryMessageActions","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercuryMessageObject').get(),t=b('MercuryMessageActions').get(),u=b('MercuryThreadActions').get(),v=b('MercuryThreads').get();function w(aa,ba,ca,da){this._threadID=aa;this._rootElement=ba;this._sheetView=ca;this._typeahead=null;this._chatTabView=da;}r(w.prototype,g,{render:function(){v.getThreadMeta(this._threadID,function(aa){var ba=aa.is_canonical_user?x:y,ca=v.isNewEmptyLocalThread(this._threadID);this._typeahead=i.render(this,this._sheetView,this._rootElement,aa,ba.bind(null,aa),ca);this._typeahead.subscribe('tokens-changed',function(){if(ca)z(this,this._typeahead,this._threadID,this._chatTabView);}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));this._typeahead.subscribe('esc-pressed',function(){this.inform('esc-pressed');}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return q.get(this._rootElement,'height');}});function x(aa,ba){var ca=aa.participants;p.createThreadForTokens(ca.concat(ba));}function y(aa,ba){var ca=aa.thread_id;if(v.isEmptyLocalThread(ca)){u.addParticipants(ca,ba);}else t.send(s.constructLogMessageObject(n.CHAT_WEB,ca,m.SUBSCRIBE,{added_participants:ba}));k.openThread(ca,'ChatAddFriendsTabSheet');}function z(aa,ba,ca,da){var ea=ba.getTypeahead().getData(),fa=ba.getTokens(),ga=ba.getTypeahead().getCore();ga.getElement().removeAttribute('disabled');ea.setShowThreads(fa.length===0);var ha=fa.length==1&&fa[0].getInfo().render_type===o.THREAD_TYPE;if(ha){var ia=fa[0].getInfo().mercury_thread;if(ia){var ja=j.get('chat_react_share_uploader')?da._sharePreview.getShareData():da._shareLinkUploader.getShareData();if(ja)var ka=j.get('chat_react_share_uploader')?function(la){return la.loadShareFromParams(ja.share_type,ja.share_params);}:function(la){return la.loadShareFromParams(ja.type,ja.params);};k.openThread(ia.thread_fbid,'openGroupChat','',ka);}h.log('MercuryQueryResultsLoggerConfig',{event:'chat_tab_group_thread_click'});l.closeTab(ca,'open_group_chat');}else{if(fa.length==1&&fa[0].getInfo().render_type===o.PAGE_TYPE)ga.getElement().setAttribute('disabled','disabled');h.log('MercuryQueryResultsLoggerConfig',{event:'chat_tab_tokens_changed',chat_tab_tokens:fa.map(function(la){return la.info.uid;})});aa.inform('chat/tokens-changed',{token_count:fa.length});}}e.exports=w;},null);
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w=l._("Done"),x=l._("Hide"),y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;},null);
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessageObject","MercuryMessageActions","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryMessageObject').get(),m=b('MercuryMessageActions').get(),n=b('MercuryServerRequests').get(),o=b('MercuryThreads').get(),p='/ajax/chat/multichat/name_conversation/dismiss.php',q={};function r(s,t,u){"use strict";this.$ChatNameConversationTabSheet0=s;this.$ChatNameConversationTabSheet1=t;this.$ChatNameConversationTabSheet2=u;this.$ChatNameConversationTabSheet3=false;}r.prototype.render=function(){"use strict";o.getThreadMeta(this.$ChatNameConversationTabSheet0,function(s){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,s,this.$ChatNameConversationTabSheet4.bind(null,s),this.$ChatNameConversationTabSheet5.bind(this,s));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};r.prototype.isPermanent=function(){"use strict";return true;};r.prototype.isSheetWithInput=function(){"use strict";return true;};r.prototype.getType=function(){"use strict";return 'name_conversation_type';};r.prototype.open=function(s){"use strict";this.$ChatNameConversationTabSheet3=s;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};r.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};r.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};r.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!q[this.$ChatNameConversationTabSheet0];};r.prototype.$ChatNameConversationTabSheet7=function(){"use strict";q[this.$ChatNameConversationTabSheet0]=true;};r.prototype.$ChatNameConversationTabSheet5=function(s){"use strict";if(!s.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();n.getServerThreadID(s.thread_id,function(t){new g(p).setData({thread_fbid:t}).send();});}};r.prototype.$ChatNameConversationTabSheet4=function(s,t){"use strict";var u=s.name;if((t||u)&&(t!=u))m.send(l.constructLogMessageObject(k.CHAT_WEB,s.thread_id,j.THREAD_NAME,{name:t}),null,i.CHAT);};e.exports=r;},null);
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(n.getNode('text'),l._("Scroll down to see new messages."));i.setContent(this._rootElement,n.getRoot());g.listen(n.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatNoRecipientsTabSheet",["DOM","MercuryViewer","ChatTabTemplates","copyProperties","fbt","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryThreads').get(),m=b('MercuryThreadInformer').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;m.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}j(n.prototype,{render:function(){var o=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),k._("Everyone has left the conversation."));g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=h.getID(),q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;},null);
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","JSXDOM","Event","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","WorkModeConfig","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();function u(v,w,x){this._rootElement=w;this._sheetView=x;this._logger=m.create('blackbird');this._canonicalUser=n.getUserIDFromThreadID(v);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}r(u.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var v=p[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),w='fbid:'+this._canonicalUser;o.get(w,function(x){var y='fbChatGoOnlineLink',z=k.a({href:"#",className:y},t._("turn on chat")),aa;if(q.is_work_user){aa=t._("To chat with {name} and other co-workers, {link}.",[t.param("name",x.short_name),t.param("link",z)]);}else aa=t._("To chat with {name} and other friends, {link}.",[t.param("name",x.short_name),t.param("link",z)]);j.setContent(v.getNode('text'),aa);i.addClass(v.getRoot(),"_1sk1");j.setContent(this._rootElement,v.getRoot());l.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),y)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(v){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(v){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=u;},null);
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","fbt","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l,m,n){this._threadID=l;this._rootElement=m;this._sheetView=n;}j(k.prototype,{render:function(){var l=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(l.getNode('text'),i._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,l.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=k;},null);
__d("ChatReadOnlyTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyTabSheet0=l;this.$ChatReadOnlyTabSheet1=m;this.$ChatReadOnlyTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getReason(j.getThreadMetaNow(this.$ChatReadOnlyTabSheet0));g.render(g.createElement("div",{className:"_87-"},l),this.$ChatReadOnlyTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};e.exports=k;},null);
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(n.getNode('text'),l._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,n.getRoot());g.listen(n.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","ChatTabTemplates"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";this.$ChatEmployeeAwaySheet0=o;this.$ChatEmployeeAwaySheet1=p;this.$ChatEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$ChatEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$ChatEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$ChatEmployeeAwaySheet2.close(this);};e.exports=n;},null);
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=m.getUserIDFromThreadID(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;n.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message.",[r.param("name",v.short_name)]);break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message.",[r.param("name",v.short_name)]);break;default:w=r._("You turned off chat for {name} but you can still send them a message.",[r.param("name",v.short_name)]);}i.setContent(t.getNode('text'),w+' ');var x=r._("Turn on chat for {name}?",[r.param("name",v.short_name)]);i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;n.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;},null);
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMutedTabSheet","ChatEmployeeAwaySheet","ChatUserBlockedTabSheet","MercuryIDs","MercurySheetView","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=function(u,v,w,x){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView,x);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new n(u,v,this._sheetView);this._employeeAwaySheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);if(!q.getUserIDFromThreadID(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};s(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},openEmployeeAwaySheet:function(){this._employeeAwaySheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},onEscape:function(u){this._addFriendsTabSheet.subscribe('esc-pressed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;},null);
__d("ChatTitleLink.react",["Link.react","MercuryThreadTitle.react","React","TrackingNodes","cx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatTitleLink",propTypes:{href:m.string,isNewThread:m.bool,thread:m.object,viewer:m.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (i.createElement(g,{"aria-level":"3",className:(("titlebarText")+(this.props.href===null?' '+"noLink":'')),"data-ft":j.getTrackingInfo(j.types.TITLE),"data-hover":"tooltip",href:this.props.href},i.createElement(h,{ref:"threadTitle",isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});e.exports=n;},null);
__d("ChatVideoCallButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i,n=m.PropTypes,o=i.createClass({displayName:"ChatVideoCallButton",mixins:[h],propTypes:{onClick:n.func,onKeyUp:n.func,shown:n.bool,tooltipLabel:n.string},getDefaultProps:function(){return {tooltipLabel:(l._("Start a video call"))};},render:function(){var p=j.getTrackingInfo(j.types.VIDEOCHAT),q=JSON.stringify({videochat:'call_clicked_bhat_tab'});return (i.createElement(g,{"aria-label":this.props.tooltipLabel,className:(("videoicon")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":p,"data-gt":q,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp}));}});e.exports=o;},null);
__d("EmoticonUtils",["EmoticonsList","Parent"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i='emoticon_',j=g.symbols,k={getEmoteFromTarget:function(l){var m=h.byClass(l,'emoticon');if(!m)return null;var n=null;m.className.split(' ').forEach(function(o){if(o.startsWith(i))n=o.substring(i.length);});return j[n]||null;},insertEmoticon:function(l,m,n){var o=m.substring(0,n.start),p=m.substring(n.end);if(n.start>0&&!o.endsWith(' '))l=' '+l;if(!p.startsWith(' '))l+=' ';var q=o+l+p;n.start+=l.length;n.end=n.start;return {result:q,start:n.start,end:n.end};}};e.exports=k;},null);
__d("MercurySharePreview.react",["AsyncRequest","LeftRight.react","LoadingIndicator.react","MercuryFallbackShareAttachment.react","MercuryShareAttachmentRenderLocations","React","XUICloseButton.react","cx","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=l,q=p.PropTypes,r=l.createClass({displayName:"MercurySharePreview",propTypes:{imageSize:q.shape({width:q.number.isRequired,height:q.number.isRequired}).isRequired,location:q.oneOf(k.getValues()).isRequired,share:q.shape({params:q.array,type:q.number}),uri:q.string,onClose:q.func,onUpdate:q.func},getInitialState:function(){return {attachmentData:null,loading:false};},componentWillMount:function(){this._requestID=1337;this._currentRequest=null;},componentWillUnmount:function(){this._reset();},componentWillReceiveProps:function(s){o(!(s.share&&s.uri));if(!s.share&&!s.uri)return this._reset();var t=this.state.attachmentData||this.state.loading;if(s.share&&!t){this._loadFromShare(s.share);}else if(s.uri&&!(t&&this.props.uri==s.uri))this._loadFromURI(s.uri);},componentDidUpdate:function(s,t){this.props.onUpdate&&this.props.onUpdate(this);},getShareData:function(){return this.state.attachmentData&&this.state.attachmentData.share_data;},isLoading:function(){return this.state.loading;},_loadFromShare:function(s){this._currentRequest=new g().setURI('/message_share_attachment/fromParams/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,share_params:s.params,share_type:s.type}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_loadFromURI:function(s){this._currentRequest=new g().setURI('/message_share_attachment/fromURI/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,uri:s}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_getNextRequestID:function(){return (++this._requestID);},_getCurrentRequestID:function(){return this._requestID;},_onShareLoaded:function(s,t){if(this._getCurrentRequestID()!==s)return;this.setState({loading:false,attachmentData:t.payload});},_close:function(){this._reset();this.props.onClose&&this.props.onClose();},_reset:function(){this._getNextRequestID();this._currentRequest&&this._currentRequest.abort();this._currentRequest=null;this.setState({loading:false,attachmentData:null});},render:function(){var s=(("_tig")+(' '+"_tih"));if(this.state.loading)return (l.createElement(h,{direction:h.DIRECTION.right,className:s},l.createElement(i,{className:"_tii",size:"large",color:"white"}),l.createElement(m,{className:"_tij",shade:"dark",size:"small",onClick:this._close})));var t=this.state.attachmentData;if(!t)return l.createElement("div",null);return (l.createElement("div",null,l.createElement(m,{className:"_tij",shade:"dark",size:"small",onClick:this._close}),l.createElement(j,{attachment:t,location:k.CHAT_PREVIEW})));}});e.exports=r;},null);
__d("MessengerHotLikeButton.react",["ImmutableObject","Keys","KeyStatus","Link.react","MercurySourceType","MessengerHotLikePreviewEvents","MessengerHotLikeUtils","ReactComponentWithPureRenderMixin","React","StickerConstants","fbt","MercuryMessageObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();'use strict';var r=b('MercuryMessageObject').get(),s=o,t=s.PropTypes,u=o.createClass({displayName:"MessengerHotLikeButton",mixins:[n],propTypes:{onClick:t.func.isRequired,threadID:t.string,disabled:t.bool},render:function(){return (o.createElement(j,{"aria-label":q._("Send a Like"),className:this.props.className,disabled:this.props.disabled,onClick:this._handleClickEvent,onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp},o.createElement("i",{style:{opacity:0,backgroundImage:'url('+m.getURIWithID(p.HOT_LIKE_LARGE_STICKER_ID)+')'}}),o.createElement("i",{style:{opacity:0,backgroundImage:'url('+m.getURIWithID(p.HOT_LIKE_SMALL_STICKER_ID)+')'}}),o.createElement("i",{style:{opacity:0,backgroundImage:'url('+m.getURIWithID(p.HOT_LIKE_MEDIUM_STICKER_ID)+')'}})));},_handleClick:function(v){setTimeout(function(){return this.props.onClick(v);}.bind(this),301);},_handleMouseDown:function(v){if(this.props.disabled||this._pressedSince){v.preventDefault();v.stopPropagation();}if(this.props.disabled||v.button!==0)return;this._pressedSince=Date.now();this._informPreviewStart();this._preparePop();},_handleMouseUp:function(){if(!this.props.threadID){this._handleClick(m.getStickerIDForTime(1));return;}if(!this._pressedSince)return;var v=Date.now()-this._pressedSince;this._pressedSince=0;var w=m.getStickerIDForTime(v);this._cancelPop();this._informPreviewStop(v);if(w)this._handleClick(w);},_informPreviewStart:function(){l.emit(l.START,this._getFakeMessage(),this.props.threadID);},_informPreviewStop:function(v){l.emit(l.STOP,this.props.threadID);},_informPreviewPop:function(){l.emit(l.POP,this.props.threadID);},_getFakeMessage:function(){var v=r.constructStickerMessageObject(p.HOT_LIKE_SMALL_STICKER_ID,k.MESSENGER_WEB,this.props.threadID);r.normalizeNewMessage(v);v.is_like_preview=true;v.like_preview_since=this._pressedSince;v.body='';return new g(v);},_preparePop:function(){this._cancelPop();this._popTimeout=setTimeout(this._informPreviewPop,m.SizeTimes.large);},_cancelPop:function(){clearTimeout(this._popTimeout);},_handleClickEvent:function(v){v.stopPropagation();if(this.props.disabled)return;if(i.getKeyDownCode()===h.RETURN)this._handleClick(m.getStickerIDForTime(1));}});e.exports=u;},null);
__d("P2PAbstractSendMoneyButton.react",["React","TooltipLink.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=g,l=k.PropTypes,m=g.createClass({displayName:"P2PAbstractSendMoneyButton",propTypes:{isDialogOpen:l.bool.isRequired,isDisabled:l.bool.isRequired,isMessenger:l.bool.isRequired,onClick:l.func.isRequired,recipientName:l.string},_clickGuard:(false),render:function(){return (g.createElement(h,{alignH:"center",className:((this.props.isDialogOpen?"open":'')+(this.props.isDisabled?' '+"disabled":'')+(!this.props.isMessenger?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":'')),href:"#",onClick:this._handleClick,onMouseDown:this._prepareForClick,position:"above",title:this._getLinkTitle(),tooltip:this._getDisabledTitle()}));},_getLinkTitle:function(){if(this.props.isDisabled)return null;return (j._("Send Money"));},_getDisabledTitle:function(){if(!this.props.isDisabled)return null;return (j._("{receiverName} isn't able to receive money right now.",[j.param("receiverName",this.props.recipientName)]));},_prepareForClick:function(){this._clickGuard=this.props.isDialogOpen;},_handleClick:function(n){n.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});e.exports=m;},null);
__d("MessengerContextualDialog.react",["LayerHideOnEscape","ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=12,l=i.createClass(h.createSpec({displayName:'MessengerContextualDialog',theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:k,length:16}},addedBehaviors:[g]}));e.exports=l;},null);
__d("P2PGroupSendDialog.react",["CurrentEnvironment","Image.react","MercuryIDs","MessengerContextualDialog.react","P2PActions","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PText.react","React","ScrollableArea.react","XUIContextualDialog.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();'use strict';var u=p,v=u.PropTypes,w=p.createClass({displayName:"P2PGroupSendDialog",propTypes:{amount:v.string,currency:v.string,onToggle:v.func.isRequired,participants:v.arrayOf(v.object).isRequired,threadFBID:v.string.isRequired},componentDidMount:function(){if(this.props.amount){this.log(m.UI_ACTN_INITIATE_GROUP_SEND_TRIGGER,{raw_amount:this.props.amount,currency:this.props.currency});}else this.log(m.UI_ACTN_INITIATE_GROUP_SEND);},log:function(x,y){l.log(x,Object.assign({www_event_flow:n.UI_FLOW_P2P_GROUP_SEND},y));},_handleToggle:function(x){this.props.onToggle(x);this.log(m.UI_ACTN_GROUP_SEND_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},renderParticipantRow:function(x){var y=g.messengerdotcom,z=y?32:40,aa=!x.orion_eligible,ba;if(aa)ba=p.createElement(o,{className:"_4cof",type:"primary"},t._("Isn't able to receive money right now"));return (p.createElement("li",{className:(("_4cog")+(aa?' '+"_4coh":'')),key:x.id,onClick:this.handleGroupThreadClicked.bind(this,x)},p.createElement("div",{className:"_4coi"},p.createElement(h,{className:"_4coj",height:z,src:x.big_image_src||x.image_src,width:z})),p.createElement("div",{className:"_4cok"},p.createElement(o,{className:"_4col",type:"primary"},x.name),ba)));},renderGroupList:function(){return (p.createElement(q,{height:178},p.createElement("ul",null,this.props.participants.map(this.renderParticipantRow))));},handleGroupThreadClicked:function(x){if(!x.orion_eligible)return;var y=i.getThreadIDFromParticipantID(x.id);this.props.onToggle(false);k.chatSendViewOpened({amount:this.props.amount,threadID:y,groupThreadFBID:this.props.threadFBID});this.log(m.UI_ACTN_GROUP_SEND_RECIPIENT_PICKED,{raw_amount:this.props.amount,currency:this.props.currency});},render:function(){var x=g.messengerdotcom,y=x?j:r,z=x?302:280;return (p.createElement(y,{alignment:x?'right':'left',context:this.props.context,onBlur:this._handleBlur,onToggle:this._handleToggle,shown:true,width:z,position:'above'},p.createElement("div",{className:(("_4com")+(x?' '+"_4con":''))},p.createElement(o,{className:"_4coo",type:"primary",weight:"bold"},t._("Who are you paying?")),this.renderGroupList())));}});e.exports=w;},null);
__d("P2PAddCreditCardDialog.react",["CurrentEnvironment","Link.react","P2PAPI","P2PAPIUtils","P2PCreditCardForm.react","P2PLoadingMask.react","P2PLinkConstants","React","P2PButton.react","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PText.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=n,y=x.PropTypes,z='fbP2PAddCreditCardDialog_learnMoreSentenceID',aa=g.messengerdotcom,ba=n.createClass({displayName:"P2PAddCreditCardDialog",propTypes:{asyncRequestState:y.object,onCancel:y.func,onError:y.func,onSaving:y.func,onSuccess:y.func,showPayButton:y.bool},getDefaultProps:function(){return {asyncRequestState:{},onCancel:v,onError:v,onSaving:v,onSuccess:v,showPayButton:false};},getInitialState:function(){return {isValid:false,formData:{},formFieldLoggingData:{},loading:false,requestID:'',saveErrors:null};},componentWillReceiveProps:function(ca){var da=ca.asyncRequestState?ca.asyncRequestState[this.state.requestID]:null;if(da){this.setState({requestID:''});if(da.error){this.handleOnSaveError(da.error);}else this.handleOnSaveSuccess(da);}},onSaveClick:function(){var ca=j.genRequestID();this.setState({loading:true,requestID:ca,saveErrors:null});this.props.onSaving();i.addCreditCard(Object.assign({requestID:ca},this.state.formData));},handleOnSaveSuccess:function(ca){this.props.onSuccess(ca);},handleOnSaveError:function(ca){this.setState({loading:false,saveErrors:ca});this.props.onError();},handleValidation:function(ca,da,ea){this.setState({isValid:ca,formData:da,formFieldLoggingData:ea});},isSaveButtonDisabled:function(){return this.state.loading||!this.state.isValid;},onToggle:function(ca){if(!ca)this.props.onCancel(this.state.formFieldLoggingData);},onCancelClicked:function(){this.onToggle(false);},getButtonType:function(){var ca='default';if(this.props.showPayButton)ca='confirm';return ca;},getButtonText:function(){var ca=w._("Save");if(this.props.showPayButton)ca=w._("Pay");return ca;},renderAddCardForm:function(){var ca;if(aa)ca=n.createElement(o,{use:"default",size:"medium",label:w._("Cancel"),disabled:this.state.loading,onClick:this.props.onCancelClicked});return (n.createElement("div",null,n.createElement(q,null,w._("Add Debit Card")),n.createElement(r,null,n.createElement(t,{type:"primary",className:"_3-96"},w._("Please enter a debit card. Credit cards can't be used.")),n.createElement(k,{asyncRequestState:this.props.asyncRequestState,onValidation:this.handleValidation,saveErrors:this.state.saveErrors,validateBIN:true}),n.createElement(t,{className:"_3-8y",id:z,type:"secondary"},w._("Your payment info is stored securely. {Learn more about p2p link}",[w.param("Learn more about p2p link",n.createElement(h,{"aria-describedby":z,href:m.addDebitCardHelpURI,target:"_blank"},w._("Learn more.")))]))),n.createElement(s,null,ca,n.createElement(o,{use:this.getButtonType(),size:"medium",label:this.getButtonText(),disabled:this.isSaveButtonDisabled(),onClick:this.onSaveClick}))));},render:function(){var ca;ca=aa?350:288;return (n.createElement(p,{layerHideOnBlur:false,ref:"dialog",onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:ca},this.renderAddCardForm(),n.createElement(l,{visible:this.state.loading})));}});e.exports=ba;},null);
__d("P2PConfirmAmountDialog.react",["CurrentEnvironment","React","P2PButton.react","P2PDialog.react","P2PDialogBody.react","P2PDialogFooter.react","P2PDialogTitle.react","P2PLoadingMask.react","P2PText.react","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=h,s=r.PropTypes,t=g.messengerdotcom,u=h.createClass({displayName:"P2PConfirmAmountDialog",propTypes:{amount:s.string,currencySymbol:s.string,onCancel:s.func,onConfirm:s.func,receiverName:s.string},getDefaultProps:function(){return {amount:'',currencySymbol:'',onCancel:p,onConfirm:p,receiverName:s.string};},getInitialState:function(){return {loading:false};},handleCancelClick:function(){this.props.onCancel();},handleConfirmClick:function(){this.setState({loading:true});this.props.onConfirm();},getFormattedAmount:function(){var v=this.props.amount,w=(parseFloat(v)).toFixed(2);return this.props.currencySymbol+''+w;},render:function(){var v=t?350:300;return (h.createElement(j,{layerHideOnBlur:false,shown:true,width:v},h.createElement(m,{showCloseButton:false},q._("Confirm Payment")),h.createElement(k,null,h.createElement(o,{type:"primary"},q._("Do you want to pay {recipient name} {amount}?",[q.param("recipient name",this.props.receiverName),q.param("amount",this.getFormattedAmount())]))),h.createElement(l,null,h.createElement(i,{label:q._("Cancel"),onClick:this.handleCancelClick,use:"default"}),h.createElement(i,{label:q._("Pay"),onClick:this.handleConfirmClick,use:"confirm"})),h.createElement(n,{visible:this.state.loading})));}});e.exports=u;},null);
__d("P2PSendMoneyAmountInput.react",["CurrentEnvironment","React","XUIError.react","P2PAmountUtils","P2PText.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=h,p=o.PropTypes,q=g.messengerdotcom,r=h.createClass({displayName:"P2PSendMoneyAmountInput",propTypes:{currencySymbol:p.string,onInputChange:p.func,value:p.string},getDefaultProps:function(){return {currencySymbol:'$',onInputChange:m,value:''};},getInitialState:function(){return {inputError:null,maxInputWidth:q?236:100,value:this.props.value,width:''};},componentDidMount:function(){this.updateAmount(this.state.value);this.initDelayedFocus();},initDelayedFocus:function(){setTimeout(this.focus);},focus:function(){var s,t=this.state.value,u=0;if(this.isMounted()&&this.refs.textInput){s=h.findDOMNode(this.refs.textInput);s.focus();if(t){u=t.length;s.setSelectionRange(u,u);}}},handleAmountInputChange:function(s){var t=s.target.value;this.clearInputError();this.updateAmount(t);},clearInputError:function(){this.setState({inputError:null});},setInputError:function(s){this.setState({inputError:s});},updateAmount:function(s){var t=true,u,v=j.isAmountOverLegalLimit(s);s=j.sanitizeAmount(s);u=parseFloat(s);if(v){t=false;this.setInputError(n._("Please enter a smaller amount"));}var w=s.split('.'),x=w[0],y=w[1];if(y!==undefined){s=(x&&parseFloat(x)!==0?x:'0')+'.'+y.substr(0,2);}else if(x&&parseFloat(x)===0)s='0';this.setValue(s);u=parseFloat(s);t=t&&!isNaN(u)&&u>0;this.props.onInputChange(s,t);},setValue:function(s){this.setState({value:s},this.updateWidth);},updateWidth:function(){var s=this.getMockWidth();if(s)this.setState({width:Math.min(s,this.state.maxInputWidth)});},getMockWidth:function(){return h.findDOMNode(this.refs.mock_input).offsetWidth;},render:function(){var s;if(q&&!this.state.value.length)s=h.createElement("div",{ref:"placeholder_input",className:"_1-sv"},"0");return (h.createElement("div",{className:(("_ipw")+(q?' '+"_1-sw":''))},h.createElement("label",null,h.createElement(k,{className:"_3-91 _1-sx",display:"inline",type:"primary"},n._("Enter Amount")),h.createElement("div",{className:(("_4puh")+(!this.state.value.length?' '+"_1-sy":''))},h.createElement("div",{className:"_5fbp"},this.props.currencySymbol),s,h.createElement("div",{ref:"mock_input",className:"_5fbs"},this.state.value),h.createElement(i,{xuiError:this.state.inputError},h.createElement("span",{className:"_1-sz"},h.createElement("input",{className:"_5fbv",onChange:this.handleAmountInputChange,ref:"textInput",style:{width:this.state.width},value:this.state.value})))))));}});e.exports=r;},null);
__d("P2PSendMoneyDialog.react",["Arbiter","CreditCardFormParam","CurrentEnvironment","Image.react","ImageBlock.react","Link.react","MessengerContextualDialog.react","P2PAPI","P2PAddCreditCardDialog.react","P2PButton.react","P2PCreditCardStore","P2PChooseCreditCardForm.react","P2PConfirmAmountDialog.react","P2PEditCreditCardDialog.react","P2PLinkConstants","P2PLoadingMask.react","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PSendMoneyAmountInput.react","P2PText.react","P2PVerifyCreditCardDialog.react","React","ReactLayeredComponentMixin","XUIContextualDialog.react","cx","fbt","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){b.__markCompiled&&b.__markCompiled();'use strict';var ia=ca,ja=ia.PropTypes,ka=i.messengerdotcom,la=ga._("Change"),ma=ga._("Add Debit Card"),na=100,oa=ca.createClass({displayName:"P2PSendMoneyDialog",mixins:[da],propTypes:{amount:ja.string,currency:ja.string.isRequired,currencySymbol:ja.string.isRequired,groupThreadFBID:ja.string,onError:ja.func,onSendSuccess:ja.func,onToggle:ja.func,receiver:ja.object},getDefaultProps:function(){return {amount:'',onError:ha,onSendSuccess:ha,onToggle:ha,receiver:{}};},getInitialState:function(){var pa=q.getAll();return {asyncRequestState:q.getAsyncRequestState(),addCreditCardDialogShown:false,amount:this.props.amount,creditCards:pa,confirmAmountDialogShown:false,isAmountValid:false,loading:false,selectedCard:pa[0],showChooseCreditCardForm:false,verifyCreditCardDialogShown:false};},_isAmountVerified:false,passwordCancelSubscribeToken:null,log:function(pa,qa){w.log(pa,Object.assign({www_event_flow:y.UI_FLOW_P2P_SEND,object_id:this.props.receiver.userId},qa));},componentWillUnmount:function(){if(this.passwordCancelSubscribeToken!==null){g.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},componentWillMount:function(){this.creditCardStoreSub=q.addListener('change',this.onCreditCardStoreChange);if(this.state.amount){this.log(x.UI_ACTN_INITIATE_SEND_TRIGGER,{raw_amount:this.state.amount,currency:this.props.currency});}else this.log(x.UI_ACTN_INITIATE_SEND);},onAmountInputChange:function(pa,qa){this.setState({amount:pa,isAmountValid:qa});},onCreditCardStoreChange:function(){var pa=q.getAll(),qa;if(this.state.selectedCard)qa=pa.filter(function(ra){return (ra.getCredentialId()===this.state.selectedCard.getCredentialId());}.bind(this))[0];if(!qa)qa=pa[0];this.setState({asyncRequestState:q.getAsyncRequestState(),creditCards:pa,selectedCard:qa});},shouldShowConfirmAmountDialog:function(){var pa=parseFloat(this.state.amount);return (!this._isAmountVerified&&pa>=na);},shouldShowVerifyCreditCardDialog:function(){return !this.state.selectedCard.getIsVerified();},shouldShowEditCreditCardDialog:function(){return this.state.selectedCard.isExpired();},handleSendClick:function(pa){if(this.isSendButtonDisabled())return false;this.log(x.UI_ACTN_SEND_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this._isAmountVerified=false;this.initiatePayment();},initiatePayment:function(){if(this.shouldShowConfirmAmountDialog()){this.hideAllDialogs();this.setState({confirmAmountDialogShown:true});this.log(x.UI_ACTN_CONFIRM_AMOUNT,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowEditCreditCardDialog()){this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});this.log(x.UI_ACTN_EDIT_CARD,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowVerifyCreditCardDialog()){this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});this.log(x.UI_ACTN_VERIFY_CSC,{raw_amount:this.state.amount,currency:this.props.currency});return;}this.createTransaction();},shouldShowLoading:function(){return (!this.state.addCreditCardDialogShown&&!this.state.confirmAmountDialogShown&&!this.state.verifyCreditCardDialogShown&&!this.state.editCreditCardDialogShown);},createTransaction:function(){var pa={};this.setState({loading:this.shouldShowLoading()});pa[h.CREDENTIAL_ID]=this.state.selectedCard.getCredentialId();pa.amount=this.state.amount;pa.receiverId=this.props.receiver.userId;if(this.props.groupThreadFBID)pa.group_thread_fbid=this.props.groupThreadFBID;this.passwordCancelSubscribeToken=g.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);n.createTransaction({formData:pa,error:this.setCreateTransferError,success:this.setCreateTransferSuccess});this.log(x.UI_ACTN_CONFIRM_SEND,{raw_amount:this.state.amount,currency:this.props.currency});},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,confirmAmountDialogShown:false,verifyCreditCardDialogShown:false,editCreditCardDialogShown:false});},setCreateTransferError:function(pa){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onError(pa);this.log(x.UI_ACTN_SEND_FAIL);},setCreateTransferSuccess:function(pa){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onSendSuccess(pa);this.log(x.UI_ACTN_SEND_SUCCESS);},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},onAddCreditCardCancel:function(pa){this.setState({addCreditCardDialogShown:false});this.log(x.UI_ACTN_CANCEL_ADD_CARD,pa);},onAddCreditCardSaving:function(){this.log(x.UI_ACTN_CONFIRM_CARD_DETAILS);},onAddCreditCardSuccess:function(pa){var qa=this.state.creditCards.filter(function(ra){var sa=ra.getCredentialId();return (pa[h.CREDENTIAL_ID]===sa);})[0];this.setState({selectedCard:qa});if(this.state.isAmountValid){this.initiatePayment();}else{this.setState({addCreditCardDialogShown:false});this.focusAmountInput();}this.log(x.UI_ACTN_ADD_CARD_SUCCESS);},onAddCreditCardError:function(){this.log(x.UI_ACTN_ADD_CARD_FAIL);},onEditCreditCardSuccess:function(){this.initiatePayment();},onEditCreditCardCancel:function(){this.setState({editCreditCardDialogShown:false});},focusAmountInput:function(){if(this.refs.send_money_amount_input)ca.findDOMNode(this.refs.send_money_amount_input).focus();},_handleToggle:function(pa){this.props.onToggle(pa);if(!this.state.loading)this.log(x.UI_ACTN_SEND_MONEY_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},handleAddCreditCardClick:function(){this.setState({addCreditCardDialogShown:true,showChooseCreditCardForm:false});this.log(x.UI_ACTN_CHANGE_CARD);},handleBackClick:function(){this.setState({showChooseCreditCardForm:false},function(){this.focusAmountInput();});},handleChooseCardNextClick:function(){var pa=this.refs.choose_credit_card_form.getSelectedCard();this.setState({selectedCard:pa,showChooseCreditCardForm:false},function(){this.focusAmountInput();});},handleAddCardNextClick:function(){this.setState({addCreditCardDialogShown:true});this.log(x.UI_ACTN_INITIATE_ADD_CARD);},handleChangeSelectedCardClick:function(){var pa={};if(this.state.creditCards.length===1){pa.addCreditCardDialogShown=true;this.log(x.UI_ACTN_CHANGE_CARD);}else pa.showChooseCreditCardForm=true;this.setState(pa);},onConfirmAmountCancel:function(){this.setState({confirmAmountDialogShown:false});},onConfirmAmountSuccess:function(){this._isAmountVerified=true;this.initiatePayment();},onVerifyCreditCardSuccess:function(){this.initiatePayment();},onVerifyCreditCardCancel:function(){this.setState({verifyCreditCardDialogShown:false});},isSendButtonDisabled:function(){return (!this.state.isAmountValid||!this.state.creditCards.length||this.state.loading);},isAddCardNextButtonDisabled:function(){return !this.state.isAmountValid;},renderAddDebitCardLink:function(){return (ca.createElement(aa,{className:"_42h3",type:"secondary",ref:"send_money_dialog_add_card_text"},ca.createElement(l,{className:"_49nm",href:"#",onClick:this.handleAddCreditCardClick},ma)));},renderSelectedCard:function(){var pa=this.state.selectedCard;return (ca.createElement(aa,{className:"_21x5",size:"small",type:"primary"},ca.createElement("div",{className:"_49nn"},pa.getName()),ca.createElement("div",{className:"_21wx"},pa.getCreditCardNumberFormatted()),ca.createElement("div",{className:"_21ww"},'\u00b7'),ca.createElement(l,{className:"_21wy",onClick:this.handleChangeSelectedCardClick,href:"#"},la)));},renderFormButtons:function(){var pa;if(!this.state.creditCards.length){pa=this.renderAddCardNextButton();}else if(this.state.showChooseCreditCardForm){pa=ca.createElement("div",null,this.renderChooseCardBackButton(),this.renderChooseCardNextButton());}else pa=this.renderPayButton();return pa;},renderChooseCardBackButton:function(){return (ca.createElement(p,{className:"_2abj",label:ga._("Back"),onClick:this.handleBackClick,ref:"back_button",size:"medium",type:"secondary",use:"default"}));},renderAddCardNextButton:function(){return (ca.createElement(p,{className:"_5p-b",disabled:this.isAddCardNextButtonDisabled(),label:ga._("Next"),onClick:this.handleAddCardNextClick,ref:"add_card_next_button",size:"medium",type:"primary",use:"default"}));},renderChooseCardNextButton:function(){return (ca.createElement(p,{label:ga._("Next"),onClick:this.handleChooseCardNextClick,ref:"choose_card_next_button",size:"medium",type:"primary",use:"confirm"}));},renderPayButton:function(){return (ca.createElement(p,{className:"_21x6 _5p-b",disabled:this.isSendButtonDisabled(),label:ga._("Pay"),onClick:this.handleSendClick,ref:"send_button",size:"medium",type:"primary",use:"confirm"}));},renderPaymentDetails:function(){var pa;if(this.state.creditCards.length){if(this.state.showChooseCreditCardForm){pa=this.renderAddDebitCardLink();}else pa=this.renderSelectedCard();}else pa=ca.createElement("div",{className:"_2abl"},ca.createElement(aa,{type:"secondary",ref:"send_money_dialog_add_card_next_text"},ga._("Sending money is free and secure")));return pa;},renderSendMoneyForm:function(){var pa=ka?32:40;return (ca.createElement("div",null,ca.createElement("div",{className:"_49no _2pi4",ref:"send_money_dialog_title"},ca.createElement(k,{spacing:"large"},ca.createElement(j,{className:"_5p-i",height:pa,src:this.props.receiver.big_image_src||this.props.receiver.image_src,width:pa}),ca.createElement("div",{className:"_3-8w"},ca.createElement(aa,{type:"secondary"},ga._("Send to")),ca.createElement(aa,{className:"_5p-j",size:"small",type:"primary",weight:"bold"},this.props.receiver.name))),ca.createElement(l,{className:"_49np",href:u.helpCenterURI,target:"_blank"})),ca.createElement("div",{className:"_2abm"},this.renderMainContainer()),ca.createElement("div",{className:(("_21w-")+(ka?' '+"_4eb_":''))},ca.createElement("div",{className:"_5p-k"},ca.createElement("div",{className:"_21x4"},this.renderPaymentDetails()),ca.createElement("div",{className:"_4zf-"},this.renderFormButtons())))));},renderMainContainer:function(){var pa;if(this.state.showChooseCreditCardForm){pa=ca.createElement("div",{className:"_xn7"},ca.createElement(r,{creditCards:this.state.creditCards,selectedCard:this.state.selectedCard,ref:"choose_credit_card_form"}));}else pa=ca.createElement("div",{className:"_2abn"},ca.createElement(z,{currencySymbol:this.props.currencySymbol,onInputChange:this.onAmountInputChange,ref:"send_money_amount_input",value:this.state.amount}));return pa;},renderLayers:function(){var pa={};if(this.state.addCreditCardDialogShown){pa.addCreditCard=ca.createElement(o,{asyncRequestState:this.state.asyncRequestState,ref:"send_money_dialog_add_credit_card_form",onCancel:this.onAddCreditCardCancel,onSuccess:this.onAddCreditCardSuccess,onError:this.onAddCreditCardError,onSaving:this.onAddCreditCardSaving,showPayButton:this.state.isAmountValid});}else if(this.state.confirmAmountDialogShown){pa.confirmAmount=ca.createElement(s,{amount:this.state.amount,currencySymbol:this.props.currencySymbol,onCancel:this.onConfirmAmountCancel,onConfirm:this.onConfirmAmountSuccess,receiverName:this.props.receiver.short_name});}else if(this.state.verifyCreditCardDialogShown){pa.verifyCreditCard=ca.createElement(ba,{asyncRequestState:this.state.asyncRequestState,creditCard:this.state.selectedCard,isSending:true,onCancel:this.onVerifyCreditCardCancel,onSuccess:this.onVerifyCreditCardSuccess});}else if(this.state.editCreditCardDialogShown)pa.confirmAmount=ca.createElement(t,{asyncRequestState:this.state.asyncRequestState,creditCard:this.state.selectedCard,onCancel:this.onEditCreditCardCancel,onSuccess:this.onEditCreditCardSuccess});return pa;},render:function(){var pa=ka?m:ea,qa=ka?286:260;return (ca.createElement(pa,{alignment:ka?'right':'left',context:this.props.context,onBlur:this._handleBlur,onToggle:this._handleToggle,shown:true,width:qa,position:this.props.position||'above'},ca.createElement("div",{className:(("_21x9")+(ka?' '+"_1pka":''))},this.renderSendMoneyForm(),ca.createElement(v,{ref:"send_money_dialog_loader",visible:this.state.loading}))));}});e.exports=oa;},null);
__d("MessengerURIConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g={COMPOSE_SUBPATH:'/new',GROUPS_PATH:'/groups',PEOPLE_PATH:'/people',THREAD_PREFIX:'/t/',GROUP_PREFIX:'group-',RESERVED_WORDS:['groups','people','new','messenger','t']};e.exports=g;},null);
__d("MessengerStateProcessor",["MercuryAPIArgsSource","MercuryIDs","MercuryParticipantTypes","MercuryParticipants","MercuryServerRequests","MercuryThreads","MessengerURIConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n={preprocess:function(p){var q=p.activeThreadID;if(q){var r=h.getUserIDFromThreadID(q),s=r&&j.getNow(h.getParticipantIDFromUserID(r));if(s&&s.type!==i.EVENT){p.threadKey=s.vanity||r;}else if(r&&!s){p.threadKey=r;}else{var t=k.get(),u=t.getServerThreadIDNow(q);p.threadKey=u||q;}}delete p.activeThreadID;return p;},postprocess:function(p){var q=k.get(),r=l.get(),s=o(p.threadKey),t;t=h.isValid(s)?s:q.getClientThreadIDNow(s);if(!t){var u=j.getIDFromVanityOrFBID(s),v=u&&r.getCanonicalThreadToParticipant(u,null,g.MESSENGER);if(v)t=v.thread_id;}if(t){p.activeThreadID=t;p.serverThreadID=q.getServerThreadIDNow(t);}delete p.threadKey;return p;}};function o(p){if(!p)return null;return p.startsWith(m.GROUP_PREFIX)?p.substr(m.GROUP_PREFIX.length):p;}e.exports=n;},null);
__d("MessengerURISerializer",["MessengerStateProcessor","MessengerURIConstants","MessengerView","URI","WWWBase"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l='/?$',m={serialize:function(v){var w=new j(k.uri);v=g.preprocess(v);switch(v.masterView){case i.MASTER.GROUPS:w.setPath(h.GROUPS_PATH);break;case i.MASTER.PEOPLE:w.setPath(h.PEOPLE_PATH);break;}if(v.detailView===i.DETAIL.COMPOSE){w.setPath(w.getPath()+h.COMPOSE_SUBPATH);}else if(v.threadKey)w.setPath(w.getPath()+h.THREAD_PREFIX+t(v.threadKey));return w;},deserialize:function(v){var w={},x=v.getPath();if(x.match('^'+h.GROUPS_PATH)){w.masterView=i.MASTER.GROUPS;}else if(x.match('^'+h.PEOPLE_PATH)){w.masterView=i.MASTER.PEOPLE;}else w.masterView=i.MASTER.RECENT;if(x.match(h.COMPOSE_SUBPATH+l)){w.detailView=i.DETAIL.COMPOSE;}else{var y=n(x);if(y&&!r(y)){w.threadKey=u(y);w.detailView=i.DETAIL.THREAD;}}return g.postprocess(w);}};function n(v){var w=v.match(h.THREAD_PREFIX+'([^/]+)'+l);return w&&w[1];}var o=h.RESERVED_WORDS.join('|'),p=new RegExp('^('+o+')$'),q=new RegExp('^\\.('+o+')$');function r(v){return !!v.match(p);}function s(v){return !!v.match(q);}function t(v){v=r(v)?'.'+v:v;return j.encodeComponent(v);}function u(v){v=j.decodeComponent(v);return s(v)?v.substr(1):v;}e.exports=m;},null);
__d("MessengerActions",["MessengerDispatcher","MessengerURISerializer","MessengerView","URI","goURI","keyMirror"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=l({REPLACE_STATE:null,REPLACE_INFO_PANEL_VISIBILITY:null,SHOW_DIALOG:null,HIDE_DIALOG:null}),n={Types:m,changeDetailView:function(p){o(function(q){if(q.detailView!==p)return {detailView:p};});},changeMasterView:function(p){o(function(q){if(q.masterView!==p)return {masterView:p};});},selectThread:function(p){o(function(q){if(q.activeThreadID!==p)return {activeThreadID:p,detailView:i.DETAIL.THREAD};});},changeState:function(p){g.dispatch({type:m.REPLACE_STATE,nextState:p});},changeInfoPanelVisibility:function(p){g.dispatch({type:n.Types.REPLACE_INFO_PANEL_VISIBILITY,nextState:{infoPanelVisibility:p}});},showDialog:function(p,q){g.dispatch({type:n.Types.SHOW_DIALOG,dialogClass:p,dialogProps:q});},hideDialog:function(p){g.dispatch({type:n.Types.HIDE_DIALOG,dialogClass:p});}};function o(p){var q=h.deserialize(new j(window.location.href)),r=p(q);if(r)k(h.serialize(Object.assign(q,r)));}e.exports=n;},null);
__d("P2PSendMoneyDialogStore",["P2PActionConstants","ChatOpenTab","EventEmitter","MessengerActions","P2PDispatcher"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l,m;for(var n in i)if(i.hasOwnProperty(n))p[n]=i[n];var o=i===null?null:i.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=i;function p(){i.call(this);m={};l=k.register(this.onEventDispatched.bind(this));}p.prototype.onEventDispatched=function(q){var r=q.data,s=q.type;switch(s){case g.CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(r);this.emit('change');break;case g.CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(r);this.emit('change');break;}};p.prototype.getStateByThreadID=function(q){return m[q];};p.prototype.handleChatSendViewOpened=function(q){if(h.canOpenTab()){h.openThread(q.threadID);}else j.selectThread(q.threadID);m[q.threadID]={amount:q.amount,groupThreadFBID:q.groupThreadFBID,isOpen:true,groupSendReceiptDetails:q.groupSendReceiptDetails};};p.prototype.handleChatSendViewClosed=function(q){m[q.threadID]={amount:'',groupThreadFBID:'',isOpen:false,groupSendReceiptDetails:null};};e.exports=new p();},null);
__d("P2PGroupSendReceiptDialog.react",["CurrentEnvironment","LeftRight.react","MessengerContextualDialog.react","P2PActions","P2PAmountUtils","P2PButton.react","P2PBigAmount.react","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PText.react","React","XUIContextualDialog.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();'use strict';var v=r,w=v.PropTypes,x=r.createClass({displayName:"P2PGroupSendReceiptDialog",propTypes:{currency:w.string.isRequired,onToggle:w.func.isRequired,groupSendReceiptDetails:w.object.isRequired,threadFBID:w.string.isRequired,threadID:w.string.isRequired},componentDidMount:function(){this.log(o.UI_ACTN_3RD_PARTY_LOG_MESSAGE_CLICKED,{raw_amount:this.props.groupSendReceiptDetails.amount,currency:this.props.currency});},log:function(y,z){n.log(y,Object.assign({www_event_flow:p.UI_FLOW_P2P_GROUP_SEND},z));},_handleToggle:function(y){this.props.onToggle(y);if(!y)this.log(o.UI_ACTN_3RD_PARTY_LOG_MESSAGE_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},handleTryItClicked:function(){j.chatSendViewOpened({threadID:this.props.threadID,groupThreadFBID:this.props.threadFBID});this.log(o.UI_ACTN_3RD_PARTY_LOG_MESSAGE_TRY_CLICKED,{raw_amount:this.props.groupSendReceiptDetails.amount,currency:this.props.currency});},render:function(){var y=g.messengerdotcom,z=y?i:s,aa=y?302:280,ba=this.props.groupSendReceiptDetails,ca=r.createElement(q,{className:"_bpt",size:"small",type:y?"secondary":"primary"},u._("{sender name} sent {amount} to {receiver name}",[u.param("sender name",ba.senderName),u.param("amount",ba.amount),u.param("receiver name",ba.receiverName)]),".");return (r.createElement(z,{alignment:y?'right':'left',context:this.props.context,onBlur:this._handleBlur,onToggle:this._handleToggle,shown:true,width:aa,position:'above'},r.createElement("div",{className:(("_bpu")+(y?' '+"_bpv":''))},r.createElement(q,{className:"_bpw",type:"primary",weight:"bold"},u._("Payments in Messenger")),r.createElement("div",{className:"_2pi9"},r.createElement(q,{className:"_bpx",type:"secondary"},u._("Now you can send and receive money.")),r.createElement("div",{className:"_bpy"},r.createElement(m,{amount:k.sanitizeAmount(ba.amount)}),y?ca:null),!y?ca:null,r.createElement(h,{className:"_2pio"},r.createElement("div",null),r.createElement(l,{use:"confirm",size:"medium",label:u._("Try It"),type:"primary",onClick:this.handleTryItClicked}))))));}});e.exports=x;},null);
__d("P2PSendMoneyButton.react",["CurrentEnvironment","Link.react","P2PAbstractSendMoneyButton.react","P2PErrorDialog.react","P2PGroupSendDialog.react","P2PLinkConstants","P2PPasswordProtectionNUXDialog.react","P2PPasswordProtectionStatusTypes","P2PSendMoneyDialog.react","P2PSendMoneyDialogStore","P2PTransferRiskResult","P2PTransferParam","P2PVerificationFlowHelper","React","ReactLayeredComponentMixin","P2PActions","P2PButton.react","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PSuccessDialog.react","P2PText.react","P2PGroupSendReceiptDialog.react","P2PTransferStore","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){b.__markCompiled&&b.__markCompiled();'use strict';var ha=t,ia=ha.PropTypes,ja=t.createClass({displayName:"P2PSendMoneyButton",mixins:[u],propTypes:{isNewEmptyLocalThread:ia.bool,isGroupChat:ia.bool,onTrigger:ia.func,participants:ia.arrayOf(ia.object),threadID:ia.string,threadFBID:ia.string},getDefaultProps:function(){return {onTrigger:fa,participants:[]};},getInitialState:function(){return {amount:'',confirmationDialogShown:false,groupThreadFBID:'',sendMoneyDialogShown:false,passwordNUXPending:false,passwordProtectionNUXDialogShown:false,sendErrorObject:null,underManualReviewDialogShown:false};},componentDidMount:function(){this.sendMoneyDialogStoreSub=p.addListener('change',this.onSendMoneyDialogStoreChange);},componentWillUnmount:function(){if(this.sendMoneyDialogStoreSub){this.sendMoneyDialogStoreSub.remove();this.sendMoneyDialogStoreSub=null;}},componentDidUpdate:function(ka){if(ka.threadID!==this.props.threadID)this.setSendMoneyDialogState();},onSendMoneyDialogStoreChange:function(){this.setSendMoneyDialogState();},setSendMoneyDialogState:function(){var ka;if(!this.canShowSendMoneyDialog())return false;ka=this.props.threadID?p.getStateByThreadID(this.props.threadID):null;if(ka)this.setState({sendMoneyDialogShown:ka.isOpen,amount:ka.amount,groupThreadFBID:ka.groupThreadFBID,groupSendReceiptDetails:ka.groupSendReceiptDetails});},canShowSendMoneyDialog:function(){if(!this.props.participants.length)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){v.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){v.chatSendViewOpened({threadID:this.props.threadID});},_handleDialogToggle:function(ka){if(!ka){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handleOnSendSuccess:function(ka){this.hideSendMoneyDialog();var la=ka[r.RISK_RESULT];this.originalCreateTransactionResponse=ka;if(la===q.REQUIRE_VERIFICATION){s.startVerificationFlow(ka.id,true,this.handlePostSendSteps);}else if(la===q.UNDER_MANUAL_REVIEW){this.setState({underManualReviewDialogShown:true});}else this.handlePostSendSteps();},handlePostSendSteps:function(){var ka=this.originalCreateTransactionResponse,la=ka.passwordProtection===n.NOT_SET;if(ka.isFirstSend){this.setState({confirmationDialogShown:true,passwordNUXPending:la});}else if(la)this.setState({passwordProtectionNUXDialogShown:true});this.originalCreateTransactionResponse=null;this.props.onTrigger();},onPasswordProtectionNUXComplete:function(){this.setState({passwordProtectionNUXDialogShown:false});},handleConfirmationOKClick:function(){this.setState({confirmationDialogShown:false,passwordProtectionNUXDialogShown:this.state.passwordNUXPending,passwordNUXPending:false});},handleSendError:function(ka){if(this.isMounted())this.setState({sendErrorObject:ka});},handleErrorDialogOKClick:function(){this.setState({sendErrorObject:null});},onRiskResultDialogConfirmed:function(){this.setState({underManualReviewDialogShown:false},function(){this.handlePostSendSteps();}.bind(this));},getMoneyButtonNode:function(){return t.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat)return this.props.participants[0];return null;},isRecipientEligible:function(){var ka=this.getRecipient();if(!ka)return false;return !!(ka.orion_eligible||ea.hasReceivedFromSender(ka.userId));},renderLayers:function(){var ka={},la='USD',ma='$';if(this.state.sendErrorObject)ka.sendError=t.createElement(j,{error:this.state.sendErrorObject,onOKClick:this.handleErrorDialogOKClick,ref:"send_error",title:ga._("Problem Sending Money")});if(this.state.sendMoneyDialogShown)if(this.state.groupSendReceiptDetails){ka.groupSendReceiptDetailsDialog=t.createElement(da,{context:this.getMoneyButtonNode(),currency:la,groupSendReceiptDetails:this.state.groupSendReceiptDetails,onToggle:this._handleDialogToggle,threadFBID:this.props.threadFBID,threadID:this.props.threadID});}else if(this.props.isGroupChat){ka.groupSendMoneyDialog=t.createElement(k,{amount:this.state.amount,context:this.getMoneyButtonNode(),currency:la,onToggle:this._handleDialogToggle,participants:this.props.participants,threadFBID:this.props.threadFBID});}else ka.sendMoneyDialog=t.createElement(o,{amount:this.state.amount,context:this.getMoneyButtonNode(),currency:la,currencySymbol:ma,groupThreadFBID:this.state.groupThreadFBID,onToggle:this._handleDialogToggle,onError:this.handleSendError,onSendSuccess:this.handleOnSendSuccess,receiver:this.getRecipient(),ref:'send_money_dialog'});if(this.state.confirmationDialogShown)ka.confirmationDialog=t.createElement(ba,{onOKClick:this.handleConfirmationOKClick,title:ga._("Payment Sent")},t.createElement(ca,{type:"primary"},ga._("When you receive money, it will go on this card too. You can update your card in {Link with text that goes to settings page}.",[ga.param("Link with text that goes to settings page",t.createElement(h,{target:"_blank",href:l.settingsWWWURI},ga._("Payments Settings")))])));if(this.state.passwordProtectionNUXDialogShown)ka.passwordProtectionNUXDialog=t.createElement(m,{onComplete:this.onPasswordProtectionNUXComplete});if(this.state.underManualReviewDialogShown)ka.underManualReviewDialog=t.createElement(x,{layerHideOnBlur:false,ref:"under_manual_review_dialog",shown:true,width:300},t.createElement(y,{showCloseButton:false},ga._("Reviewing Payment Info")),t.createElement(z,null,t.createElement(ca,{type:"primary"},ga._("For your security, this payment is in review for up to 24 hours. When it's confirmed, it will go through."))),t.createElement(aa,null,t.createElement(w,{label:ga._("OK"),onClick:this.onRiskResultDialogConfirmed,use:"confirm"})));return ka;},render:function(){var ka=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.props.participants.length>1)return null;return (t.createElement(i,{isDialogOpen:this.state.sendMoneyDialogShown,isDisabled:!!(ka&&!this.isRecipientEligible()),isMessenger:!!g.messengerdotcom,onClick:this._onButtonClick,recipientName:ka&&ka.short_name,ref:"p2pSendMoneyButton"}));}});e.exports=ja;},null);
__d("XPagesMercuryIndicatorController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});},null);
__d("PagesMercuryChatTabIndicatorHandler",["AsyncRequest","FBID","MercuryIDs","XPagesMercuryIndicatorController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l,m){"use strict";this.$PagesMercuryChatTabIndicatorHandler0=i.getUserIDFromThreadID(l);this.$PagesMercuryChatTabIndicatorHandler1=m;}k.prototype.checkResponsiveness=function(){"use strict";if(!this.$PagesMercuryChatTabIndicatorHandler0||h.isUser(this.$PagesMercuryChatTabIndicatorHandler0))return;var l=j.getURIBuilder().getURI();new g().setURI(l).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler0}).setHandler(function(m){var n=m.payload;if(n.responsiveness)this.$PagesMercuryChatTabIndicatorHandler1(n.responsiveness);}.bind(this)).send();};e.exports=k;},null);
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;},null);
__d("XStickerReplyNUXController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/stickers\/tooltip\/",{});},null);
__d("ChatTabView",["Animation","Arbiter","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","BanzaiODS","Bootloader","BootloadedComponent.react","ChatAddToThreadButton.react","ChatArchiveWarning.react","ChatBehavior","ChatCloseButton.react","ChatConfig","ChatContextualDialogController","ChatEmployeeAwayWarning","ChatOpenTab","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatStickerTriggerController","ChatTabActions","ChatTabMenu.react","ChatTabMessagesView","ChatTabOfficeStatus","ChatTabSheetController","ChatTabViewEvents","ChatTabViewInstances","ChatTitleLink.react","ChatVisibility","ChatVideoCallButton.react","MercuryConstants","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMEvent","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","FBRTCCallabilityStore","FBID","Focus","ImmutableObject","Input","Keys","Locale","LogHistory","MercuryIDs","MercuryLogMessageType","MercuryParticipants","MercuryShareAttachmentRenderLocations","MercurySharePreview.react","MercurySourceType","MercuryThreadInfo","MercuryThreadMetadataRawRenderer","MercuryTypingReceiver","MercuryViewer","MessengerHotLikeButton.react","NubController","P2PGKValues","P2PSendMoneyButton.react","P2PTransferStore","PagesMercuryChatTabIndicatorHandler","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","Scroll","SelectionPosition","StickerActions","StickerConfig","StickerConstants","StickersFlyout.react","StickerState","Style","SubscriptionsHandler","SyntheticMouseEvent","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URLScraper","URI","UserAgent_DEPRECATED","WaterfallIDGenerator","WebMessengerDeleteThreadDialog","WebMessengerThreadPermalinks","NFXChatHeadGK","XNFXStartForMessageThreadController","XStickerReplyNUXController","cancelAnimationFrame","copyProperties","createCancelableFunction","csx","cx","emptyFunction","fbt","getActiveElement","isEmpty","requestAnimationFrame","setIntervalAcrossTransitions","ChatReactInput","MercuryMessageActions","MercuryMessages","MercuryMessageObject","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md){b.__markCompiled&&b.__markCompiled();'use strict';var nd=b('ChatReactInput').module,od=b('MercuryMessageActions').get(),pd=b('MercuryMessages').get(),qd=b('MercuryMessageObject').get(),rd=b('MercuryServerRequests').get(),sd=b('MercuryThreadInformer').get(),td=b('MercuryThreadMetadataRenderer').get(),ud=b('MercuryThreadActions').get(),vd=b('MercuryThreads').get(),wd=/^\s*$/,xd=ja,yd=null,zd,ae=10,be=960,ce=hb.getInstance('chat_tab_view');function de(ye,ze){var af=ta.create('div');ze=ze&&ze.filter(function(df){return df!=rb.getID();});if(kd(ze))return rc.remove(ye);var bf=ze.length,cf=bf-ae;if(cf>1)ze=ze.slice(0,ae);kb.getMulti(ze,function(df){for(var ef in df){var ff=df[ef],gf=oc[':fb:mercury:chat:multichat-tooltip-item'].build();ta.setContent(gf.getNode('name'),ff.name);var hf=ib.getUserIDFromParticipantID(ef),jf=hf&&bc.get(hf)==l.ACTIVE;pa.conditionShow(gf.getNode('icon'),jf);pa.conditionClass(gf.getNode('name'),'tooltipItemWithIcon',jf);ta.appendContent(af,gf.getRoot());}if(cf>1){var kf=id._("and {number of hidden chat participants} more.",[id.param("number of hidden chat participants",cf)]);ta.appendContent(af,ta.create('div',{},kf));}rc.set(ye,af,'above');});}var ee={},fe=null,ge=false;function he(ye,ze,af){if(af){ee[ye]=ze;if(!fe)fe=md(ie,600);}else{pa.removeClass(ze,'highlightTitle');delete ee[ye];}}function ie(){for(var ye in ee){var ze=ee[ye];if(ze.parentNode){pa.conditionClass(ze,'highlightTitle',ge);}else delete ee[ye];}ge=!ge;if(!Object.keys(ee).length){clearInterval(fe);fe=null;}}function je(ye){var ze=ib.tokenize(ye);switch(ze.type){case 'user':return oc[':fb:mercury:chat:user-tab'].build();}return oc[':fb:mercury:chat:multichat-tab'].build();}function ke(ye){var ze=ye._getInputValue(),af=ye._fileUploader.getAttachments();if(qe(ye))me(ye,ze,af,function(bf){var cf=ye._fileUploader.getImageFiles();if(cf.length>0){bf.image_ids=cf;bf.has_attachment=true;}var df=ye._fileUploader.getAnimatedImageFiles();if(df.length>0){bf.gif_ids=df;bf.has_attachment=true;}var ef=ye._fileUploader.getVideoFiles();if(ef.length>0){bf.video_ids=ef;bf.has_attachment=true;}var ff=ye._fileUploader.getAudioFiles();if(ff.length>0){bf.audio_ids=ff;bf.has_attachment=true;}var gf=ye._fileUploader.getFiles();if(gf.length>0){bf.file_ids=gf;bf.has_attachment=true;}od.send(bf);ye._fileUploader.removeAttachments();ye._shareLinkUploader&&ye._shareLinkUploader.clear();if(ye._sharePreview)ye._sharePreview.setProps({share:null,uri:null});if(!t.get('chat_react_input'))ye._getNode('input').value='';ye._typingDetector&&ye._typingDetector.resetState();ye._messagesView&&ye._messagesView.setShouldScrollToBottom(true);});}function le(ye,ze){if(ze===0)return;se(ye,zb.POST_PUBLISHED,{count:ze});ye._waterfallID=wc.generate();}function me(ye,ze,af,bf){vd.getThreadMeta(ye._threadID,function(cf){var df=nb.CHAT_WEB;if(ye._shareLinkUploader&&ye._shareLinkUploader.getAttachData()&&ye._shareLinkUploader.loadedFromFeed())df=nb.SAM_UFI;var ef=qd.constructUserGeneratedMessageObject(ze,df,ye._threadID);if(af.length>0){ef.has_attachment=true;ef.raw_attachments=af;}if(ye._shareLinkUploader){var ff=ye._shareLinkUploader.getAttachData();if(ff){ef.has_attachment=true;ef.content_attachment=ff;}}if(ye._sharePreview){var gf=ye._sharePreview.getShareData();if(gf){ef.has_attachment=true;ef.shareable_attachment=gf;}}if(vd.isNewEmptyLocalThread(ye._threadID)){var hf=ye._sheetController.getAddFriendsParticipants();if(hf===null||hf.length===0)return;hf=hf.filter(function(lf){return lf!=rb.getID();});if(hf.length===0){ef.thread_id=ib.getThreadIDFromUserID(oa.getID());}else if(hf.length===1){ef.thread_id=ib.getThreadIDFromParticipantID(hf[0]);}else ud.addParticipants(ye._threadID,hf);}if(vd.isEmptyLocalThread(ye._threadID)){ef.message_id=ib.tokenize(ye._threadID).value;var jf=vd.getThreadMetaNow(cf.thread_id);ef.specific_to_list=Array.from(jf.participants);}if(typeof ef!='undefined')ef.signatureID=ye._signatureID;ef.ui_push_phase=na.UIPushPhase;bf(ef);if(ye._threadID!==ef.thread_id&&!ye._photoUploader.isUploading()){var kf=ye._getInputValue();da.closeTab(ye._threadID);w.openThread(ef.thread_id,'ChatTabView',null,ze?hd:function(lf){return lf.appendTextToInput(kf);});}});}function ne(ye){ye._blocked=true;ye._sheetController.openUploadWarningTabSheet();}function oe(ye){return (ye._fileUploader.isUploading()||ye._photoUploader.isUploading()||(ye._sharePreview&&ye._sharePreview.isLoading()));}function pe(ye){return (ye._fileUploader&&ye._fileUploader.isUploading());}function qe(ye){var ze=ye._getInputValue();if(!wd.test(ze))return true;if(ye._fileUploader.getAttachments().length>0||ye._fileUploader.getImageFiles().length>0||ye._fileUploader.getAnimatedImageFiles().length>0||ye._fileUploader.getVideoFiles().length>0||ye._fileUploader.getAudioFiles().length>0||ye._fileUploader.getFiles().length>0)return true;if(ye._shareLinkUploader&&ye._shareLinkUploader.getAttachData())return true;if(ye._sharePreview&&ye._sharePreview.getShareData())return true;return false;}function re(ye){ye._nubController.flyoutContentChanged();var ze=ye._getNode('attachmentShelf');ec.setTop(ze,ze.scrollHeight);}function se(ye,ze,af){zb.sendSignal(dd({qn:ye._waterfallID,step:ze,uploader:zb.APP_CHAT},af||{}));}function te(ye,ze,af,bf,cf){var df,ef,ff;if(ze)rd.ensureThreadIsFetched(ze);this._threadID=ye;this._signatureID=af;this._eventListeners=[];this._tabTemplate=je(ye);this._tabElem=this._tabTemplate.getRoot();if(cf){this.insertBefore(cf);}else this.appendTo(bf);this._stickersFlyoutShown=false;this._messagesView=null;if(yd===null)yd=!t.get('seen_autosend_photo_nux');this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._pagesMessageIndicator=this._getNode('pagesMessageIndicator');this._waterfallID=wc.generate();this._subscriptionsHandler=new mc();this._initializeSheetController();var gf=[hd,this._initializeHotLike.bind(this),this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeAutoSendPhotoUploader.bind(this),this._initializeTitleHREF.bind(this),this._initializeP2P.bind(this),this._initializeInput.bind(this),this._initializeStickers.bind(this),function(){vd.getThreadMeta(this._threadID,function(kf){this._setUpMutingSettings(kf);}.bind(this));z.removeEmptyHrefs(this._tabElem);}.bind(this),function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}.bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this),this._initializePageMessagingIndicator.bind(this)];if(t.get('chat_defer_initialization',false)){var hf=function(kf){if(!kf.length){delete this._initFrame;return;}var lf=kf.shift();this._initFrame=ld(function(){hf(kf);});lf();}.bind(this);hf(gf);}else{var jf;for(df=gf,ef=Array.isArray(df),ff=0,df=ef?df:df[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(ef){if(ff>=df.length)break;jf=df[ff++];}else{ff=df.next();if(ff.done)break;jf=ff.value;}jf();}}xd.set(ye,this);this._logOpenTab();}function ue(ye){if(ye._photoUploader.isUploading())se(ye,zb.CANCEL_DURING_UPLOAD);}function ve(){var ye,ze,af,bf;for(ye=xd.values(),ze=Array.isArray(ye),af=0,ye=ze?ye:ye[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(ze){if(af>=ye.length)break;bf=ye[af++];}else{af=ye.next();if(af.done)break;bf=af.value;}bf.updateAvailableStatus();bf.updateMultichatTooltip();}}function we(){var ye,ze,af,bf;for(ye=xd.values(),ze=Array.isArray(ye),af=0,ye=ze?ye:ye[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(ze){if(af>=ye.length)break;bf=ye[af++];}else{af=ye.next();if(af.done)break;bf=af.value;}bf.updateCallLink();}}h.subscribe(['buddylist/availability-changed'],ve);ac.subscribe(['privacy-changed','privacy-availability-changed'],ve);ab.addListener(we);r.subscribe(r.ON_CHANGED,function(){var ye,ze,af,bf;for(ye=xd.keys(),ze=Array.isArray(ye),af=0,ye=ze?ye:ye[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(ze){if(af>=ye.length)break;bf=ye[af++];}else{af=ye.next();if(af.done)break;bf=af.value;}vd.getThreadMeta(bf,function(cf){xd.get(bf)._updateUnreadCount(cf);});}});qb.addRetroactiveListener('state-changed',function(ye){for(var ze in ye){var af=ye[ze]&&ye[ze].length,bf=xd.get(ze);bf&&bf.showTypingIndicator(af);}});sd.subscribe('threads-updated',function(ye,ze){var af,bf,cf,df;for(af=xd.keys(),bf=Array.isArray(af),cf=0,af=bf?af:af[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(bf){if(cf>=af.length)break;df=af[cf++];}else{cf=af.next();if(cf.done)break;df=cf.value;}var ef=xd.get(df);ze[df]&&ef.updateTab();if(ef._newThreadIDFromPhotoUpload&&!ef._photoUploader.isUploading()&&ze[ef._newThreadIDFromPhotoUpload]){da.closeTab(ef._threadID);w.openThread(ef._newThreadIDFromPhotoUpload,'ChatTabView');ef._newThreadIDFromPhotoUpload=null;}}});sd.subscribe('threads-deleted',function(ye,ze){var af,bf,cf,df;for(af=xd.keys(),bf=Array.isArray(af),cf=0,af=bf?af:af[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(bf){if(cf>=af.length)break;df=af[cf++];}else{cf=af.next();if(cf.done)break;df=cf.value;}ze[df]&&da.closeTab(df,'thread_deleted');}});dd(te.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(ye){setTimeout((function(){this._sheetController.openNameConversationSheet(ye);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return pa.shown(this._tabElem);},setVisibleState:function(ye,ze){var af=pa.shown(this._tabElem),bf=pa.hasClass(this._tabElem,'opened');pa.conditionShow(this._tabElem,ye);pa.conditionClass(this._tabElem,'opened',ze);if(!(af&&bf)&&ye&&ze){if(!this._messagesView)this._messagesView=new fa(this._threadID,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(af&&bf&&!(ye&&ze))this._contextualDialogController&&this._contextualDialogController.tabNotActive();},focus:function(){if(pa.hasClass(this._tabElem,'opened')){this._focusInput();}else this._getNode('dockButton').focus();},isFocused:function(){var ye=jd();return yb.byClass(ye,"_50mz")===this._tabElem;},hasEmptyInput:function(){var ye;if(t.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return false;ye=this._chatInput.getValue();}else ye=this._getNode('input').value;return wd.test(ye);},getInputElem:function(){if(t.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return null;return cc.findDOMNode(this._chatInput);}else return this._getNode('input');},setStickersFlyoutPackID:function(ye){if(this._stickerButton){this._setPackIDReact(ye);}else this._setPackIDLegacy(ye);},loadShareFromParams:function(ye,ze){this._shareLinkUploader&&this._shareLinkUploader.loadShareFromParams(ye,ze);if(this._sharePreview)this._sharePreview.setProps({share:{params:ze,type:ye},uri:null});},_linkDropped:function(ye){this._shareLinkUploader&&this._shareLinkUploader.loadShare(ye);if(this._sharePreview)this._sharePreview.setProps({share:null,uri:ye});},_filesDropped:function(ye){if(this._fileUploader)this._fileUploader.addDroppedFiles(ye);},_setPackIDLegacy:function(ye){var ze=this._stickersFlyout;if(!this._stickersFlyoutToggler||!ze||!ze.isMounted())return;gc.selectPack(ye);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(ye){if(!this._stickerButton.isMounted())return;gc.selectPack(ye);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(ye){this._stickerButton.showFlyout();this._stickersFlyoutShown=ye;},_toggleStickersFlyoutShownLegacy:function(ye){if(ye){qc.show(this._stickersFlyoutToggler);}else qc.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=ye;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(zd)return;var ye=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new j(bd.getURIBuilder().getURI()).setRelativeTo(ye).setData({thread_id:this._threadID}).setHandler(function(ze){kc.clearShowStickerReplyNUX();}).send();},insertBefore:function(ye){ta.insertBefore(ye._tabElem,this._tabElem);},appendTo:function(ye){ta.appendContent(ye,this._tabElem);},nextTabIs:function(ye){var ze=ye&&ye._tabElem;return this._tabElem.nextSibling==ze;},getScrollTop:function(){return ec.getTop(ta.find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(ye){ec.setTop(ta.find(this._tabElem,'.fbNubFlyoutBody.scrollable'),ye);},_unmountComponentAtNodeSafe:function(ye){var ze=this._getNode(ye);ze&&cc.unmountComponentAtNode(ze);},destroy:function(){this._initFrame&&cd(this._initFrame);this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();cc.unmountComponentAtNode(this._getNode('menuContainer'));if(t.get('chat_react_header')){cc.unmountComponentAtNode(this._getNode('addToThreadContainer'));this._unmountComponentAtNodeSafe('archiveContainer');this._unmountComponentAtNodeSafe('videoCallButtonContainer');cc.unmountComponentAtNode(this._getNode('closeButtonContainer'));cc.unmountComponentAtNode(this._getNode('titleContainer'));}if(t.get('chat_react_share_uploader')&&this._sharePreview&&this._sharePreview.isMounted()){cc.unmountComponentAtNode(cc.findDOMNode(this._sharePreview));}else this._shareLinkUploader&&this._shareLinkUploader.clear();try{cc.unmountComponentAtNode(this._getNode('photoUploaderContainer'));}catch(ye){m.bumpEntityKey('chat.web','chattab.unmount_failed');}if(t.get('chat_react_sticker_button')){cc.unmountComponentAtNode(this._getNode('stickerButtonContainer'));}else cc.unmountComponentAtNode(this._getNode('stickers'));if(hc.WebStickerTrigger)this._stickerTriggerController.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();if(t.get('chat_react_input')){cc.unmountComponentAtNode(this._getNode('inputContainer'));}else eb.reset(this._getNode('input'));if(this._orionTriggerContainer){cc.unmountComponentAtNode(this._orionTriggerContainer);this._orionTriggerContainer=null;this._orionTrigger=null;}this._unsubscribeP2PTransferStore();ta.remove(this._tabElem);xd["delete"](this._threadID);sa.unregisterNubController(this._nubController);},updateAvailableStatus:function(){vd.getThreadMeta(this._threadID,function(ye){var ze=l.OFFLINE,af=this._getCanonicalUserID();if(af){ze=bc.get(af);}else{var bf=ye.participants.map(function(df){return ib.getUserIDFromParticipantID(df);});ze=bc.getGroup(bf);}if(!la.isOnline())ze=l.OFFLINE;this.updateCallLink();pa.conditionClass(this._tabElem,"_5238",ze===l.ACTIVE);pa.conditionClass(this._tabElem,"_5239",ze===l.MOBILE);var cf=this._getNode('presenceIndicator');switch(ze){case l.ACTIVE:cf.setAttribute('alt',id._("Online"));break;case l.MOBILE:cf.setAttribute('alt',id._("Mobile"));break;default:cf.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){vd.getThreadMeta(this._threadID,function(ye){var ze=[this._getNode('name')];if(!t.get('chat_react_header')){ze.push(this._getNode('titlebarText'));}else if(this._title.isMounted())this._title.setProps({thread:ye},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.getTitle());}.bind(this));td.renderAndSeparatedParticipantList(this._threadID,ze,{names_renderer:pb.renderShortNames,check_length:true});this._updateControls(ye);this._updateMutingSettings(ye);this._updateUnreadCount(ye);this.updateMultichatTooltip();this._updateArchiveWarning(ye);this._updateEmployeeAwayWarning(ye);this._updateOfficeStatus(ye);this._updateNewThread(ye);this._updateNameConversationSheet(ye);this._updateReadOnlySheet(ye);this._updateSwitchToWork(ye);}.bind(this));},_updateNameConversationSheet:function(ye){if(ob.canReply(ye)&&!ye.name&&!ye.is_canonical&&!ye.name_conversation_sheet_dismissed&&!ye.has_email_participant&&!ye.read_only&&!vd.isEmptyLocalThread(ye.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(ye){var ze=ob.canReply(ye),af=vd.isEmptyLocalThread(ye.thread_id);if(!ze&&!af)this._sheetController.openReadOnlySheet();},updateSignatureID:function(ye){this._signatureID=ye;},_showPhotoNUXIfNecessary:function(){if(yd){yd=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(ye){var ze=ob.isMuted(ye);if(ze)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(ze);},_updateMutingSettings:function(ye){var ze=ob.isMuted(ye),af=this._reactChatTabMenu.props.isMuted;if(ze&&!af){this._sheetController.openThreadIsMutedTabSheet();}else if(!ze&&af)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(ze);},_updateActionMenu:function(ye){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({isMuted:ye});},_updateArchiveWarning:function(ye){if(oa.isEmployee())kb.getMulti(ye.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateEmployeeAwayWarning:function(ye){v.updateEmployeeAwayWarning(ye,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),function(){});},_updateOfficeStatus:function(ye){var ze=this._getNode('officeStatus');if(!ze||ib.isMultichat(ye.thread_id))return;var af=ib.getParticipantIDFromUserID(ye.canonical_fbid);kb.get(af,function(bf){ga.update(ze,bf);});},_updateSwitchToWork:function(ye){if(oa.isEmployee()&&oa.hasWorkUser()&&ib.isMultichat(ye.thread_id)){kb.getMulti(ye.participants,function(ze){this._showSwitchToWork(this._isEmployeesOnly(ze));}.bind(this));}else this._showSwitchToWork(false);},_updateControls:function(ye,ze){var af=false;if(ye&&ye.thread_id){var bf=ib.tokenize(ye.thread_id);if(bf.type==='user'){var cf=bf.value;af=!bb.isUser(cf);}}var df=ob.canReply(ye)&&(!kd(ye.participants)||!!ze);pa.conditionShow(this._inputContainerNode,df);pa.conditionShow(this._iconsContainerNode,df);if(this._reactChatTabMenu.isMounted()){this._reactChatTabMenu.setProps({isEmptyChat:vd.isNewEmptyLocalThread(ye.thread_id),show:df});if(af)this._reactChatTabMenu.setProps({showAddFriend:null});}var ef=df&&!af;if(t.get('chat_react_header')){this._addToThreadButton.isMounted()&&this._addToThreadButton.setProps({shown:ef});}else pa.conditionShow(this._getNode('addToThreadLink'),ef);this._resizeInputContainer();this._updateOrionTrigger(ef);},_updateOrionTrigger:function(ye){if(ye)if(this._orionTrigger){this._setOrionTriggerProps();}else if(!this._orionTrigger)this._renderOrionTrigger();},_setOrionTriggerProps:function(){this.getParticipantIDsForOrionNUX(function(ye,ze){kb.getMulti(ye,function(af){var bf=[],cf,df=vd.isNewEmptyLocalThread(this._threadID);for(var ef in af){cf=this._getUserIdFromParticipantID(ef);if(cf!==oa.getID())bf.push(db.set(af[ef],{userId:cf}));}this._orionTrigger.setProps({participants:bf,isNewEmptyLocalThread:df,isGroupChat:ib.isMultichat(this._threadID)&&!df,threadID:this._threadID,threadFBID:ze});}.bind(this));}.bind(this));},_getUserIdFromParticipantID:function(ye){return ib.getUserIDFromParticipantID(ye);},_onP2PTransferStoreChange:function(){this._renderOrionTrigger();this._unsubscribeP2PTransferStore();},_unsubscribeP2PTransferStore:function(){if(this._transferStoreSub){this._transferStoreSub.remove();this._transferStoreSub=null;}},_isP2PEnabled:function(){return ub.P2PEnabled;},_renderOrionTrigger:function(){if(ib.isMultichat(this._threadID)&&!ub.P2PGroupSendWWW)return false;var ye=this._isP2PEnabled()||wb.hasTransfers();if(ye){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=cc.render(cc.createElement(vb,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);pa.addClass(this._inputContainerNode,"_11d6");this._setOrionTriggerProps();}},getParticipantIDsForOrionNUX:function(ye){var ze=this._sheetController.getAddFriendsTabSheet(),af=ze.getParticipants(),bf=this._getCanonicalUserID();if(bf){ye([ib.getParticipantIDFromUserID(bf)]);}else if(vd.isNewEmptyLocalThread(this._threadID)&&af){ye(af);}else vd.getThreadMeta(this._threadID,function(cf){ye(cf.participants,cf.thread_fbid);}.bind(this));},_resizeInputContainer:function(){var ye=this._tabElem.clientWidth,ze=2,af=ye-(this._inputContainerNode.clientWidth+ze),bf=gb.isRTL()?'left':'right';lc.set(this._iconsContainerNode,bf,af+'px');if(!t.get('chat_react_input'))pc.getInstance(this._getNode('input')).update();},_updateNewThread:function(ye){if(vd.isNewEmptyLocalThread(ye.thread_id))this.showAddFriend();},_isEmployeesOnly:function(ye){for(var ze in ye)if(!ye[ze].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(ye){var ze=this._isEmployeesOnly(ye),af=t.get('chat_react_header'),bf=af?this._getNode('archiveContainer'):this._getNode('titanArchiveWarning');if(bf){if(this._titlebarTooltipAnchor)pa.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',ze);if(af){this._archiveWarning.isMounted()&&this._archiveWarning.setProps({shown:ze});}else pa.conditionShow(bf,ze);}},_showSwitchToWork:function(ye){if(this._reactChatTabMenu.isMounted())this._reactChatTabMenu.setProps({hasSwitchToWork:ye});},updateMultichatTooltip:function(){vd.getThreadMeta(this._threadID,function(ye){if(!ye.is_canonical){var ze;if(t.get('chat_react_header')){ze=cc.findDOMNode(this._title);}else ze=this._titlebarTooltipAnchor;de(ze,ye.participants);}}.bind(this));},_getNode:function(ye){return this._tabTemplate.getNode(ye);},_getCanonicalUserID:function(){return ib.getUserIDFromThreadID(this._threadID);},_listen:function(ye,event,ze,af){var bf=this._getNode(ye);if(bf){this._eventListeners.push(za.listen(bf,event,ze.bind(this)));}else if(!af)throw new Error('Could not find node "'+ye+'"');},_closePreClicked:function(ye){this._closeMouseDown=true;},_closeClicked:function(ye){ue(this);da.closeTab(this._threadID);if(ye instanceof nc){ye.stopPropagation();return;}ye.kill();},_closeEnter:function(ye){if(ye.keyCode===fb.RETURN)this._closeClicked(ye);},_nubClicked:function(ye){ye.kill();return ia.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===fb.RETURN||event.keyCode===fb.SPACE){ia.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===fb.ESC){this._handleEscape();if(t.get('chat_react_input'))event=new ua(event);event.kill();}else if(event.keyCode===fb.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var ye=ia.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});if(t.get('chat_react_input'))event=new ua(event);!ye&&event.kill();return true;}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}ue(this);if(this.hasEmptyInput()){ia.inform('esc-pressed',this._threadID);}else{var ye=id._("Are you sure you want to close this chat window?"),ze=id._("You haven't sent your message."),af=new ra().setTitle(ye).setBody(ze).setButtons([ra.CLOSE,ra.CANCEL]).setHandler(ia.inform.bind(ia,'esc-pressed',this._threadID,null)).setModal(true).show(),bf=af.getButtonElement('yes');bf&&cb.set(bf);}},_titleClicked:function(event){var ye=event.getTarget();if(!yb.byClass(ye,'titlebarText')&&!yb.byClass(ye,'uiSelector')&&!yb.byClass(ye,'addToThread')&&!yb.byClass(ye,'optionMenu')&&!yb.byClass(ye,'videoicon')&&!yb.byClass(ye,'close')){event.kill();da.lowerTab(this._threadID);this.focus();}},_callEnter:function(ye){if(ye.keyCode===fb.RETURN)this._callClicked(ye);},_callClicked:function(ye){if(ye.target)ye.target.blur();var ze=this._getCanonicalUserID();if(this._videoCallLinkEnabled){var af='chat_tab_icon';if(ye.target&&pa.hasClass(ye.target,'video_call_tour'))af='chat_tab_icon_tour';ia.inform('video-call-clicked',{threadID:this._threadID,userID:ze,clickSource:af});}if(t.get('chat_react_header')){ye.stopPropagation();}else return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){rd.getServerThreadID(this._threadID,function(ye){i.send(new j(new uc('/ajax/browser/dialog/multichat_members/').addQueryData({id:ye})));});},_deleteConversation:function(){xc.show(this._threadID);},_unsubscribeLinkClicked:function(){var ye=[];ye.push({name:'unsubscribe',label:id._("Leave Conversation"),handler:this._unsubscribeToThread.bind(this)});ye.push(ra.CANCEL);new ra().setTitle(id._("Leave Conversation?")).setBody(id._("You will stop receiving messages from this conversation and people will see that you left.")).setButtons(ye).show();},_switchToWorkUserClicked:function(){var ye=[];ye.push({name:'move',label:id._("Move Conversation"),handler:this._switchToWork.bind(this)});ye.push(ra.CANCEL);new ra().setTitle(id._("Move Conversation to Work Account?")).setBody(id._("Do you want to move this conversation so that it shows in your work account instead?")).setButtons(ye).show();},_getUserParticipants:function(ye){var ze=[];ye.forEach(function(af){var bf=ib.getUserIDFromParticipantID(af);bf&&ze.push(bf);});return ze;},_createGroupClicked:function(){vd.getThreadMeta(this._threadID,function(ye){if(!ye.is_canonical){var ze=new uc('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),af=this._getUserParticipants(ye.participants);ze.addQueryData({members:af});if(ye.name)ze.addQueryData({name:ye.name});i.send(new j(ze));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var ye=this._getCanonicalUserID(),ze=new uc('/ajax/chat/report.php').addQueryData({id:ye}).addQueryData({src:'top_report_link'});if(zc.result)ze=ad.getURIBuilder().setString('thread_fbid',ye).setEnum('location','www_chat_head').getURI();i.send(new j(ze));},_inputPasted:function(event){if(vc.chrome()){var ye=event.clipboardData||event.originalEvent.clipboardData;if(!ye||!ye.items||ye.items.length<1)return;var ze=ye.items[0].type;if(ze!=='image/png')return;if(ye.items[0].getAsFile){var af=ye.items[0].getAsFile();this._photoUploader.uploadFile(af);}}},_focusInput:function(){if(t.get('chat_react_input')){this._chatInput&&this._chatInput.isMounted()&&this._chatInput.focus();}else this._getNode('input').focus();},_focusTab:function(){pa.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController&&this._contextualDialogController.tabFocused();if(!zd&&this._showPhotoNUXIfNecessary())h.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){zd=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);ia.inform('focus-tab',this._threadID);},_blurTab:function(){pa.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(ye){if(t.get('chat_react_header')){this._closeButton.isMounted()&&this._closeButton.setProps({active:ye});return;}var ze=this._getNode('titlebarCloseButton'),af=ye?id._("Press Esc to close"):id._("Close tab");rc.set(ze,af,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===fb.RETURN&&!event.shiftKey){if(pe(this)){ne(this);event.kill&&event.kill();return;}ke(this);if(hc.WebStickerTrigger)this._stickerTriggerController.activateAfterparty();event.kill&&event.kill();return;}if(event.keyCode===fb.DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();da.lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_initializeInput:function(){if(!t.get('chat_react_input')){var ye=this._inputContainerNode.clientHeight;pc.getInstance(this._getNode('input')).subscribe('resize',function(){var ze=this._inputContainerNode.clientHeight;if(ze!=ye)this._nubController.flyoutContentChanged();ye=ze;}.bind(this));this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);if(vc.firefox()&&qa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._initializeThingsWithInputFn(this._tabTemplate.getNode('input'));}else this._chatInput=cc.render(cc.createElement(nd,{initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputChanged:function(ze){if(hc.WebStickerTrigger)this._stickerTriggerController.updateInput(ze);}.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onAddMention:this._onAddMention.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:this._toggleStickersFlyoutShownLegacy.bind(this,true),stickersFlyoutToggler:this._stickersFlyoutToggler,searchTriggeredWord:function(){this._toggleStickersFlyoutShownLegacy(true);this._searchStickers(this._stickerTriggerController.getTriggeredWord());}.bind(this),resizeFn:function(ze){lc.set(this._getNode('inputContainer'),'height',ze+'px');this._nubController.flyoutContentChanged();}.bind(this),uploadPhotoFn:function(ze){this._photoUploader&&this._photoUploader.uploadFile(ze);}.bind(this)}),this._getNode('chatInputContainer'));},_initializeSharePreview:function(ye,ze){this._sharePreview=cc.render(cc.createElement(mb,{imageSize:{width:be,height:be},location:lb.CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){re(this);this._unblockSend();}.bind(this)}),this._getNode('shareAttachmentShelf'));za.listen(ye,'keyup',function(){var af=ze?ze():ye.value;!af.length&&this._urlScraper.reset();}.bind(this));this._urlScraper=new tc(ye,ze);this._urlScraper.subscribe('match',function(af,bf){this._sharePreview.setProps({share:null,uri:(bf&&bf.url)});}.bind(this));},_initializeThingsWithInputFn:function(ye,ze){if(t.get('chat_react_share_uploader')){this._initializeSharePreview(ye,ze);}else{this._shareLinkUploader=new aa(this._getNode('shareAttachmentShelf'),ye,this.focus.bind(this),ze,this.appendTextToInput.bind(this));this._initializeUploader(this._shareLinkUploader);}vd.getThreadMeta(this._threadID,function(af){rd.getServerThreadID(this._threadID,function(bf){this._typingDetector=new sc(this._getCanonicalUserID(),ye,'mercury-chat',null,bf,ze);}.bind(this));}.bind(this));},_getInputValue:function(){if(t.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return '';return this._chatInput.getValue()||'';}else return this._tabTemplate.getNode('input').value||'';},appendTextToInput:function(ye){if(t.get('chat_react_input')){if(this._chatInput&&this._chatInput.isMounted())this._chatInput.appendText(ye);}else this._getNode('input').value+=ye;},_hasUnfinishedPost:function(){return qe(this)||oe(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){ud.markRead(this._threadID);ud.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(ye){this.tryMarkAsRead();if(yb.byTag(ye.getTarget(),'a')||ta.getSelection())return;this.focus();},_inputContainerClicked:function(ye){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function(){if(!this._pagesMessageIndicator)return;pa.hide(this._pagesMessageIndicator);this._pagesMessageIndicatorHandler=new xb(this._threadID,function(ye){ta.setContent(this._pagesMessageIndicator,ye);pa.show(this._pagesMessageIndicator);}.bind(this));this._pagesMessageIndicatorHandler.checkResponsiveness();},showTypingIndicator:function(ye){if(t.get('chat_closed_tab_typing_indicator_animated')){var ze=ta.find(this._tabElem,"._54m9");if(ye){this._animatedTypingIndicator=cc.render(cc.createElement(o,{bootloadPlaceholder:cc.createElement("span",null),bootloadComponent:function(af){n.loadModules(["MercuryTypingAnimation.react"],af);}}),ze);this._updateAnimatedIndicatorColor();pa.addClass(this._tabElem,"_54m8");pa.show(ze);}else{pa.removeClass(this._tabElem,"_54m8");pa.hide(ze);cc.unmountComponentAtNode(ze);this._animatedTypingIndicator=null;}}else pa.conditionClass(this._tabElem,'typing',ye);},_updateAnimatedIndicatorColor:function(){if(this._animatedTypingIndicator){var ye=pa.hasClass(this._tabElem,'highlightTab')?'light':'dark';this._animatedTypingIndicator.setProps({color:ye});}},_updateUnreadCount:function(ye){var ze=ye.unread_count;if(typeof ze!='undefined'){var af=!!ze&&(!r.showsTabUnreadUI||r.showsTabUnreadUI()),bf=this._getNode('numMessages');pa.conditionShow(bf,af);pa.conditionClass(this._tabElem,'highlightTab',af);this._updateAnimatedIndicatorColor();he(this._threadID,this._tabElem,af);ta.setContent(bf,ze);}},updateCallLink:function(){var ye=this._getCanonicalUserID();if(!ye||ye===oa.getID()||!bb.isUser(ye)){this._hideVideoCallouts();if(t.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({shown:false});}else{var ze=this._getNode('videoCallLink');if(ze)pa.hide(ze);}this._videoCallLinkEnabled=false;return;}this._videoCallLinkEnabled=ab.isCallable(ye);pa.conditionClass(this._tabElem,"_4hwz",this._videoCallLinkEnabled);if(!this._videoCallLinkEnabled)this._hideVideoCallouts();kb.get(ib.getParticipantIDFromUserID(ye),function(af){var bf=ab.callButtonTooltip(ye,af.short_name);this._setVideoCallTooltip(bf);}.bind(this));},_setVideoCallTooltip:function(ye){if(t.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({tooltipLabel:ye});}else rc.set(this._getNode('videoCallLink'),ye);},_hideVideoCallouts:function(){if(this._contextualDialogController)this._contextualDialogController.hideVideoCallouts();},_setPrivacyLinkText:function(ye){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:ye});},_updatePrivacyLink:function(ye){var ze;if(ye==y.OFFLINE){ze=id._("Go online");this._setPrivacyLinkText(ze);return;}var af=this._getCanonicalUserID();if(!af)return;var bf='fbid:'+af;kb.get(bf,function(cf){if(!cf.is_friend){ze=null;}else if(ye==y.BLOCKED){ze=id._("Turn On Chat for {name}",[id.param("name",cf.short_name)]);}else ze=id._("Turn Off Chat for {name}",[id.param("name",cf.short_name)]);this._setPrivacyLinkText(ze);}.bind(this));},_unsubscribeToThread:function(){if(!vd.isEmptyLocalThread(this._threadID)){var ye=qd.constructLogMessageObject(nb.CHAT_WEB,this._threadID,jb.UNSUBSCRIBE,{removed_participants:[rb.getID()]});od.send(ye);}da.closeTab(this._threadID,'unsubscribed');return true;},_switchToWork:function(){if(!vd.isEmptyLocalThread(this._threadID)){var ye=qd.constructLogMessageObject(nb.CHAT_WEB,this._threadID,jb.SWITCH_TO_WORK,{removed_participants:[rb.getID()]});od.send(ye);}da.closeTab(this._threadID,'unsubscribed');return true;},_initializeSheetController:function(){this._sheetController=new ha(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){ud.unmute(this._threadID);this.focus();}.bind(this));this._sheetController.onTokensChanged(function(ye,ze){vd.getThreadMeta(this._threadID,function(af){this._updateControls(af,ze.token_count);}.bind(this));}.bind(this));this._nubController=new tb().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));},_initializeUploader:function(ye){this._subscriptionsHandler.addSubscriptions(ye.subscribe(['all-uploads-completed','upload-canceled'],function(){return this._unblockSend();}.bind(this)),ye.subscribe('dom-updated',function(){re(this);}.bind(this)),ye.subscribe('submit',function(){this._focusInput();}.bind(this)));},_initializeHeader:function(){this._initializeReactMenu(this._getNode('fileAttachmentShelf'));this._initializeArchiveWarning();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeCloseButton();this._initializeTitle();},_initializeReactMenu:function(ye){var ze=this._getNode('menuContainer'),af=ib.isMultichat(this._threadID),bf=vd.isNewEmptyLocalThread(this._threadID),cf=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(ze)this._reactChatTabMenu=cc.render(cc.createElement(ea,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),deleteConversationFunc:this._deleteConversation.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),switchToWorkFunc:this._switchToWorkUserClicked.bind(this),isMultichat:af,isEmptyChat:bf,showAddFriend:cf,threadID:this._threadID,attachmentsShelf:ye,onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:re.bind(this,this),onSubmit:this._focusInput.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),ze);},_initializeArchiveWarning:function(){if(t.get('chat_react_header'))this._archiveWarning=cc.render(cc.createElement(q,{isFBAtWork:t.IsWorkUser,shown:true}),this._getNode('archiveContainer'));},_initializeAddToThreadButton:function(){if(t.get('chat_react_header')){this._addToThreadButton=cc.render(cc.createElement(p,{isFBAtWork:t.get('IsWorkUser',false),onClick:this._addFriendLinkClicked.bind(this),shown:true}),this._getNode('addToThreadContainer'));}else this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);},_initializeVideoCallButton:function(){if(!ib.getUserIDFromThreadID(this._threadID))return;var ye=null;if(t.get('chat_react_header')){this._videoCallButton=cc.render(cc.createElement(ma,{shown:true,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)}),this._getNode('videoCallButtonContainer'));ye=cc.findDOMNode(this._videoCallButton);}else{ye=this._getNode('videoCallLink');this._listen('videoCallLink','click',this._callClicked,true);this._listen('videoCallLink','keyup',this._callEnter,true);}this._contextualDialogController=new u(this._threadID,ye);},_initializeCloseButton:function(){if(t.get('chat_react_header')){this._closeButton=cc.render(cc.createElement(s,{onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)}),this._getNode('closeButtonContainer'));}else{this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);}},_initializeTitle:function(){if(t.get('chat_react_header')){var ye=vd.getThreadMetaNow(this._threadID);this._title=cc.render(cc.createElement(ka,{isNewThread:vd.isNewEmptyLocalThread(this._threadID),thread:ye,viewer:oa.getID()}),this._getNode('titleContainer'));}},_initializeTitleHREF:function(){yc.getThreadURI(this._threadID,function(ze){return this._setTitleHref(ze);}.bind(this));if(!ib.getUserIDFromThreadID(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ye=this._getCanonicalUserID();if(this._getCanonicalUserID()){kb.get(ib.getParticipantIDFromUserID(ye),function(ze){if(ze.href)this._setTitleHref(ze.href);}.bind(this));}else if(this._reactChatTabMenu.getURL())this._setTitleHref(this._reactChatTabMenu.getURL());},_initializeUIListeners:function(){if(this._pagesMessageIndicator)this._listen('scrollingArea','scroll',function(event){var ye=event.target;if(ye.scrollHeight-ye.offsetHeight!==ye.scrollTop)new g(this._pagesMessageIndicator).to('height',0).duration(100).hide().go();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===fb.TAB){this._focusInput();event.kill();}}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFileUploader:function(ye){this._fileUploader=ye;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=cc.render(cc.createElement(x,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_initializeStickers:function(){this._stickersFlyoutToggler=this._getNode('emoticons');if(t.get('chat_react_input')&&hc.WebStickerTrigger){this._stickerTriggerController=new ca(this._getNode('stickersTriggerFlyoutContainer'),this._getNode('emoticonIndicator'),this._stickersFlyoutToggler,this._stickerSelected.bind(this),this._searchStickers.bind(this));if(this._chatInput)this._stickerTriggerController.setInput(this._chatInput);}if(kc.shouldShowStickerSearchNUX())this._listen('emoticons','click',function(){if(kc.shouldShowStickerSearchNUX()){gc.selectPack(ic.SEARCH_PACK_ID);kc.clearShowStickerSearchNUX();}},true);if(t.get('chat_react_sticker_button')){this._stickerButton=cc.render(cc.createElement(ba,{className:"_4vui",flyoutAlignment:"left",onFlyoutShown:this._onFlyoutShown.bind(this),onFlyoutHidden:this._onFlyoutHidden.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));m.bumpEntityKey('chat.web','sticker_button.mounting_attempted');}else{var ye=this._getNode('stickers');if(ye)this._stickersFlyout=cc.render(cc.createElement(jc,{onStickerSelect:function(ze){this._stickerSelected(ze);}.bind(this),onShown:this._onFlyoutShown.bind(this),onHidden:this._onFlyoutHidden.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),ye);this._eventListeners.push(kc.addListener(kc.PACK_SELECTED,function(ze){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:ze});}.bind(this)));}},_initializeDragDropTarget:function(){var ye=va.scry(this._tabElem,"._1ia");if(ye&&ye.length>0){this._dropTarget=new wa(ye[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}},_initializeP2P:function(){if(!this._isP2PEnabled()){this._transferStoreSub=wb.addListener('change',this._onP2PTransferStoreChange.bind(this));}else this._renderOrionTrigger();},_initializeHotLike:function(){if(this._getNode('hotLikeContainer')){cc.render(cc.createElement(sb,{className:"_3s0d",onClick:this._stickerSelected.bind(this),threadID:this._threadID}),this._getNode('hotLikeContainer'));pa.addClass(this._inputContainerNode,"_n4k");}},_initializeUnloadListeners:function(){this._checkUnsentMessages=ed(function(){if(this._hasUnfinishedPost())return id._("You haven't sent your message yet. Do you want to leave without sending?");if(pd.getNumberLocalMessages(this._threadID))return id._("Your message is still being sent. Are you sure you want to leave?");return null;}.bind(this));dc.onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=ed(ue.bind(null,this));dc.onUnload(this._logUnsentPhotos);},_handlePUSubmit:function(ye,ze){se(this,zb.UPLOAD_START,ze);me(this,'',[],function(af){if(this._threadID!==af.thread_id){this._newThreadIDFromPhotoUpload=af.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(af.thread_id);}af.content_attachment=null;od.addAttachmentPlaceholder(af,ze.upload_id,ze);}.bind(this));xe('submit',ze);this._focusInput();},_handlePULastUploadFailed:function(ye,ze){se(this,zb.CLIENT_ERROR,ze);xe('failed',ze);od.cancelAttachmentPlaceholder(ze.upload_id,ze);var af=id._("Photo Upload Failed"),bf=id._("Please try again. Make sure you are uploading a valid photo.");new ra().setTitle(af).setBody(bf).setButtons(ra.OK).show();},_handlePULastUploadCanceled:function(ye,ze){se(this,zb.CANCEL_DURING_UPLOAD,ze);xe('canceled',ze);od.cancelAttachmentPlaceholder(ze.upload_id,ze);},_handlePUAllUploadsCompleted:function(ye,ze){se(this,zb.ALL_UPLOADS_DONE,ze);xe('completed',ze);od.confirmAttachmentPlaceholder(ze.upload_id,ze);var af=ze.image_ids.length||ze.attachments.length;le(this,af);},_stickerSelected:function(ye){me(this,'',[],function(ze){ze.has_attachment=true;ze.sticker_id=ye;od.send(ze);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(ye){var ze=xa.symbols[ye];if(!ze)return;if(t.get('chat_react_input')){this._chatInput.insertEmoticon(ze);return;}this._selectionPosition=this._selectionPosition||new fc(this._getNode('input'));var af=pc.getInstance(this._getNode('input')),bf=af.getValue(),cf=ya.insertEmoticon(ze,bf,this._selectionPosition.getPos());af.setValue(cf.result);this._selectionPosition.setPos(cf.start,cf.end);},_orionTriggered:function(){me(this,'',[],function(ye){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){pa.addClass(this._getNode('emoticonIndicator'),'nux');zd=false;},_onFlyoutShown:function(ye){if(t.get('chat_react_sticker_button')){var ze=this._stickersFlyout.props.packID;if(ze!==ic.SEARCH_PACK_ID)this.focus();}if(hc.WebStickerTrigger){this._stickerTriggerController.onFlyoutShown(ye);}else ye();this._stickersFlyoutShown=true;},_searchStickers:function(ye,ze){this._stickersFlyout.isMounted()&&this._stickersFlyout.setProps({packID:ic.SEARCH_PACK_ID,trigger:ye},ze);},_onFlyoutHidden:function(){this._stickersFlyoutShown=false;this.focus();},_setTitleHref:function(ye){if(t.get('chat_react_header')){this._title.isMounted()&&this._title.setProps({href:ye});}else{var ze=this._getNode('titlebarText');ze.setAttribute('href',ye);ze.removeAttribute('rel');pa.removeClass(ze,'noLink');}},_onAddMention:function(ye){this._linkDropped((new uc(ye.getURI())).getQualifiedURI().toString());},_unblockSend:function(){if(!this._blocked||pe(this))return;this._blocked=false;ke(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new k('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();}});function xe(ye,ze){ce.debug('photo_uploader:'+ye,Object.assign({},ze));}e.exports=te;},null);
__d("ChatTabViewCoordinator",["Arbiter","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l.create('chat_tab_coordinator');function o(p,q){var r=new j(p),s={},t=false;function u(){var y=h.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});n.log('process_tab_changed',{model_tabs:Object.keys(z),view_tabs:Object.keys(s)});for(var aa in s)if(!z[aa]){n.log('remove_tab',{tab_id:aa});s[aa].destroy();delete(s[aa]);}v(y);w(y);if(y.tabNeedsFocus&&!y.tabNeedsFocus.isFocused())y.tabNeedsFocus.focus();}function v(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!s[ba]){n.log('add_tab',{tab_id:ba});s[ba]=new i(ba,aa.server_id,aa.signatureID,p,z);ca=true;}else s[ba].updateSignatureID(aa.signatureID);if(s[ba].isFocused())y.tabNeedsFocus=s[ba];if(!ca&&!s[ba].nextTabIs(z)){var da=s[ba].getScrollTop();if(z){s[ba].insertBefore(z);}else s[ba].appendTo(p);if(da)s[ba].setScrollTop(da);}z=s[ba];});}function w(y){var z=q.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){s[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){s[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});r.setTabData(aa);x(ba);}function x(y){if(!y&&t){g.inform('layer_hidden',{type:'ChatTab'});t=false;}else if(y&&!t){g.inform('layer_shown',{type:'ChatTab'});t=true;}}if(m.isVideoCallSupported())k.addClass(p,'videoCallEnabled');q.subscribe('tabs-changed',u);u();}e.exports=o;},null);
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=175,v=269,w=0;function x(){return u;}function y(){return v;}function z(aa){this._root=aa;var ba=this._recalculateWidth.bind(this);m.listen(window,'resize',ba);j.subscribe('resize',ba);g.subscribeOnce('sidebar/initialized',ba,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(z.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var aa=z._getAvailableDockWidth(this._root),ba=Math.max(1,Math.floor(aa/y())),ca=ba!=this._maxShown;if(!this._viewState||ca||aa<=this._viewState.usedWidth||aa>this._viewState.widthToShowNext){this._availableWidth=aa;this._maxShown=ba;this._viewState=null;this._recalculateTabs(ca);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(aa){var ba=z._getTabsToShow(i.get(),this._availableWidth);if(aa||!q(this._viewState,ba)){this._viewState=ba;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>y();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var aa=i.get(),ba=this._viewState.tabsToShow;return aa.tabs.filter(function(ca){return ba[ca.id];});},getRightmostHiddenTab:function(){var aa=i.get(),ba=this._viewState.tabsToShow,ca=aa.tabs.filter(function(ea){return !ba[ea.id];}),da=ca.shift();return da?da.id:null;},getLeftmostVisibleTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.pop();return ba?ba.id:null;},getRaisedVisibleTabs:function(){var aa=[],ba=this.getShowingTabsOrder(),ca=ba.length;for(var da=0;da<ca;da++)if(i.getTab(ba[da].id).raised)aa.push(ba[da].id);return aa;},shouldPromoteOnRaise:function(aa){if(!this._viewState.tabsToShow[aa])return true;if(this._viewState.nextToHide!=aa)return false;var ba=i.getTab(aa),ca=ba&&ba.raised;return !ca&&(this._availableWidth-this._viewState.usedWidth<y()-x());}});r(z,{_getAvailableDockWidth:function(aa){var ba=l.getViewportWithoutScrollbarDimensions().width;ba-=p.getLeft()+p.getRight();ba-=50;var ca=n.byClass(aa,'fbDock'),da=k.find(ca,"._56ox"),ea=o.getElementDimensions(da).x;ba-=ea;var fa=k.scry(ca,"._56oy");ea+=o.getElementDimensions(fa.pop()).x;var ga=o.getElementDimensions(ca),ha=ga.x-ea;if(ha>w)w=ha;ba-=w;ba-=15;return Math.max(ba,0);},_getTabsToShow:function(aa,ba){ba=Math.max(ba,y()+1);function ca(sa,ta){return (sa.raised||!ta)?y():x();}var da=JSON.parse(JSON.stringify(aa.tabs)),ea=-1,fa=null;if(aa.promoted)da.forEach(function(sa,ta){if(sa.id===aa.promoted){ea=ta;fa=sa;}});var ga=0,ha=false,ia=0,ja=!fa;da.forEach(function(sa,ta){var ua=ca(sa,ha);ha=ha||!sa.raised;sa.leftmostOffset=ga+ua;ga+=ua;if(sa.leftmostOffset<ba)ia++;ja|=ta==ea;sa.alreadyPlacedPromoted=ja;});function ka(sa,ta,ua){var va={};for(var wa=0;wa<ta;wa++){var xa=sa[wa];if(!xa.alreadyPlacedPromoted&&wa==ta-1){va[ua]=true;}else va[xa.id]=true;}return va;}var la=ka(da,ia,aa.promoted),ma=ka(da,ia-1,aa.promoted),na=null;for(var oa in la)if(!ma[oa])na=oa;var pa=da[ia-1],qa=pa?pa.leftmostOffset:0,ra=Infinity;if(ia<da.length)ra=da[ia].leftmostOffset;return {nextToHide:na,tabsToShow:la,usedWidth:qa,widthToShowNext:ra};}});e.exports=z;},null);
__d("MNCommerceDialogContainer.react",["MNCommerceDialogStateStore","PureStoreBasedStateMixin","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i.createClass({displayName:"MNCommerceDialogContainer",mixins:[h(g)],statics:{calculateState:function(){var k=g.getDialogContainer();return {dialogContainer:k};}},render:function(){var k=this.state.dialogContainer;if(!k)return null;return i.createElement(k,null);}});e.exports=j;},null);
__d("ChatApp",["CSS","ChatPerfInstrumentation","DOM","JSLogger","Promise","React","csx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n={init:function(q,r,s){if(this._isInitialized){j.create('chat_app').error('repeated_init');return;}this._rootElem=q;k.resolve().then(function(){return h.init();}).then(function(){return o(s);}).then(function(){return p(r,q);}).then(function(){this._isInitialized=this._isLoaded=true;h.logTTI();}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(q){q.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(q){q.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');q.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function o(q){return new k(function(r){d(['MercuryChannelHandler','MercuryDeliveryState','MercuryServerRequests','MercuryStateCheck'],function(s,t,u,v){s.get().turnOn();u.get().handleUpdate(q);t.get();v.get();r();});});}function p(q,r){return new k(function(s){d(['ChatTabController','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react'],function(t,u,v,w){n.tabsViewport=new v(q);n.tabViewCoordinator=new u(q,n.tabsViewport);n.tabController=new t(n.tabsViewport);var x=i.find(r,"._1kh-");l.render(l.createElement(w,null),x);s();});});}e.exports=n;},null);