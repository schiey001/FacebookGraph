/*!CK:170219300!*//*1430431057,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["BI\/FU"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ACTION_EDUCATE:"educate",ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};},null);
__d("MessagesViewerSetID",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("MNCommerceErrors",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ALREADY_UNLINKED:1893001};},null);
__d("MNCommerceReplyTypes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={COMMERCE_LINK:2};},null);
__d("P2PPaymentLogMessageSubtype",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SENT_IN_GROUP:"sent_in_group",CANCELED_SENDER_RISK:"canceled_sender_risk",CANCELED_DECLINED:"canceled_declined",CANCELED_RECIPIENT_RISK:"canceled_recipient_risk",CANCELED_EXPIRED:"canceled_expired",CANCELED_SAME_CARD:"canceled_same_card",CANCELED_CUSTOMER_SERVICE:"canceled_customer_service"};},null);
__d("StickerAssetType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={IMAGE:"BestEffortImage",SPRITE:"SpriteImage",PADDED_SPRITE:"PaddedSpriteImage"};},null);
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;},null);
__d("Chat",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(k,l){g.subscribe(h[k],function(event,m){l(m);});}var j={openBuddyList:function(){i('buddyListNub',function(k){k.show();i('sidebar',function(l){l.enable();});});},closeBuddyList:function(){i('buddyListNub',function(k){k.hide();});},toggleSidebar:function(){i('sidebar',function(k){k.toggle();});}};e.exports=j;},null);
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("ChatQuietLinks",["Event","DOM","UserAgent_DEPRECATED","DataStore","Parent"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","SearchableEntry","ShortProfiles","WorkModeConfig","createArrayFromMixed","isValidUniqueID","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=[],o=[],p={},q=[],r={},s=[],t={contains:function(u){return u in p;},getList:function(){if(k.is_work_user)return l(n);t.reRank();var u=l(n);u=u.filter(function(v){var w=j.getNowUnsafe(v);return !w||w.type=="friend";});return u;},getSearchableEntries:function(u,v){var w=t.getList();j.getMulti(w.slice(0,u),function(x){var y=[];for(var z in x)y.push(t.normalizeProfileEntry(x[z]));var aa=t.getGroups().map(t.normalizeThreadEntry);v(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});},normalizeProfileEntry:function(u){var v=u.searchTokens||[];return new i({uniqueID:u.id,keywordString:v.join(' '),order:t.getRank(u.id),photo:u.thumbSrc,title:u.name,type:u.type,uri:u.uri,auxiliaryData:{isMessengerUser:u.is_messenger_user}});},normalizeThreadEntry:function(u,v){var w=u.mercury_thread,x=u.participants_to_render,y=u.text,z=null;if(!y)y=w.name;var aa=x.map(function(ca){return ca.name;}).join(', ');if(!y){y=aa;}else z=aa;var ba=u.uid;if(!y||!m(ba))return null;return new i({uniqueID:ba,order:v,photo:w.image_src,title:y,subtitle:z,type:'thread',auxiliaryData:{participantsToRender:x,thread:w}});},getRank:function(u){return u in p?p[u]:n.length;},getActiveList:function(){if(q.length>0)return q;return t.getList();},getActiveRank:function(u){return u in r?r[u]:t.getRank(u);},reRank:function(){n=[];var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(h.get(w)==x){n[u]=w;p[w]=u++;}});},rankActive:function(){var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(x==g.ACTIVE){q[u]=w;r[w]=u++;}});},getGroups:function(){return o;}};(function(){var u=b('InitialChatFriendsList');n=u.list.length?u.list:[];o=u.groups||[];if(!k.is_work_user){s=n.slice();t.rankActive();t.reRank();}else n.forEach(function(v,w){p[v]=w;});})();e.exports=a.OrderedFriendsList||t;},null);
__d("ChatSortUsers",["AvailableListConstants","OrderedFriendsList","PresencePrivacy","PresenceStatus","ShortProfiles","TokenizeUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(q,r){var s=i.allows(q),t=i.allows(r);if(s!==t)return s?-1:1;return 0;}var n={};function o(q){if(n[q])return n[q];var r=(k.getNowUnsafe(q)||{}).name;if(r)return n[q]=l.flatten(r);return '~';}var p={sortAlphabetical:function(q,r){var s=o(q),t=o(r);if(s!==t)return s<t?-1:1;return 0;},sortMobile:function(q,r){var s=j.get(q)===g.MOBILE,t=j.get(r)===g.MOBILE;if(s!==t)return t?-1:1;return p.sortAlphabetical(q,r);},sortCoefficient:function(q,r){var s=h.getRank(q),t=h.getRank(r);if(s!==t)return s-t;return p.sortAlphabetical(q,r);},sort:function(q,r){var s=m(q,r);if(s!==0)return s;return p.sortCoefficient(q,r);}};e.exports=p;},null);
__d("TypingDetector",["ArbiterMixin","Event","Input","Run","TypingStates","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(p,q){this._input=p;this._ignoreKeys={};this._getValueFn=q;}l(o.prototype,g,{_timeout:7000,_currentState:k.INACTIVE,init:function(){this.init=n;this.reset();this._subscription=h.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=k.INACTIVE;},setIgnoreKeys:function(p){this._ignoreKeys=m(p);},destroy:function(){this._subscription.remove();},_onunload:function(){if(this._currentState==k.TYPING)this._transition(k.QUITTING);},_update:function(event){var p=h.getKeyCode(event),q=this._currentState;if(!this._ignoreKeys[p]){var r=this._getValueFn?this._getValueFn():i.getValue(this._input);if(r.trim().length===0){if(q==k.TYPING)this._transition(k.INACTIVE);}else if(q==k.TYPING){this._recordKeystroke();}else if(q==k.INACTIVE){this._transition(k.TYPING);this._recordKeystroke();}}},_transition:function(p){this.reset();this._currentState=p;this.inform('change',p);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var p=this._lastKeystrokeTime+this._timeout,q=Date.now();if(q>p){this._transition(k.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),p-q+10);}}});e.exports=o;},null);
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","TypingDetector","TypingStates","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v,w,x,y){"use strict";this.userID=t;this.input=u;this.source=v;this.threadID=x;this.remoteState=n.INACTIVE;this.notifyTimer=null;w=w||{};this.notifyDelay=w.notifyDelay||this.notifyDelay;this._typingDetector=new m(u,y);this._typingDetector.init(w);this._typingDetector.subscribe('change',this._stateChange.bind(this));}s.prototype.setUserAndThread=function(t,u){"use strict";if(this.userID!==t||this.threadID!==u){this.resetState();this.userID=t;this.threadID=u;}};s.prototype.setIgnoreEnter=function(t){"use strict";var u=t?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(u);};s.prototype.resetState=function(){"use strict";this._notifyState(n.INACTIVE);this.remoteState=n.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};s.prototype.destroy=function(){"use strict";this.resetState();this._typingDetector.destroy();};s.prototype._stateChange=function(t,u){"use strict";if(u!=n.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=q(r(this._notifyState,this,u),this.notifyDelay);}else this._notifyState(u,true);};s.prototype._notifyState=function(t,u){"use strict";if((!this.userID&&!this.threadID)||!k.isOnline()||t===this.remoteState||j.disconnected())return;this._sendRequest(t,this.userID,u);};s.prototype._sendRequest=function(t,u,v){"use strict";this.remoteState=t;var w={typ:t,to:u,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,u)).setErrorHandler(p).setData(w).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!v).send();};s.prototype._onTypResponse=function(t,u){"use strict";var v=u.getPayload()||{};if(v.offline)h.set(t,i.OFFLINE,'typing_response');};o(s.prototype,{notifyDelay:1000});e.exports=s;},null);
__d("ChatDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatTabActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),j={Types:i,closeTab:function(k,l){g.dispatch({actionType:i.CLOSE_TAB,reason:l,threadID:k});},closeAllTabs:function(){g.dispatch({actionType:i.CLOSE_ALL_TABS});},closeFragileTabs:function(){g.dispatch({actionType:i.CLOSE_FRAGILE_TABS});},lowerTab:function(k){g.dispatch({actionType:i.LOWER_TAB,threadID:k});},persistLocalState:function(){g.dispatch({actionType:i.PERSIST_LOCAL_STATE});},promoteTab:function(k){g.dispatch({actionType:i.PROMOTE_TAB,threadID:k});},raiseTab:function(k,l,m){g.dispatch({actionType:i.RAISE_TAB,signatureID:m,threadID:k,userAction:l});}};e.exports=j;},null);
__d("ChatSidebarComposeLink.react",["ChatOpenTab","React","TooltipLink.react","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h,m=l.PropTypes,n=h.createClass({displayName:"ChatSidebarComposeLink",propTypes:{className:m.string.isRequired},componentDidMount:function(){g.listenOpenEmptyTab(h.findDOMNode(this),'sidebar');},render:function(){var o=k._("New Message");return (h.createElement(i,{ajaxify:new j('/ajax/messaging/composer.php'),className:this.props.className,tooltip:o,rel:"dialog"}));}});e.exports=n;},null);
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};Object.assign(g,{getImageSize:function(h){if(h===false)return g.IMAGE_SIZE;return g.LITESTAND_CLASSIC_SIZE;},getItemHeight:function(h){if(h===false)return g.IMAGE_SIZE+4;return g.LITESTAND_CLASSIC_SIZE+4;}});e.exports=g;},null);
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryConstants').ChatNotificationConstants,l=false,m=h.getWebChatNotification(),n=l,o=true,p=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=h.getWebChatNotification();m=s;if(r!=s)q();});g.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});g.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});e.exports=p;},null);
__d("ChatSidebarSheet",["ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","copyProperties","fbt","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=q.create('sidebar_sheet');function x(da){switch(da){case j.HINT_AUTH:return t._("Your session has timed out. Please log in.");case j.HINT_CONN:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);case j.HINT_MAINT:return t._("Facebook {Chat} is currently down for maintenance.",[t.param("Chat",t._("Chat"))]);default:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);}}function y(da){var ea;if(da===null||false===navigator.onLine){ea=t._("Unable to connect to chat. Check your Internet connection.");}else if(da>l.get('warning_countdown_threshold_msec')){var fa=o.create('a',{href:'#',className:'fbChatReconnectLink'},t._("Try again"));ea=t._("Unable to connect to chat. {try-again-link}",[t.param("try-again-link",fa)]);}else if(da>1000){ea=t._("Unable to connect to chat. Reconnecting in {seconds}...",[t.param("seconds",Math.floor(da/1000))]);}else ea=t._("Unable to connect to chat. Reconnecting...");return ea;}var z=u(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da){"use strict";this._root=da;this._message=o.find(da,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}ca.prototype._handleConnectionChange=function(da,ea){"use strict";this._channelStatus=da;this._channelData=ea;this._render();};ca.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,x(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var da=this._channelData;o.setContent(this._message,y(da));if(da>1000){if(da>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=v(this._handleConnectionChange.bind(this,i.RECONNECTING,da-1000),1000);}}};ca.prototype._renderOffline=function(){"use strict";var da='fbChatGoOnlineLink',ea=t._("Turn on chat"),fa=o.create('a',{href:'#',className:da},ea),ga=t._("{=Go online} to see who's available.",[t.param("=Go online",fa)]);o.setContent(this._message,ga);this._goOnlineEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),da)){w.log('sidebar_go_online');m.goOnline();return false;}});};ca.prototype._renderBlackbirdUpsell=function(){"use strict";o.setContent(this._message,h.getOfflineContent());};ca.prototype._renderBlackbird=function(da){"use strict";o.setContent(this._message,h.getBlackbirdContent(da));};ca.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};ca.prototype._render=function(){"use strict";this._clear();if(h.shouldShow()){if(m.hasBlackbirdEnabled()){var da=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,da);this._renderBlackbird(r.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');var ea=t._("Alerts are off while you use another client to chat.");o.setContent(this._message,ea);}this.inform('updated');};s(ca.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=ca;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","BanzaiODS","Bootloader","ChatConfig","ChatImpressionLogger","ChatOptions","ChatSidebarComposeLink.react","ChatSidebarConstants","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","JSLogger","KeyEventController","LitestandClassicPlaceHolders","MercuryConfig","OrderedFriendsList","Parent","PresencePrivacy","React","ScrollableArea","SidebarFitWindowHeight","Style","ViewportBounds","copyProperties","createArrayFromMixed","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){b.__markCompiled&&b.__markCompiled();var oa='chat_sidebar_visibility',pa,qa=null,ra,sa=false,ta=false,ua=false,va=false,wa=false,xa=false,ya,za,ab=false,bb,cb,db,eb,fb,gb,hb,ib=null,jb,kb=v.create('chat_sidebar');j.setEntitySample(oa,.01);function lb(){r.removeClass(document.documentElement,'sidebarMode');if(!wa||(!wb.isVisible()&&!va)){g.inform('reflow');return;}ua=false;va=false;ib=null;eb.hide();gb.getCore().reset();r.hide(cb);if(ab){r.hide(za);r.hide(bb);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(cb,"_51xq");ya&&ya.setProps({shown:false},function(){return rb(false);});kb.log('minisidebar_hide');}else kb.log('sidebar_hide');g.inform('sidebar/hide',wb);g.inform('reflow');}function mb(){var xb=wb.shouldShowSidebar(),yb=wb.shouldShowMiniSidebar();if(wb.isEnabled()&&(xb||yb)){if(xb){pb();qb();}else sb();}else lb();if(!wa){vb();wa=true;}ib=null;}function nb(){if(gb&&wb.isVisible())gb.getCore().getElement().focus();}function ob(xb){var yb=hb.height;xb.forEach(function(zb){if(zb&&zb!==pa)yb-=t.getElementDimensions(zb).height;});if(jb)yb-=jb.getOffset();if(fb)yb-=t.getElementDimensions(fb).height;return Math.max(0,yb);}function pb(){if(wb.isVisible())return;if(ab){r.hide(za);r.show(bb);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(cb,"_51xq");ya&&ya.setProps({shown:false},function(){return rb(false);});}ua=true;va=false;ib=null;r.show(cb);r.addClass(document.documentElement,'sidebarMode');eb.show();kb.log('sidebar_show');g.inform('sidebar/show',wb);x.destroy('sidebar');}function qb(){var xb=ob(ia(bb.childNodes)),yb=eb.getItemHeight(),zb=8,ac=Math.floor((xb-zb)/yb);fa.set(pa,'height',xb+'px');eb.setNumTopFriends(ac);var bc=Math.floor((xb-zb)/yb);bc=(bc-2)>0?bc-2:0;gb.getData().setMaxResults(bc);g.inform('sidebar/resized',wb);g.inform('reflow');}function rb(xb){if(cb===null)return;r.conditionClass(cb,"_2e4g",xb);}function sb(){r.hide(bb);r.show(za);r.show(cb);r.addClass(document.documentElement,'sidebarMode');r.addClass(document.documentElement,'miniSidebar');r.addClass(cb,"_51xq");var xb=ob([]),yb=p.getItemHeight(true),zb=Math.floor(xb/yb)-4;if(!ya){k.loadModules(["ChatMiniSidebar.react","ChatMiniSidebarSearchSource"],function(ac,bc){if(!ra)ra=new bc({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});ya=ca.render(ca.createElement(ac,{dataSource:ra,height:xb,maxEntries:Math.max(zb,0),onClickSearch:rb,onToggleSidebar:wb.toggle,shown:true}),za);});}else ya.setProps({height:xb,maxEntries:Math.max(zb,0),shown:true});ua=false;va=true;x.destroy('sidebar');kb.log('minisidebar_show');g.inform('minisidebar/show',wb);g.inform('reflow');}function tb(){n.setSetting('sidebar_mode',wb.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(ma).setErrorHandler(ma).setData({sidebar_mode:wb.isEnabled()}).setAllowCrossPageTransition(true).send();}function ub(){return z.getActiveList().length<=l.get('sidebar.min_friends');}function vb(){var xb=true;if(!wb.isEnabled()){kb.log('state_not_enabled');xb=false;}if(!wb.isViewportCapable())if(!ab){kb.log('state_not_shown_viewport');xb=false;}else if(!wb.isViewportCapableForMiniSidebar()){kb.log('state_not_shown_viewport_mini');xb=false;}if(xb)j.bumpEntityKey(oa,'state_viewport_can_show');if(ta){kb.log('state_not_shown_hidden');xb=false;}if(ub()){kb.log('state_not_shown_num_friends');xb=false;}var yb=xb?'state_shown':'state_not_shown';kb.log(yb);j.bumpEntityKey(oa,yb);}var wb={init:function(xb,yb,zb,ac){wb.init=ma;xa=true;cb=xb;eb=yb;gb=zb;db=ac;pa=s.find(xb,'div.fbChatSidebarBody');za=s.find(xb,"._51x-");bb=s.find(xb,"._51x_");fb=s.find(xb,"._5qqe");ab=l.get('www_mini_sidebar',false);var bc=s.find(xb,"._x1u");bc&&ca.render(ca.createElement(o,{className:"_3a-4 _5q85"}),bc);u.listen(window,'resize',mb);w.registerKey('q',function(event){if(ua){if(!qa)qa=s.scry(xb,'.inputsearch')[0];if(qa){qa.focus();event.prevent();}}});var cc=new q(xb);cc.subscribe('updated',mb);eb.setScrollContainer(aa.byClass(eb.getRoot(),'uiScrollableAreaWrap'));eb.subscribe(['render','show','hide'],la(function(dc){var ec=da.getInstance(eb.getRoot());ec&&ec.adjustGripper();}));g.subscribe('chat/option-changed',function(dc,ec){if(ec.name=="sidebar_mode"){sa=!!n.getSetting('sidebar_mode');mb();}if(ec.name==='hide_groups')mb();});zb.getCore().subscribe('sidebar/typeahead/active',wb.updateOnActiveTypeahead);if(y.SidebarClearTypeaheadGK){zb.subscribe('blur',function(){if(!eb.isVisible())wb.updateOnActiveTypeahead(null,false);});zb.subscribe('focus',function(){if(eb.isVisible()&&zb.getCore().getValue())wb.updateOnActiveTypeahead(null,true);});}zb.subscribe('reset',function(){if(!zb.getCore().getValue()&&!eb.isVisible())wb.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(dc,ec){u.listen(ec.getButton(),'click',function(event){var fc=ta;ta=false;wb.enable();var gc=wb.shouldShowSidebar()||wb.shouldShowMiniSidebar();ta=fc&&!gc;return !gc;});});sa=!!n.getSetting('sidebar_mode');ba.subscribe('privacy-user-presence-changed',mb);mb();m.init(eb);ga.addPersistentRight(wb.getVisibleWidth);wb.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);jb=new ea(fb);jb.subscribe('resized',mb);},updateOnActiveTypeahead:function(xb,yb){if(!ua)return;if(yb){eb.hide();}else{gb.getView().clearContent();eb.show();mb();}},isInitialized:function(){return wa;},disable:function(){if(!wb.isEnabled())return;sa=false;tb();lb();},enable:function(){if(wb.isEnabled())return;sa=true;tb();mb();setTimeout(nb,0);},ensureLoaded:function(){if(!sa)return;if(xa)return;if(na('pagelet_sidebar'))return;d(['UIPagelet'],function(xb){var yb=s.create('div',{id:'pagelet_sidebar'});s.appendContent(document.body,yb);xb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});xa=true;},hide:function(){if(ta)return;ta=true;lb();},unhide:function(){if(!ta)return;ta=false;mb();},getBody:function(){return pa;},getRoot:function(){return cb;},getVisibleWidth:function(){if((!ua&&!va)||!cb)return 0;if(ib===null){ib=cb.offsetWidth;if(va)ib=206;}return ib;},isEnabled:function(){return sa;},isViewportCapable:function(){hb=t.getViewportWithoutScrollbarDimensions();var xb=l.get('sidebar.minimum_width');return hb.width>xb;},shouldShowSidebar:function(){var xb=wb.isViewportCapable();return xb&&!ta&&!ub();},isViewportCapableForMiniSidebar:function(){hb=t.getViewportWithoutScrollbarDimensions();var xb=l.get('sidebar.minimum_width'),yb=l.get('minisidebar.minimum_width');return hb.width>yb&&hb.width<=xb;},shouldShowMiniSidebar:function(){if(!ab)return false;var xb=wb.isViewportCapableForMiniSidebar();return xb&&!ta&&!ub();},isVisible:function(){return ua;},resize:mb,toggle:function(){wb.isEnabled()?wb.disable():wb.enable();}};ha(wb,h);e.exports=wb;},null);
__d("ChatMiniSidebarSearchSource",["AbstractSearchSource","AsyncRequest","ChatSortUsers","CurrentUser","MercuryParticipantTypes","OrderedFriendsList","SearchableEntry","SearchSourceCallbackManager","ShortProfiles","TokenizeUtil","copyProperties","emptyFunction","isValidUniqueID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();'use strict';for(var t in g)if(g.hasOwnProperty(t))v[t]=g[t];var u=g===null?null:g.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=g;function v(w){this.$ChatMiniSidebarSearchSource0=new n({parseFn:p.parse,matchFn:p.isQueryMatch,indexFn:w.indexFn});this.$ChatMiniSidebarSearchSource1=[];this.$ChatMiniSidebarSearchSource2=w.queryRequests||[];this.$ChatMiniSidebarSearchSource3=false;}v.prototype.bootstrapImpl=function(w){o.fetchAll().then(function(){this.$ChatMiniSidebarSearchSource3=true;this.$ChatMiniSidebarSearchSource4();w();}.bind(this));};v.prototype.searchImpl=function(w,x,y){var z=null,aa={},ba=y&&y.onQueryFinished,ca=y&&y.onQueryStarted;ca&&ca(w);var da=this.$ChatMiniSidebarSearchSource0.search(w,function(ga){if(!z){z=ga;z.forEach(function(ha){return aa[ha.getUniqueID()]=true;});}else ga.forEach(function(ha){var ia=ha.getUniqueID();if(!aa[ia]){z.push(ha);aa[ia]=true;}});x(z,w);if(w.length===1&&this.$ChatMiniSidebarSearchSource3)ba&&ba(w);}.bind(this),y);if(!da||!this.$ChatMiniSidebarSearchSource2||!this.$ChatMiniSidebarSearchSource2.length||w.length===0){ba&&ba(w);return;}if(w.length===1){if(this.$ChatMiniSidebarSearchSource3)ba&&ba(w);return;}var ea={value:w,existing_ids:z&&z.map(function(ga){return ga.getUniqueID();}).join(','),needs_friends:!this.$ChatMiniSidebarSearchSource3,limit:y.threadLimit},fa=this.$ChatMiniSidebarSearchSource2.length;this.$ChatMiniSidebarSearchSource2.forEach(function(ga){this.$ChatMiniSidebarSearchSource5(ea,ga,function(ha){this.$ChatMiniSidebarSearchSource6(this.$ChatMiniSidebarSearchSource7(this.$ChatMiniSidebarSearchSource8(ha)),w);fa--;if(fa===0){this.$ChatMiniSidebarSearchSource0.setQueryStringAsExhausted(w);ba&&ba(w);}}.bind(this));}.bind(this),this);};v.prototype.getBootstrappedEntries=function(w){return this.bootstrap(function(){return w(this.$ChatMiniSidebarSearchSource1||[]);}.bind(this));};v.prototype.getAllEntriesMap=function(){return this.$ChatMiniSidebarSearchSource0.getAllEntries();};v.prototype.$ChatMiniSidebarSearchSource4=function(){var w=o.getCachedProfileIDs(),x=w.filter(function(z){var aa=o.getNow(z);return (z==j.getID()||aa.type===k.FRIEND);});x.sort(i.sort);var y=x.map(this.$ChatMiniSidebarSearchSource9);this.$ChatMiniSidebarSearchSource0.addLocalEntries(y);if(y.length)this.$ChatMiniSidebarSearchSource1=this.$ChatMiniSidebarSearchSource1.concat(y);};v.prototype.$ChatMiniSidebarSearchSource7=function(w){return w.map(this.$ChatMiniSidebarSearchSourcea,this);};v.prototype.$ChatMiniSidebarSearchSourcea=function(w,x){if(w.mercury_thread)return l.normalizeThreadEntry(w,x);var y=w.text,z=w.uid;if(!y||!s(z))return null;return new m({uniqueID:z,title:y,order:l.getActiveRank(z),subtitle:w.subtext,type:w.render_type||w.type,photo:w.photo,uri:w.path,auxiliaryData:{isMessengerUser:w.is_messenger_user}});};v.prototype.$ChatMiniSidebarSearchSource8=function(w){var x=w.getPayload();if(Array.isArray(x)){return x;}else if(x&&x.entries){return x.entries;}else return [];};v.prototype.$ChatMiniSidebarSearchSource9=function(w,x){var y=o.getNow(w),z=w==j.getID()?k.FRIEND:y.type,aa=[y.additionalName,y.alternateName].concat(y.searchTokens||[]).join(' ');return new m({uniqueID:w,title:y.name,order:x,subtitle:y.additionalName,keywordString:aa,type:z,photo:y.thumbSrc,uri:y.uri,auxiliaryData:{isMessengerUser:y.is_messenger_user}});};v.prototype.$ChatMiniSidebarSearchSource5=function(w,x,y,z){new h(x.uri).setData(q({},w,x.data)).setMethod('GET').setReadOnly(true).setHandler(y).setErrorHandler(z||r).setAllowCrossPageTransition(true).send();};v.prototype.$ChatMiniSidebarSearchSource6=function(w,x){if(w.length)this.$ChatMiniSidebarSearchSource0.addQueryEntries(w,x);};v.prototype.addLocalEntries=function(w){this.$ChatMiniSidebarSearchSource0.addLocalEntries(w);};v.prototype.refreshData=function(){o.fetchAll();d(['AvailableList'],function(w){return w.update();});};e.exports=v;},null);
__d("ChatTypeaheadBehavior",["ChatOpenTab","CSS","MercuryConfig","Parent","Rect","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(p,q){var r=j.byClass(p,"_4oes");if(r)h.conditionClass(r,"_5q83",q);}function o(p){"use strict";this._typeahead=p;}o.prototype.enable=function(){"use strict";var p=this._typeahead;this._subscriptions=[p.subscribe('focus',function(){p.getData().refreshData();n(p.getElement(),true);}),p.subscribe('blur',function(q){if(!i.SidebarClearTypeaheadGK)p.getCore().reset();n(p.getElement(),false);}),p.subscribe('respond',function(q,r){if(r.value&&r.value===p.getCore().getValue()){if(!r.results.length){var s=r.value.toLowerCase(),t=p.getData().getQueryCache();if(!r.isAsync&&!t.hasOwnProperty(s))return;p.getView().showNoResults();}h.addClass(p.getElement(),'hasValue');}}),p.subscribe('reset',function(){h.removeClass(p.getElement(),'hasValue');}),p.subscribe('select',function(q,r){var s=r.selected.uid;if(r.selected.mercury_thread&&!r.selected.mercury_thread.is_canonical)s=r.selected.mercury_thread.thread_fbid;p.getView().hide();g.openTabByType(s,r.selected.type,'typeahead');}),p.subscribe('highlight',function(q,r){if(r.index>=0){var s=p.getView().getItems()[r.index];if(s){var t=new k(s),u=s.offsetParent,v=t.boundWithin(new k(u)).getPositionVector();t.getPositionVector().sub(v).scrollElementBy(u);}}})];};o.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(p){this._typeahead.unsubscribe(p);},this);this._subscriptions=null;};l(o.prototype,{_subscriptions:null});e.exports=o;},null);
__d("MercuryMessageInfo",["MercuryActionStatus","MercuryViewer"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={isOutbound:function(j){return j.author===h.getID();},isInbound:function(j){return !i.isOutbound(j);},isSending:function(j){return (j.status===g.UNSENT||j.status===g.UNCONFIRMED||j.status===g.UNABLE_TO_CONFIRM||j.status===g.RESENDING);},hasError:function(j){return (j.status===g.FAILED_UNKNOWN_REASON||j.status===g.UNABLE_TO_CONFIRM||j.status===g.ERROR);}};e.exports=i;},null);
__d("MercuryErrorInfo",["MercuryErrorType","MercuryMessageInfo","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={getMessage:function(k){var l='';if(j.isConnectionError(k)){l=i._("This message didn't send.");if(j.isTransient(k))l=i._("{message} Check your internet connection and click to try again.",[i.param("message",l)]);}else{if(k&&k.description){l=k.description;}else l=i._("This message failed to send.");if(j.isTransient(k))l=i._("{message} Click to send again.",[i.param("message",l)]);}return l;},isConnectionError:function(k){if(k&&k.type==g.TRANSPORT)return k.code===1001||k.code===1004||k.code===1006;return false;},isTransient:function(k){return k&&k.is_transient;},isPermanent:function(k){return k?!this.isTransient(k):false;},hasErrorStatus:function(k){return h.hasError(k);}};e.exports=j;},null);
__d("MercuryMessageError.react",["CurrentUser","ImmutableObject","MercuryErrorInfo","MercuryMessageActions","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=k,o=n.PropTypes,p=k.createClass({displayName:"MercuryMessageError",propTypes:{authorFBID:o.string,message:o.instanceOf(h).isRequired},getDefaultProps:function(){return {authorFBID:g.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (k.createElement("div",k.__spread({},this.props,{className:m(this.props.className,this._getClassNameFromStatus(q)),tabIndex:i.isTransient(r)?0:null,onClick:i.isTransient(r)?this.messageResend:null}),k.createElement("div",{className:"_2fs1"}),k.createElement("span",{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){j.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(i.hasErrorStatus(q)){return (("_2fs2")+(' '+"_2fs3")+(i.isTransient(q.error_data)?' '+"_2fs4":'')+(i.isPermanent(q.error_data)?' '+"_2fs5":''));}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(i.hasErrorStatus(q))r=i.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});e.exports=p;},null);
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","UserAgent_DEPRECATED","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=200;function n(){if(k.webkit()&&!k.chrome())return false;var w=i.create('audio'),x=false;try{if(!!w.canPlayType)if(w.canPlayType('video/mp4;').replace(/^no$/,''))x=true;}finally{return x;}}function o(){return j.isAvailable();}var p=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),m);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(p.prototype,{setAudio:function(w,x){this.audio.setAttribute('src',w);this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var q=function(){this.src=null;this.arbiterInstance=null;var w=i.create('div');document.body.appendChild(w);this.swf=j.embed('/swf/SoundStreamPlayer.swf',w,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(q.prototype,{setAudio:function(w,x){this.src=w;this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var w=this.swf.getCurrentTime();this.informAttachment('playing',w);}.bind(this),m);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function r(){if(n()){return new p();}else if(o())return new q();return false;}var s=null,t=null,u=0;function v(w,x){this.src=w;this.arbiterInstance=x;this.audio_id=++u;s!==null||(s=r());if(!s)return false;}l(v.prototype,{getType:function(){if(!s){return false;}else return s.getType();},play:function(w){if(w&&t==this.audio_id){s.resume();}else{this.pause();t=this.audio_id;s.setAudio(this.src,this.arbiterInstance);s.play();}},pause:function(){s.pause();}});e.exports=v;},null);
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","MercuryShareAttachmentRenderLocations","React","SubscriptionsHandler","cx","fbt","joinClasses","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=n,u=t.PropTypes,v='MercuryAttachmentAudioClip/play',w=k.create('mercury_audio_clip'),x=n.createClass({displayName:"AudioClip",mixins:[h],propTypes:{duration:u.number,location:u.oneOf(m.getValues()),rootClassName:u.string,showHelp:u.bool,src:u.string.isRequired,width:u.number},getInitialState:function(){this.logged=false;var y=this.props.downloadOnly?false:new i(this.props.src,this);return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:y};},componentDidMount:function(){this._subscriptionsHandler=new o();this._subscriptionsHandler.addSubscriptions(this.subscribe('playing',this.updateTime),this.subscribe('played',s(this.setState,this,{playing:true,started:true})),this.subscribe('paused',s(this.setState,this,{playing:false})),this.subscribe('finished',s(this.setState,this,{playing:false,started:false,time:this.props.duration})),g.subscribe(v,function(y,z){if(this.props.src!=z)this.setState({time:0});}.bind(this)));},componentWillUnmount:function(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},updateTime:function(y,z){this.setState({time:z});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(v,this.props.src);if(!this.logged){this.logged=true;w.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(y){if(y){y=Math.ceil(y);var z=y%60;if(z<10)z='0'+z;var aa=Math.floor(y/60);return aa+':'+z;}else return null;},_renderPlayer:function(y,z){return (n.createElement("a",{className:"_1miz _2e-1",href:"#",style:{width:y},onClick:this.play},n.createElement("span",{className:"_1mi- _2e-2"},n.createElement("i",{className:"_1mi_ _2e-3"})),n.createElement("span",{className:"_1mj0 _2e-4"},z),n.createElement("div",{className:"_1mj1 _2e-5"})));},render:function(){var y=this.state.time,z=this.state.playing,aa=this._formatSeconds(this.state.duration),ba=this.props.location===m.MESSENGER,ca=this.props.width||170;if(ba){var da=this.props.duration;if(da>10){ca=240;}else if(da>5){ca=200;}else if(da>2){ca=160;}else ca=120;}var ea=null,fa=Math.ceil((y*(ca+2))/this.state.duration);if(ba)fa=Math.ceil((y*(ca+24))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var ga=this._renderPlayer(ca,aa),ha=this._renderPlayer(ca,aa),ia=(("_1mj2")+(' '+"_2e-6")+(z&&(y!==0)?' '+"_1mj3":'')+(z&&(y===0)?' '+"_4g4x":''));ea=(n.createElement("div",{className:ia},ga,n.createElement("div",{className:"_1mj4 _2e-7",style:{width:fa}},ha)));}else ea=(n.createElement("div",{className:"_1mj2"},n.createElement("div",{className:"_1miz"},n.createElement(l,null,n.createElement("a",{className:"_1mj5",href:this.props.src},n.createElement("span",{className:"_3qi6"},n.createElement("i",{className:"_1mj6"})),n.createElement("span",{className:"_1mj7"},q._("Voice Message")),n.createElement("span",{className:"_1mj8"},aa)),n.createElement("a",{href:this.props.src,className:"_1mj9"},n.createElement("i",{className:"_1mja"}))))));return (n.createElement("div",{className:r((("_1mjb")+(ba?' '+"_454y":'')),this.props.rootClassName)},ea));}});e.exports=x;},null);
__d("MercuryAttachmentPhoto.react",["Bootloader","ChatImageArrowDirection","ChatImageWithArrow.react","MercuryMessageInfo","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=k,n=m.PropTypes,o=k.createClass({displayName:"MercuryAttachmentPhoto",propTypes:{height:n.number,image:n.object.isRequired,message:n.object.isRequired,width:n.number},_handleClickPicture:function(p){var q=this.props.image;g.loadModules(["MessagesViewer"],function(r){r.bootstrapWithConfig({src:q.preview_url,endpoint:q.url,fbid:q.metadata.fbid,dimensions:q.metadata.dimensions,disablePaging:true},null);});},render:function(){var p=j.isInbound(this.props.message);return (k.createElement("div",{className:"_1rqb"},k.createElement(i,{arrowDirection:p?h.LEFT:h.RIGHT,source:this.props.image.preview_url,height:this.props.height,width:this.props.width,onClick:this._handleClickPicture,isLoading:!!this.props.image.preview_uploading})));}});e.exports=o;},null);
__d("ChatGridImage.react",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=h,k=j.PropTypes,l=h.createClass({displayName:"ChatGridImage",propTypes:{isLoading:k.bool,onClick:k.func,size:k.number.isRequired,source:k.string},render:function(){if(this.props.isLoading)return (h.createElement("div",{className:"_4ypb",style:{width:this.props.size,height:this.props.size}}));return (h.createElement(g,{onClick:this.props.onClick},h.createElement("div",{className:"_332l",style:{backgroundImage:'url('+this.props.source+')',width:this.props.size,height:this.props.size}})));}});e.exports=l;},null);
__d("MercuryAttachmentPhotoGrid.react",["Bootloader","ChatGridImage.react","ChatImageArrowDirection","ChatImageWithArrow.react","Grid.react","MercuryAttachmentType","MercuryMessageInfo","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=k.GridItem,q=n,r=q.PropTypes,s=n.createClass({displayName:"MercuryAttachmentPhotoGrid",propTypes:{images:r.arrayOf(r.object).isRequired,size:r.number.isRequired,message:r.object.isRequired},_generateClickHandler:function(t){var u=this.props.images.some(function(v){return v.attach_type===l.ANIMATED_IMAGE;});return (function(v){g.loadModules(["MessagesViewer"],function(w){w.bootstrapWithConfig({src:t.preview_url,endpoint:t.url,fbid:t.metadata.fbid,dimensions:t.metadata.dimensions,disablePaging:u},null);});});},render:function(){var t=this.props.images,u=t.length,v=(u==2||u==4)?2:3,w=Math.floor(this.props.size/v),x=m.isInbound(this.props.message),y=x?0:v-1,z=[];for(var aa=0;aa<t.length;aa++)if(aa===y){z.push(n.createElement(p,{key:aa},n.createElement(j,{arrowDirection:x?i.LEFT:i.RIGHT,source:t[aa].preview_url,height:w,width:w,isLoading:!!t[aa].preview_uploading,onClick:this._generateClickHandler(t[aa])})));}else z.push(n.createElement(p,{key:aa},n.createElement(h,{isLoading:!!t[aa].preview_uploading,onClick:this._generateClickHandler(t[aa]),size:w,source:t[aa].preview_url})));return (n.createElement(k,{cols:v,className:"_5b2w",spacing:"_5b2x",alignh:"right"},z));}});e.exports=s;},null);
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MercuryStatusTemplates","Tooltip","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={renderParticipantListWithNoThreadName:function(q,r,s,t,u,v){var w={callback:true,check_length:true,show_unread_count:true};v=v||{};var x={};for(var y in v)if(w[y]){x[y]=v[y];delete v[y];}var z=s.map(function(ea){return t[ea];}),aa=this.renderRawParticipantList(q,z,s.length,v);aa=this.renderRawTitleWithUnreadCount(aa,x.show_unread_count?r.unread_count:0);var ba=v.abbr_mode,ca={};for(var da in v)ca[da]=v[da];ca.abbr_mode=true;u.forEach(function(ea){var fa=u.length>1?this._cloneIfDOMElement(aa):aa;i.setContent(ea,fa);if(x.check_length&&!ba&&ea.scrollWidth>ea.clientWidth){var ga=this.renderRawParticipantList(q,z,s.length,ca),ha=this.renderRawTitleWithUnreadCount(ga,x.show_unread_count?r.unread_count:0);i.setContent(ea,ha);}}.bind(this));x.callback&&x.callback(aa);},renderRawParticipantList:function(q,r,s,t){var u={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};t=t||{};var v=null;if(t.names_renderer){v=t.names_renderer(r);}else v=r.map(function(x){return x.name;});var w=null;if(v.length===0){if(!q){w=o._("New Message");}else w=o._("No Participants");}else if(v.length==1){w=v[0];}else if(v.length==2){if(t.last_separator_uses_and){w=o._("{participant1} and {participant2}",[o.param("participant1",v[0]),o.param("participant2",v[1])]);}else w=o._("{participant1}, {participant2}",[o.param("participant1",v[0]),o.param("participant2",v[1])]);}else if(t.last_separator_uses_and){if(t.abbr_mode){w=o._("{participant1} and {others_link}",[o.param("participant1",v[0]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-1}))]);}else if(v.length==3){w=o._("{participant1}, {participant2} and {participant3}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2])]);}else w=o._("{participant1}, {participant2} and {others_link}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-2}))]);}else if(v.length==3){w=o._("{participant1}, {participant2}, {participant3}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2])]);}else w=o._("{participant1}, {participant2}, {participant3}, {others_link}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-3}))]);if(Array.isArray(w))w=i.create('span',{},w);return w;},renderRawTitleWithUnreadCount:function(q,r){var s=q;if(r&&r>1)s=i.create('span',{},o._("{conversation_title} ({unread_count})",[o.param("conversation_title",q),o.param("unread_count",r)]));return s;},renderRawParticipantCount:function(q){var r=q.render_subset,s;if(!r){s=q.count>1?o._({"*":"{num} people"},[o.param("num",q.count,[0])]):o._("1 person");}else s=q.count>1?o._({"*":"{others_count} others"},[o.param("others_count",q.count,[0])]):o._("1 other");return s;},renderShortNames:function(q){if(q.length==1)return [q[0].name];return q.map(function(r){return r.short_name;});},renderStatusIndicator:function(q,r,s){var t;if(q==j.RESENDING){t=this.renderResendIndicator();}else if(q!==(void 0)&&q!=j.UNSENT&&q!=j.UNCONFIRMED&&q!=j.SUCCESS)t=this.renderErrorIndicator(r,s);return t;},renderResendIndicator:function(){return l[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(q,r){if(!q)return null;var s=l[':fb:mercury:error-indicator'].render(),t=q.is_transient,u=k.getMessage(q);if(t)if(k.isConnectionError(q)){u=o._("{message} Check your internet connection and click to try again.",[o.param("message",u)]);}else u=o._("{message} Click to send again.",[o.param("message",u)]);m.set(s,u,'above','center');if(r&&t){g.listen(s,'click',r);s.setAttribute('tabindex','0');h.addClass(s,"_55q-");}return s;},_cloneIfDOMElement:function(q){if(q&&q.cloneNode){return q.cloneNode();}else return q;}};e.exports=p;},null);
__d("MessagingRecipientTypeaheadItem.react",["BackgroundImage.react","ChatTypeaheadConstants","ImageBlock.react","LeftRight.react","React","SplitImage.react","MercuryThreadMetadataRawRenderer","TypeaheadViewItem","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k,r=q.PropTypes,s=k.createClass({displayName:"MessagingRecipientTypeaheadItem",propTypes:Object.assign({},n.propTypes,{imageSize:r.number.isRequired}),mixins:[n.Mixin],isThreadRecipient:function(){return this.props.entry.getType()===h.THREAD_TYPE;},_getImage:function(){var t=this.props.entry;if(t.getType()===h.THREAD_TYPE&&!t.getPhoto()){var u=t.getAuxiliaryData();return (k.createElement(l,{size:this.props.imageSize,srcs:u.participantsToRender.map(function(v){return v.image_src;})}));}if(t.getPhoto())return (k.createElement(g,{width:this.props.imageSize,height:this.props.imageSize,backgroundSize:"cover",src:t.getPhoto()}));return k.createElement("span",null);},_getThreadParticipantList:function(){if(!this.isThreadRecipient())return null;var t=this.props.entry;return m.renderRawParticipantList(t.getUniqueID(),t.getAuxiliaryData().participantsToRender,t.getAuxiliaryData().thread.participants.length-1,{names_renderer:m.renderShortNames});},_getTitle:function(){var t=this.props.entry;if(this.isThreadRecipient()&&!t.getTitle())return this._getThreadParticipantList();return t.getTitle();},_getSubtitle:function(){var t=this.props.entry;if(this.isThreadRecipient()&&!t.getTitle())return this._getThreadParticipantList();return t.getSubtitle()?t.getSubtitle().split(' \u00b7 ')[0]:null;},render:function(){var t=this._getSubtitle(),u=p((("_599m")+(' '+"_55xn")+(!t?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":'')),this.props.className);return (k.createElement("li",{"aria-selected":this.props.selected,className:u,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},k.createElement(i,{spacing:"medium"},this._getImage(),k.createElement(j,null,k.createElement("div",null,k.createElement("div",{className:"_55xt _599p"},this._getTitle()),k.createElement("div",{className:"_55z3 _599q"},t)),this.props.children))));}});e.exports=s;},null);
__d("MessagingRecipientSelectedList.react",["Image.react","LeftRight.react","Map","MessagingRecipientTypeaheadItem.react","React","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=k,p=o.PropTypes,q=k.createClass({displayName:"MessagingRecipientSelectedList",propTypes:{entries:p.instanceOf(i),onSelect:p.func.isRequired},_renderSelectedEntry:function(r){var s=n({name:'cross',shade:'dark',size:'small'});return (k.createElement(j,{key:r.getUniqueID(),entry:r,imageSize:24,onSelect:this.props.onSelect},k.createElement(g,{className:"_1jm4",src:s})));},render:function(){var r=(m._("Send to:")),s=[];this.props.entries.forEach(function(t){return s.push(this._renderSelectedEntry(t));}.bind(this));return (k.createElement("div",{className:"_1jm5"},k.createElement(h,{className:"_1jm6 _2ph-"},k.createElement("span",null,r),k.createElement("span",null,this.props.entries.size)),k.createElement("ul",null,s)));}});e.exports=q;},null);
__d("MessagingRecipientTypeaheadView.react",["CenteredContainer.react","Link.react","Map","MessagingRecipientTypeaheadItem.react","React","TypeaheadViewPropTypes","XUISpinner.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=k,q=p.PropTypes,r=32,s=k.createClass({displayName:"MessagingRecipientTypeaheadView",propTypes:Object.assign({},l,{selectedEntries:q.instanceOf(i),loading:q.bool}),getDefaultProps:function(){return {role:'listbox'};},_renderItem:function(t){var u=t===this.props.highlightedEntry,v=this.props.selectedEntries.has(t.getUniqueID());return (k.createElement(j,{key:t.getUniqueID(),entry:t,highlighted:u,imageSize:r,selected:v,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight},k.createElement(h,{"aria-checked":v,className:(("_2i83")+(v?' '+"_2i85":'')+(!v?' '+"_2i86":'')),href:"#",role:"checkbox",tabIndex:"0"})));},render:function(){if(this.props.entries.length===0&&!this.props.loading)return (k.createElement(g,{className:"_2pi1"},o._("No results")));return (k.createElement("ul",{id:this.props.ariaOwneeID,className:"_51do",role:this.props.role},this.props.entries.map(this._renderItem),k.createElement("div",{className:"_51dq"},this.props.loading?k.createElement(m,null):null)));}});e.exports=s;},null);
__d("XMessagingForwardAttachmentController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/mercury\/attachments\/forward\/",{});},null);
__d("MessagingForwardAttachmentDialog.react",["AsyncRequest","ChatMiniSidebarSearchSource","Image.react","LayerFadeOnHide","Layout.react","Map","MessagingRecipientSelectedList.react","MessagingRecipientTypeaheadView.react","OrderedFriendsList","React","SearchableTextInput.react","ScrollableArea.react","XMessagingForwardAttachmentController","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogFooter.react","XUIDialogTitle.react","XUISpinner.react","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();var da=k.Column,ea=k.FillColumn,fa=p,ga=fa.PropTypes,ha=p.createClass({displayName:"MessagingForwardAttachmentDialog",propTypes:{attachmentID:ga.string.isRequired,onClose:ga.func,shown:ga.bool.isRequired,title:ga.string.isRequired},getInitialState:function(){return {bootstrappedEntries:[],entries:[],loading:true,selectedEntries:new l(),sendError:null,sending:false,startingThreadingID:Date.now(),query:''};},componentDidMount:function(){this._dataSource=new h({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});o.getSearchableEntries(20,function(ia){this.setState({bootstrappedEntries:ia,loading:false});}.bind(this));},_onSelectEntry:function(ia){var ja=ia.getUniqueID(),ka=new l(this.state.selectedEntries);if(ka.has(ja)){ka["delete"](ja);}else ka.set(ja,ia);this.setState({selectedEntries:ka});},_onSearchChange:function(ia){var ja=ia.target.value;this.setState({loading:true,query:ja});},_onSearchEntriesFound:function(ia){this.setState({entries:ia});},_onSearchFinished:function(ia){ia===this.state.query&&this.setState({loading:false});},_onSubmit:function(){var ia={},ja=this.state.startingThreadingID;this.state.selectedEntries.forEach(function(la){ia[ja++]=la.getUniqueID();});var ka=s.getURIBuilder().getURI();new g(ka).setMethod('POST').setHandler(this._onSubmitResponse).setData({attachment_id:this.props.attachmentID,recipient_map:ia}).send();this.setState({sending:true,sendError:null});},_onSubmitResponse:function(ia){if(ia.payload.success){this.props.onClose&&this.props.onClose();this.setState({bootstrappedEntries:[],selectedEntries:new l(),sending:false,startingThreadID:Date.now(),query:''});return;}this.setState({sending:false,sendError:ia.payload.error});},_onToggle:function(ia){if(!ia)this.props.onClose();},render:function(){var ia=(ba._("Send")),ja=null;if(this.state.sending){ja=(p.createElement("div",null,p.createElement(z,null),p.createElement("span",{className:"_5s0d _3-99"},ba._("Sending"))));}else if(this.state.sendError){var ka=ca({name:'error-solid',shade:'dark',size:'medium'});ja=(p.createElement("div",{className:"_5s0d"},p.createElement(i,{src:ka}),p.createElement("span",{className:"_3-99"},this.state.sendError)));}var la=(ba._("Search for people and groups"));return (p.createElement(t,{shown:this.props.shown,behaviors:{LayerFadeOnHide:j},onToggle:this._onToggle,width:560},p.createElement(y,null,this.props.title),p.createElement(u,{useCustomPadding:true},p.createElement(k,null,p.createElement(da,{className:"_5s0e"},p.createElement("div",{className:"_2ph_"},p.createElement(q,{className:"_5s0f autofocus",onChange:this._onSearchChange,onEntriesFound:this._onSearchEntriesFound,placeholder:la,queryString:this.state.query,searchSource:this._dataSource,searchSourceOptions:{onQueryFinished:this._onSearchFinished}})),p.createElement(r,{className:"_5s0g",height:400,width:360},p.createElement(n,{entries:this.state.query?this.state.entries:this.state.bootstrappedEntries,loading:this.state.loading,selectedEntries:this.state.selectedEntries,onSelect:this._onSelectEntry}))),p.createElement(ea,{className:"_5s0h"},p.createElement(r,{height:457,shadow:false},p.createElement(m,{entries:this.state.selectedEntries,onSelect:this._onSelectEntry}))))),p.createElement(x,{leftContent:ja},p.createElement(w,{onClick:this.props.onClose}),p.createElement(v,{use:"confirm",disabled:!this.state.selectedEntries.size||this.state.sending,label:ia,onClick:this._onSubmit}))));}});e.exports=ha;},null);
__d("Spotlight.react",["LayerHideOnBlur","LayerHideOnEscape","ReactLayer","Spotlight"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i.createClass({getDefaultEnabledBehaviors:function(){return {hideOnBlur:g,hideOnEscape:h};},createLayer:function(l){var m=this.enumerateBehaviors(this.props.behaviors),n={addedBehaviors:m,rootClassName:this.props.rootClassName},o=new j(n,l);o.conditionShow(this.props.shown);if(this.props.onBeforeHide)o.subscribe('beforehide',this.props.onBeforeHide);if(this.props.onHide)o.subscribe('hide',this.props.onHide);return o;},receiveProps:function(l){this.layer.conditionShow(l.shown);}});e.exports=k;},null);
__d("SpotlightViewer",["React","ReactLayeredComponentMixin","Spotlight.react","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g.createClass({displayName:"SpotlightViewer",mixins:[h],renderLayers:function(){if(!this.props.open)return null;var l="_n3";if(this.props.className)l+=' '+this.props.className;return {photoLayer:g.createElement(i,{onBeforeHide:this.props.onBeforeHide,onHide:this.props.onHide,rootClassName:this.props.rootClassName,shown:this.props.open},g.createElement("div",{className:l,onClick:this.props.onClick},this.props.children))};},render:function(){return (g.createElement("div",null));}});e.exports=k;},null);
__d("SpotlightViewerAutoResize",["Event","SubscriptionsHandler","invariant"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this.$SpotlightViewerAutoResize0=k;i(typeof this.$SpotlightViewerAutoResize0.onResize==='function');}j.prototype.enable=function(){"use strict";this.$SpotlightViewerAutoResize1=new h();this.$SpotlightViewerAutoResize1.addSubscriptions(g.listen(window,'resize',this.$SpotlightViewerAutoResize0.onResize));};j.prototype.disable=function(){"use strict";this.$SpotlightViewerAutoResize1.release();delete this.$SpotlightViewerAutoResize1;};e.exports=j;},null);
__d("SpotlightViewerBehaviorsMixin",["BehaviorsMixin","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={componentWillMount:function(){this.behaviors&&this.enableBehaviors(this.behaviors);},componentWillUnmount:function(){this.destroyBehaviors();}};h(i,g);e.exports=i;},null);
__d("SpotlightViewerBottomBar",["LeftRight.react","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=h.createClass({displayName:"SpotlightViewerBottomBar",render:function(){var l=Array.isArray(this.props.children)?this.props.children:[this.props.children],m="_4_8n _51an";if(this.props.className)m=j(m,this.props.className);if(l.length===1)return (h.createElement("div",{className:m},l[0]));m=j(m,"_50-m");return (h.createElement(g,{className:m},l[0],l[1]));}});e.exports=k;},null);
__d("SpotlightViewerBottomBarGroup",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g.createClass({displayName:"SpotlightViewerBottomBarGroup",render:function(){var j=this.props.itemmargin||'right',k=((j=='left'?"marginLeft":'')+(j=='right'?' '+"marginRight":'')+(' '+"_4_8i"));return (g.createElement("div",{className:k},this.props.children));}});e.exports=i;},null);
__d("SpotlightViewerBottomBarLink",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=h.createClass({displayName:"SpotlightViewerBottomBarLink",render:function(){return (h.createElement(g,h.__spread({},this.props,{className:"_4_8j _4_8k"}),this.props.children));}});e.exports=j;},null);
__d("SpotlightViewerPagers",["LeftRight.react","Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i.createClass({displayName:"SpotlightViewerPagers",render:function(){return (i.createElement(g,null,i.createElement(h,{className:"_4-oa _4-ob _50-m"}),i.createElement(h,{className:"_4-oa _4-oc _50-m"})));}});e.exports=k;},null);
__d("SpotlightViewerPageWithKeys",["KeyEventController","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){"use strict";this.$SpotlightViewerPageWithKeys0=j;}i.prototype.enable=function(){"use strict";this.$SpotlightViewerPageWithKeys1=new h();this.$SpotlightViewerPageWithKeys1.addSubscriptions(g.registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys0.viewState.backward();return false;}.bind(this)),g.registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys0.viewState.forward();return false;}.bind(this)));};i.prototype.disable=function(){"use strict";this.$SpotlightViewerPageWithKeys1.release();delete this.$SpotlightViewerPageWithKeys1;};e.exports=i;},null);
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;},null);
__d("XMessagingPhotoDownloadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/mercury\/attachments\/photo\/",{photo_id:{type:"String",required:true}});},null);
__d("SpotlightMessagesViewer",["ArbiterMixin","MercuryConfig","MessagingForwardAttachmentDialog.react","PageTransitions","React","ReactLayeredComponentMixin","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerThumbnailMixin","SpotlightViewport","SubscriptionsHandler","XMessagingPhotoDownloadController","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();var ca=k.createClass({displayName:"SpotlightMessagesViewer",mixins:[g,l,o,t,x,u],behaviors:[w,n],componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getViewerID:function(){return this.props.setid;},getInitialState:function(){this._subscriptions=new z();return {photoData:this._getInitialPhotoData(),open:true,showForward:false};},_enableSubscriptions:function(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',function(){return this.setState({photoData:null});}.bind(this)));},_showForwardDialog:function(){this.setState({showForward:true});},_hideForwardDialog:function(){this.setState({showForward:false});},renderLayers:function(){if(this.props.disableForward)return {};var da=(ba._("Forward in separate messages"));return {forwardDialog:(k.createElement(i,{attachmentID:String(this.state.photoData.id),onClose:this._hideForwardDialog,shown:this.state.showForward,title:da}))};},render:function(){var da=this.getMedia(),ea=this.props.snapToPhoto?this.getImageDimensions():this.getStageDimensions(),fa=this.props.useloadingindicator&&!this.state.photoData;j.registerCompletionCallback(function(){if(this.state.open)this.close();return true;}.bind(this));return (k.createElement(m,{rootClassName:this.props.rootClassName,open:this.state.open,onHide:this.close},k.createElement(y,{onClick:this._onClickViewport,stageDimensions:ea,media:da,showLoadingIndicator:fa},k.createElement(s,{onClick:this.close}),this.props.disablepaging?null:k.createElement(v,null),this._renderBottomBar())));},_renderBottomBar:function(){var da;if(h.ForwardingEnabled&&!this.props.disableForward)da=(k.createElement(r,{onClick:this._showForwardDialog},ba._("Forward")));var ea=aa.getURIBuilder().setString('photo_id',String(this.state.photoData.id)).getURI();return (k.createElement(p,null,k.createElement(q,null),k.createElement(q,null,da,k.createElement(r,{rel:"async",ajaxify:ea},ba._("Download")))));}});e.exports=ca;},null);
__d("MessagesViewer",["AsyncRequest","DOM","MessagesViewerSetID","PhotoStore","React","SpotlightMessagesViewer","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={bootstrapWithElem:function(o){n.bootstrapWithConfig({fbid:o.getAttribute('data-fbid'),dimensions:o.getAttribute('data-dimensions'),src:o.getAttribute('href'),endpoint:o.getAttribute('data-endpoint'),disablePaging:o.getAttribute('data-disablepaging')},o);},bootstrapWithConfig:function(o,p){var q=o.setID;if(!q)q=i.MESSAGES;var r=k.createElement(l,{dimensions:[o.dimensions],disablepaging:o.disablePaging,disableForward:o.disableForward,open:true,photoid:o.fbid,reverse:false,rootClassName:o.rootClassName,setid:q,snapToPhoto:o.snapToPhoto,thumbsrc:o.src});n.render(r);if(!j.hasBeenCreated(q)&&o.endpoint){var s=new g(o.endpoint);if(p)s.setRelativeTo(p);s.send();}},render:function(o){var p=m('messages_viewer');if(!p){p=h.create('div',{id:'messages_viewer'});document.body.appendChild(p);}o=k.render(o,p);o.subscribeOnce('close',function(){k.unmountComponentAtNode(p);});}};e.exports=n;},null);
__d("XMessagingVideoAttachmentController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/mercury\/attachments\/video\/",{video_id:{type:"String",required:true},video_container_id:{type:"String",required:true},width:{type:"Int",required:true},height:{type:"Int",required:true}});},null);
__d("MessagingVideoViewer.react",["ActorURI","ArbiterMixin","AsyncRequest","MercuryConfig","MessagingForwardAttachmentDialog.react","React","ReactLayeredComponentMixin","SpotlightViewer","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewport","PageTransitions","PhotoViewerDimensions","XMessagingVideoAttachmentController","Vector","cx","fbt","guid"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=l,ba=aa.PropTypes,ca=200,da=l.createClass({displayName:"MessagingVideoViewer",propTypes:{disableForward:ba.bool,pageID:ba.number,rootClassName:ba.string,videoSize:ba.instanceOf(w).isRequired,videoID:ba.string.isRequired,videoURI:ba.string.isRequired},mixins:[h,m],getInitialState:function(){var ea=new u({verticalPadding:ca});return {dimensions:ea.getStageDimensions(this.props.videoSize),loading:true,open:true,showForward:false};},componentWillMount:function(){this._domID=z();},componentDidMount:function(){this._loadVideoPlayer();t.registerCompletionCallback(function(){this.close();return true;}.bind(this));},_loadVideoPlayer:function(){var ea=v.getURIBuilder().setString('video_id',this.props.videoID).setString('video_container_id',this._domID).setInt('width',this.state.dimensions.x).setInt('height',this.state.dimensions.y).getURI();if(this.props.pageID)ea=g.create(ea,this.props.pageID);this.request=new i().setMethod('GET').setURI(ea).setReadOnly(true).setHandler(function(fa){return this.setState({loading:false});}.bind(this)).send();},close:function(){if(!this.state.open)return;this.setState({open:false},function(){this.inform('close');});},_showForwardDialog:function(){this.setState({showForward:true});},_hideForwardDialog:function(){this.setState({showForward:false});},renderLayers:function(){var ea=(y._("Forward in separate messages"));return {forwardDialog:(l.createElement(k,{attachmentID:this.props.videoID,onClose:this._hideForwardDialog,shown:this.state.showForward,title:ea}))};},render:function(){var ea=l.createElement("div",{className:"rfloat",id:this._domID}),fa=j.ForwardingEnabled&&!this.props.disableForward?l.createElement(q,{onClick:this._showForwardDialog},y._("Forward")):null;return (l.createElement(n,{onHide:this.close,open:this.state.open,rootClassName:this.props.rootClassName},l.createElement(s,{className:"_39hc",media:ea,showLoadingIndicator:this.state.loading,stageDimensions:this.state.dimensions},l.createElement(r,{onClick:this.close}),l.createElement(o,{className:"stat_elem"},l.createElement(p,null),l.createElement(p,null,fa,l.createElement(q,{href:this.props.videoURI},y._("Download")))))));}});e.exports=da;},null);
__d("MercuryAttachmentVideo.react",["ChatImageArrowDirection","ChatImageWithArrow.react","CenteredContainer.react","FBOverlayBase.react","FBOverlayContainer.react","FBOverlayElement.react","Image.react","MercuryConfig","MessagesViewer","MessagingVideoViewer.react","React","Vector","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=q,v=u.PropTypes,w=q.createClass({displayName:"MercuryAttachmentVideo",propTypes:{duration:v.number.isRequired,isChat:v.bool,isInbound:v.bool,name:v.string.isRequired,pageID:v.number,thumbSize:v.shape({height:v.number,width:v.number}).isRequired,thumbnail:v.string.isRequired,videoSize:v.shape({height:v.number,width:v.number}).isRequired,videoID:v.string.isRequired,videoURI:v.string.isRequired},_formatDuration:function(){var x=this.props.duration,y=Math.floor(x/60),z=x%60;if(z<10)return y+':0'+z;return y+':'+z;},openViewer:function(){var x=new r(this.props.videoSize.width,this.props.videoSize.height);o.render(q.createElement(p,{pageID:this.props.pageID,videoID:this.props.videoID,videoSize:x,videoURI:this.props.videoURI}));},_renderImage:function(){if(this.useImageBubbles){return (q.createElement(h,{arrowDirection:this.props.isInbound?g.LEFT:g.RIGHT,height:this.props.thumbSize.height,source:this.props.thumbnail,width:this.props.thumbSize.width}));}else return (q.createElement(m,{height:this.props.thumbSize.height,width:this.props.thumbSize.width,src:this.props.thumbnail}));},_getStyle:function(){if(this.useImageBubbles)return {};return this.props.thumbSize;},render:function(){this.useImageBubbles=n.MercuryImageBubblesGK&&this.props.isChat;var x=(("_zow")+(' '+"_59go")+(this.useImageBubbles?' '+"_3ds5":''));return (q.createElement(k,{className:x,onClick:this.openViewer,style:this._getStyle()},q.createElement(j,null,this._renderImage()),q.createElement(l,null,q.createElement("div",{className:((!this.useImageBubbles?"_zox":''))},q.createElement("span",{className:"_zoz"},this._formatDuration()))),q.createElement(l,null,q.createElement(i,{vertical:true},q.createElement(m,{src:t('/images/chat/chat_play_icon.png')})))));}});e.exports=w;},null);
__d("SyncRequestTitle.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestTitle",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("Waiting for {receiver} to accept your invite to play {app_name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app_name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("{sender} wants to play {app_name} with you, right now.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app_name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestAcceptedMessage.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestAcceptedMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("{receiver} accepted your invite to play {app name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("You accepted an invite from {sender} to play {app name}.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestRejectedMessage.react",["AsyncRequest","Link.react","React","URI","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=i,n=m.PropTypes,o=i.createClass({displayName:"SyncRequestRejectedMessage",propTypes:{requestId:n.string.isRequired,app:n.object.isRequired,isSender:n.bool.isRequired,receiver:n.object.isRequired,sender:n.object.isRequired},render:function(){if(this.props.isSender){return (i.createElement("div",null,l._("{receiver} declined your invite to play {app_name}.",[l.param("receiver",i.createElement("span",{className:"_dg4"},this.props.receiver.name)),l.param("app_name",i.createElement("span",{className:"_dg5"},this.props.app.name))])));}else return (i.createElement("div",null,l._("You declined an invite from {sender} to play {app_name}.",[l.param("sender",i.createElement("span",{className:"_dg4"},this.props.sender.name)),l.param("app_name",i.createElement("span",{className:"_dg5"},this.props.app.name))]),i.createElement("div",{className:"_13n7"},i.createElement("div",null,i.createElement(h,{onClick:this._submitBlockApp},l._("Block {app}",[l.param("app",this.props.app.name)]))),i.createElement("div",null,i.createElement(h,{onClick:this._submitBlockUser},l._("Block requests from {sender}",[l.param("sender",this.props.sender.name)]))))));},_submitBlockApp:function(){var p=new j('/games/block_app/'),q=new g().setURI(p);q.setData({app_id:this.props.app.id,source:'sync_request'});q.send();},_submitBlockUser:function(){var p=new j('/games/block_user/'),q=new g().setURI(p);q.setData({app_id:this.props.app.id,blockee_uid:this.props.sender.id});q.send();}});e.exports=o;},null);
__d("SyncRequestExpiredMessage.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestExpiredMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("{receiver} missed your invite to play {app name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("You missed an invite from {sender} to play {app name}.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestCanceledMessage.react",["React","cx","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestCanceledMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,i._("You canceled an invite to {receiver} to play {app name}.",[i.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),i.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,i._("{sender} canceled an invitation to play {app name}.",[i.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),i.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestTimer.react",["React","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g,j=i.PropTypes;function k(m){if(m){m=Math.ceil(m);var n=m%60;if(n<10)n='0'+n;var o=Math.floor(m/60);return o+':'+n;}else return "0:00";}var l=g.createClass({displayName:"SyncRequestTimer",propTypes:{timeRemaining:j.number.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("({time_remaining} remaining)",[h.param("time_remaining",k(this.props.timeRemaining))])));}else return (g.createElement("div",null,h._("You have {time_remaining} to accept.",[h.param("time_remaining",k(this.props.timeRemaining))])));}});e.exports=l;},null);
__d("XSyncRequestSubmitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/platform\/games\/sync_requests\/submit\/",{request_id:{type:"Int",required:true},sender:{type:"Int",required:true},action:{type:"Int",required:true}});},null);
__d("SyncRequest.react",["Arbiter","AsyncRequest","ChannelConstants","React","SyncRequestStatusEnum","SyncRequestTitle.react","SyncRequestAcceptedMessage.react","SyncRequestRejectedMessage.react","SyncRequestExpiredMessage.react","SyncRequestCanceledMessage.react","SyncRequestTimer.react","XUIButton.react","XSyncRequestSubmitController","cx","fbt","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=j,x=w.PropTypes,y=j.createClass({displayName:"SyncRequest",propTypes:{app:x.object.isRequired,creationTime:x.number.isRequired,requestId:x.string.isRequired,receiver:x.object.isRequired,sender:x.object.isRequired,status:x.oneOf(v(k)).isRequired,timeout:x.number.isRequired,timeRemaining:x.number.isRequired,viewerId:x.number.isRequired,onStatusUpdate:x.func},componentWillMount:function(){if(this.props.status===k.PENDING){var z=g.subscribe(i.getArbiterType('sync_request_updated'),function(ca,da){da=da.obj;if(da.id.toString()!==this.props.requestId)return;this.setState({status:da.status});}.bind(this));this.setState({statusEvent:z});}var aa=null;if(this.props.status===k.PENDING){var ba=function(){this.setState({time_remaining:(this.state.time_remaining-1)});if(this.state.time_remaining<=0){clearInterval(this.state.counter);var ca={counter:null,time_remaining:0};if(this.state.status===k.PENDING)ca.status=k.EXPIRED;this.setState(ca);}};aa=setInterval(ba.bind(this),1000);}this.setState({time_remaining:this.props.timeRemaining,counter:aa});},componentWillUnmount:function(){if(this.state.counter)clearInterval(this.state.counter);g.unsubscribe(this.state.statusEvent);},getInitialState:function(){return {buttonsDisabled:false,time:Date.now(),status:this.props.status,viewerIsSender:this.props.viewerId===this.props.sender.id};},componentDidUpdate:function(z,aa){if(this.props.status!=k.PENDING)this.state.status=this.props.status;if(this.props.onStatusUpdate)this.props.onStatusUpdate(this.state.status,aa.status);},render:function(){var z;switch(this.state.status){case k.PENDING:var aa;if(!this.state.viewerIsSender){aa=[j.createElement(r,{use:"confirm",onClick:this._handleAccept,disabled:this.state.buttonsDisabled,label:u._("Accept")}),j.createElement(r,{use:"default",onClick:this._handleReject,disabled:this.state.buttonsDisabled,label:u._("Decline")})];}else aa=j.createElement(r,{use:"default",onClick:this._handleCancel,disabled:this.state.buttonsDisabled,label:u._("Cancel")});z=(j.createElement("div",null,j.createElement("div",{className:"_372m"},j.createElement(l,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name})),j.createElement("div",{className:"_372n"},j.createElement(q,{isSender:this.state.viewerIsSender,timeRemaining:this.state.time_remaining,receiverName:this.props.receiver.name})),j.createElement("div",{className:"_372o"},aa)));break;case k.ACCEPTED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(m,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case k.REJECTED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(n,{requestId:this.props.requestId,app:this.props.app,isSender:this.state.viewerIsSender,receiver:this.props.receiver,sender:this.props.sender}));break;case k.EXPIRED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(o,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case k.CANCELED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(p,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;default:throw new Error('The request status `%s` is unknown.',this.state.status);}return (j.createElement("div",{className:"_372q"},z));},_handleAccept:function(){this._handleStatusUpdate(k.ACCEPTED);var z=window.open(this.props.app.uri);if(z)z.focus();},_handleReject:function(){this._handleStatusUpdate(k.REJECTED);},_handleCancel:function(){this._handleStatusUpdate(k.CANCELED);},_handleStatusUpdate:function(z){this.setState({status:z,buttonsDisabled:true});var aa=s.getURIBuilder().setInt('request_id',this.props.requestId).setInt('sender',this.props.sender.id).setInt('action',z).getURI();new h().setURI(aa).setHandler(function(ba){this.setState({status:z});}.bind(this)).setErrorHandler(function(ba){this.setState({buttonsDisabled:false});}.bind(this)).send();}});e.exports=y;},null);
__d("Tooltip.react",["React","TooltipMixin"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g,j=i.PropTypes,k=g.createClass({displayName:"Tooltip",propTypes:{display:j.oneOf(['inline','block'])},getDefaultProps:function(){return {display:'inline'};},mixins:[h],render:function(){if(this.props.display==='block')return (g.createElement("div",g.__spread({},this.props),this.props.children));return g.createElement("span",g.__spread({},this.props),this.props.children);}});e.exports=k;},null);
__d("WebMessengerEvents",["Arbiter","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h(new g(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},stickerClicked:function(j,k){this.inform(i.STICKER_CLICKED,{packID:j,stickerID:k});},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});e.exports=i;},null);
__d("WebMessengerSubscriptionsHandler",["SubscriptionsHandler"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=new g('webmessenger');e.exports=h;},null);
__d("isWebMessengerURI",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){return (/^(\/messages)/).test(h.getPath());}e.exports=g;},null);
__d("WebMessengerWidthControl",["Arbiter","CSS","CSSClassTransition","DOM","DOMDimensions","Event","Style","URI","ViewportBounds","WebMessengerEvents","WebMessengerSubscriptionsHandler","$","cx","csx","isWebMessengerURI","requestAnimationFrame","setTimeoutAcrossTransitions","shield","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=205,aa=981,ba=257,ca=18,da=848,ea=724,fa=.57,ga=56,ha,ia,ja;function ka(pa,qa,ra){this.masterChanged=pa;this.detailChaned=qa;q.addSubscriptions(l.listen(window,'resize',y(x(la,this,this),100)),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],x(la,this,this),g.SUBSCRIBE_NEW));var sa=oa()?ga:0;if(ra)sa=z;this._width=oa()?0:da;ja=true;la(this,sa);}function la(pa,qa){var ra=o.getRight()+o.getLeft();ra=ra||qa||0;var sa=k.getViewportWithoutScrollbarDimensions().width-ra,ta=Math.round(Math.max(0,sa/2-aa/2));sa=aa+ta-ba;sa-=ca;sa=Math.max(ea,Math.min(da,sa));if(!isNaN(sa)&&pa._width!==sa){pa._width=sa;var ua=Math.round(sa/(1+fa)),va=sa-ua;pa.masterChanged(va);pa.detailChaned(ua);if(oa()){var wa=sa+ba;ma(function(){if(ia){document.body.className=ia;ia='';}na(wa+'px');h.removeClass(document.body,"_5uj5");ja&&p.detailDOMChanged();ja=false;},ia);}}}function ma(pa,qa){qa&&h.addClass(document.documentElement,"_5uj6");v(pa);qa&&w(h.removeClass.bind(null,document.documentElement,"_5uj6"),1000);}function na(pa){m.set(j.find(document,"div._uaw"),'width',pa);m.set(r('globalContainer'),'width',pa);}function oa(){if(!ha)ha=h.hasClass(document.body,"_6nw");return ha;}i.registerHandler(function(pa,qa,ra,sa){function ta(ua){return oa()&&u(n(ua));}if(ta(sa)){ia=qa;return true;}else if(ta(ra)){ma(function(){pa.className=qa;na('');},true);return true;}});e.exports=ka;},null);
__d("Dock",["Event","shield","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Scroll","Style","Toggler","Vector","copyProperties","csx","emptyFunction","WebMessengerWidthControl"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();b('WebMessengerWidthControl');function w(){}t(w,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(x){this.init=v;this.rootEl=x;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(x,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));r.subscribe(['show','hide'],function(y,z){var aa=z.getActive();if(!n.contains(x,aa))return;if(l.hasClass(aa,'fbNub')){this.notifyNub(aa,y);if(y==='show')this._resizeNubFlyout(aa);}else{var ba=o.byClass(aa,'fbNubFlyout');if(ba)l.conditionClass(ba,'menuOpened',y==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=s.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+s.getElementDimensions(this.rootEl).y;var x=n.scry(document,"div._4f7n")[0];if(x){var y=q.isFixed(x)?'viewport':'document';this.flyoutHeightOffset+=s.getElementPosition(x,y).y+s.getElementDimensions(x).y;}},toggle:function(x){var y=this._findFlyout(x);if(!y)return;this.subscribe('init',function(){r.toggle(x);});},show:function(x){this.subscribe('init',function(){r.show(x);});},showNub:function(x){l.show(x);},hide:function(x){this.subscribe('init',function(){var y=r.getInstance(x);n.contains(x,y.getActive())&&y.hide();});},hideNub:function(x){l.hide(x);this.hide(x);},setUseMaxHeight:function(x,y){l.conditionClass(x,'maxHeight',y!==false);this._resizeNubFlyout(x);},_resizeNubFlyout:function(x){var y=this._findFlyout(x);if(!y||!(l.hasClass(x,'openToggler')||l.hasClass(x,'opened')))return;var z=n.find(y,'div.fbNubFlyoutOuter'),aa=n.find(z,'div.fbNubFlyoutInner'),ba=n.find(aa,'div.fbNubFlyoutBody'),ca=p.getTop(ba),da=ba.offsetHeight;q.set(ba,'height','auto');var ea=s.getElementDimensions(y),fa=s.getElementDimensions(ba),ga=this.getMaxFlyoutHeight(x);q.set(y,'max-height',ga+'px');q.set(z,'max-height',ga+'px');ea=s.getElementDimensions(y);var ha=s.getElementDimensions(aa),ia=ha.y-fa.y,ja=ea.y-ia,ka=parseInt(ba.style.height||ba.clientHeight,10),la=ja!==ka;if(ea.y>ia&&la)q.set(ba,'height',ja+'px');l.removeClass(y,'swapDirection');var ma=s.getElementPosition(y).x;l.conditionClass(y,'swapDirection',function(){if(ma<0)return true;return (ma+ea.x>this.viewportDimensions.x);}.bind(this)());if(la&&ca+da>=fa.y){p.setTop(ba,ba.scrollHeight);}else p.setTop(ba,ca);this.notifyNub(x,'resize');},getMaxFlyoutHeight:function(x){var y=this._findFlyout(x),z=s.getElementPosition(y,'viewport'),aa=s.getElementDimensions(y),ba=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-z.y-aa.y);return Math.max(ba,0);},resizeAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this._resizeNubFlyout(x[y]);},hideAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this.hide(x[y]);},_getAllNubs:function(){var x=n.scry(this.rootEl,"div._50-v.openToggler");return x.concat(n.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var x=event.getTarget(),y=o.byClass(x,'fbNub');if(y){if(o.byClass(x,'fbNubFlyoutTitlebar')){var z=o.byTag(x,'a'),aa=x.nodeName=='INPUT'&&x.getAttribute('type')=='submit';if(!z&&!aa){this.hide(y);return false;}}this.notifyNub(y,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(x){return l.hasClass(x,'fbNubFlyout')?x:n.scry(x,'div.fbNubFlyout')[0]||null;},registerNubController:function(x,y){m.set(x,'dock:nub:controller',y);y.subscribe('nub/button/content-changed',h(this.inform,this,'resize',x));y.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,x));},unregisterNubController:function(x){m.remove(x,'dock:nub:controller');},notifyNub:function(x,y,z){var aa=m.get(x,'dock:nub:controller');aa&&aa.inform(y,z);}});e.exports=a.Dock||w;},null);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;},null);
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;},null);
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this._form=k;}j.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};j.prototype._submit=function(){"use strict";i(this._form.getRoot());};h(j.prototype,{_listener:null});e.exports=j;},null);
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=x(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(ea,fa,ga,ha){"use strict";this.$MercuryFileUploader0=ea;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.$MercuryFileUploader9={};this.updateElements(fa,ga,ha);}ca.prototype.updateElements=function(ea,fa,ga){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploadera=new t();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.$MercuryFileUploaderb=new l(ea,[o,m]);this.$MercuryFileUploaderb.setAllowCrossOrigin(true);this.$MercuryFileUploaderb.setUploadInParallel(true);var ha=j.find(ea,"._4q60"),ia=j.find(ha,"._4q61");new n(ha,ia,fa);this.$MercuryFileUploadera.addSubscriptions(this.$MercuryFileUploaderb.subscribe('submit',function(){var ja={count:0,file_sizes:[]};if(fa.files){for(var ka=0;ka<fa.files.length;ka++)if(fa.files[ka].size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var la={};for(var ma=0;ma<fa.files.length;ma++){var na=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(na,fa.files[ma].name);ja.count++;ja.file_sizes.push(fa.files[ma].size);la[na]=fa.files[ma];}this.$MercuryFileUploaderb.setFiles(la);}else{ga.value=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga.value,fa.value);ja.count=1;}this.inform('submit',ja);}.bind(this)),this.$MercuryFileUploaderb.subscribe('success',this.$MercuryFileUploadere.bind(this)),this.$MercuryFileUploaderb.subscribe('failure',this.$MercuryFileUploaderf.bind(this)),k.listen(ia,'click',y(this.inform,this,'open')));};ca.prototype.showAttachmentSizeErrorDialog=function(){"use strict";this.$MercuryFileUploaderb.abort();this.$MercuryFileUploaderb.clear();new i().setTitle(v._("The file you have selected is too large")).setBody(v._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(i.OK).setSemiModal(true).show();};ca.prototype.addDroppedFiles=function(ea){"use strict";if(!this.$MercuryFileUploaderb||!this.$MercuryFileUploaderb.canUseXHR())return;var fa={},ga={count:0,file_sizes:[]};for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia.size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var ja=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ja,ia.name);fa[ja]=ia;ga.file_sizes.push(ia.size);ga.count++;}this.$MercuryFileUploaderb.setFiles(fa);this.$MercuryFileUploaderb.forceSendViaXHR();this.inform('submit',ga);};ca.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader7).length;};ca.prototype.addCachedAttachments=function(ea){"use strict";ea.forEach(function(fa){var ga=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga,fa.filename);this.$MercuryFileUploaderg(ga,fa);}.bind(this));};ca.prototype.addCachedImageFiles=function(ea){"use strict";var fa=v._("Photo");ea.forEach(function(ga){var ha=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ha,fa);this.$MercuryFileUploaderg(ha,{filename:ga,image_id:ga,filetype:'image/jpeg'});}.bind(this));};ca.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ca.prototype.getImageFiles=function(){"use strict";var ea=Object.keys(this.$MercuryFileUploader2).sort(),fa=[];ea.forEach(function(ga){return fa.push(this.$MercuryFileUploader2[ga]);}.bind(this));return fa;};ca.prototype.getAnimatedImageFiles=function(){"use strict";return w(this.$MercuryFileUploader3);};ca.prototype.getVideoFiles=function(){"use strict";return w(this.$MercuryFileUploader4);};ca.prototype.getAudioFiles=function(){"use strict";return w(this.$MercuryFileUploader5);};ca.prototype.getFiles=function(){"use strict";return w(this.$MercuryFileUploader6);};ca.prototype.removeAttachments=function(){"use strict";j.empty(this.$MercuryFileUploader0);this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader8={};this.$MercuryFileUploader7={};this.$MercuryFileUploader9={};h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.destroy=function(){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.removeAttachments();};ca.prototype.$MercuryFileUploaderd=function(ea,fa){"use strict";var ga=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader8[ea]=ga;this.$MercuryFileUploader7[ea]=true;this.$MercuryFileUploader9[ea]=Date.now();j.appendContent(ga.getNode('iconText'),da(fa));k.listen(ga.getNode('closeFileUpload'),'click',this.$MercuryFileUploaderh.bind(this,ea));j.appendContent(this.$MercuryFileUploader0,ga.getRoot());h.show(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.$MercuryFileUploaderh=function(ea,event){"use strict";if(this.$MercuryFileUploader7[ea]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ea]||this.$MercuryFileUploader2[ea]||this.$MercuryFileUploader3[ea]||this.$MercuryFileUploader4[ea]||this.$MercuryFileUploader5[ea]||this.$MercuryFileUploader6[ea])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ea];delete this.$MercuryFileUploader2[ea];delete this.$MercuryFileUploader3[ea];delete this.$MercuryFileUploader4[ea];delete this.$MercuryFileUploader5[ea];delete this.$MercuryFileUploader6[ea];delete this.$MercuryFileUploader7[ea];delete this.$MercuryFileUploader9[ea];var fa=this.$MercuryFileUploader8[ea];delete this.$MercuryFileUploader8[ea];if(fa){j.remove(fa.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ca.prototype.$MercuryFileUploaderi=function(ea,fa){"use strict";var ga=this.$MercuryFileUploader8[ea],ha=p.getAttachIconClassByMime(fa);h.addClass(ga.getNode('iconText'),ha);h.addClass(ga.getRoot(),'done');};ca.prototype.$MercuryFileUploaderg=function(ea,fa){"use strict";if(this.$MercuryFileUploader7[ea]){delete this.$MercuryFileUploader7[ea];if(fa.image_id){this.$MercuryFileUploader2[ea]=fa.image_id;}else if(fa.gif_id){this.$MercuryFileUploader3[ea]=fa.gif_id;}else if(fa.video_id){this.$MercuryFileUploader4[ea]=fa.video_id;}else if(fa.audio_id){this.$MercuryFileUploader5[ea]=fa.audio_id;}else if(fa.file_id){this.$MercuryFileUploader6[ea]=fa.file_id;}else this.$MercuryFileUploader1[ea]=fa;this.$MercuryFileUploaderi(ea,fa.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader9[ea]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ca.prototype.$MercuryFileUploadere=function(event,ea){"use strict";var fa=ea.response.getPayload();this.$MercuryFileUploaderg(this.$MercuryFileUploaderj(ea),fa.metadata[0]);};ca.prototype.$MercuryFileUploaderf=function(event,ea){"use strict";this.inform('one-upload-failed');this.$MercuryFileUploaderh(this.$MercuryFileUploaderj(ea),event);};ca.prototype.$MercuryFileUploaderc=function(){"use strict";return 'upload_'+s.getNewID();};ca.prototype.$MercuryFileUploaderj=function(ea){"use strict";var fa=ea.response.getPayload();if(ea.upload){return ea.upload.getName();}else return fa.uploadID;};function da(ea){if(ea&&ea.startsWith('C:\\fakepath\\'))return ea.substring(12);return ea;}e.exports=ca;},null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Event","Form","URLScraper","WebMessengerEvents","mixin","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=o(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v,w,x,y){"use strict";this.$MercuryShareLinkUploader0=u;this.$MercuryShareLinkUploader1=v;this.$MercuryShareLinkUploader2=w;this.$MercuryShareLinkUploader3=y;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;k.listen(x,'click',this.close.bind(this));k.listen(y,'keyup',function(){!y.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new m(y);this.$MercuryShareLinkUploader7.subscribe('match',function(z,aa){this.loadShare(aa&&aa.url);}.bind(this));}t.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};t.prototype.getShareDataFromStage=function(u,v){"use strict";var w=l.serialize(v),x=w.attachment&&w.attachment.params;if(!x)return null;if(x instanceof Object){var y=[];y.push(x[0]);y.push(x[1]);x=y;}return {params:x,type:w.attachment.type};};t.prototype.loadAttachData=function(u,v,w,x){"use strict";if(u){var y=l.serialize(v),z=y.attachment&&y.attachment.params,aa=y.link_metrics?y.link_metrics.no_image:true;if(!z||p(z))return null;var ba=x?x():w.value;if(ba.indexOf(z.url)===-1)return y;if(!z.summary&&!z.favicon&&aa&&z.title&&z.url&&z.url.substr(0,z.title.length)===z.title)return null;return y;}return null;};t.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};t.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};t.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};t.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};t.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};t.prototype.loadShare=function(u){"use strict";this.$MercuryShareLinkUploader5=u;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,u)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};t.prototype.$MercuryShareLinkUploader9=function(u,v){"use strict";if(this.$MercuryShareLinkUploader5!==u)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,v.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}n.detailDOMChanged();};t.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();n.detailDOMChanged();};e.exports=t;},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} messaged {groupName}",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} messaged you",[j.param("name",s.short_name)]));});}else o(j._("New message!"));});});}e.exports={renderDocumentTitle:m};},null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;},null);
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryThreadInformer').get(),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)k.doSync();}}var t={blink:function(x,y){if(!o&&p<y)j.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=k.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}k.registerStateStorer(w);k.registerStateLoader(v);l.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=k.getInitial();if(x)p=u(x)||0;})();e.exports=t;},null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","isFacebookURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=null,o={init:function(s){if(!n)h.init(s);},play:function(s,t,u){if(n){i.playRemote(n.contentWindow,s,t,false);}else i.playLocal(s,t,u);},stop:function(s){if(!n)h.stop(s);}},p=new k(location.href);if(p.getSubdomain()&&p.getSubdomain()!=='www')p.setSubdomain('www');var q=p.getDomain();function r(){if(l.ie()<9)return false;if(g.RPC_DISABLED)return false;return j.isSupported()&&i.supportsRPC();}if(m(p)&&location.host!==q&&r()){n=document.createElement('iframe');n.setAttribute('src','//'+q+'/sound_iframe.php');n.style.display='none';document.body.appendChild(n);}e.exports=o;},null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryThreadInfo","MercuryViewer","MessagingTag","Sound","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=b('MercuryThreads').get();o.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))o.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(m.isViewer(t.author)||!t.is_unread||(t.folder!=n.INBOX&&t.folder!=n.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}q.getThreadMeta(u,function(x){var y=l.isMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=p(s,g);},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={init:function(){g.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(i,j,k){var l=k.getInstance();i.subscribe(i.SEND,function(){j.logSavedSummaries(l);});});}};e.exports=h;},null);
__d("FBRTCAvailability",["ChannelConstants","PresenceStatus","RTCConfig"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={isCallable:function(k){var l=h.getCapabilities(k),m=g.CAPABILITY_VOIP_INTEROP|g.CAPABILITY_VIDEO;return !!(l&m);},isMDotComCallable:function(k){if(i.MobileFriendsCallableGk)return this.isCallable(k.fbid)||!!(k.is_friend&&k.is_messenger_user);return this.isCallable(k.fbid);}};e.exports=j;},null);
__d("FBRTCStruct",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=function(i,j,k){var l,m;if(typeof i=='string'||i instanceof String){m=i;l=i;}else for(var n in i)if(i.hasOwnProperty(n))if(n==='index'){k=i[n];}else{m=n;l=i[n];}j[m]=k;j.strNames[k]=l;};function h(i){"use strict";this.strNames=[];for(var j=0;j<i.length;j++)g(i[j],this,j);}e.exports=h;},null);
__d("FBRTCConstants",["FBRTCStruct"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',SDP_UPDATE:'sdp_update',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video',VIDEO_REQUEST:'video_request',ACK:'ack'},i=new g([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),j={TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,START_CALL:9},k={PayloadType:h,CallEndReason:i,UIEventType:j,endCallReasonFromString:function(l){return i.strNames.indexOf(l);},callEndReasonString:function(l){if(l<0||l>i.strNames.length)return 'Unknown';return i.strNames[l];},fullCallEndReasonString:function(l,m){return this.callEndReasonString(l)+'_'+(m?'remote':'local');}};e.exports=k;},null);
__d("FBRTCIceStatsParser",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=null;h.getInstance=function(){"use strict";if(!g)g=new h();return g;};function h(){"use strict";}h.prototype.extractIceInfo=function(i){"use strict";var j=[],k=i.split("\r\n");for(var l=0;l<k.length;l++){var m=k[l];if(this.$FBRTCIceStatsParser0(m))j.push({gen:this.$FBRTCIceStatsParser1(m),type:this.$FBRTCIceStatsParser2(m)});}return j;};h.prototype.$FBRTCIceStatsParser0=function(i){"use strict";return (i.indexOf('candidate:')>-1);};h.prototype.$FBRTCIceStatsParser1=function(i){"use strict";var j=0,k=i.match(/generation (\d+)/);if(k)j=parseInt(k[1],10);return j;};h.prototype.$FBRTCIceStatsParser2=function(i){"use strict";var j=i.match(/typ (host|relay|srflx|prflx)/);if(j){return j[1];}else return 'unknown';};e.exports=h;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed',TOGGLE_SCREEN_SHARING:'toggle_screen_sharing',SCREEN_SHARING_ENABLED:'screen_sharing_status'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};e.exports=ha;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","copyProperties","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=5*60*1000,n={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};o.CURRENT_SUMMARY_VERSION=10;function o(p){"use strict";this.peerID=p.peerID;this.callID=p.callID;this.$FBRTCCallSummary0=p.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=l();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=this.$FBRTCCallSummaryg;this.$FBRTCCallSummaryk=0;this.$FBRTCCallSummaryl={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummarym());this.$FBRTCCallSummaryn();this.$FBRTCCallSummaryo=h.getInstance();this.$FBRTCCallSummaryp=i.getInstance();}o.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:o.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryk,extraInfo:this.$FBRTCCallSummaryl,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryq()});};o.fromJsonString=function(p){"use strict";var q;try{q=JSON.parse(p);}catch(r){return null;}if(q.version!==o.CURRENT_SUMMARY_VERSION)return null;if(!q.hasOwnProperty('peerID')||!q.hasOwnProperty('callID')||!q.hasOwnProperty('isCaller')||!q.hasOwnProperty('startTime')||!q.hasOwnProperty('trigger')||!q.hasOwnProperty('signalingTime')||!q.hasOwnProperty('endCallReason')||!q.hasOwnProperty('isRemoteEnded')||!q.hasOwnProperty('lastUpdatedTime')||!q.hasOwnProperty('lastSerializedTime'))return null;var s=new o({peerID:q.peerID,callID:q.callID,isCaller:q.isCaller});s.$FBRTCCallSummary1=q.startTime;s.$FBRTCCallSummary2=q.trigger;s.$FBRTCCallSummary3=q.signalingTime;s.$FBRTCCallSummary4=q.endCallReason;s.$FBRTCCallSummary5=q.endCallSubreason;s.$FBRTCCallSummary6=q.isRemoteEnded;s.$FBRTCCallSummary7=q.lastUpdatedTime;s.$FBRTCCallSummary8=q.lastSerializedTime;if(q.unsetOnRetrieve)s.$FBRTCCallSummary9=q.unsetOnRetrieve;if(q.openCount)s.$FBRTCCallSummaryk=q.openCount;if(q.extraInfo)s.$FBRTCCallSummaryl=q.extraInfo;if(q.pcStats)s.$FBRTCCallSummarya=q.pcStats;if(q.captureStats)s.$FBRTCCallSummaryb=q.captureStats;if(q.gen0IceSentCount)s.$FBRTCCallSummaryc=q.gen0IceSentCount;if(q.gen0IceReceivedCount)s.$FBRTCCallSummaryd=q.gen0IceReceivedCount;if(q.iceSentCount)s.$FBRTCCallSummarye=q.iceSentCount;if(q.iceReceivedCount)s.$FBRTCCallSummaryf=q.iceReceivedCount;if(q.newSignalingTime)s.$FBRTCCallSummaryi=q.newSignalingTime;if(q.accumulatedCallTime)s.$FBRTCCallSummaryh=q.accumulatedCallTime;return s;};o.restoreOrInitialize=function(p,q,r,s,t){"use strict";var u=p.retrieveCallSummary(q,r);if(!u){u=new o({peerID:q,callID:r,isCaller:s});if(t){u.onFullMessageReceived({msg:t});u.onOfferAckSent(t);}else u.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(q,r,'Missing call summary from storage');}else if(u.$FBRTCCallSummary9){u.$FBRTCCallSummary4=null;u.$FBRTCCallSummary5=null;u.$FBRTCCallSummary6=null;delete u.$FBRTCCallSummary3[n.CALL_ENDED];delete u.$FBRTCCallSummaryi[n.CALL_ENDED];u.$FBRTCCallSummary9=null;}return u;};o.logSavedSummaries=function(p){"use strict";var q=p.getLoggableSummaries(),r=q.length;if(r<=0)return;var s=i.getInstance(),t=[];for(var u=0;u<r;u++){var v=q[u];s.logEndCallSummary(v);t.push({peerID:v.peerID,callID:v.callID});}p.removeCallSummaries(t);s.logToConsole('Logged pending summaries: '+r);};o.prototype.save=function(p){"use strict";var q=l(),r=q-this.$FBRTCCallSummaryj;if(r>m){this.$FBRTCCallSummaryp.logInfo(this.peerID,this.callID,'Summary too old: '+r);return;}p.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummaryj=q;};o.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};o.prototype.setLastUpdatedTime=function(p){"use strict";this.$FBRTCCallSummary7=p;};o.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryl;};o.prototype.addExtraInfo=function(p,q){"use strict";this.$FBRTCCallSummaryl[p]=q;this.$FBRTCCallSummaryn();};o.prototype.onCallStarted=function(p){"use strict";this.$FBRTCCallSummary2=p;this.$FBRTCCallSummaryr(n.CALL_STARTED);this.$FBRTCCallSummaryn();};o.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummaryr(n.POPUP_OPENED);this.$FBRTCCallSummaryk++;this.$FBRTCCallSummaryn();};o.prototype.setPcStats=function(p){"use strict";this.$FBRTCCallSummarya=p;this.$FBRTCCallSummaryn();};o.prototype.setVideoCaptureStats=function(p,q){"use strict";this.$FBRTCCallSummaryb={w:p,h:q};this.$FBRTCCallSummaryn();};o.prototype.onOfferAckSent=function(p){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:p.flag});};o.prototype.onMessageSent=function(p){"use strict";var q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummarys(q,n.SENT_OFFER,n.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummarys(q,n.SENT_ANSWER,n.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(q,n.SENT_OFFER_ACK,n.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(q,n.SENT_ANSWER_ACK,n.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummaryn();};o.prototype.$FBRTCCallSummaryt=function(p,q,r){"use strict";var s=null,t=null,u=this.$FBRTCCallSummaryo.extractIceInfo(p.sdp);for(var v=0;v<u.length;v++){s=u[v].gen;t=u[v].type;if(s===0)this.$FBRTCCallSummaryu(q,t);this.$FBRTCCallSummaryu(r,t);}};o.prototype.$FBRTCCallSummaryu=function(p,q){"use strict";if(!p[q]){p[q]=1;}else p[q]=p[q]+1;};o.prototype.$FBRTCCallSummaryv=function(p){"use strict";if(p.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};o.prototype.onFullMessageReceived=function(p){"use strict";var q=p.msg,r=q.flag===1;switch(q.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_OFFER,n.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_ANSWER,n.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummaryn();};o.prototype.onMsgAckReceived=function(p,q){"use strict";var r=p.msg.flag===1;if(q){this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);};o.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummaryr(n.NETWORK_READY);this.$FBRTCCallSummaryr(n.CALL_CONNECTED);this.$FBRTCCallSummaryn();};o.prototype.onCallEnded=function(p,q,r,s){"use strict";this.$FBRTCCallSummary9=r;this.$FBRTCCallSummary4=p;this.$FBRTCCallSummary5=s;this.$FBRTCCallSummary6=q;this.$FBRTCCallSummaryr(n.CALL_ENDED);this.$FBRTCCallSummaryn();};o.prototype.toString=function(){"use strict";var p={};p.core_metrics=this.$FBRTCCallSummaryw();p.time_series=null;return JSON.stringify(p);};o.prototype.$FBRTCCallSummaryw=function(){"use strict";var p={};p.ver=o.CURRENT_SUMMARY_VERSION;p.caller=this.$FBRTCCallSummary0;p.conn=this.$FBRTCCallSummaryx();p.peer_id=this.peerID;p.has_video=true;p.open_count=this.$FBRTCCallSummaryk;p.signaling=this.$FBRTCCallSummaryy();p.sender=this.$FBRTCCallSummaryz();p.receiver=this.$FBRTCCallSummaryA();p.end=this.$FBRTCCallSummaryB();p.video=this.$FBRTCCallSummaryC();return p;};o.prototype.$FBRTCCallSummaryx=function(){"use strict";var p={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)p.rtt=this.$FBRTCCallSummarya.sender.rtt;return p;};o.prototype.$FBRTCCallSummaryy=function(){"use strict";var p={};if(this.$FBRTCCallSummary2)p.trigger=this.$FBRTCCallSummary2;p.start_time=this.$FBRTCCallSummary1;p.time_from_start=this.$FBRTCCallSummary3;var q=this.$FBRTCCallSummary3[n.CALL_CONNECTED],r=this.$FBRTCCallSummary3[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummary8){r=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else r=this.$FBRTCCallSummaryD();var s=r-q;if(s>0)p.duration=s;}p.new_time_from_start=this.$FBRTCCallSummaryi;q=this.$FBRTCCallSummaryi[n.CALL_CONNECTED];r=this.$FBRTCCallSummaryi[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummaryh>0){r=this.$FBRTCCallSummaryh;}else r=this.$FBRTCCallSummaryq();s=r-q;if(s>0)p.new_duration=s;}return p;};o.prototype.$FBRTCCallSummaryz=function(){"use strict";var p={};if(this.$FBRTCCallSummaryc)p.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)p.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)k(p,this.$FBRTCCallSummarya.sender);return p;};o.prototype.$FBRTCCallSummaryA=function(){"use strict";var p={};if(this.$FBRTCCallSummaryd)p.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)p.ice=this.$FBRTCCallSummaryf;return p;};o.prototype.$FBRTCCallSummaryB=function(){"use strict";var p={};if(this.$FBRTCCallSummary4!==null){p.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)p.end_call_subreason_string=this.$FBRTCCallSummary5;p.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)k(p,this.$FBRTCCallSummarya.end);return p;};o.prototype.$FBRTCCallSummaryC=function(){"use strict";var p={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)k(p,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)k(p.capture,this.$FBRTCCallSummaryb);return {sender:p};};o.prototype.$FBRTCCallSummaryD=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};o.prototype.$FBRTCCallSummaryq=function(){"use strict";var p=l()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+p);};o.prototype.$FBRTCCallSummaryr=function(p){"use strict";if(this.$FBRTCCallSummary3[p])return;this.$FBRTCCallSummary3[p]=this.$FBRTCCallSummaryD();this.$FBRTCCallSummaryi[p]=this.$FBRTCCallSummaryq();};o.prototype.$FBRTCCallSummarys=function(p,q,r){"use strict";if(p){this.$FBRTCCallSummaryr(r);}else this.$FBRTCCallSummaryr(q);};o.prototype.$FBRTCCallSummaryn=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};o.prototype.$FBRTCCallSummarym=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=o;},null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k='localstorage',l='RTC_CALL_SUMMARY_',m='summary',n=2000,o=3,p=3*60*1000,q=null;r.getInstance=function(){"use strict";if(!q)q=new r();return q;};function r(){"use strict";this.$FBRTCCallSummaryStore0=new g(k,l);this.$FBRTCCallSummaryStore1=i.getInstance();}r.prototype.storeCallSummary=function(s,t,u){"use strict";var v=this;this.$FBRTCCallSummaryStore2(function(w){if(!w[s])w[s]={};var x=w[s][t];if(x){var y=v.$FBRTCCallSummaryStore3(x);if(y&&y.getLastUpdatedTime()>u.getLastUpdatedTime()){v.$FBRTCCallSummaryStore1.logToConsole('Outdated summaries');return null;}}w[s][t]=v.$FBRTCCallSummaryStore4(u);return w;},v.$FBRTCCallSummaryStore1.logError.bind(v.$FBRTCCallSummaryStore1,s,t));};r.prototype.retrieveCallSummary=function(s,t){"use strict";var u=this.$FBRTCCallSummaryStore5(),v=null;if(u[s])v=u[s][t];if(v){return this.$FBRTCCallSummaryStore3(v);}else return null;};r.prototype.removeCallSummary=function(s,t){"use strict";this.removeCallSummaries([{peerID:s,callID:t}]);};r.prototype.removeCallSummaries=function(s){"use strict";var t=this;this.$FBRTCCallSummaryStore2(function(u){var v=s.length;for(var w=0;w<v;w++){var x=s[w].peerID,y=s[w].callID;if(u[x]&&u[x][y]){delete u[x][y];if(t.$FBRTCCallSummaryStore6(u[x]))delete u[x];}}return u;},t.$FBRTCCallSummaryStore1.logError.bind(t.$FBRTCCallSummaryStore1,null,null));};r.prototype.getLoggableSummaries=function(){"use strict";var s=this.$FBRTCCallSummaryStore5(),t=[];for(var u in s)if(s.hasOwnProperty(u))for(var v in s[u])if(s[u].hasOwnProperty(v)){var w=this.$FBRTCCallSummaryStore3(s[u][v],p);if(w)t.push(w);}return t;};r.prototype.$FBRTCCallSummaryStore6=function(s){"use strict";for(var t in s)if(s.hasOwnProperty(t))return false;return true;};r.prototype.$FBRTCCallSummaryStore4=function(s){"use strict";var t={__t:Date.now(),__d:s.toJsonString()};return t;};r.prototype.$FBRTCCallSummaryStore3=function(s,t){"use strict";if(s)if(!t||(Date.now()-s.__t>=t))return h.fromJsonString(s.__d);return null;};r.prototype.$FBRTCCallSummaryStore5=function(){"use strict";var s=this.$FBRTCCallSummaryStore0.get(m)||{};return s;};r.prototype.$FBRTCCallSummaryStore2=function(s,t,u,v){"use strict";if(u===(void 0)||u===null)u=o;var w=this.$FBRTCCallSummaryStore5(),x=this.$FBRTCCallSummaryStore5(),y=s(w);if(y===null)return;var z=this.$FBRTCCallSummaryStore5();if(j(x,z)){this.$FBRTCCallSummaryStore0.set(m,y);this.$FBRTCCallSummaryStore1.logToConsole('Updated summaries');}else if(u>0){t('Retry lock');if(v){var aa=this;setTimeout(function(){aa.$FBRTCCallSummaryStore2(s,t,u-1,true);},n);}else this.$FBRTCCallSummaryStore2(s,t,u-1,true);}else t('Failed to lock');};e.exports=r;},null);
__d("FBRTCUtils",["emptyFunction","randomInt","AsyncRequest"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=6000,k={attachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=window.webkitURL.createObjectURL(m);}else{l.mozSrcObject=m;l.play();}},reattachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=m.src;}else{l.mozSrcObject=m.mozSrcObject;l.play();}},generateRandomInt:function(){return h(0,4294967294)+1;},aboutEqual:function(l,m){return (l-m)<.01&&(m-l)<.01;},sendServerRequest:function(l,m,n,o,p,q){m=m||g;n=n||g;o=o||false;p=p||j;q=q||{};var r=new i().setURI(l).setData(q).setAllowCrossPageTransition(true).setHandler(m).setErrorHandler(n).setTimeoutHandler(p,function(){n();});if(o)r.setOption('asynchronous',false);r.send();}};e.exports=k;},null);
__d("XVideoCallInitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("XVideoCallController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitController","XVideoCallController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=3,l=function(p,q,r,s){g.getInstance().logCallAction(p,q,g.CallAction.OLD_URI);return j.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();},m=function(p,q,r,s,t,u,v){if(v===(void 0)||v===null)v=k;var w=i.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();h.sendServerRequest(w,function(x){t(x.payload.uri);},function(x){if(v>0){m(p,q,r,s,t,u,v-1);}else t(l(p,q,r,s));});},n=function(p){window.history.replaceState({},'',p);},o={init:function(p){this._peerID=p;},onCallStarted:function(){n(l(this._peerID));},getCallUri:m};e.exports=o;},null);
__d("FBRTCCallUI",["BanzaiLogger","Cookie","UserAgent","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCUrlManager","pageID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q={openAsCaller:function(r,s,t,u){if(!p&&window.rtcCallChildWindow){p=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(r)){p.focus();return;}if(this._shouldCloseCallWindow())p.close();g.log('VideoCallLoggerConfig',{event:'open_as_caller'});m.getInstance().logCallAction(r,s,m.CallAction.START_CALL,null,t);var v=new j({peerID:r,callID:s,isCaller:true});v.onCallStarted(t);this._open(r,s,true,v,false,u);},openAsCallee:function(r,s,t,u,v){g.log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(r,s,false,t,u,v);},_shouldFocusCallWindow:function(r){return p&&!p.closed&&p.rtcCallInProgessWith===r;},_shouldCloseCallWindow:function(){return p&&!p.closed&&!p.rtcCallInProgessWith;},_open:function(r,s,t,u,v,w){h.clear('vcpwn');h.clear('vctid');var x=this._windowPosition(),y=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',x.height,x.width,x.top,x.left].join(',');if(this._isSparkBrowser())y='';u.addExtraInfo(m.Key.INITIATED_BY_PAGE_ID,o);u.onCallEnded(l.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');u.save(k.getInstance());g.log('VideoCallLoggerConfig',{event:'open_popup'});if(!v){p=window.open('','Video Call',y);this._setUri(p,r,s,t,w);}else{m.getInstance().logCallAction(r,s,m.CallAction.OPEN_POPUP);p=window.open(v,'Video Call',y);}if(window.focus)p.focus();},_setUri:function(r,s,t,u,v){n.getCallUri(s,t,u,v,function(w){m.getInstance().logCallAction(s,t,m.CallAction.OPEN_POPUP);r.location=w;},function(){m.getInstance().logCallAction(s,t,m.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var r=933,s=700,t,u,v,w;if(window.innerWidth!==(void 0)){u=window.innerWidth;t=window.innerHeight;}else{u=screen.width;t=screen.height;}if(window.screenLeft!==(void 0)){v=window.screenLeft;w=window.screenTop;}else{v=window.screenX;w=window.screenY;}var x=Math.floor(((u/2)-(r/2))+v),y=Math.floor(((t/2)-(s/2))+w);return {height:'height='+s.toString(),width:'width='+r.toString(),top:'top='+y.toString(),left:'left='+x.toString()};},_isSparkBrowser:function(){return i.isBrowser('Chrome < 34')&&i.isBrowser('Chrome > 33');}};e.exports=q;},null);
__d("XBrowserNotSupportedDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/browser_not_supported\/",{user_id:{type:"Int"},warning:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("FBRTCSoundController",["RTCConfig","Sound"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.ringtone_mp3_url,g.ringtone_ogg_url],j={playIncomingRingtone:function(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');h.play(i,n,m);},stopIncomingRingtone:function(){h.stop(i);}};e.exports=j;},null);
__d("FBRTCUnsupportedBrowserMessage",["AsyncDialog","AsyncRequest","XBrowserNotSupportedDialogController","FBRTCSoundController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={_dialog:null,warnForOutgoingCall:function(l){var m=i.getURIBuilder().setBool('warning',true).getURI();this._presentDialog(m,l);},showForOutgoingCall:function(){var l=i.getURIBuilder().getURI();this._presentDialog(l);},showForIncomingCall:function(l,m){j.playIncomingRingtone(l,m,false);var n=i.getURIBuilder().setInt('user_id',m).getURI();this._presentDialog(n);},dismiss:function(){if(this._dialog)this._dialog.hide();},_presentDialog:function(l,m){if(this._dialog)return;var n=new h(l);g.send(n,function(o){this._dialog=o;o.subscribe('hide',function(){this._dialog=null;if(m)m();}.bind(this));}.bind(this));}};e.exports=k;},null);
__d("FBRTCCore",["Arbiter","ChatVisibility","FBRTCAvailability","FBRTCCallUI","FBRTCStruct","FBRTCUnsupportedBrowserMessage","mixInEventEmitter","PresencePrivacy","UserAgent","VideoCallSupport","fbt","randomInt","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=false,u={startOutgoingCall:function(v,w,x){s(!isNaN(parseInt(v,10)));if(t)return;t=true;setTimeout(function(){t=false;},1000);if(p.isWebrtcSupported()){var y=this._generateCallID();j.openAsCaller(v,y,w,x);}else l.showForOutgoingCall();},isAvailableForWebrtcCalling:function(v){return i.isCallable(v);},shouldEnableVideoCalling:function(){return !o.isPlatform('Android')&&!o.isPlatform('iOS');},callabilityForUser:function(v){if(!h.isOnline()){return u.CallabilityStatus.OFFLINE;}else if(u.isAvailableForWebrtcCalling(v)){return u.CallabilityStatus.AVAILABLE;}else if(!n.allows(v)){return u.CallabilityStatus.BLOCKED;}else return u.CallabilityStatus.UNAVAILABLE;},generateCallButtonTooltip:function(v,w){switch(w){case u.CallabilityStatus.AVAILABLE:return q._("Start a video call with {shortname}",[q.param("shortname",v)]);case u.CallabilityStatus.BLOCKED:return q._("You must turn on chat for {shortname} to make a call.",[q.param("shortname",v)]);case u.CallabilityStatus.UNAVAILABLE:return q._("{shortname} is currently unavailable for video calling",[q.param("shortname",v)]);case u.CallabilityStatus.OFFLINE:return q._("You must be online to make a call.");default:return q._("You must be online to make a call.");}},_generateCallID:function(){return r(0,4294967295);},buddyCallabilityChanged:function(){this.emit('callabilityChanged');}};u.CallabilityStatus=new k(['AVAILABLE','BLOCKED','OFFLINE','UNAVAILABLE']);g.subscribe(['buddylist/availability-changed'],function(v,w){u.buddyCallabilityChanged();});n.subscribe(['privacy-changed','privacy-availability-changed'],function(v,w){u.buddyCallabilityChanged();});m(u,{callabilityChanged:true});e.exports=u;},null);
__d("FBRTCMessageListener",["Arbiter","ChannelConstants","invariant","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=[],l=null,m={init:function(){g.subscribe(h.getArbiterType('webrtc'),function(n,o){this._onMessage(o.obj);}.bind(this));},setMessageHandler:function(n,o){i(!l);l=o?n.bind(o):n;while(k.length)l(k.shift());},_onMessage:function(n){this.emit('messageReceived',n);if(l){l(n);}else k.push(n);}};j(m,{messageReceived:true});e.exports=m;},null);
__d("VideoCallCore",["Bootloader","FBRTCCallSummaryUploader","FBRTCCore","FBRTCLogger","FBRTCMessageListener","FBRTCUnsupportedBrowserMessage","VideoCallSupport","FBRTCCallUI","randomInt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q=false,r={availableForCall:function(v){return u(v);},showOutgoingCallDialog:function(v,w,x){if(q)return;q=true;setTimeout(function(){q=false;},1000);if(m.isWebrtcSupported()){this.makeWebRTCCall(v,x||j.Trigger.CHAT_TAB_ICON);}else l.showForOutgoingCall();},canCallByWebrtc:function(v){if(m.isSendWebrtcSupported())return u(v);return false;},makeWebRTCCall:function(v,w){var x=parseInt(v,10),y=t();n.openAsCaller(x,y,w,false);}};function s(){if(!p)g.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(v,w,x,y){p=new v(w,y,(new x(r)));k.setMessageHandler(p.onMessageReceived,p);});}function t(){return o(0,4294967295);}function u(v){return i.isAvailableForWebrtcCalling(v);}if(m.isReceiveWebrtcSupported()){h.init();k.init();k.once('messageReceived',function(v){s();});}e.exports=r;},null);
__d("ChatAnimatedGifs",["URI"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={shouldHideBody:function(i){if(!i.has_attachment)return false;for(var j=0;j<i.attachments.length;j++){var k=i.attachments[j];if(k.preview_url){var l=h.getRawUrlFromSafeUrl(k.preview_url);if(i.body==l)return true;}}return false;},getRawUrlFromSafeUrl:function(i){return g(i).getQueryData().url;}};e.exports=h;},null);
__d("ChatEmployeeAwayWarning",["MercuryIDs","MercuryParticipants","MercuryViewer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={updateEmployeeAwayWarning:function(k,l,m){h.get(i.getID(),function(n){var o=n.employee;if(o)h.getMulti(k.participants,function(p){var q=false,r=g.getUserIDFromThreadID(k.thread_id);if(!r)return;var s='fbid:'+r;for(var t in p)if(s==p[t].id&&p[t].is_employee_away)q=true;if(q){l();}else m();});});}};e.exports=j;},null);
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatDispatcher","ChatConfig","ChatCookieInterface","ChatTabActions","InitialServerTime","LogHistory","JSLogger","MercuryAssert","MercuryLocalIDs","PresenceState","PresenceUtil","areJSONRepresentationsEqual","copyProperties","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=b('MercuryServerRequests').get(),x=b('MercuryThreads').get(),y=b('MercuryTimestampTracker').get(),z=[],aa=null,ba=null,ca=null,da=n.serverTime,ea=k.get('tab_max_load_age')||3600000,fa=da-ea,ga=0,ha=20,ia=o.getInstance('chat_tab_model'),ja=false;function ka(hb){var ib=s.verifyNumber(hb.uct2);if(!ib||typeof ib!=='number'){ia.warn('bad_cookie_version',hb);return null;}if(ib<ga||ib<fa)return null;return ib;}function la(hb){if(hb){var ib=ka(hb);if(ib&&ib!==ga){var jb={};jb.old_tabs=JSON.stringify(z);jb.old_promoted=aa;jb.old_time=ga;jb.old_reason=ca;jb.window_id=t.getSessionID();jb.cookie_tabs=hb&&hb.t2&&JSON.stringify(hb.t2);jb.cookie_promoted=hb&&hb.lm2;jb.cookie_time=hb&&hb.uct2;jb.cookie_reason=hb&&hb.tr;jb.cookie_window=hb&&hb.tw;ga=ib;ca='load';var kb=ma(hb.t2,hb.lm2||null);jb.load_result=kb;jb.new_tabs=JSON.stringify(z);jb.new_promoted=aa;jb.new_time=ga;jb.new_reason=ca;var event='load';if(!ja)event+='_init';ia.log(event,jb);return kb;}}else ia.warn('load_bad_state',hb);return false;}function ma(hb,ib){if(na(hb,ib)){var jb=z.filter(function(mb){return mb.fragile;}),kb={};aa=null;z=hb.map(function(mb){var nb={id:mb.i,server_id:mb.si};if(nb.id==ib)aa=nb.id;if(mb.r)nb.raised=true;kb[nb.id]=nb;return nb;});z=z.filter(function(mb){return mb!=null;});if(ba)for(var lb in ba)if(!kb[lb]||!kb[lb].raised)delete ba[lb];jb=jb.filter(function(mb){return !kb[mb.id];});z=z.concat(jb);ra();return true;}return false;}function na(hb,ib){if(ib!=aa)return true;var jb=z.filter(function(mb){return !mb.fragile;});if(hb.length!=jb.length)return true;for(var kb=0,lb=hb.length;kb<lb;kb++)if(!u(hb[kb],jb[kb]))return true;return false;}function oa(hb,ib,jb){var kb=la(s.get());if(ib===(void 0)||ib>ga){if(hb()){kb=true;ca=jb||null;qa(ib);}}else ia.error('rejected',{change_time:ib,state_time:ga});kb&&pa();}function pa(){if(ja)fb.inform('chat/tabs-changed',fb.get());}function qa(hb){if(hb===(void 0))hb=Math.max(y.getLastUserMessageTimestamp()||1,ga+1);ga=hb;s.doSync();}function ra(hb){var ib=z.length-ha;if(ib>0)z=z.filter(function(jb){return jb.raised||jb.id==hb||ib--<=0;});if(ib>0)z=z.filter(function(jb){return jb.id==aa||jb.id==hb||ib--<=0;});}function sa(hb){for(var ib=0;ib<z.length;ib++)if(z[ib].id==hb)return ib;return -1;}function ta(hb,ib){var jb=x.getThreadMetaNow(hb);if(!jb)return false;if(jb.is_canonical_user){return va(hb,ib);}else{var kb=ua(hb);if(kb)w.getServerThreadID(hb,function(lb){if(ya(hb,lb)){qa();pa();}});return kb;}}function ua(hb){if(sa(hb)===-1){z.push({id:hb,fragile:true});ia.log('open_fragile_tab',{tabs:JSON.stringify(z),opened:hb,window_id:t.getSessionID()});return true;}return false;}function va(hb,ib){var jb=sa(hb);if(jb!=-1)if(z[jb].fragile){z.splice(jb,1);}else{ib&&(z[jb].signatureID=ib);return true;}for(var kb=0;kb<=z.length;kb++)if(kb==z.length||z[kb].fragile){z.splice(kb,0,{id:hb,signatureID:ib});ra(hb);ia.log('open_tab',{tabs:JSON.stringify(z),opened:hb,window_id:t.getSessionID()});return true;}}function wa(hb,ib,jb){q.isThreadID(hb);var kb=false;if(ba&&ib){ba[hb]=true;kb=true;}oa(function(){if(ta(hb,jb))kb=true;var lb=sa(hb);if(lb!=-1&&!z[lb].raised){z[lb].raised=true;kb=true;ia.log('raise_tab',{tabs:JSON.stringify(z),raised:hb,window_id:t.getSessionID()});}return kb;});}function xa(hb){var ib=sa(hb);if(ib!=-1&&(!z[ib].raised||aa!==hb)){z[ib].raised=true;aa=hb;return true;}return false;}function ya(hb,ib){var jb=sa(hb);if(jb!=-1&&z[jb].fragile){var kb=z[jb];kb.fragile=false;kb.server_id=ib;var lb=[];z.forEach(function(mb){if(mb.id!=hb){if(kb&&mb.fragile){lb.push(kb);kb=null;}lb.push(mb);}});if(kb)lb.push(kb);z=lb;ia.log('make_permanent',{tabs:JSON.stringify(z),tab_id:hb,window_id:t.getSessionID()});return true;}return false;}function za(hb,ib){q.isThreadID(hb);var jb=false;if(ba){delete ba[hb];jb=true;}oa(function(){if(ab(hb))jb=true;return jb;},(void 0),ib);}function ab(hb){var ib=sa(hb);if(hb==aa)aa=null;if(ib!=-1){z.splice(ib,1);ia.log('close_tab',{tabs:JSON.stringify(z),closed:hb,window_id:t.getSessionID()});return true;}return false;}function bb(){if(z.length){ia.log('close_all_tabs',{closed_tabs:JSON.stringify(z),window_id:t.getSessionID()});z=[];aa=null;if(ba)ba={};qa();pa();}}function cb(){var hb=[];for(var ib=0;ib<z.length;ib++)if(z[ib].fragile&&!x.isNewEmptyLocalThread(z[ib].id)){hb.push(z[ib]);z.splice(ib);pa();break;}ia.log('close_fragile_tabs',{tabs:JSON.stringify(z),fragile_closed:hb,window_id:t.getSessionID()});}function db(hb){q.isThreadID(hb);var ib=false;if(ba){delete ba[hb];ib=true;}oa(function(){var jb=sa(hb);if(jb!=-1&&z[jb].raised){delete z[jb].raised;ia.log('lower_tab',{tabs:JSON.stringify(z),lowered:hb,window_id:t.getSessionID()});ib=true;}return ib;});}function eb(){if(ba){oa(function(){var hb=false;z.forEach(function(ib){if(ib.raised!=ba[ib.id]){hb=true;if(ba[ib.id]){ib.raised=true;}else delete ib.raised;}});return hb;});ia.log('persist_local_raise',{tabs:JSON.stringify(z),window_id:t.getSessionID()});}}s.registerStateStorer(function(hb){return l.store(hb,{tabs:z,promotedTab:aa,lastChangeTime:ga,lastChangeReason:ca});});s.registerStateLoader(function(hb){if(la(hb))pa();});function fb(){}v(fb,h,{isTabPromoted:function(hb){if(hb)return hb==aa;return false;},indexOf:function(hb){return sa(hb);},getTab:function(hb){q.isThreadID(hb);var ib=this.indexOf(hb);if(ib>-1){var jb=z[ib];return v({},jb);}return null;},getEmptyTab:function(){var hb;for(var ib=0;ib<z.length;ib++){hb=z[ib].id;if(x.isNewEmptyLocalThread(hb))return hb;}hb=r.generateThreadID();x.createNewLocalThread(hb,[]);return hb;},get:function(){var hb=z.map(function(ib){var jb=v({},ib);delete jb.fragile;if(ba)jb.raised=ba[jb.id];return jb;});return {tabs:hb,promoted:aa};},openFragileTab:function(hb){q.isThreadID(hb);if(ua(hb))pa();},openTab:function(hb){q.isThreadID(hb);oa(ta.bind(null,hb));},raiseAndPromoteTab:function(hb,ib,jb,kb,lb){q.isThreadID(hb);var mb=false;if(ba&&ib){ba[hb]=true;mb=true;}oa(function(){if(ta(hb,jb))mb=true;if(xa(hb)){mb=true;ia.log('raise_and_promote_tab',{tabs:JSON.stringify(z),promoted:hb,window_id:t.getSessionID()});}return mb;},kb,lb);},promoteThreadInPlaceOfThread:function(hb,ib,jb,kb){q.isThreadID(hb);q.isThreadID(ib);oa(function(){var lb=sa(hb),mb=sa(ib);if(kb){aa=hb;}else if(aa===ib)return true;var nb=z[lb];if(jb){q.isThreadID(jb);var ob=sa(jb),pb=z[mb];z[mb]=nb;z.splice(lb,1);z.splice(ob,0,pb);}else{z[lb]=z[mb];z[mb]=nb;}return true;});}});g.subscribe(p.DUMP_EVENT,function(hb,ib){ib.chat_tabs={promoted:aa,tabs:z.map(function(jb){return v({},jb);}),time:ga,max_load_age:ea};});function gb(){var hb=i.ignoresRemoteTabRaise();if(hb&&!ba){ia.log('start_ignore_remote_raise');ba={};pa();}else if(!hb&&ba){ia.log('stop_ignore_remote_raise');ba=null;pa();}}j.register(function(hb){switch(hb.actionType){case m.Types.CLOSE_TAB:za(hb.threadID,hb.reason);break;case m.Types.CLOSE_ALL_TABS:bb();break;case m.Types.CLOSE_FRAGILE_TABS:cb();break;case m.Types.LOWER_TAB:db(hb.threadID);break;case m.Types.PERSIST_LOCAL_STATE:eb();break;case m.Types.PROMOTE_TAB:q.isThreadID(hb.threadID);oa(xa.bind(null,hb.threadID));break;case m.Types.RAISE_TAB:wa(hb.threadID,hb.userAction,hb.signatureID);break;}});i.subscribe(i.ON_CHANGED,gb);gb();la(s.getInitial(),true);if(ga===0)ga=da-600000;ja=true;e.exports=fb;},null);
__d("MercurySeenByAll",["CSS","DataStore","MercuryDelayedRoger","DOM","MercuryIDs","MercuryViewer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreads').get(),n={},o={updateOnSeenChange:function(q,r,s){n[q.tagName]=true;h.set(q,'thread-id',r.thread_id);g.addClass(q,'seenByListener');p(q,r,s);}};function p(q,r,s){var t=null;if(s){t=k.getParticipantIDFromUserID(s);}else t=l.getID();var u=r.participants.filter(function(w){return w!==t;}),v=r.participants.length>0&&r.participants[0]===t;g.conditionClass(q,'repliedLast',v);g.conditionClass(q,'seenByAll',v&&i.getSeenBy(r.thread_id).length===u.length);}i.subscribe('state-changed',function(q,r){for(var s in n){var t=j.scry(document.body,s+'.seenByListener');for(var u=0;u<t.length;u++){var v=t[u],w=h.get(v,'thread-id');if(r[w])m.getThreadMeta(w,function(x){p(v,x);});}}});e.exports=o;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachmentType","MercuryIDs","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","Style","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFromMixed","copyProperties","cx","formatDate","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){b.__markCompiled&&b.__markCompiled();var ha=k.create('wm_timestamp');function ia(na){this._fbid=na;this._serverRequests=v.getForFBID(na);this._threads=x.getForFBID(na);}da(ia,o);da(ia.prototype,{renderTimestamp:function(na,oa,pa,qa){if(qa){if(!oa){ha.warn('no_title');oa=(new Date(qa)).toLocaleDateString();}na.setAttribute('title',oa);na.setAttribute('data-utime',qa/1000);if(!pa){ha.warn('no_display');pa=fa(new Date(qa),'g:ia');}h.setContent(na,pa);g.show(na);}},renderMessageSourceTags:function(na,oa,pa,qa){var ra='',sa='',ta='';if(ba(pa,n.MESSENGER)){ra=ga._("Sent from Messenger");sa=new z('/mobile/messenger');ta="_9g";}else if(ba(pa,n.MOBILE)){ra=ga._("Sent from Mobile");sa=new z('/mobile/');ta="_9j";}else if(ba(pa,n.CHAT)){ra=ga._("Sent from chat");ta="_9h";}else if(ba(pa,n.EMAIL)){if(qa){ra=ga._("Sent from {email}",[ga.param("email",qa)]);}else ra=ga._("Sent from email");ta="_9i";}if(ta){y.set(na,ra);g.addClass(oa,ta);if(sa){na.setAttribute('href',sa);}else na.removeAttribute('href');}else g.hide(na);},renderMessageLocation:function(na,oa,pa){var qa=z('/ajax/messaging/hovercard/map.php').setQueryData(pa);na.setAttribute('data-hovercard',qa);g.removeClass(na,"_b9");g.show(oa);},renderSpoofWarning:function(na,oa,pa){if(oa){g.addClass(na,"_sa");y.set(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));}},renderChatSpoofWarning:function(na,oa,pa){if(oa)h.appendContent(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));},renderCoreThreadlist:function(na,oa,pa,qa,ra){qa=qa||{};this.renderThreadImage(na,oa.getNode('image'));var sa=oa.getNode('accessibleName'),ta=[oa.getNode('name')];if(sa)ta.push(sa);ma(this,na,ta,qa);if(na.folder&&ra)la(oa.getNode('folderBadge'),na.folder);var ua=oa.getNode('timestamp');this.renderTimestamp(ua,na.timestamp_absolute,na.timestamp_relative,na.timestamp);this.renderSnippet(na,oa.getNode('snippet'));ka(oa,na);pa(oa,na);},renderAndSeparatedParticipantList:function(na,oa,pa){pa=pa||{};pa.last_separator_uses_and=true;this._threads.getThreadMeta(na,function(qa){ma(this,qa,oa,pa);}.bind(this));},renderSnippet:function(na,oa){var pa=false,qa=h.create('span');g.addClass(qa,'MercuryRepliedIndicator');h.appendContent(oa,qa);u.updateOnSeenChange(qa,na,this._fbid);var ra=na.snippet;if(ra){if(na.snippet_has_attachment)h.appendContent(oa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},ga._("Forwarded Message:")));if(ra.substr(0,4)=='?OTR'){ra=ga._("[encrypted message]");}else ra=ra.replace(/\r\n|[\r\n]/g," ");ra=j(i.htmlEmojiAndEmote(ra));}else{if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},ga._("Forwarded Message")));if(na.snippet_has_attachment&&na.snippet_attachments&&na.snippet_attachments.length){pa=true;ra=h.create('span');d(['MercuryAttachmentSnippet.react'],function(ua){t.render(t.createElement(ua,{thread:na,viewer:this._fbid}),ra);}.bind(this));}}var sa=na.participants.length;if(na.is_subscribed)sa--;var ta=na.snippet_sender;if(!pa&&ta&&m.getParticipantIDFromUserID(this._fbid)!=ta&&sa>1){s.get(ta,function(ua){if(ua.short_name){h.appendContent(oa,ga._("{name}: {conversation_snippet}",[ga.param("name",ua.short_name),ga.param("conversation_snippet",ra)]));}else h.appendContent(oa,ra);});}else h.appendContent(oa,ra);},renderWebMessengerLink:function(na,oa,pa,qa){aa.getThreadURI(na,function(ra){oa.setAttribute('href',ra);pa&&pa();},qa);},renderThreadImage:function(na,oa){t.render(t.createElement(p,{thread:na,viewer:this._fbid}),oa);},renderParticipantList:function(na,oa,pa,qa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa);},renderThreadNameAndParticipantList:function(na,oa,pa,qa){var ra=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa),sa=this._threads.getThreadMetaNow(na);if(!sa.name)return ra;return ga._("{conversation_name} [with {participant_list}]",[ga.param("conversation_name",sa.name),ga.param("participant_list",ra)]);},renderParticipantCount:function(na,oa){return q.renderRawParticipantCount(oa);}});function ja(na){if(!na.snippet_attachments)return [];return na.snippet_attachments.filter(function(oa){return oa.attach_type===l.PHOTO;});}function ka(na,oa){var pa=ja(oa);if(pa.length===0)return;var qa=pa[0].thumbnail_url;if(!qa)return;var ra=(pa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',sa=na.getNode(ra);if(!sa)return;var ta=h.find(sa,'i');w.set(ta,'background-image','url('+qa+')');g.show(sa);}function la(na,oa){ca(na).forEach(function(pa){h.setContent(pa,oa);});}function ma(na,oa,pa,qa){pa=ca(pa);var ra=na._fbid;if(oa.name){pa.forEach(function(ta){t.render(t.createElement(r,{thread:oa,viewer:ra,showUnreadCount:!!qa.show_unread_count}),ta);});return;}var sa=oa.participants;if(oa.participants.length>1)sa=oa.participants.filter(function(ta){return ta!=m.getParticipantIDFromUserID(ra);});s.getMulti(sa,function(ta){q.renderParticipantListWithNoThreadName(na._serverRequests.getServerThreadIDNow(oa.thread_id),oa,sa,ta,pa,qa);});}e.exports=ia;},null);
__d("ChatTabController",["Arbiter","BanzaiLogger","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabActions","ChatTabLRUManager","ChatTabModel","ChatTabPolicy","ChatTabViewEvents","ChatTabViewInstances","ChatTabViewSelector","JSLogger","MercuryViewer","Style","UserAgent_DEPRECATED","VideoCallCore","ChatTabPresence","ChatTypeaheadBehavior","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();b('ChatTabPresence');b('ChatTypeaheadBehavior');var x=b('MercuryThreadInformer').get(),y=b('MercuryThreadActions').get(),z=b('MercuryThreads').get(),aa=j.get('tab_auto_close_timeout')||7200000,ba=s.create('tab_controller');function ca(na,oa,pa){var qa=n.get().tabs,ra=qa[na],sa,ta;if(qa.length===0)return false;var ua=qa.slice(na+1),va=qa.slice(0,na),wa=ua.concat(va);if(!oa)wa.reverse();if(ra)wa.push(ra);for(var xa=0;xa<wa.length;xa++){sa=wa[xa];ta=q.get(sa.id);if(ta&&ta.isVisible()&&(!pa||sa.raised)){ta.focus();return true;}}return false;}function da(na,oa){var pa=oa&&oa.getRightmostHiddenTab();if(pa===na)return null;return pa;}function ea(){return Math.floor(Math.random()*2147483648).toString(16);}function fa(na,oa,pa,qa){l.raiseTab(na,true,pa);var ra=oa&&oa.getLeftmostVisibleTab(),sa=oa&&oa.getTabsToShow();if(sa&&!sa[na]&&ra){n.promoteThreadInPlaceOfThread(na,ra,da(na,oa),true);}else l.promoteTab(na);g.inform('chat/open-tab',na);var ta=q.get(na);ta&&ta.focus();}function ga(na,oa){if(!n.getTab(na))l.raiseTab(na,false);var pa=oa&&m.getLRUVisibleTab(oa),qa=oa&&oa.getTabsToShow();if(qa&&!qa[na]&&pa)n.promoteThreadInPlaceOfThread(na,pa,da(na,oa));}function ha(na){r.subscribe('selected',function(pa,qa){fa(qa,na);});g.subscribe('page_transition',function(pa,qa){l.closeFragileTabs();});g.subscribe('chat-visibility/go-offline',function(){l.closeAllTabs();});i.subscribe('idle',function(pa,qa){if(qa>aa){var ra=n.get().tabs;ra.forEach(function(sa){var ta=sa.id;z.getThreadMeta(ta,function(ua){if(!ua.unread_count){ba.log('autoclose_idle_seen',{thread_id:ta,idleness:qa});l.closeTab(ta,'autoclose_idle_seen');}});});}});p.subscribe('nub-activated',function(pa,qa){fa(qa,na);});p.subscribe('focus-tab',function(pa,qa){var ra=n.getTab(qa);if(ra&&ra.raised)fa(qa,na,ra.signatureID,true);});function oa(pa,qa){h.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});w.showOutgoingCallDialog(qa.userID,qa.clickSource);}p.subscribe('video-call-clicked',oa);p.subscribe('interaction-with-tab',function(pa,qa){var ra=n.getTab(qa);ra&&ra.raised&&y.markSeen(qa);});p.subscribe('esc-pressed',function(pa,qa){ba.log('close_esc',{thread_id:qa});var ra=n.indexOf(qa);l.closeTab(qa,'close_esc');setTimeout(function(){ca(ra-1,true,true);},0);});x.subscribe('messages-received',function(pa,qa){for(var ra in qa){var sa=qa[ra];for(var ta=0;ta<sa.length;ta++){var ua=sa[ta];if(ua.author!=t.getID()){if(!ua.is_unread){ba.log('message_already_read',{action_id:ua.action_id,thread_id:ua.thread_id});continue;}z.getThreadMeta(ra,function(va){o.messageIsAllowed(va,ua,function(){ga(ra,na);k.newMessage(ra,ua);});});}}}});x.subscribe('thread-read-changed',function(pa,qa){for(var ra in qa)if(!qa[ra].mark_as_read){ba.log('autoclose_marked_unread',{thread_id:ra});l.closeTab(ra,'autoclose_marked_unread');}});p.subscribe('tab-pressed',function(pa,qa){return !ca(n.indexOf(qa.id),qa.shiftPressed);});g.subscribe(s.DUMP_EVENT,function(pa,qa){qa.chat_controller={auto_close_timeout:aa};});this.openTab=function(pa,qa,ra){fa(pa,qa,ea());if(ra)ra(q.get(pa));};}if(v.firefox()){var ia=function(){return u.get(document.body,'overflowX')+' '+u.get(document.body,'overflowY');},ja=ia(),ka=function(){var na=ia();if(na!==ja){ja=na;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var la=new MutationObserver(ka),ma={attributes:true,attributeFilter:['class','style']};la.observe(document.documentElement,ma);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ka();},false);}e.exports=ha;},null);
__d("MNCommerceButton.react",["CurrentEnvironment","MessengerDialogButton.react","React","XUIButton.react"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i.createClass({displayName:"MNCommerceButton",render:function(){var l=g.messengerdotcom,m=l?h:j,n=this.props.type;if(!n)n=this.props.type==='confirm'?'primary':'secondary';var o=l?'default':this.props.use,p=Object.assign({},this.props,{type:n,use:o});return (i.createElement(m,i.__spread({},p),this.props.children));}});e.exports=k;},null);
__d("MNCommerceDialogFooter.react",["CurrentEnvironment","MessengerDialogFooter.react","React","XUIDialogFooter.react","cloneWithProps","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i.createClass({displayName:"MNCommerceDialogFooter",render:function(){var n=g.messengerdotcom,o=n?h:j,p,q=this.props.children;if(n){p=i.Children.count(this.props.children);q=i.Children.map(this.props.children,function(r,s){if(!r)return null;return k(r,{className:"_4ec0",type:s===0&&p===2?'secondary':'primary'});});}return (i.createElement(o,i.__spread({},this.props),q));}});e.exports=m;},null);
__d("MNCommerceUnlinkDialog.react",["MNCommerceButton.react","MNCommerceDialog.react","MNCommerceDialogBody.react","MNCommerceDialogFooter.react","MNCommerceDialogTitle.react","React","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=l,o=n.PropTypes,p=l.createClass({displayName:"MNCommerceUnlinkDialog",propTypes:{onCancelButtonClick:o.func,onTurnOffButtonClick:o.func},render:function(){var q=m._("Cancel"),r=m._("Turn Off");return (l.createElement(h,{onToggle:this.props.onToggle,shown:this.props.shown},l.createElement(k,{showCloseButton:false},m._("Unlink account?")),l.createElement(i,null,l.createElement("div",null,m._("You can turn off updates if you didn't sign up or just don't want to get them anymore."))),l.createElement(j,null,l.createElement(g,{label:q,onClick:this.props.onCancelButtonClick,use:"default"}),l.createElement(g,{label:r,onClick:this.props.onTurnOffButtonClick,use:"confirm"}))));}});e.exports=p;},null);
__d("MNCommerceUnlinkErrorDialog.react",["MNCommerceAttachmentConstants","MNCommerceErrors","React","MNCommerceButton.react","MNCommerceDialog.react","MNCommerceDialogBody.react","MNCommerceDialogFooter.react","MNCommerceDialogTitle.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=i,q=p.PropTypes,r=i.createClass({displayName:"MNCommerceUnlinkErrorDialog",propTypes:{errorType:q.number,onOkayButtonClick:q.func},render:function(){var s=o._("OK"),t=null,u=null;switch(this.props.errorType){case h.ALREADY_UNLINKED:u=i.createElement("div",null,o._("Updates Are Already Off"));t=i.createElement("div",null,o._("You aren't getting updates in Messenger."));break;default:u=i.createElement("div",null,o._("Couldn't Turn Off Updates"));t=i.createElement("div",null,o._("Sorry, something went wrong. Please try again."));break;}return (i.createElement(k,{onToggle:this.props.onToggle,shown:this.props.shown,width:g.UNLINK_ERROR_DIALOG.WIDTH},i.createElement(n,null,u),i.createElement(l,null,t),i.createElement(m,null,i.createElement(j,{label:s,onClick:this.props.onOkayButtonClick,use:"confirm"}))));}});e.exports=r;},null);
__d("MNCommerceUnlinkDialogContainer.react",["BanzaiLogger","MNCommerceDialogStateActions","MNCommerceDialogStateStore","MNCommerceLoggingConstants","MNCommerceUnlinkDialog.react","MNCommerceUnlinkErrorDialog.react","React"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=m.createClass({displayName:"MNCommerceUnlinkDialogContainer",render:function(){var o=i.getState();if(o&&o.errorType){return (m.createElement(l,{onToggle:this._onToggle,shown:!!o,errorType:o.errorType,onOkayButtonClick:this._hideDialog}));}else{g.log(j.MODULE,{event:j.NOT_YOU_EVENT_TYPE.NOT_YOU_CLICKED});return (m.createElement(k,{onToggle:this._onToggle,shown:!!o,onCancelButtonClick:this._hideDialog,onTurnOffButtonClick:o&&o.onTurnOffButtonClick}));}},_onToggle:function(o){if(!o)this._hideDialog();},_hideDialog:function(){h.hideDialog();}});e.exports=n;},null);
__d("XMNCommerceUnlinkController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/messages\/commerce\/unlink\/",{page_id:{type:"String",required:true},user_id:{type:"String",required:true}});},null);
__d("MNCommerceUnlinkDataManager",["AsyncRequest","BanzaiLogger","MNCommerceDialogStateActions","MNCommerceLoggingConstants","MNCommerceUnlinkDialogContainer.react","XMNCommerceUnlinkController"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(){}m.prototype.unlink=function(n,o){h.log(j.MODULE,{event:j.NOT_YOU_EVENT_TYPE.NOT_YOU_UNSUBSCRIBE_ATTEMPT,page_id:n});var p=l.getURIBuilder().setString('page_id',n).setString('user_id',o).getURI();new g().setURI(p).setErrorHandler(this.$MNCommerceUnlinkDataManager0).send();};m.prototype.$MNCommerceUnlinkDataManager0=function(n){h.log(j.MODULE,{event:j.NOT_YOU_EVENT_TYPE.NOT_YOU_UNSUBSCRIBE_ERROR});i.showDialog(k,{errorType:n.error});};e.exports=new m();},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","DOM","MercuryThreadInfo"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;i.scry(this.getRoot(),'input[type="radio"]').forEach(function(p){if(p.checked)o=p.value;});o=k.convertRawMuteSetting(o);d(['MercuryThreadActions'],function(p){p.get().updateMuteSetting(l,o);});}.bind(n));});},convertRawMuteSetting:function(l){switch(l){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var m,n=new Date(),o=new Date();o.setHours(8);o.setMinutes(0);o.setSeconds(0);if(o>n){m=o-n;}else m=o-n+(24*3600*1000);return m/1000;default:return 0;}}};e.exports=k;},null);
__d("MercuryCallLogMessage.react",["FBRTCCore","FBRTCLogger","React","SimpleXUIDialog","Tooltip.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=i.createClass({displayName:"MercuryCallLogMessage",render:function(){if(this.props.isAnswered){return (this._renderAnsweredCallLogMessage(this.props.peerFBID,this.props.peerName,this.props.isOutgoingCall));}else return (this._renderMissedCallLogMessage(this.props.peerFBID,this.props.peerName,this.props.isOutgoingCall));},_renderAnsweredCallLogMessage:function(o,p,q){var r=m._("call {firstname}",[m.param("firstname",p)]),s;if(q){s=m._("You called {firstname}.",[m.param("firstname",p)]);}else s=m._("{firstname} called you.",[m.param("firstname",p)]);return this._generateCallLink(s,r,o,p);},_renderMissedCallLogMessage:function(o,p,q){var r,s;if(q){r=m._("{firstname} missed a call from you.",[m.param("firstname",p)]);s=m._("call {firstname} again",[m.param("firstname",p)]);}else{r=m._("You missed a call from {firstname}.",[m.param("firstname",p)]);s=m._("call {firstname} back",[m.param("firstname",p)]);}return this._generateCallLink(r,s,o,p);},_generateCallLink:function(o,p,q,r){if(g.shouldEnableVideoCalling()){return (i.createElement("a",{className:"_1xpw",onClick:this._handleClick.bind(this,q,r)},i.createElement(k,{alignH:"center",position:"above",tooltip:p},o)));}else return (i.createElement("span",{className:"_1xpw"},o));},_handleClick:function(o,p){if(g.isAvailableForWebrtcCalling(o)){g.startOutgoingCall(o,h.Trigger.ADMIN_MESSAGE,false);}else j.show(m._("{firstname} can't be called because they are temporarily offline.",[m.param("firstname",p)]),m._("Can't Connect Call"));}});e.exports=n;},null);
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionType","MercuryIDs","MercuryPayloadSource","MercuryViewer","TypingStates","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=b('MercuryServerRequests').get(),q,r={},s=30000,t={};n(t,{'state-changed':true});function u(aa){var ba=r[aa]||{},ca=Object.keys(ba);ca.sort(function(da,ea){return ba[da]-ba[ea];});return ca;}function v(){q=null;var aa=Date.now(),ba={},ca=false;for(var da in r){var ea=false;for(var fa in r[da]||{})if(r[da][fa]<aa-s){delete r[da][fa];ea=true;}else ca=true;if(ea)ba[da]=u(da);}for(var ga in ba){x(ba);break;}if(ca)q=o(v,3000);}function w(aa,ba){if(aa in r)if(ba in r[aa]){delete r[aa][ba];y(aa);}}function x(aa){t.releaseHeldEventType('state-changed');t.emitAndHold('state-changed',aa);}function y(aa){var ba={};ba[aa]=u(aa);x(ba);}function z(aa){if(aa.thread_fbid)return p.getClientThreadIDNow(aa.thread_fbid);if(aa.type==='typ')return j.getThreadIDFromUserID(aa.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(aa,ba){var ca=ba.obj,da=z(ca);if(da){var ea=j.getParticipantIDFromUserID(ca.from);if(ca.st==m.TYPING){r[da]=r[da]||{};var fa=r[da][ea];r[da][ea]=Date.now();if(!q)q=o(v,3000);!fa&&y(da);}else if(ca.st==m.INACTIVE)w(da,ea);}});p.subscribe('update-typing-state',function(aa,ba){var ca=ba.payload_source;if(ca!=k.CLIENT_CHANNEL_MESSAGE)return;var da=ba.actions;if(!da||!da.length)return;var ea=i.USER_GENERATED_MESSAGE;da.forEach(function(fa){if(fa.action_type==ea&&fa.author!=l.getID())w(fa.thread_id,fa.author);});});e.exports=t;},null);
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionType","MercuryDelayedRoger","MercuryIDs","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryTypingReceiver","MercuryViewer","arrayContains","copyProperties","formatDate","removeFromArray","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=b('MercuryThreads').get(),w=[];function x(y){this._threadID=y;this._canonicalUser=k.getUserIDFromThreadID(y);w.push(this);}r(x.prototype,g,{destroy:function(){t(w,this);},setLastMessage:function(y){this._lastMsg=y;this._handleStateChange();},_informStateChanged:function(y){if(y.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&p.isViewer(this._lastMsg.author))y.self_authored=true;this._currentActivity=y.activity;this.inform('state-changed',y);},_notifySentFrom:function(){var y,z,aa=this._lastMsg.location_text,ba=this._lastMsg.source_tags||[];if(aa){y=u._("Sent from {location}",[u.param("location",aa)]);z='sentFromMobile';}else if(q(ba,l.MESSENGER)){y=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},u._("Sent from Messenger"));z='sentFromMobile';}else if(q(ba,l.MOBILE)){y=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},u._("Sent from Mobile"));z='sentFromMobile';}else if(q(ba,l.EMAIL)){y=u._("Sent from email");z='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:z,text:y});},_notifySeenTimestamp:function(y){var z=n.getSeenTimestamp(this._threadID,y[0])*.001,aa=Date.now()*.001,ba;if(z<aa-518400){ba='M j';}else if(z<aa-86400){ba='D g:ia';}else ba='g:ia';this._informStateChanged({activity:'seen-timestamp',text:u._("Seen {timestamp}",[u.param("timestamp",s(z,ba))])});},_nameNormalizer:function(y){var z;m.getMulti(y,function(aa){function ba(da){if(aa[da]!==(void 0)){return aa[da].short_name.toLowerCase();}else return da;}var ca=y.map(ba);z=function(da){var ea=ba(da),fa=ca.indexOf(ea)!==ca.lastIndexOf(ea);return fa?aa[da].name:aa[da].short_name;};});return z;},_notifySeenBy:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea=y.length+(z.author!=p.getID()),fa,ga=false,ha=da>2&&ea>=da-1,ia;if(ca)ia=this._nameNormalizer(ca.participants);if(!ia)ia=function(ma){return ba[ma].short_name;};if(ha){fa=u._("Seen by everyone");}else if(y.length==1){fa=u._("Seen by {user}",[u.param("user",ba[y[0]].short_name)]);}else if(y.length==2){fa=u._("Seen by {user1}, {user2}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=u._("Seen by {user1}, {user2}, {user3}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ja=Object.keys(ba).length-2,ka=u._({"*":"{num} more"},[u.param("num",ja,[0])]),la=h.create('span',{className:'more'},ka);fa=u._("Seen by {user1}, {user2}, {=num more link}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("=num more link",la)]);ga=true;}this._informStateChanged({activity:'seen-by',text:fa,seenBy:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_notifyTyping:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea;if(ca)ea=this._nameNormalizer(ca.participants);if(!ea)ea=function(ka){return ba[ka].short_name;};var fa,ga=false;if(da>2&&y.length>=da-1){fa=u._("Everyone is typing...");}else if(y.length==1){fa=u._("{name} is typing...",[u.param("name",ba[y[0]].short_name)]);}else if(y.length==2){fa=u._("{user1} and {user2} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=u._("{user1}, {user2}, and {user3} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ha=Object.keys(ba).length-2,ia=u._({"*":"{num} more"},[u.param("num",ha,[0])]),ja=h.create('a',{href:'#'},ia);fa=u._("{user1}, {user2}, and {=num more link} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("=num more link",ja)]);ga=true;}this._informStateChanged({activity:'typing',text:fa,typing:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var y=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==y){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=p.getID()){this._notifySentFrom();return;}var z=j.getSeenBy(this._threadID,true);if(z.length)if(this._canonicalUser){this._notifySeenTimestamp(z);return;}else{this._notifySeenBy(z);return;}this._informStateChanged({activity:'none'});}});o.addRetroactiveListener('state-changed',function(y){w.forEach(function(z){var aa=y[z._threadID];if(aa!==(void 0)){z._typing=aa;z._handleStateChange();}});});j.subscribe('state-changed',function(y,z){w.forEach(function(aa){z[aa._threadID]&&aa._handleStateChange();});});e.exports=x;},null);
__d("MercuryLastMessageIndicator.react",["DOM","MercuryIndicatorController","MercuryParticipants","React","Tooltip","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j,p=o.PropTypes,q=j.createClass({displayName:"MercuryLastMessageIndicator",propTypes:{hideTyping:p.bool,indicatorWillShow:p.func,indicatorDidShow:p.func,lastMessage:p.object,threadID:p.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:m,indicatorDidShow:m};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(r){if(r.threadID!=this.props.threadID){this._destroy();this._setup(r);}else if(r.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(r.lastMessage);},componentWillUpdate:function(r,s){if(this.isVisible(r,s))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (j.createElement("div",{className:this.getRootClass()},j.createElement("div",{className:"_510h"}),j.createElement("span",{className:"_510f",ref:"text"},"")));},getRootClass:function(){var r=(("_510g")+(this.state.data.self_authored?' '+"_510e":'')),s=this.state.data.activity,t=null;if(String(s).startsWith('seen')){t='seen';}else if(s=='typing'){t=this.props.hideTyping?null:s;}else t=s;return n(r,t,this.props.className);},isVisible:function(r,s){r=r||this.props;s=s||this.state;return (s.data&&s.data.activity!='none'&&!(r.hideTyping&&s.data.activity=='typing'));},setText:function(){if(this.state.data.text)g.setContent(j.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)i.getMulti(this.state.data.seenBy,function(r){var s=g.create('div',null,this.state.data.seenBy.map(function(t){return g.create('div',null,r[t].name);}));k.set(g.find(j.findDOMNode(this),'span.more'),s,'above','center');}.bind(this));},_setup:function(r){this._controller=new h(r.threadID);this._subscription=this._controller.subscribe('state-changed',function(s,t){return this.setState({data:t});}.bind(this));r.lastMessage&&this._controller.setLastMessage(r.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});e.exports=q;},null);
__d("MercuryShareAttachment.react",["MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","MercuryShareStyleMap","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryShareAttachment",propTypes:{attachment:g,location:n.oneOf(h.getValues())},_renderComponent:function(p,q){if(this.props.location===h.MESSENGER){return (j.createElement("div",{className:l("_haj _5i_d _2poz _52mr _ui9",q)},p));}else return !!q?j.createElement("div",{className:q},p):p;},render:function(){var p=this.props.attachment;if(!p.style_list)return null;for(var q=0;q<p.style_list.length;q++){var r=i.get(p.style_list[q]);if(r){var s=r.getComponent();return (this._renderComponent(j.createElement(s,j.__spread({},this.props)),!!r.cx?r.cx.get(this.props.location):null));}}return null;}});e.exports=o;},null);
__d("WebMessengerDeleteThreadDialog",["Dialog","fbt","MercuryThreadActions"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=b('MercuryThreadActions').get(),j={show:function(k){var l=[];l.push({name:'delete_conversation',label:h._("Delete Conversation"),handler:function(){return i["delete"](k);}});l.push(g.CANCEL);new g().setTitle(h._("Delete This Entire Conversation?")).setBody(h._("Once you delete your copy of this conversation, it cannot be undone.")).setButtons(l).show();}};e.exports=j;},null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=g.delivery_timeout||120000;function p(q){this.$MercuryDeliveryState0=q;this.$MercuryDeliveryState1=i.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState2=k.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState3=[];if(!g.ChatWebDRGK)return;this.$MercuryDeliveryState2.subscribe('messages-received',this.$MercuryDeliveryState4.bind(this));m.subscribe(n(this.$MercuryDeliveryState5,300,this));}p.prototype.$MercuryDeliveryState4=function(q,r){for(var s in r){var t=r[s];t.forEach(function(u){if(this.$MercuryDeliveryState7(u))this.$MercuryDeliveryState3.push(u);}.bind(this));}if(m.isActive(o))this.$MercuryDeliveryState5();};p.prototype.$MercuryDeliveryState5=function(){if(this.$MercuryDeliveryState3.length===0)return;var q=this.$MercuryDeliveryState3.filter(this.$MercuryDeliveryState7,this).map(function(r){return r.message_id;});if(q)this.$MercuryDeliveryState1.sendDeliveryReceipts(q);this.$MercuryDeliveryState3=[];};p.prototype.$MercuryDeliveryState7=function(q){var r=q.author?h.getUserIDFromParticipantID(q.author):null;if(r===this.$MercuryDeliveryState0)return false;if(!q.is_unread)return false;if(!l.allows(r))return false;return true;};Object.assign(p,j);e.exports=p;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionType","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();'use strict';var t=g.getInstance('ordered_threadlist_model'),u=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),v=j.getSupportedFolders();function w(ga,ha,ia,ja){var ka=[],la=false,ma=false,na=(ha||[]).filter(function(ua){var va=ua.filter||i.ALL;return (ua.folder==ia||(!ua.folder&&ia==m.INBOX))&&va==ja;}),oa=ga._threadlistOrderMap[ia][ja].getAllResources(),pa;na.forEach(function(ua){ka=ka.concat(ua.thread_ids);if(ua.error){if(ua.end>oa.length)ma=ua.error;}else{var va=ua.end-ua.start;if(ua.thread_ids.length<va)la=true;}if(!pa||ua.end>pa)pa=ua.end;});aa(ga,ka,ia,ja);if(la){ga._threadlistOrderMap[ia][ja].setReachedEndOfArray();}else if(ma){ga._threadlistOrderMap[ia][ja].setError(ma);}else{var qa=ga._threadlistOrderMap[ia][ja].getCurrentArraySize();if(pa&&qa<pa){var ra={},sa=oa.concat(ka),ta=sa.filter(function(ua){var va=ra[ua];ra[ua]=true;return va;});if(ta.length){t.warn('duplicate_threads',{folder:ia,expected_final_size:pa,actual_final_size:qa,duplicate_thread_ids:ta});ga._serverRequests.fetchThreadlistInfo(pa,ta.length,ia,ja==i.ALL?null:ja);}}}}function x(ga,ha){v.forEach(function(ia){u.forEach(function(ja){w(ga,ha,ia,ja);});});}function y(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ha.forEach(function(ja){if(ja.is_forward)return;var ka=ja.thread_id,la=ba(ga,ka),ma=ca(ga,ka);function na(){ma.forEach(function(pa){ia[la][pa].to_add.push(ka);if(!ga._threadlistOrderMap[la][pa].hasReachedEndOfArray()&&!ga._threadlistOrderMap[la][pa].hasResource(ka))ia[la][pa].to_remove_if_last_after_add[ka]=true;});}function oa(pa){if(r(u,pa))if(r(ma,pa)){ia[la][pa].to_add.push(ka);}else ia[la][pa].to_remove.push(ka);}if(!la){if(ja.action_type===h.CHANGE_FOLDER||ja.action_type===h.CHANGE_ARCHIVED_STATUS)v.forEach(function(pa){if(pa!==la)u.forEach(function(qa){ga._threadlistOrderMap[pa][qa].removeResources([ka]);});});return;}switch(ja.action_type){case h.DELETE_THREAD:ma.forEach(function(pa){ia[la][pa].to_remove.push(ka);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:na();break;case h.CHANGE_READ_STATUS:oa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:ma.forEach(function(pa){if(da(ga,ka,la,pa))ia[la][pa].to_add.push(ka);});break;}});v.forEach(function(ja){u.forEach(function(ka){var la=ga._threadlistOrderMap[ja][ka];aa(ga,ia[ja][ka].to_add,ja,ka);for(var ma=la.getCurrentArraySize()-1;ma>=0;ma--){var na=la.getResourceAtIndex(ma);if(!ia[ja][ka].to_remove_if_last_after_add[na])break;ia[ja][ka].to_remove.push(na);}la.removeResources(ia[ja][ka].to_remove);});});}function z(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]=[];});});ha.forEach(function(ja){var ka=ba(ga,ja.thread_id),la=ca(ga,ja.thread_id);if(ka)la.forEach(function(ma){if(da(ga,ja.thread_id,ka,ma))ia[ka][ma].push(ja.thread_id);});});v.forEach(function(ja){u.forEach(function(ka){if(ia[ja][ka].length>0)aa(ga,ia[ja][ka],ja,ka);});});}function aa(ga,ha,ia,ja){ja=ja||i.ALL;ga._threadlistOrderMap[ia][ja].addResources(ha);v.forEach(function(ka){if(ka!=ia)ga._threadlistOrderMap[ka][ja].removeResources(ha);});}function ba(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=null;if(!ia){ja='No thread metadata';}else if(!ia.folder)ja='No thread folder';if(ja){var ka={error:ja,tid:ha};t.warn('no_thread_folder',ka);return null;}var la=ia.folder;if(ia.is_archived)la=m.ACTION_ARCHIVED;if(ga._threadlistOrderMap[la]){return la;}else return null;}function ca(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=[i.ALL];if(!ia){var ka={error:'no_thread_metadata',tid:ha};t.warn('no_thread_metadata',ka);return [];}if(ia.unread_count)ja.push(m.UNREAD);if(!ia.is_canonical)ja.push(m.GROUPS);return ja;}function da(ga,ha,ia,ja){var ka=ga._threads.getThreadMetaNow(ha);return ka&&ka.timestamp&&ba(ga,ha)==ia&&r(ca(ga,ha),ja);}function ea(ga){this._fbid=ga;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadlistOrderMap={};v.forEach(function(ha){this._threadlistOrderMap[ha]={};u.forEach(function(ia){this._threadlistOrderMap[ha][ia]=new n(function(ja){return this._threads.getThreadMetaNow(ja).timestamp;}.bind(this),function(ja,ka){return ka-ja;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ha,ia){if(!fa(ia))return;var ja=ia.ordered_threadlists;if(ja&&ja.length){x(this,ja);}else{var ka=(ia.actions||[]).filter(function(la){return la.thread_id;});z(this,ia.threads||[]);y(this,ka);}this._threadInformer.updatedThreadlist();}.bind(this));}s(ea.prototype,{getThreadlist:function(ga,ha,ia,ja,ka,la){return this.getFilteredThreadlist(ga,ha,ia,i.ALL,ja,ka,la);},getFilteredThreadlist:function(ga,ha,ia,ja,ka,la,ma){var na=this._threadlistOrderMap[ia][ja],oa=na.executeOrEnqueue(ga,ha,ka,la),pa=na.getUnavailableResources(oa),qa=na.getError(ga,ha,la);if(pa.length||qa){if(na.getCurrentArraySize()<ga){var ra={start:ga,limit:ha,filter:ja,resources_size:na.getCurrentArraySize()};t.warn('range_with_gap',ra);}na.setError(false);this._serverRequests.fetchThreadlistInfo(na.getCurrentArraySize(),pa.length,ia,ja==i.ALL?null:ja,ma);}return oa;},getThreadlistUntilTimestamp:function(ga,ha,ia){ia=ia||i.ALL;return this._threadlistOrderMap[ha][ia].getElementsUntil(ga);},getAvailableThreadlistNow:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].getAllResources();},getThreadCount:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].getCurrentArraySize();},hasLoadedThreadlist:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].hasReachedEndOfArray();},unsubscribe:function(ga,ha,ia){ia=ia||i.ALL;this._threadlistOrderMap[ha][ia].unsubscribe(ga);}});s(ea,l);function fa(ga){switch(ga.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ga.ordered_threadlists;default:return false;}}e.exports=ea;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","LogHistory","MercuryAPIArgsSource","MercuryFolders","MercuryOrderedThreadlist","MercuryServerRequests","MercurySingletonMixin","MessagingTag","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=i.getInstance('mercury_state_check');function r(s){"use strict";this.$MercuryStateCheck0=s;this.$MercuryStateCheck1=m.getForFBID(this.$MercuryStateCheck0);this.$MercuryStateCheck2=l.getForFBID(this.$MercuryStateCheck0);g.subscribe(h.ON_INVALID_HISTORY,this.$MercuryStateCheck3.bind(this,h.ON_INVALID_HISTORY));d(['ChannelConnection'],function(t){t.subscribe(t.CONNECTED,function(u,v){if(!v.init)this.$MercuryStateCheck4(t.CONNECTED);}.bind(this));}.bind(this));}r.prototype.$MercuryStateCheck3=function(s){"use strict";var t;if(p.getRequestURI().getPath().search(/messages/)!==-1){t=k.getSupportedFolders();}else t=[o.INBOX];q.debug('check',{folders:t,source:s});this.$MercuryStateCheck1.fetchMissedMessages(t,j.MERCURYSYNC);};r.prototype.$MercuryStateCheck4=function(s){"use strict";var t=this.$MercuryStateCheck2.getAvailableThreadlistNow(o.INBOX)||[];t=t.slice(0,20);q.debug('full_check',{threads:t,source:s});this.$MercuryStateCheck1.fetchThreadData(t,j.MERCURYSYNC);this.$MercuryStateCheck3(s);};Object.assign(r,n);e.exports=r;},null);
__d("XStickerAssetController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/stickers\/asset\/",{sticker_id:{type:"Int",required:true},image_type:{type:"Enum",defaultValue:"BestEffortImage",enumType:1}});},null);
__d("XLinkshimLogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/si\/ajax\/l\/render_linkshim_log\/",{u:{type:"String",required:true},h:{type:"String",required:true},render_verification:{type:"Bool",defaultValue:false},enc:{type:"String"},d:{type:"String"}});},null);
__d("LinkshimHandler",["Event","LinkshimAsyncLink","LinkshimHandlerConfig","URI","XLinkshimLogController","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={setUpLinkshimHandling:function(s){try{var u=j(s.getAttribute('href')),v=n(u);if(v&&o(u)){g.listen(s,'mouseover',l(h.swap,null,s,v));var w=q(u);g.listen(s,'click',function(){if(i.supports_meta_referrer){h.referrer_log(s,w,p(u).toString());}else h.swap(s,u);});}}catch(t){}}};function n(s){return s.getQueryData().u?new j(s.getQueryData().u):null;}function o(s){return s.getQueryData().hasOwnProperty('s');}function p(s){var t=s.getQueryData().hasOwnProperty('enc')?s.getQueryData().enc:'';return (k.getURIBuilder()).setString('u',s.getQueryData().u).setString('h',s.getQueryData().h).setBool('render_verification',s.getQueryData().hasOwnProperty('render_verification')).setString('enc',t).getURI();}function q(s){var t;if(r()){t=j(s).addQueryData({render_verification:true});}else t=n(s);return t;}function r(){var s=i.render_verification_rate||0;return Math.floor(Math.random()*s+1)===s;}e.exports=m;},null);
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","Bootloader","ChatAnimatedGifs","SyncRequest.react","P2PMercuryAttachment.react","CSS","MercuryConstants","DOM","Event","MercuryAttachment","MercuryAttachmentPhoto.react","MercuryAttachmentPhotoGrid.react","MercuryAttachmentType","MercuryAttachmentVideo.react","MercuryConfig","MercuryIDs","MercuryMessageInfo","MercuryParticipants","MercuryShareAttachment.react","MercuryShareAttachmentRenderLocations","MercuryViewer","ProgressBar","React","Sticker.react","StickerAssetType","StickerConstants","StickerImages","StickerUtils","Style","URI","UserAgent_DEPRECATED","cx","fbt","invariant","updatePhotoProgressBar","XStickerAssetController","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa){b.__markCompiled&&b.__markCompiled();'use strict';var ra=b('MercuryMessages').get(),sa=la.ie()<=8;function ta(wa,xa){var ya=g[xa].build().setNodeContent('filename',wa.name),za=ya.getNode('link');za.setAttribute('href',wa.url);wa.rel&&za.setAttribute('rel',wa.rel);m.addClass(ya.getRoot(),q.getAttachIconClass(wa.icon_type));return ya;}function ua(wa,xa){var ya=g[xa].build().setNodeContent('filename',wa.name);m.addClass(ya.getRoot(),q.getAttachIconClass(wa.icon_type));return ya;}var va={renderAttachment:function(wa,xa,ya,za,ab,bb){var cb=100,db=wa?160:400,eb=null,fb=null,gb=n.MercurySupportedShareType;if(this.isErrorAttachment(xa))eb=va.renderError(xa);if(this.isShareAttachment(xa)&&xa.share){fb=o.create('div',{className:((ya.body&&wa?"_r38":''))});var hb=wa?aa.CHAT:aa.WEB_INBOX;da.render(da.createElement(z,{attachment:xa.share,location:hb,maxWidth:za}),fb);}if(!fb&&this.isShareAttachment(xa)&&xa.share_xhp&&(xa.share_data_type===gb.FB_BROWSE_QUERY||!wa))fb=va.renderShareXHP(xa,ya.id);if(this.isStickerAttachment(xa))fb=va.renderSticker(xa,ya,wa,bb);if(!fb&&this.isShareAttachment(xa)){var ib=xa.share_data_type;switch(ib){case gb.FB_PHOTO:fb=va.renderPreview(xa,ya,za,ab);break;case gb.FB_VIDEO:fb=va.renderVideoThumb(xa);break;case gb.FB_MUSIC_ALBUM:case gb.FB_SONG:case gb.FB_PLAYLIST:case gb.FB_MUSICIAN:case gb.FB_RADIO_STATION:fb=va.renderMusic(xa);break;case gb.EXTERNAL:case gb.FB_TEMPLATE:case gb.FB_SOCIAL_REPORT_PHOTO:fb=va.renderExternalLink(xa);break;case gb.FB_COUPON:case gb.FB_EVENT:fb=va.renderChatXHP(xa);break;case gb.FB_SOCIAL_RESOLUTION:case gb.FB_STATUS:fb=va.renderSocialResolution(xa);break;case gb.FB_SYNC_REQUEST:fb=va.renderSyncRequest(xa);break;case gb.FB_OPEN_GRAPH:fb=va.renderOpenGraph(xa);break;case gb.FB_ORION:fb=va.renderP2PMercuryAttachment(xa,wa);break;case gb.FB_GENERIC_SHAREABLE:fb=va.renderGenericShareable(xa);break;default:if(xa.name)fb=va.renderShareLink(xa,ya&&ya.id,wa);break;}}if(!fb&&xa.preview_loading)fb=va.renderPreview(xa,ya,za,ab);if(!fb&&this.isVideoAttachment(xa)){fb=o.create('div');da.render(va.renderVideo(xa,wa,ya),fb);}if(!fb&&xa.preview_url)fb=va.renderPreview(xa,ya,za,ab);if(!fb&&this.isFileAttachment(xa))if(xa.metadata&&q.isVoiceMessage(xa.metadata.type)){fb=o.create('div');var jb=va.renderAudioClip(xa,ya.message_id,cb,db);da.render(jb,fb);}else fb=wa?va.renderFileLink(xa):va.renderExtendedFileLink(xa);if(v.MercuryStoryAttachmentsGK&&!(this.isShareAttachment(xa)&&xa.share)&&fb)m.addClass(fb,"_1t06");return {error:eb,content:fb,bubblePreferred:this.isBubblePreferred(xa)};},isBubblePreferred:function(wa){return !this.isStickerAttachment(wa)&&!this.isSyncRequestAttachment(wa);},renderError:function(wa){var xa=g[':fb:mercury:attachment:error'].build();o.appendContent(xa.getNode('error'),wa.error_msg);return xa.getRoot();},renderSocialResolution:function(wa){var xa=g[':fb:mercury:attachment:social-resolution'].build();xa.setNodeContent('post',wa.share_xhp);return xa.getRoot();},renderChatXHP:function(wa){var xa=g[':fb:mercury:attachment:social-resolution'].build();xa.setNodeContent('post',wa.chat_xhp);return xa.getRoot();},renderOpenGraph:function(wa){var xa=wa.share_xhp.cloneNode(true);if(la.firefox())ja.set(xa,'minWidth','180px');return xa;},renderGenericShareable:function(wa){return va.renderExternalLink(wa);},renderExternalLink:function(wa){var xa=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',wa.name);wa.base_url&&xa.setNodeContent('shortLink',wa.base_url);var ya=xa.getNode('preview'),za=xa.getNode('image-link');za.setAttribute('href',wa.url);wa.rel&&za.setAttribute('rel',wa.rel);if(wa.preview_url){var ab=xa.getNode('preview-image'),bb=wa.preview_url,cb=ka(j.getRawUrlFromSafeUrl(bb));if(wa.animated_gif_uri){bb=ka(wa.animated_gif_uri);m.addClass(ya,"_dri");if(wa.name&&wa.name.__html==cb.toString())xa.setNodeContent('name','');}ab.setAttribute('src',bb);wa.preview_class&&m.addClass(ya,wa.preview_class);m.show(ab);}else{m.addClass(xa.getRoot(),'noMedia');m.hide(ya);}xa.getNode('name').setAttribute('href',wa.url);d(['LinkshimHandler'],function(db){db.setUpLinkshimHandling(xa.getNode('name'));db.setUpLinkshimHandling(xa.getNode('image-link'));});if(wa.rel)xa.getNode('name').setAttribute('rel',wa.rel);return xa.getRoot();},renderFileLink:function(wa){var xa=null;if(wa.url===''){xa=':fb:mercury:attachment:file-name';return ua(wa,xa).getRoot();}else{xa=':fb:mercury:attachment:file-link';return ta(wa,xa).getRoot();}},renderAudioClip:function(wa,xa,ya,za){var ab=wa.metadata.duration/1000,bb=200;if(ya&&za)if(ab<5){bb=ya;}else bb=(1-Math.pow(10,(ab-5)/-30))*(za-ya)+ya;return (da.createElement(h,{src:wa.url,duration:wa.metadata.duration/1000,showHelp:false,width:bb}));},renderVideo:function(wa,xa,ya){var za=xa?wa.metadata.chat_size:wa.metadata.inbox_size,ab=xa?wa.metadata.chat_preview:wa.metadata.inbox_preview,bb=wa.metadata.dimensions;if(!za){ab=wa.thumbnail_url;za=bb={height:wa.preview_height,width:wa.preview_width};}return (da.createElement(u,{duration:wa.metadata.duration,isInbound:x.isInbound(ya),isChat:xa,name:wa.name,pageID:wa.metadata.pageid,thumbSize:za,thumbnail:ab,videoSize:bb,videoID:wa.metadata.fbid,videoURI:wa.url}));},renderExtendedFileLink:function(wa){var xa=null;if(wa.url===''){xa=':fb:mercury:attachment:file-name';return ua(wa,xa).getRoot();}xa=':fb:mercury:attachment:extended-file-link';var ya=ta(wa,xa);if(wa.open_url){var za=ya.getNode('openLinkContainer');m.show(za);var ab=ya.getNode('openFile');ab.setAttribute('href',wa.open_url);}var bb=ya.getNode('downloadFile');bb.setAttribute('href',wa.url);wa.rel&&bb.setAttribute('rel',wa.rel);return ya.getRoot();},renderMusic:function(wa){var xa=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',wa.name),ya=xa.getNode('link');ya.setAttribute('href',wa.url);ya.setAttribute('target','_blank');wa.rel&&ya.setAttribute('rel',wa.rel);var za=xa.getNode('image-link');za.setAttribute('href',wa.url);wa.rel&&za.setAttribute('rel',wa.rel);var ab=xa.getNode('preview-image');ab.setAttribute('src',wa.preview_url);m.show(ab);m.addClass(xa.getNode('icon_link'),'MercuryMusicIcon');return xa.getRoot();},renderSyncRequest:function(wa){var xa=k(wa.metadata),ya=o.create('div');da.render(xa,ya);return ya;},renderP2PMercuryAttachment:function(wa,xa){var ya={metadata:wa.metadata};if(!xa)ya.theme='messages';var za=da.createElement(l,da.__spread({},ya)),ab=o.create('div');da.render(za,ab);return ab;},resizeContain:function(wa,xa){var ya=wa.width/wa.height,za=xa.width/xa.height;if(za<ya){return {width:Math.min(wa.height*za,xa.width),height:Math.min(wa.height,xa.height)};}else return {width:Math.min(wa.width,xa.width),height:Math.min(wa.width/za,xa.height)};},renderPreview:function(wa,xa,ya,za){var ab=g[':fb:mercury:attachment:preview'].build(),bb=ab.getNode('image-link');if(wa){wa.url&&bb.setAttribute('href',wa.url);wa.rel&&bb.setAttribute('rel',wa.rel);if(wa.rel==='async'&&wa.hires_url){bb.setAttribute('href',wa.hires_url);bb.setAttribute('ajaxify',wa.url);}var cb;if(wa.preview_uploading){var db=ab.getNode('cancel-button-container');m.show(db);var eb=ab.getNode('cancel-button'),fb=p.listen(eb,'click',function(){wa.upload_canceled(wa.upload_id);m.hide(ab.getRoot());fb.remove();});wa.on_success(function(event,mb){if(mb.upload_id==wa.upload_id){m.hide(db);fb.remove();}});var gb=ab.getNode('progress-bar'),hb=new ca(gb),ib=ab.getNode('progress-bar-container');oa(wa.upload_id);wa.on_progress(function(event,mb){if(mb.upload_id==wa.upload_id){m.removeClass(ib,"_395w");m.show(ib);pa(hb,mb.event);}});if(wa.on_resizing_progress)wa.on_resizing_progress(function(event,mb){if(mb.upload_id==wa.upload_id){m.addClass(ib,"_395w");m.show(ib);hb.setPosition(100*mb.event.written/mb.event.total);}});m.addClass(bb,"_57jm");if(ya>=176){cb='/images/photos/dots_large.png';}else if(ya>=86){cb='/images/photos/dots_medium.png';}else cb='/images/photos/dots_small.png';ja.set(bb,'width',ya+'px');ja.set(bb,'max-width',ya+'px');if(wa.preview_width&&wa.preview_height)ja.set(bb,'padding-bottom',((wa.preview_height/wa.preview_width)*100)+'%');}else if(wa.preview_loading){m.addClass(bb,"_5xdv");if(za==='contain'&&wa.preview_width&&wa.preview_height){ja.set(bb,'width',wa.preview_width+'px');ja.set(bb,'height',wa.preview_height+'px');}if(za==='cover'&&!sa)m.addClass(bb,"_55pj");}else if(wa.metadata&&wa.metadata.fbid){cb=ka('/ajax/mercury/attachments/photo.php').addQueryData({fbid:wa.metadata.fbid,request_user_id:wa.metadata.pageid,mode:za,width:ya,height:ya}).toString();var jb=bb.getAttribute('ajaxify');bb.removeAttribute('ajaxify');bb.removeAttribute('rel');p.listen(bb,'click',function(event){event.prevent();i.loadModules(["MessagesViewer"],function(mb){mb.bootstrapWithConfig({src:cb,endpoint:jb,fbid:wa.metadata.fbid,dimensions:wa.metadata.dimensions,disablePaging:xa&&xa.attachments.length==1},bb);});});}else cb=ka(wa.preview_url).toString();var kb=ab.getNode('preview-image');if(cb){if(za==='contain'&&wa.preview_width&&wa.preview_height){var lb=va.resizeContain({width:ya,height:ya},{width:wa.preview_width,height:wa.preview_height});kb.setAttribute('width',lb.width);kb.setAttribute('height',lb.height);}if(wa.preview_uploading||(za==='cover'&&!sa)){m.addClass(bb,"_55pj");ja.set(bb,'backgroundImage','url('+cb+')');}else{kb.onload=function(){kb.removeAttribute('width');kb.removeAttribute('height');};kb.setAttribute('src',cb);}}if(xa)this.renderReportRespondLink(ab.getRoot(),wa,xa.message_id);}return ab.getRoot();},renderShareLink:function(wa,xa,ya){var za=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',wa.name),ab=za.getNode('link');ab.setAttribute('href',wa.url);wa.rel&&ab.setAttribute('rel',wa.rel);return za.getRoot();},renderVideoThumb:function(wa){var xa=g[':fb:mercury:attachment:video-thumb'].build(),ya=xa.getNode('thumb');ya.setAttribute('href',wa.url);ya.setAttribute('rel',wa.rel);var za=o.find(xa.getRoot(),'img');za.src=wa.preview_url;return xa.getRoot();},renderShareXHP:function(wa,xa){var ya=o.create('div');if(wa){o.appendContent(ya,wa.share_xhp);this.renderReportRespondLink(ya,wa,xa);}return ya;},renderSticker:function(wa,xa,ya,za){var ab=ya?'chatScrolled/':'messengerScrolled/';ab+=xa.thread_id;var bb=o.create('div');m.addClass(bb,'stickerContainer');if(!wa.metadata){var cb=ha.getSticker(xa.sticker_id),db=Object.assign({},cb),eb=ia.getScaledDimensions(cb.height,cb.width,ga.THREAD_SIZE),fb=eb.height,gb=eb.width;db.height=fb;db.width=gb;db.stickerID=xa.sticker_id;db.spriteURI='';db.spriteURI2x='';db.paddedSpriteURI='';db.paddedSpriteURI2x='';wa.metadata=db;}var hb=null;if(wa.metadata.stickerID)hb=wa.metadata.stickerID.toString();var ib=null;if(wa.metadata.packID)ib=wa.metadata.packID.toString();var jb=qa.getURIBuilder().setInt('sticker_id',hb),kb=null,lb=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){lb=wa.metadata.paddedSpriteURI2x;kb=wa.metadata.spriteURI2x;}else{lb=wa.metadata.paddedSpriteURI;kb=wa.metadata.spriteURI;}var mb=da.createElement(ea,{animationTrigger:"hover",className:"mvs",frameCount:wa.metadata.frameCount||1,frameRate:wa.metadata.frameRate||83,framesPerCol:wa.metadata.framesPerCol||1,framesPerRow:wa.metadata.framesPerRow||1,onStickerClick:za,packID:ib,paddedSpriteURI:lb,sourceHeight:wa.metadata.height,sourceURI:jb.setEnum('image_type',fa.IMAGE).getURI().toString(),sourceWidth:wa.metadata.width,spriteURI:kb,stickerID:hb,subscribedThreadID:ab});da.render(mb,bb);return bb;},renderReportRespondLink:function(wa,xa,ya){if(!xa.is_social_report_attachment)return null;switch(xa.share_data_type){case n.MercurySupportedShareType.FB_PHOTO:break;case n.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var za=null;if(ya)za=ra.getMessagesFromIDs([ya])[0];if(!za)return null;if(za.author===ba.getID())return null;var ab=null;y.get(za.author,function(bb){ab=o.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:ka('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:xa.attach_id,post_fbid:xa.shared_object_id,sender_id:w.getUserIDFromParticipantID(bb.id)}).toString()});o.setContent(ab,na._("Respond to {name}'s request",[na.param("name",bb.name)]));o.appendContent(wa,ab);});},renderPhotoAttachments:function(wa,xa,ya,za,ab){var bb=wa.length;if(!bb)return null;var cb=o.create('div',{className:(("_55pk")+(v.MercuryImageBubblesGK&&!!xa.body?' '+"_9id":''))});if(bb===1){if(v.MercuryImageBubblesGK&&!xa.body&&ab){var db=wa[0],eb=va.resizeContain({width:ya,height:ya},{width:db.preview_width,height:db.preview_height});da.render(da.createElement(r,{image:db,width:eb.width,height:eb.height,message:xa}),cb);}else{var fb=va.renderPreview(wa[0],xa,ya,'contain');o.appendContent(cb,fb);}return cb;}if(v.MercuryImageBubblesGK&&!xa.body&&ab){da.render(da.createElement(s,{images:wa,size:ya,message:xa}),cb);return cb;}var gb=(bb==2||bb==4)?2:3,hb=(ya-(gb-1)*za)/gb,ib=Math.ceil(bb/gb),jb=ib*hb+(ib-1)*za,kb=o.create('div',{className:"_55pm",style:'padding-bottom: '+(jb/ya*100)+'%;'});o.appendContent(cb,kb);for(var lb=0;lb<bb;++lb){var mb=va.renderPreview(wa[lb],xa,hb,'cover'),nb=lb%gb,ob=Math.floor(lb/gb);m.addClass(mb,"_55pn");ja.apply(mb,{width:(hb/ya*100)+'%',left:((nb*(hb+za))/ya*100)+'%',top:((ob*(hb+za))/jb*100)+'%'});o.appendContent(kb,mb);}return cb;},isPhotoAttachment:function(wa){return wa.attach_type==t.PHOTO||wa.attach_type==t.ANIMATED_IMAGE||(wa.attach_type==t.FILE&&wa.preview_url);},isVideoAttachment:function(wa){return wa.attach_type==t.VIDEO;},isShareAttachment:function(wa){return wa.attach_type==t.SHARE;},isFileAttachment:function(wa){return wa.attach_type==t.FILE;},isErrorAttachment:function(wa){return wa.attach_type==t.ERROR;},isStickerAttachment:function(wa){return wa.attach_type==t.STICKER;},isSyncRequestAttachment:function(wa){var xa=n.MercurySupportedShareType;return this.isShareAttachment(wa)&&wa.share_data_type==xa.FB_SYNC_REQUEST;},sortAttachmentsStablyByType:function(wa){var xa=[va.isPhotoAttachment,va.isShareAttachment,va.isFileAttachment,va.isErrorAttachment];xa.push(function(za){return true;});var ya=xa.map(function(za){return [];});wa.forEach(function(za){for(var ab=0;ab<xa.length;ab++)if(xa[ab](za)){ya[ab].push(za);break;}});return Array.prototype.concat.apply([],ya);}};e.exports=va;},null);
__d("MNCommerceLogMessageUtils",["Link.react","MercuryIDs","MNCommerceUnlinkDataManager","MNCommerceDialogStateActions","MNCommerceReplyTypes","MNCommerceUnlinkDialogContainer.react","React","cx","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=b('MercuryThreads').get();function q(){}q.prototype.isCommercePageAdminMessage=function(r){return !!(r&&r.log_message_data&&r.log_message_data.replyType===k.COMMERCE_LINK);};q.prototype.getCommercePageUnlink=function(r){var s=function(){var t=h.getUserIDFromParticipantID(r.author),u=p.getThreadMetaNow(r.thread_id),v=null;u.participants.every(function(x){if(x!==r.author){v=h.getUserIDFromParticipantID(x);return false;}return true;});var w=function(){j.hideDialog();i.unlink(t,v);};j.showDialog(l,{onTurnOffButtonClick:w});};return (m.createElement("span",null,r.log_message_body,' ',m.createElement(g,{className:"_2w2m",onClick:s},o._("Not You?"))));};e.exports=new q();},null);
__d("P2PMercuryLogMessage.react",["Link.react","P2PLinkConstants","P2PPaymentLogMessageSubtype","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"P2PMercuryLogMessage",propTypes:{formattedAmount:n.string,receiverParticipant:n.object,senderParticipant:n.object,subtype:n.oneOf(Object.keys(i).map(function(p){return i[p];})),viewerIsSender:n.bool},getDefaultProps:function(){return {formattedAmount:'',senderParticipant:null,receiverParticipant:null,subtype:null,viewerIsSender:false};},render:function(){var p=null,q=this.props.formattedAmount,r=this.props.subtype,s=this.props.viewerIsSender,t=j.createElement(g,{className:"_kiq",href:h.settingsWWWURI,target:"_blank"},l._("See details."));switch(r){case i.SENT_IN_GROUP:p=(l._("{sendername} sent {amount} to {receivername}.",[l.param("sendername",this.props.senderParticipant.short_name),l.param("amount",q),l.param("receivername",this.props.receiverParticipant.short_name)]));break;case i.CANCELED_EXPIRED:case i.CANCELED_SAME_CARD:case i.CANCELED_SENDER_RISK:case i.CANCELED_RECIPIENT_RISK:case i.CANCELED_CUSTOMER_SERVICE:if(s){p=(l._("Your {amount} payment was canceled. {details}",[l.param("amount",q),l.param("details",t)]));}else p=(l._("{firstname}'s {amount} payment was canceled. {details}",[l.param("firstname",this.props.senderParticipant.short_name),l.param("amount",q),l.param("details",t)]));break;case i.CANCELED_DECLINED:if(s){p=(l._("{firstname} didn't accept your {amount} payment. {details}",[l.param("firstname",this.props.receiverParticipant.short_name),l.param("amount",q),l.param("details",t)]));}else p=(l._("You didn't accept {firstname}'s {amount} payment. {details}",[l.param("firstname",this.props.senderParticipant.short_name),l.param("amount",q),l.param("details",t)]));break;}return j.createElement("div",null,p);}});e.exports=o;},null);
__d("MercuryLogMessageRenderer",["MercuryAttachmentRenderer","MercuryCallLogMessage.react","CSS","DOM","HovercardLink","MercuryIDs","MercuryViewer","MercuryLogMessageType","MNCommerceLogMessageUtils","P2PMercuryLogMessage.react","MercuryParticipants","React","Image.react","TextWithEntities.react","TooltipLink.react","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y={renderText:function(pa,qa){switch(pa.log_message_type){case n.SUBSCRIBE:aa(pa,qa);break;case n.UNSUBSCRIBE:fa(pa,qa);break;case n.VIDEO_CALL:case n.PHONE_CALL:ha(pa,qa);break;case n.THREAD_NAME:ia(pa,qa);break;case n.THREAD_IMAGE:ja(pa,qa);break;case n.WALLPAPER:ka(pa,qa);break;case n.SERVER_ERROR:la(pa,qa);break;case n.ORION:ma(pa,qa);break;case n.PAGE_REPLY:ga(pa,qa);break;}},renderIcon:function(pa){return (r.createElement(s,{className:z(pa),src:x('images/spacer.gif')}));},renderLegacy:function(pa,qa,ra,sa){z(sa).split(' ').forEach(function(ta){return ta&&i.addClass(pa,ta);});this.renderText(sa,function(ta){r.render(r.createElement("span",null,ta),qa);});this.renderAttachmentLegacy(ra,sa);},renderAttachmentLegacy:function(pa,qa){if(qa.log_message_type==n.THREAD_IMAGE){var ra=qa.log_message_data.image;if(ra){var sa=g.renderPreview(ra.preview_url?ra:null);j.setContent(pa,sa);i.addClass(sa,"_z6a");i.show(pa);}}}};e.exports=y;function z(pa){var qa=pa.log_message_type,ra=pa.log_message_data;return (("_5wzu")+(qa==n.SUBSCRIBE?' '+"_5wzj":'')+(qa==n.UNSUBSCRIBE?' '+"_5wzk":'')+(qa==n.THREAD_NAME?' '+"_5wzl":'')+(qa==n.THREAD_IMAGE?' '+"_5wzm":'')+(qa==n.VIDEO_CALL&&ra.answered?' '+"_5wzn":'')+(qa==n.VIDEO_CALL&&!ra.answered?' '+"_5wzo":'')+(qa==n.PHONE_CALL&&ra.answered?' '+"_5wzp":'')+(qa==n.PHONE_CALL&&!ra.answered?' '+"_5wzq":'')+(qa==n.SERVER_ERROR?' '+"_5wzr":''));}function aa(pa,qa){var ra=oa(pa.log_message_data.added_participants);switch(ra.length){case 1:ba(pa,qa,ra);break;case 2:ca(pa,qa,ra);break;case 3:da(pa,qa,ra);break;default:ea(pa,qa,ra);break;}}function ba(pa,qa,ra){var sa=[pa.author,ra[0]];q.getMulti(sa,function(ta){if(pa.author==m.getID()){qa(w._("You added {subscriber1}.",[w.param("subscriber1",na(ta[ra[0]]))]));}else if(ra[0]==m.getID()){qa(w._("{actor} added you.",[w.param("actor",na(ta[pa.author]))]));}else qa(w._("{actor} added {subscriber1}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber1",na(ta[ra[0]]))]));});}function ca(pa,qa,ra){var sa=[pa.author].concat(ra);q.getMulti(sa,function(ta){if(pa.author==m.getID()){qa(w._("You added {subscriber1} and {subscriber2}.",[w.param("subscriber1",na(ta[ra[0]])),w.param("subscriber2",na(ta[ra[1]]))]));}else if(ra[0]==m.getID()){qa(w._("{actor} added you and {subscriber2}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber2",na(ta[ra[1]]))]));}else qa(w._("{actor} added {subscriber1} and {subscriber2}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber1",na(ta[ra[0]])),w.param("subscriber2",na(ta[ra[1]]))]));});}function da(pa,qa,ra){var sa=[pa.author].concat(ra);q.getMulti(sa,function(ta){if(pa.author==m.getID()){qa(w._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param("subscriber1",na(ta[ra[0]])),w.param("subscriber2",na(ta[ra[1]])),w.param("subscriber3",na(ta[ra[2]]))]));}else if(ra[0]==m.getID()){qa(w._("{actor} added you, {subscriber2} and {subscriber3}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber2",na(ta[ra[1]])),w.param("subscriber3",na(ta[ra[2]]))]));}else qa(w._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber1",na(ta[ra[0]])),w.param("subscriber2",na(ta[ra[1]])),w.param("subscriber3",na(ta[ra[2]]))]));});}function ea(pa,qa,ra){var sa=[pa.author].concat(ra);q.getMulti(sa,function(ta){function ua(wa){var xa=r.createElement("div",null,wa.map(function(ya){return r.createElement("div",null,ya.name);}));return (r.createElement(u,{alignH:"center",position:"above",tooltip:xa},w._({"*":"{num} more"},[w.param("num",wa.length,[0])])));}var va=ra.map(function(wa){return ta[wa];});if(pa.author==m.getID()){qa(w._("You added {subscriber1}, {subscriber2} and {more_people}.",[w.param("subscriber1",na(va[0])),w.param("subscriber2",na(va[1])),w.param("more_people",ua(va.slice(2)))]));}else if(ra[0]==m.getID()){qa(w._("{actor} added you, {subscriber2} and {more_people}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber2",na(va[1])),w.param("more_people",ua(va.slice(2)))]));}else qa(w._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[w.param("actor",na(ta[pa.author])),w.param("subscriber1",na(va[0])),w.param("subscriber2",na(va[1])),w.param("more_people",ua(va.slice(2)))]));});}function fa(pa,qa){var ra=[pa.author],sa=pa.log_message_data.removed_participants,ta;if(sa.length===1){ta=sa[0];ra.push(ta);}q.getMulti(ra,function(ua){var va=ua[pa.author],wa=ua[ta];if(pa.author==m.getID()){if(!ta||ta==pa.author){qa(w._("You left the conversation."));}else qa(w._("You removed {name} from the conversation.",[w.param("name",na(wa))]));}else if(!ta||ta==pa.author){qa(w._("{actor} left the conversation.",[w.param("actor",na(va))]));}else if(ta==m.getID()){qa(w._("{actor} removed you from the conversation.",[w.param("actor",na(va))]));}else qa(w._("{actor} removed {name} from the conversation.",[w.param("actor",na(va)),w.param("name",na(wa))]));});}function ga(pa,qa){if(o.isCommercePageAdminMessage(pa)){qa(o.getCommercePageUnlink(pa));}else qa(pa.log_message_body);}function ha(pa,qa){var ra=pa.log_message_data.caller,sa=pa.log_message_data.callee,ta=pa.log_message_data.answered,ua=ra===m.getID(),va=ua?sa:ra;q.get(va,function(wa){var xa=l.getUserIDFromParticipantID(wa.id),ya=wa.short_name?wa.short_name:wa.name;qa(r.createElement(h,{peerFBID:xa,peerName:ya,isAnswered:ta,isOutgoingCall:ua}));});}function ia(pa,qa){var ra=pa.log_message_data.name;if(pa.author==m.getID()){if(ra){qa(w._("You named the conversation: {name}.",[w.param("name",r.createElement("span",{className:"_5wzs"},r.createElement(t,{renderEmoticons:true,renderEmoji:true,text:ra})))]));}else qa(w._("You removed the conversation name."));}else q.get(pa.author,function(sa){var ta=na(sa);if(ra){qa(w._("{actor} named the conversation: {name}.",[w.param("actor",ta),w.param("name",r.createElement("span",{className:"_5wzs"},ra))]));}else qa(w._("{actor} removed the conversation name.",[w.param("actor",ta)]));});}function ja(pa,qa){if(pa.author==m.getID()){if(pa.log_message_data.image){qa(w._("You changed the conversation picture."));}else qa(w._("You removed the conversation picture."));}else q.get(pa.author,function(ra){var sa=na(ra);if(pa.log_message_data.image){qa(w._("{actor} changed the conversation picture.",[w.param("actor",sa)]));}else qa(w._("{actor} removed the conversation picture.",[w.param("actor",sa)]));});}function ka(pa,qa){if(pa.author==m.getID()){qa(w._("You changed the wallpaper."));}else q.get(pa.author,function(ra){var sa=na(ra);qa(w._("{actor} changed the wallpaper.",[w.param("actor",sa)]));});}function la(pa,qa){qa(w._("Couldn't find previous messages."));}function ma(pa,qa){var ra=pa.log_message_data,sa=ra.senderId,ta=ra.receiverId,ua=sa===m.getID();q.getMulti([sa,ta],function(va){qa(r.createElement(p,r.__spread({},ra,{receiverParticipant:va[ta],senderParticipant:va[sa],viewerIsSender:ua})));});}function na(pa,qa){var ra=pa.fbid,sa=k.constructEndpoint({id:ra});if(pa.href)return (r.createElement("a",{className:"_5wzt",href:pa.href,"data-hovercard":sa},qa?pa.short_name:pa.name));return pa.name;}function oa(pa){var qa=pa.indexOf(m.getID());if(qa>0){var ra=pa.filter(function(sa){return sa!==m.getID();});return [m.getID()].concat(ra);}return pa;}},null);
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.createElement("a",{href:"/help/224049364288051"},h._("Learn more")))]));}else return (h._("You cannot reply to this conversation."));}};e.exports=i;},null);
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={canReplaceOpenSheet:function(h,i){if(h.isSheetWithInput&&h.isSheetWithInput())return i.getType()!=h.getType()&&i.isSheetWithInput&&i.isSheetWithInput();if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;},null);
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;},null);
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){event.stopPropagation();if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable()){this._tokenizer.removeToken(t);return;}}else{this._typeahead.getCore().reset();return;}this.inform('esc-pressed');return;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;},null);