/*!CK:2921772024!*//*1430113716,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["vz5Do"]); }

__d("ChatPerfEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={TTI:"tti"};},null);
__d("GenderConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("P2PTransferRiskResult",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SUCCESS:"SUCCESS",UNDER_MANUAL_REVIEW:"UNDER_MANUAL_REVIEW",REQUIRE_VERIFICATION:"REQUIRE_VERIFICATION"};},null);
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;},null);
__d("getURLRanges",["URI","URLScraper"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';function i(j,k){k=k||0;var l=h.match(j);if(!l)return [];var m=l;if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(l)))m='http://'+l;if(!g.isValidURI(m))return [];k+=j.indexOf(l);var n=l.length,o=[{offset:k,length:l.length,entity:{url:m}}];return o.concat(i(j.substr(k+n),k+n));}e.exports=i;},null);
__d("MercuryMessageBody.react",["EmoticonsList","React","Link.react","P2PTriggersUtils","ReactComponentWithPureRenderMixin","SupportedEmoji","TextWithEntities.react","URI","URLMatcher","cancelAnimationFrame","cx","fbt","getURLRanges","isFacebookURI","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=h,w=v.PropTypes,x=h.createClass({displayName:"MercuryMessageBody",mixins:[k],propTypes:{body:w.string,ranges:w.array,threadID:w.string},getInitialState:function(){return {richText:false};},componentDidMount:function(){this._raf=u(this.setIsRichText);},targetBlankLinkInterpolator:function(y,z){if(z.entity&&z.entity.url){var aa=new n(z.entity.url);if(t(aa)&&!aa.getFragment())z.entity.url=aa.addQueryData({__mref:'message_bubble'}).toString();}return (h.createElement(i,{target:"_blank",href:z.entity},y));},setIsRichText:function(){delete this._raf;var y=this.props,z=y.body,aa=y.ranges;if((aa&&aa.length)||g.noncapturingRegexp.test(z)||l.findEmoji(z||'')||o.match(z)||!!(j.canSeeTriggers()&&j.getMatches(z)))this.setState({richText:true});},componentWillUnmount:function(){this._raf&&p(this._raf);},render:function(){var y=this.props.body||'';if(y.startsWith('?OTR'))return (h.createElement("span",{className:"_89h"},r._("[encrypted message]")));y=y.replace(/\s+$/,'');if(y.length===0)return null;if(!this.state.richText)return h.createElement("span",{className:this.props.className},y);var z=this.props.ranges;if(z==undefined)z=s(y);return (h.createElement(m,{className:this.props.className,interpolator:this.targetBlankLinkInterpolator,text:y,ranges:z,renderEmoticons:true,renderEmoji:true,renderP2PTriggers:j.canSeeTriggers(),threadID:this.props.threadID}));}});e.exports=x;},null);
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;},null);
__d("DataViewPolyfill",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';function g(h,i,j){if(i===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h);}else if(j===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h,i);}else this.$DataViewPolyfill0=new Uint8Array(h,i,j);this.byteLength=this.$DataViewPolyfill0.byteLength;}g.prototype.getUint8=function(h){if(h>=this.$DataViewPolyfill0.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill0[h];};g.prototype.getUint16=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1);return i?(k*256)+j:(j*256)+k;};g.prototype.getUint32=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1),l=this.getUint8(h+2),m=this.getUint8(h+3);return i?(((m*256+l)*256+k)*256)+j:(((j*256+k)*256+l)*256)+m;};g.isSupported=function(){return !!a.Uint8Array;};e.exports=g;},null);
__d("MNCommerceDialogContainer.react",["MNCommerceDialogStateStore","PureStoreBasedStateMixin","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i.createClass({displayName:"MNCommerceDialogContainer",mixins:[h(g)],statics:{calculateState:function(){var k=g.getDialogContainer();return {dialogContainer:k};}},render:function(){var k=this.state.dialogContainer;if(!k)return null;return i.createElement(k,null);}});e.exports=j;},null);
__d("ChatCookieInterface",["ChatConfig","InitialServerTime","LogHistory","PresenceState","PresenceUtil"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i.getInstance('chat_cookie'),m=h.serverTime,n=g.get('tab_max_load_age')||3600000,o=m-n,p={store:function(r,s){if(r.uct2==s.lastChangeTime)return r;var t=q(r,s),u={};if(!t){u.old_tabs=r&&r.t2&&JSON.stringify(r.t2);u.old_promoted=r&&r.lm2;u.old_time=r&&r.uct2;u.old_reason=r&&r.tr;u.old_window=r&&r.tw;var v=[];s.tabs.forEach(function(w){if(!w.fragile){var x={i:w.id,si:w.server_id};if(w.raised)x.r=1;v.push(x);}});r.t2=v;r.lm2=s.promotedTab;r.uct2=s.lastChangeTime;r.tr=s.lastChangeReason;r.tw=k.getSessionID();u.new_tabs=JSON.stringify(r.t2);u.new_promoted=r.lm2;u.new_time=r.uct2;u.new_reason=r.tr;u.new_window=r.tw;l.debug('store',u);}else{u.tabs=r&&r.t2&&JSON.stringify(r.t2);u.promoted=r&&r.lm2;u.time=r&&r.uct2;u.reason=r&&r.tr;u.window=r&&r.tw;u.last_change_time=s.lastChangeTime;u.last_change_reason=s.lastChangeReason;u.min_change_time=o;l.warn('store_bad_state',u);}return r;}};function q(r,s){var t=j.verifyNumber(r.uct2);if(!t||typeof t!=='number'){l.warn('bad_cookie_version',r);return null;}if(t<s.lastChangeTime||t<o)return null;return t;}e.exports=p;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryIDs"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={};function k(l){var m=i.getUserIDFromThreadID(l);if(m&&g.shouldUpdateForID(m))g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification(g._("You were tagged in a message!"),{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("ChatTabViewInstances",["Map"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatNewMessageHandler",["ChatActivity","ChatMentionsNotifications","ChatTabModel","ChatTabViewInstances","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","MercuryConfig","MercuryThreadlistConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.create('chat_new_message'),r={_notify:function(s,t,u){if(o.DesktopNotificationsGK)h.notifyIfMessageToMe(t);var v=j.get(s);u.view_is_visible=v&&v.isVisible();u.view_is_focused=v&&v.isFocused();if(!u.view_is_visible)q.log('message_to_hidden');u.is_active=g.isActive();m.messageReceived(t);},newMessage:function(s,t){l.isThreadID(s);var u=i.getTab(s),v={thread_id:s,message_id:t.message_id,to_new_tab:!u,to_raised_tab:u?!!u.raised:true};this._notify(s,t,v);q.log('message',v);}};m.subscribe('before-alert',function(s,event){var t=event.threadID,u=j.get(t),v=i.getTab(t),w=p.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(v&&v.raised&&u&&u.isVisible()&&u.isFocused()&&n.isActive(w)){u.tryMarkAsRead();event.cancelAlert();}});e.exports=r;},null);
__d("ChatTabLRUManager",["ChatTabViewInstances","ChatTabModel","InitialServerTime","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryThreads').get(),k={getLRUVisibleTab:function(l){if(l.hasRoomForRaisedTab())return (void 0);var m=Object.keys(l.getTabsToShow()||{}),n=1*60,o=null,p=Infinity;for(var q=0;q<m.length;q++){var r=m[q],s=j.getThreadMetaNow(r);if(h.isTabPromoted(r))continue;if(!g.get(r).hasEmptyInput()||!s)continue;var t=(i.serverTime-s.timestamp)/1000;if(!s.timestamp||(s.timestamp&&s.timestamp<p&&t>n)){o=s.thread_id;p=s.timestamp;}}return o;}};e.exports=k;},null);
__d("ChatTabPolicy",["ChatBehavior","JSLogger","MercuryActionType","MercuryLogMessageType","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercurySourceType","MercuryThreadInfo","MercuryThreadMode","MercuryViewer","MessagingTag","PresencePrivacy","ShortProfiles","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryThreadActions').get(),v=h.create('tab_policy');e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(o.isMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};v.log('message_thread_muted',ba);return;}if(w.mode==p.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};v.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};v.log('message_source_not_allowed',ba);return;}var ca=l.getUserIDFromParticipantID(x.author);if(!ca){v.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=i.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(x,w)){ba={thread_id:z,message_id:aa,type:x.action_type};v.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){v.log('message_jabber',{thread_id:z,message_id:aa});u.markSeen(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){v.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(w.folder!=r.INBOX){v.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserIDFromParticipantID(q.getID());t.getMulti([ca,da],function(ea){if(!s.allows(ca)){v.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&!ea[ca].isCommercePage&&ea[ca].type!==m.FRIEND){v.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});},_messageIsNewlyCreatedGroup:function(w,x){return w.action_type===i.LOG_MESSAGE&&w.log_message_type===j.THREAD_NAME&&x.message_count===1;}};},null);
__d("ChatTabViewEvents",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatTabViewSelector",["Event","Arbiter","ChatTabActions","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=b('MercuryThreadInformer').get(),s=b('MercuryThreads').get(),t=b('MercuryThreadMetadataRenderer').get();function u(v){var w=o[':fb:chat:tab:selector'].build(),x=w.getRoot(),y=w.getNode('menu'),z=l.find(y,'.uiMenuInner'),aa={},ba=new n().init(x);j.hide(x);l.insertBefore(v,x);function ca(fa){var ga=0;for(var ha in aa){var ia=aa[ha],ja=s.getThreadMetaNow(ha),ka=ia.getNode('unreadCount'),la=(ja&&ja.unread_count)||0;ga+=la;if(la>9)la='+';j.conditionClass(ka,'invisible_elem',!la);l.setContent(ka,la);}var ma=w.getNode('numMessages');j.conditionShow(ma,ga);l.setContent(ma,ga);}this.setTabData=function(fa){aa={};if(fa.length<1){j.hide(x);return;}j.show(x);l.empty(z);fa.forEach(function(ga){var ha=o[':fb:chat:tab:selector:item'].build();aa[ga.id]=ha;var ia=ha.getNode('content');t.renderAndSeparatedParticipantList(ga.id,ia);l.prependContent(z,ha.getRoot());k.set(ha.getRoot(),'threadID',ga.id);var ja=ha.getNode('closeButton');g.listen(ja,'click',function(event){i.closeTab(ga.id,'selector/close-tab');event.kill();});});ba.flyoutContentChanged();l.setContent(w.getNode('numTabs'),fa.length);ca();};function da(event,fa){if(fa.menu!=y)return;var ga=k.get(fa.item,'threadID');u.inform('selected',ga);p.hide(x);}function ea(event,fa){m.register(y);}m.subscribe('select',da.bind(this));p.listen('show',x,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ea();});p.listen('hide',x,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});r.subscribe('threads-updated',ca);}q(u,new h());e.exports=u;},null);
__d("ChatAddToThreadButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i,n=m.PropTypes,o=i.createClass({displayName:"ChatAddToThreadButton",mixins:[h],propTypes:{isFBAtWork:n.bool,onClick:n.func,shown:n.bool},render:function(){var p=this.props.isFBAtWork?l._("Add more co-workers to chat"):l._("Add more friends to chat"),q=j.getTrackingInfo(j.types.ADD_TO_THREAD);return (i.createElement(g,{"aria-label":p,className:(("addToThread")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":q,"data-hover":"tooltip","data-tooltip-alignv":"top",onClick:this.props.onClick}));}});e.exports=o;},null);
__d("ChatArchiveWarning.react",["Image.react","ReactComponentWithPureRenderMixin","React","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatArchiveWarning",mixins:[h],propTypes:{isFBAtWork:m.bool,shown:m.bool},render:function(){var o=this.props.isFBAtWork?k('images/chat/tab/archive-grey.png'):k('images/chat/tab/archive.png');return (i.createElement(g,{src:o,className:(("titanArchiveWarning")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-hover":"tooltip","data-tooltip-alignh":"center","aria-label":"All employee-to-employee conversations will be archived"}));}});e.exports=n;},null);
__d("ChatCloseButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatCloseButton",mixins:[h],propTypes:{onClick:m.func,onKeyUp:m.func,onMouseDown:m.func,active:m.bool},getDefaultProps:function(){return {active:false};},render:function(){var o=j.getTrackingInfo(j.types.CLOSE_BUTTON),p=k._("Press Esc to close"),q=k._("Close tab");return (i.createElement(g,{"aria-label":this.props.active?p:q,className:"close button","data-ft":o,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp,onMouseDown:this.props.onMouseDown}));}});e.exports=n;},null);
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryIDs","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getUserIDFromThreadID(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;},null);
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=60000,o=false,p=function(w,x){this._videoCallTour=new k();this._threadID=w;this._tabMainElement=x;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function q(w,event,x){if(w._openDialog)w._openDialog.updatePosition();}function r(w){if(w._openDialog)w._openDialog.updatePosition();}function s(w){if(w._openDialog){w._openDialog.hide();w._openDialog=null;}if(w._timeout){clearTimeout(w._timeout);w._timeout=null;}while(w._subscriptionTokens.length)w._subscriptionTokens.pop().unsubscribe();if(w._scrollListener){w._scrollListener.remove();w._scrollListener=null;}}function t(w,event,x){if(x.thread_id===w._threadID){w._openDialog=x.dialog;v(w);w._timeout=m(w.destroy.bind(w,w._threadID),n);w._scrollListener=g.listen(window,'scroll',r.bind(null,w));}}function u(w,x){if(!w._openDialog){w._subscriptionTokens.push(x.subscribe('chat/dialog-rendered',t.bind(null,w)));x.render(w._tabMainElement,w._threadID);}}function v(w){w._subscriptionTokens.push(i.subscribe('chat/tabs-changed',q.bind(null,w)),p.subscribe('dialog/close-all',s.bind(null,w)));}l(p,h);l(p.prototype,{destroy:function(){s(this);},tabFocused:function(){if(o){u(this,this._videoCallTour);return;}},tabNotActive:function(){s(this);},hideVideoCallouts:function(){s(this);}});j.subscribe('videocallingtour/start',function(){o=true;p.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){o=false;});e.exports=p;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","ModulePerformanceGating","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';function ba(){return 'upload_'+s.getNewID();}var ca=aa(g);for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){this.$ChatAutoSendPhotoUploader0=ia;this.$ChatAutoSendPhotoUploader1=ha;this.$ChatAutoSendPhotoUploader2=new t();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=ga.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(ga,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ja=i.find(ga,"._4q60"),ka=i.find(ja,"._4q61");this.$ChatAutoSendPhotoUploader7=new m(ja,ka,ha);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploadera.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploaderb.bind(this)),j.listen(ka,'click',function(){if(this.$ChatAutoSendPhotoUploaderc===(void 0))this.$ChatAutoSendPhotoUploaderd();if(this.$ChatAutoSendPhotoUploaderc)if(o.prepareResource)o.prepareResource();this.inform('open');}.bind(this)));if(!q.js_module_defer_blob_creation)this.$ChatAutoSendPhotoUploaderd();}fa.prototype.$ChatAutoSendPhotoUploaderd=function(){this.$ChatAutoSendPhotoUploaderc=o.isSupported();if(this.$ChatAutoSendPhotoUploaderc)this.$ChatAutoSendPhotoUploader6.setPreprocessHandler(this.$ChatAutoSendPhotoUploadere.bind(this));};fa.prototype.isUploading=function(){return !z(this.$ChatAutoSendPhotoUploader3);};fa.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};fa.prototype.$ChatAutoSendPhotoUploaderf=function(ga,ha){var ia=this.$ChatAutoSendPhotoUploaderg(ga);if(ha){ia.preview_width=ha.width;ia.preview_height=ha.height;}return ia;};fa.prototype.$ChatAutoSendPhotoUploaderg=function(ga){var ha={upload_id:ga,on_progress:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ia));}.bind(this),on_resizing_progress:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ia));}.bind(this),on_success:function(ia){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ia));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderh.bind(this),attach_type:p.PHOTO,preview_uploading:true};return ha;};fa.prototype.$ChatAutoSendPhotoUploadere=function(ga,ha){var ia=ga.getFile();if(!r(ia.type).isJpeg())return ha(ga);o.getSingleton().resizeBlob(ia,function(ja,ka,la){if(ka)ga.setFile(ka);ha(ga);},this.$ChatAutoSendPhotoUploaderi.bind(this,ga));};fa.prototype.$ChatAutoSendPhotoUploader8=function(){var ga=ba();this.$ChatAutoSendPhotoUploaderj(ga,this.$ChatAutoSendPhotoUploader1.files);};fa.prototype.$ChatAutoSendPhotoUploaderj=function(ga,ha){var ia={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ha&&ha.length===1){this.$ChatAutoSendPhotoUploader3[ga]=ga;ia[ga]=ha[0];var ja=new FileReader();ja.onload=function(){this.inform('submit',{upload_id:ga,preview_attachments:[this.$ChatAutoSendPhotoUploaderf(ga,w(ja.result))]});}.bind(this);ja.onerror=function(){this.inform('submit',{upload_id:ga,preview_attachments:[this.$ChatAutoSendPhotoUploaderg(ga)]});}.bind(this);ja.readAsArrayBuffer(ha[0]);}else{var ka=[];if(!ha){this.$ChatAutoSendPhotoUploader3[ga]=ga;this.$ChatAutoSendPhotoUploader0.value=ga;ka.push(this.$ChatAutoSendPhotoUploaderg(ga));}else for(var la=0;la<ha.length;++la){var ma=ba();ia[ma]=ha[la];this.$ChatAutoSendPhotoUploader3[ma]=ga;ka.push(this.$ChatAutoSendPhotoUploaderg(ma));}this.inform('submit',{upload_id:ga,preview_attachments:ka});}if(Object.keys(ia).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(ia);};fa.prototype.$ChatAutoSendPhotoUploader9=function(event,ga){var ha=this.$ChatAutoSendPhotoUploaderk(ga);if(this.$ChatAutoSendPhotoUploader3[ha]){var ia=this.$ChatAutoSendPhotoUploader3[ha];delete this.$ChatAutoSendPhotoUploader3[ha];var ja=ga.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ia])this.$ChatAutoSendPhotoUploader4[ia]=[];this.$ChatAutoSendPhotoUploader4[ia].push({id:ha,audio_id:ja.metadata[0].audio_id,image_id:ja.metadata[0].image_id,file_id:ja.metadata[0].file_id,gif_id:ja.metadata[0].gif_id});this.inform('success',{upload_id:ha});if(!this.$ChatAutoSendPhotoUploaderl(ia))this.$ChatAutoSendPhotoUploaderm(ia);this.$ChatAutoSendPhotoUploader7.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader7.getInput();}};fa.prototype.$ChatAutoSendPhotoUploaderm=function(ga){y(!this.$ChatAutoSendPhotoUploaderl(ga));this.$ChatAutoSendPhotoUploader4[ga].sort(function(ha,ia){return ha.id<ia.id?-1:1;});this.inform('all-uploads-completed',{upload_id:ga,audio_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.audio_id;}),image_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.image_id;}),file_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.file_id;}),gif_ids:this.$ChatAutoSendPhotoUploader4[ga].map(function(ha){return ha.gif_id;})});delete this.$ChatAutoSendPhotoUploader4[ga];};fa.prototype.$ChatAutoSendPhotoUploaderb=function(event,ga){this.inform('progress',{upload_id:ga.upload.getName(),event:ga.event});};fa.prototype.$ChatAutoSendPhotoUploaderi=function(ga,event){this.inform('resize_progress',{upload_id:ga.getName(),event:event});};fa.prototype.$ChatAutoSendPhotoUploaderl=function(ga){return u(x(this.$ChatAutoSendPhotoUploader3),ga);};fa.prototype.$ChatAutoSendPhotoUploadera=function(event,ga){var ha=this.$ChatAutoSendPhotoUploaderk(ga);this.$ChatAutoSendPhotoUploadern(ha,'last-upload-failed');this.$ChatAutoSendPhotoUploader7.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader7.getInput();return false;};fa.prototype.$ChatAutoSendPhotoUploaderh=function(ga){this.$ChatAutoSendPhotoUploadern(ga,'last-upload-canceled');};fa.prototype.$ChatAutoSendPhotoUploadern=function(ga,ha){if(!this.$ChatAutoSendPhotoUploader3[ga])return;var ia=this.$ChatAutoSendPhotoUploader3[ga];delete this.$ChatAutoSendPhotoUploader3[ga];if(!this.$ChatAutoSendPhotoUploaderl(ia))if(this.$ChatAutoSendPhotoUploader4[ia]){this.$ChatAutoSendPhotoUploaderm(ia);}else this.inform(ha,{upload_id:ia});};fa.prototype.$ChatAutoSendPhotoUploaderk=function(ga){if(ga.upload){return ga.upload.getName();}else return ga.response.getPayload().uploadID;};fa.prototype.uploadFile=function(ga){var ha=ba(),ia={};ia[ha]=ga;var ja=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setFiles(ia);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ja.subscribe('success',function(event,ka){this.$ChatAutoSendPhotoUploader9(event,{upload:ka,response:ka.getResponse()});}.bind(this)),ja.subscribe('failure',this.$ChatAutoSendPhotoUploadera.bind(this)));ja.send();this.$ChatAutoSendPhotoUploaderj(ha,[ga]);};e.exports=fa;},null);
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=l,t=s.PropTypes,u=l.createClass({displayName:"ChatPhotoUploader",propTypes:{actionURI:t.string,disabled:t.bool,imageClassName:t.string,imagesOnly:t.bool,linkClassName:t.string,onSubmit:t.func,onAllUploadsComplete:t.func,onLastUploadFail:t.func,onLastUploadCancel:t.func},getDefaultProps:function(){return {actionURI:k.upload_url,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(l.findDOMNode(this.refs.form),l.findDOMNode(this.refs.input),l.findDOMNode(this.refs.attachID));this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(v,w){return v.actionURI!=this.props.actionURI||v.disabled!==this.props.disabled;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (l.createElement("form",{action:this.props.actionURI,title:this.props.imagesOnly?p._("Add Photos"):p._("Add Files"),method:"post",onClick:function(v){v.stopPropagation();if(this.props.disabled)v.preventDefault();}.bind(this),ref:"form"},l.createElement("input",{type:"hidden",name:"attach_id",ref:"attachID"}),l.createElement("input",{type:"hidden",name:"images_only",value:this.props.imagesOnly}),l.createElement(i,{className:"_m _4q60 _3rzn"},l.createElement(j,{className:r("_4q61 _5f0v _509v",this.props.linkClassName)},l.createElement(h,{className:this.props.imageClassName,src:q('/images/chat/chat_camera_icon.png'),alt:p._("Camera")})),l.createElement("input",{disabled:this.props.disabled,type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:this.props.imagesOnly?'image/*':'*',ref:"input"}))));},_handleSubmit:function(v,w){this.props.onSubmit(v,w);},_handleAllUploadsCompleted:function(v,w){this.props.onAllUploadsComplete(v,w);},_handleLastUploadFailed:function(v,w){this.props.onLastUploadFail(v,w);},_handleLastUploadCanceled:function(v,w){this.props.onLastUploadCancel(v,w);},isUploading:function(){return this._uploader&&this._uploader.isUploading();},uploadFile:function(v){this._uploader.uploadFile(v);}});e.exports=u;},null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&i.unsubscribe(this._subscribeToken);}});e.exports=k;},null);
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s,t,u){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=t;this.$ChatShareLinkUploader6=u;this.$ChatShareLinkUploader7=false;m.listen(r,'keyup',function(){!this.getInputValue().length&&this.$ChatShareLinkUploader8.enable();}.bind(this));this.$ChatShareLinkUploader8=new j(r,t);this.$ChatShareLinkUploader8.subscribe('match',function(v,w){this.loadShare(w&&w.url);}.bind(this));this.$ChatShareLinkUploader9=1337;this.$ChatShareLinkUploadera=null;}p.prototype.getInputValue=function(){"use strict";return this.$ChatShareLinkUploader5?this.$ChatShareLinkUploader5():this.$ChatShareLinkUploader1.value;};p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1,this.$ChatShareLinkUploader5);};p.prototype.getShareData=function(){"use strict";if(!this.$ChatShareLinkUploader3)return null;return this.getShareDataFromStage(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploaderb();this.$ChatShareLinkUploader8.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploaderb();this.$ChatShareLinkUploader8.enable();};p.prototype.$ChatShareLinkUploaderb=function(){"use strict";var q=this.$ChatShareLinkUploadera;delete this.$ChatShareLinkUploadera;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploaderc();this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader7=false;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader8&&this.$ChatShareLinkUploader8.reset();};p.prototype.loadShareFromParams=function(q,r){"use strict";this.$ChatShareLinkUploader7=true;this.$ChatShareLinkUploaderd(new g().setMethod('POST').setURI('/ajax/share_params.php').setData({chat:true,share_type:q,share_params:r}));};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploaderd(new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData({chat:true,extra_params:JSON.stringify(r),u:q}),q);};p.prototype.loadedFromFeed=function(){"use strict";return this.$ChatShareLinkUploader7;};p.prototype.$ChatShareLinkUploaderc=function(){"use strict";return (++this.$ChatShareLinkUploader9);};p.prototype.$ChatShareLinkUploadere=function(){"use strict";return this.$ChatShareLinkUploader9;};p.prototype.$ChatShareLinkUploaderd=function(q,r){"use strict";this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploadera)i.remove(this.$ChatShareLinkUploadera);this.$ChatShareLinkUploadera=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploadera);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');var t=this.$ChatShareLinkUploaderc();this.$ChatShareLinkUploader4=q.setHandler(function(u){return this.$ChatShareLinkUploaderf(t,u,r);}.bind(this));this.$ChatShareLinkUploader4.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploaderf=function(q,r,s){"use strict";if(this.$ChatShareLinkUploadere()!==q)return;this.$ChatShareLinkUploader4=null;i.appendContent(this.$ChatShareLinkUploadera,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();if(s&&this.getInputValue().indexOf(s)===-1)this.$ChatShareLinkUploader6(s);return;}h.addClass(this.$ChatShareLinkUploadera,'done');};e.exports=p;},null);
__d("StickerContextualDialog.react",["ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=47,k=h.createClass(g.createSpec({displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:j,length:16}}}));k.WIDTH={NORMAL:312,WIDE:400};e.exports=k;},null);
__d("ChatStickerButton.react",["BanzaiODS","React","ReactLayeredComponentMixin","StickerContextualDialog.react","StickersFlyout.react","StickerState","cx","emptyFunction","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=h,r=q.PropTypes,s=278,t=h.createClass({displayName:"ChatStickerButton",propTypes:{className:r.string,flyoutClassName:r.string,flyoutWidth:r.number,wrapperClass:r.func,onStickerSelect:r.func,onEmoticonSelect:r.func,onFlyoutShown:r.func,onFlyoutHidden:r.func},getInitialState:function(){return {shown:false,packID:l.getTrayPackID()};},mixins:[i],getDefaultProps:function(){return {flyoutWidth:s,onStickerSelect:n,onEmoticonSelect:n};},componentDidMount:function(){g.bumpEntityKey('chat.web','sticker_button.mounted');this._subscription=l.addListener(l.PACK_SELECTED,function(u){return this.setState({packID:u});}.bind(this));},shouldComponentUpdate:function(u,v){return (v.packID!=this.state.packID||v.shown!=this.state.shown);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (h.createElement("a",{onClick:this.showFlyout,onMouseDown:this._prepareForClick,title:o._("Choose a sticker or emoticon"),ref:"link"},h.createElement("span",{className:p(this.props.className,((this.state.shown?"open":'')))})));},renderLayers:function(){var u=this.props.wrapperClass||j;return {contextualDialog:h.createElement(u,{alignment:this.props.flyoutAlignment,className:"_5e-r",contextRef:"link",onBlur:this._hideFlyout,position:"above",shown:this.state.shown,width:this.props.flyoutWidth},h.createElement("div",null,h.createElement(k,{className:this.props.flyoutClassName,onShown:function(v){return this.props.onFlyoutShown&&this.props.onFlyoutShown(v);}.bind(this),onHidden:function(){return this.props.onFlyoutHidden&&this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.state.packID,shown:this.state.shown})))};},_prepareForClick:function(){this._clickGuard=this.state.shown;},showFlyout:function(){!this._clickGuard&&this.setState({shown:true});},_hideFlyout:function(){this.setState({shown:false});},_handleStickerSelected:function(u){this.props.onStickerSelect(u);},_handleEmoticonSelected:function(u){this._hideFlyout();this.props.onEmoticonSelect(u);}});e.exports=t;},null);
__d("StickersFlyoutTriggerSelector.react",["React","Sticker.react","StickerConstants","StickerUtils","XUIContextualDialog.react","XUICloseButton.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=g,o=n.PropTypes,p=84,q=g.createClass({displayName:"StickersFlyoutTriggerSelector",getDefaultProps:function(){return {stickers:[]};},propTypes:{context:o.object.isRequired,stickers:o.array,onStickerSelect:o.func.isRequired},shouldComponentUpdate:function(r){if(this.props.stickers.length!==r.stickers.length)return true;for(var s=0;s<Math.min(this.props.stickers.length,5);s++)if(this.props.stickers[s].id!==r.stickers[s].id)return true;return false;},_renderStickers:function(){if(!this.props.stickers||this.props.stickers.length===0)return null;var r=Math.floor(Math.random()*Math.min(this.props.stickers.length,5)),s=this.props.stickers[r],t=j.getScaledDimensions(s.height,s.width,i.TRAY_SIZE);return (g.createElement("div",null,g.createElement(l,{size:"small",className:"_2ohj",onClick:this.props.onDismissTrigger}),g.createElement("div",{className:"_5r8h _onc","data-id":s.id,onClick:function(){return this.props.onStickerSelect(s.id);}.bind(this)},g.createElement(h,{animationTrigger:"hover",className:"_5r8i",frameCount:s.frameCount,frameRate:s.frameRate||83,framesPerCol:s.framesPerCol,framesPerRow:s.framesPerRow,sourceHeight:t.height,sourceURI:s.sourceURI,sourceWidth:t.width,spriteURI:s.spriteURI,paddedSpriteURI:s.paddedSpriteURI,stickerID:s.id,style:{cursor:'pointer',height:'64px'}}))));},render:function(){return (g.createElement(k,{alignment:"left",autoFocus:false,context:this.props.context,onBlur:this._resetFlyout,offsetY:11,position:"above",shown:this.props.stickers&&this.props.stickers.length>0,width:p},this._renderStickers()));}});e.exports=q;},null);
__d("StickerTrigger",["EmoticonsList","Map","StickerConfig","StickerSearch","StickerServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=new h(),m={findTriggerForInput:function(n,o){if(n===null){o([],null);return;}j.prepareTagsData().then(function(){return this.findTagForInput(n,function(p,q){return o(p,q);});}.bind(this));},findTagForInput:function(n,o){var p=this.findTriggeredWord(n);if(p){if(l.has(p)){o(l.get(p),p);}else k.getStickersForQuery(p,function(q){var r=q.getPayload();l.set(p,r);o(r,p);});}else o([],null);},_getRegex:function(){if(i.TriggerConfidence==='emoji_only'){return g.noncapturingRegexp;}else if(i.TriggerConfidence==='high')return (/^(?:\w+\s?){1,4}$/);return null;},findTriggeredWord:function(n){var o=j.getTagsIndex();if(!o)return null;n=n.toLowerCase();var p=n.match(this._getRegex()),q=null;for(var r=0;p!==null&&r<p.length;r++)if(o[p[r]])q=p[r];return q;}};e.exports=m;},null);
__d("StickerTriggerIndicator.react",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=g,j=i.PropTypes,k=g.createClass({displayName:"StickerTriggerIndicator",getDefaultProps:function(){return {stickers:[]};},propTypes:{stickers:j.array},shouldComponentUpdate:function(l){var m=this.props.stickers.length>0,n=l.stickers.length>0;return m!==n;},render:function(){var l=this.props.stickers&&this.props.stickers.length>0;return g.createElement("span",{className:((l?"emoticonIndicator":''))});}});e.exports=k;},null);
__d("ChatStickerTriggerController",["BanzaiLogger","React","StickerConfig","StickersFlyoutTriggerSelector.react","StickerTrigger","StickerTriggerIndicator.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n,o,p,q,r){this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerController1=null;this.$ChatStickerTriggerController2=null;this.$ChatStickerTriggerController3=r;this.$ChatStickerTriggerController4=q;this.$ChatStickerTriggerController5=null;if(i.TriggerInterface==='one_tap'){this.$ChatStickerTriggerController1=h.render(h.createElement(j,{context:p,onStickerSelect:this.$ChatStickerTriggerController6.bind(this),onDismissTrigger:this.$ChatStickerTriggerController7.bind(this)}),n);this.$ChatStickerTriggerController2=n;}else if(i.TriggerInterface==='hyperlink'){this.$ChatStickerTriggerController1=h.render(h.createElement(l,null),o);this.$ChatStickerTriggerController2=o;}}m.prototype.setInput=function(n){this.$ChatStickerTriggerController8=n;};m.prototype.activateAfterparty=function(){this.$ChatStickerTriggerController9=true;clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerControllera=setTimeout(this.$ChatStickerTriggerControllerb.bind(this),5000);};m.prototype.updateInput=function(n){if(this.$ChatStickerTriggerController9)this.$ChatStickerTriggerControllerb();this.$ChatStickerTriggerControllerc(n);};m.prototype.onFlyoutShown=function(n){if(this.$ChatStickerTriggerController0&&!this.$ChatStickerTriggerControllerd){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController3(this.$ChatStickerTriggerController0,n);this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});}else n();};m.prototype.getTriggeredWord=function(){return this.$ChatStickerTriggerController0;};m.prototype.$ChatStickerTriggerController6=function(n){this.$ChatStickerTriggerController4(n);this.$ChatStickerTriggerController7();};m.prototype.$ChatStickerTriggerController7=function(){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});};m.prototype.$ChatStickerTriggerControllere=function(n,o){if(this.$ChatStickerTriggerController5===null||this.$ChatStickerTriggerController5&&this.$ChatStickerTriggerController5.toLowerCase().indexOf(o)===-1){this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:null});this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});return;}if(o)g.log('StickersLoggerConfig',{event:'sticker_trigger_activated',numsearchresults:n.length,triggeredword:o,triggerused:false});this.$ChatStickerTriggerController0=o;this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:o});if(!this.$ChatStickerTriggerControllerd)this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:n});};m.prototype.$ChatStickerTriggerControllerb=function(){clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerController9=false;this.$ChatStickerTriggerControllerd=false;this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerControllerc(null);};m.prototype.$ChatStickerTriggerControllerc=function(n){if(this.$ChatStickerTriggerController5!==n){this.$ChatStickerTriggerController5=n;k.findTriggerForInput(this.$ChatStickerTriggerController5,this.$ChatStickerTriggerControllere.bind(this));}};m.prototype.destroy=function(){h.unmountComponentAtNode(this.$ChatStickerTriggerController2);clearTimeout(this.$ChatStickerTriggerControllera);};e.exports=m;},null);
__d("ChatFileUploaderMixin",["SubscriptionsHandler","React"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h,j=i.PropTypes,k={propTypes:{attachmentsShelf:j.object,onFileUploaderMounted:j.func,onUploadFinished:j.func,onUpdateAttachmentsShelf:j.func,onSubmit:j.func},setUpSubscriptionsHandler:function(l){this._uploader=l;this._subscriptions=new g();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();if(!this.props.uploaderIsFromHigherLevel)this._uploader&&this._uploader.destroy();},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},getAudioFiles:function(){return this._uploader.getAudioFiles();},getFiles:function(){return this._uploader.getFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){if(this.props.onUploadFinished)this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){if(this.props.onUpdateAttachmentsShelf)this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){if(this.props.onSubmit)this.props.onSubmit();}};e.exports=k;},null);
__d("ChatFileUploader.react",["ChatFileUploaderMixin","InlineBlock.react","MercuryConfig","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j.createClass({displayName:"ChatFileUploader",mixins:[g],getDefaultProps:function(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function(){return false;},componentDidMount:function(){var n=this.props.initFileUploaderFn(j.findDOMNode(this.refs.form),j.findDOMNode(this.refs.input),j.findDOMNode(this.refs.attachID));this.setUpSubscriptionsHandler(n);},render:function(){return (j.createElement("form",{ref:"form",action:i.upload_url,method:"post"},j.createElement("input",{type:"hidden",ref:"attachID",name:"attach_id"}),j.createElement(h,{className:"_m _4q60 itemLabel"},j.createElement("input",{type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),j.createElement("span",{className:"_4q61 itemAnchor"},l._("Add Files...")))));}});e.exports=m;},null);
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryThreadMuter","ReactComponentWithPureRenderMixin","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","WebMessengerThreadPermalinks","cx","fbt","goURI","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=b('MercuryThreadActions').get(),y=p.Item,z=n,aa=z.PropTypes,ba=n.createClass({displayName:"ChatTabMenu",mixins:[m],propTypes:{onFileUploaderMounted:aa.func,updatePrivacyLinkFunc:aa.func,nameConversationFunc:aa.func,leaveConversationFunc:aa.func,showParticipantsFunc:aa.func,deleteConversationFunc:aa.func,reportSpamFunc:aa.func,createGroupFunc:aa.func,switchToWorkFunc:aa.func,isMultichat:aa.bool,isEmptyChat:aa.bool,hasSwitchToWork:aa.bool,showAddFriend:aa.func,threadID:aa.string,attachmentsShelf:aa.object,onUploadFinished:aa.func,onUpdateAttachmentsShelf:aa.func,onSubmit:aa.func,enableDesktopNotif:aa.func},getInitialState:function(){return {url:null};},getDefaultProps:function(){return {show:true};},componentDidMount:function(){t.getThreadURI(this.props.threadID,function(ca){this.isMounted()&&this.setState({url:ca});}.bind(this));if(!this.props.isMultiChat)this._privacyActionController=new h(j.getUserIDFromThreadID(this.props.threadID),this.props.updatePrivacyLinkFunc);},_initFileUploader:function(ca,da,ea){if(this._fileUploader){this._fileUploader.updateElements(ca,da,ea);}else this._fileUploader=new k(this.props.attachmentsShelf,ca,da,ea);return this._fileUploader;},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploader&&this._fileUploader.destroy();},_unmuteThread:function(){x.unmute(this.props.threadID);r.hide();},_togglePrivacyFunc:function(){this._privacyActionController.togglePrivacy();},getURL:function(){return this.state.url;},_renderFileUploader:function(){return (n.createElement(y,{className:"_37_x"},n.createElement(g,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.state.url)return (n.createElement(y,{onclick:function(){return w(this.state.url);}.bind(this)},v._("See Full Conversation")));return null;},_renderAddFriend:function(){if(!this.props.showAddFriend)return null;return (n.createElement(y,{onclick:this.props.showAddFriend},v._("Add Friends to Chat...")));},_renderTogglePrivacy:function(){if(!this.props.isMultichat&&this.props.privacyText)return (n.createElement(y,{onclick:this._togglePrivacyFunc},this.props.privacyText));return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var ca=l.showMuteChangeDialog.bind(null,this.props.threadID,null);return (n.createElement(y,{onclick:ca},v._("Mute Conversation...")));}else return (n.createElement(y,{onclick:this._unmuteThread},v._("Unmute Conversation")));},_renderDeleteConversation:function(){return (n.createElement(y,{onclick:this.props.deleteConversationFunc},v._("Delete Conversation...")));},_renderReportSpam:function(){if(!this.props.isMultichat)return (n.createElement(y,{onclick:this.props.reportSpamFunc},v._("Report as Spam or Abuse...")));return null;},_renderCreateGroup:function(){if(this.props.isMultichat)return (n.createElement(y,{onclick:this.props.createGroupFunc},v._("Create Group")));return null;},_renderSwitchToWork:function(){if(this.props.hasSwitchToWork)return (n.createElement(y,{onclick:this.props.switchToWorkFunc},v._("Move to Work Account")));},_renderConversationName:function(){if(this.props.isMultichat&&this.state.url)return (n.createElement(y,{onclick:this.props.nameConversationFunc},v._("Edit Conversation Name")));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (n.createElement(y,{onclick:this.props.leaveConversationFunc},v._("Leave Conversation...")));return null;},_renderEnableDesktopNotifications:function(){if(i.DesktopNotificationsGK&&"Notification" in window&&Notification.permission!=="granted")return (n.createElement(y,{onclick:this.props.enableDesktopNotif},v._("Enable Desktop Notifications")));return null;},_renderPeopleList:function(){if(this.props.isMultichat&&this.state.url)return (n.createElement(y,{onclick:this.props.showParticipantsFunc},v._("Edit Participants...")));return null;},render:function(){var ca=this._renderReportSpam(),da=this._renderCreateGroup(),ea=n.createElement(p,{className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),n.createElement(q,null),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderDeleteConversation(),this._renderLeaveConversation(),ca?(n.createElement(q,null)):null,ca,da?(n.createElement(q,null)):null,da,this._renderEnableDesktopNotifications()),fa=v._("Options"),ga=s.getTrackingInfo(s.types.DROPDOWN_BUTTON);return (n.createElement(o,{menu:ea},n.createElement("a",{"data-ft":ga,"data-hover":"tooltip","aria-label":fa,"data-tooltip-alignh":"center",className:(("button")+(this.props.isEmptyChat?' '+"hidden_elem":''))})));}});e.exports=ba;},null);
__d("ChatDateBreak.react",["React","Timestamp.react","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g,m=l.PropTypes,n=g.createClass({displayName:"ChatDateBreak",propTypes:{date:m.instanceOf(Date).isRequired},shouldComponentUpdate:function(o){return this.props.date.getTime()!==o.date.getTime();},render:function(){var o=this.props.date,p=j(o,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),q=Math.round(o.getTime()/1000);return (g.createElement("div",g.__spread({},this.props,{className:k(this.props.className,"_5w-5")}),g.createElement("div",{className:"_5w-6"},g.createElement(h,{time:q,verbose:p,text:p}))));}});e.exports=n;},null);
__d("ChatAuthorPhotoBlock.react",["MercuryParticipants","React","cx","fbt","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=h,n=m.PropTypes,o=86400000,p=h.createClass({displayName:"ChatAuthorPhotoBlock",propTypes:{authorID:n.string.isRequired,hideName:n.bool,hidePhoto:n.bool,timestamp:n.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.updateAuthor(this.props.authorID);},componentWillReceiveProps:function(q){if(q.authorID!=this.state.author.id)this.updateAuthor(q.authorID);},render:function(){return (h.createElement("div",h.__spread({},this.props,{className:l(this.props.className,"_5yt9")}),this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (h.createElement("div",{className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto){var q=null;if(this.props.timestamp){var r=(Date.now()-this.props.timestamp>o)?'M jS, g:ia':'g:ia';q=k(new Date(this.props.timestamp),r);}var s=j._("{name} {time}",[j.param("name",this.state.author.name),j.param("time",q)]);return (h.createElement("a",{"aria-label":s,className:"_5ys_","data-hover":"tooltip","data-tooltip-position":"left",href:this.state.author.href||'#',ref:"link"},h.createElement("img",{src:this.state.author.image_src,ref:"image"})));}},updateAuthor:function(q){g.get(q,function(r){this.isMounted()&&this.setState({author:r});}.bind(this));}});e.exports=p;},null);
__d("MessageBubbleMixin",["DOMDimensions","MercuryConfig","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=2,k={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(l){if(l.maxWidth!==this.props.maxWidth||l.body!==this.props.body||(!l.attachments&&this.props.attachments))this._restyleBubble(l);},_restyleBubble:function(l){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var m=i.findDOMNode(this.refs.bubble);if(l.maxWidth!==this.props.maxWidth||g.getElementDimensions(m).width>this.props.maxWidth){var n=this.props.maxWidth;this.setState({bubbleWidth:n},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var l=i.findDOMNode(this.refs.bubble),m=g.getElementDimensions(l).width,n=0,o=i.findDOMNode(this.refs.content);if(o){n=g.getElementDimensions(o).width;if(h.MercuryStoryAttachmentsGK)n+=g.measureElementBox(i.findDOMNode(this.refs.contentWrapper),'width',true,false,false);}var p=n+j;if(n>0&&p<this.props.maxWidth&&m-p-this.getBoxWidth()>0)this.setState({bubbleWidth:p});}};e.exports=k;},null);
__d("ChatBubble.react",["DOMDimensions","MercuryConfig","MercuryMessageBody.react","MessageBubbleMixin","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=k,o=n.PropTypes,p=null,q=h.MercuryStoryAttachmentsGK,r=k.createClass({displayName:"ChatBubble",mixins:[j],propTypes:{attachments:o.node,body:o.string,maxWidth:o.number.isRequired,threadID:o.string},_renderContent:function(){if(!this.props.body)return null;return (k.createElement("div",{className:((q?"_d97":'')),ref:"contentWrapper"},k.createElement("span",{className:"_5yl5",ref:"content"},k.createElement(i,{body:this.props.body,ranges:this.props.ranges,threadID:this.props.threadID}))));},render:function(){return (k.createElement("div",k.__spread({},this.props,{className:m((("_5w1r")+(!q?' '+"_d98":'')),this.props.className),ref:"bubble",style:{maxWidth:this.props.maxWidth,width:this.state.bubbleWidth}}),this._renderContent(),this.props.attachments));},contentWraps:function(){var s=k.findDOMNode(this.refs.content),t=s.getClientRects(),u=g.getElementDimensions(s).height;return (t&&t.length>1&&t[0].height<u);},getBoxWidth:function(){if(!p)p=g.measureElementBox(k.findDOMNode(this.refs.bubble),'width',true,true,false);return p;}});e.exports=r;},null);
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","DOM","Event","ImmutableObject","React","SubscriptionsHandler","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=k,q=p.PropTypes,r=176,s=4,t=k.createClass({displayName:"MercuryAttachments",propTypes:{attachments:q.array.isRequired,customPhotoWidth:q.number,maxWidth:q.number,message:q.instanceOf(j).isRequired,isChat:q.bool,onImageLoad:q.func,onStickerClick:q.func},getDefaultProps:function(){return {isChat:false,onImageLoad:n,onStickerClick:n};},componentDidMount:function(){this._subscriptionsHandler=new l();this.renderAttachments();},componentDidUpdate:function(){this.renderAttachments();},componentWillUnmount:function(){this._subscriptionsHandler.release();},render:function(){var u=this.props.attachments.filter(g.isPhotoAttachment).length>0;return (k.createElement("div",k.__spread({},this.props,{className:o(this.props.className,(("_5h9y")+(u?' '+"_zl6":'')))})));},renderAttachments:function(){var u=k.findDOMNode(this);h.empty(u);var v=this.props.message,w=g.sortAttachmentsStablyByType(this.props.attachments),x=this.props.customPhotoWidth||r,y=g.renderPhotoAttachments(w.filter(g.isPhotoAttachment),v,x,s,this.props.isChat);y&&h.appendContent(u,y);for(var z=0;z<w.length;z++){var aa=w[z];if(g.isPhotoAttachment(aa))continue;var ba=g.renderAttachment(this.props.isChat,aa,v,this.props.maxWidth,null,this.props.onStickerClick);ba.error&&h.appendContent(u,ba.error);ba.content&&h.appendContent(u,ba.content);}h.scry(u,'img').forEach(function(ca){this._subscriptionsHandler.addSubscriptions(i.listen(ca,'load',function(){this.props.onImageLoad(ca);}.bind(this)));}.bind(this));}});e.exports=t;},null);
__d("ChatMessage.react",["Bootloader","BootloadedComponent.react","ChatAnimatedGifs","ChatAuthorPhotoBlock.react","ChatBubble.react","ChatConfig","CSS","ImmutableObject","MercuryAttachment","MercuryAttachments.react","MercuryAttachmentRenderer","MercuryConfig","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercuryMessageInfo","React","cx","fbt","formatDate","isRTL","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=w,da=ca.PropTypes,ea=w.createClass({displayName:"ChatMessage",propTypes:{message:da.instanceOf(n).isRequired,maxBubbleWidth:da.number.isRequired,onImageLoad:da.func,onStickerClick:da.func},componentDidMount:function(){m.conditionClass(w.findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var fa=this.props.message;return (v.isInbound(fa)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(fa,ga){return fa.message!==this.props.message;},render:function(){var fa=this.props.message,ga=v.isInbound(fa),ha=t.isMultichat(fa.thread_id),ia=aa(fa.body),ja=l.get('chat_fading_bubbles')&&!ga&&v.isSending(fa),ka=s.hasErrorStatus(fa),la=(("_5wd4")+(ga?' '+"_1nc7":'')+(!ga?' '+"_1nc6":'')+(ga&&ha?' '+"_5ysy":'')+(ja?' '+"_4oe5":'')+(ka?' '+"_1zcs":'')+(ia?' '+"direction_rtl":'')+(!ia?' '+"direction_ltr":'')),ma=new Date(fa.timestamp);return (w.createElement(j,w.__spread({},this.props,{authorID:fa.author,className:ba(this.props.className,la),hideName:!ga||!ha,hidePhoto:!ga,timestamp:fa.timestamp,title:ga?null:z(ma,'g:ia')}),this._renderInner(),this._renderUndertext()));},_renderInner:function(){if(this.props.message.is_filtered_content)return (w.createElement("div",{className:"_5wd9",ref:"inner"},this._renderFilteredContent()));return (w.createElement("div",{className:"_5wd9",ref:"inner"},this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (w.createElement("div",{className:"_3ry4",ref:"undertext"},w.createElement(u,{className:"_5wda clearfix",message:this.props.message,ref:"status"}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?w.createElement(h,{bootloadPlaceholder:w.createElement("span",null),bootloadComponent:function(fa){g.loadModules(["MercurySpoofWarning.react"],fa);},authorID:this.props.message.author,className:"_5wdb"}):null);},_renderFilteredContent:function(){return w.createElement("div",{className:"_5wdc uiBoxYellow clearfix"},y._("This message is no longer available because it was identified as abusive or marked as spam."));},_renderAttachments:function(fa){var ga=this.props.message,ha=fa=='inside'?'attachmentsInside':'attachmentsOutside',ia=o.get(ga).filter(function(ja){var ka=q.isBubblePreferred(ja)&&!(r.MercuryImageBubblesGK&&(q.isPhotoAttachment(ja)||q.isVideoAttachment(ja))&&!ga.body);return (ka&&fa==='inside')||(!ka&&fa==='outside');});if(ia.length>0)return w.createElement(p,{className:"_5wdd clearfix",isChat:true,message:ga,attachments:ia,ref:ha,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick,maxWidth:this.props.maxBubbleWidth});},_renderBubble:function(){var fa=this.props.message,ga=fa.body,ha=this._renderAttachments('inside'),ia=v.isInbound(fa);if(i.shouldHideBody(fa))ga='';if(ga||ha)return (w.createElement("div",{className:"_5wde"},w.createElement(k,{attachments:ha,body:ga,className:(("_5wdf")+(o.hasBubbleTail(fa,ia)?' '+"_3okg":'')),maxWidth:this.props.maxBubbleWidth,ranges:fa.ranges,ref:"bubble",threadID:fa.thread_id})));}});e.exports=ea;},null);
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryViewer","PresencePrivacy","React","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=k,q=p.PropTypes,r=k.createClass({displayName:"ChatVideoCallLink",propTypes:{message:q.object.isRequired,onClick:q.func.isRequired},componentDidMount:function(){this._subscriptions=new l();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.createElement("a",{className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),"data-gt":JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return (o._("Retry setup and call back."));}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)return (o._("Call back."));},shouldHideLink:function(){return !h.isOnline()||!m.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var s;if(this.props.message.log_message_data.event_name=='install_canceled'){s='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)s='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,s);},availabilityChanged:function(){this.forceUpdate();}});e.exports=r;},null);
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","VideoCallSupport","cx","emptyFunction","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=m,t=s.PropTypes,u=m.createClass({displayName:"MercuryLogMessage",propTypes:{maxWidth:t.number,message:t.instanceOf(j).isRequired,onImageLoad:t.func,onVideoCallLinkClick:t.func},getDefaultProps:function(){return {onImageLoad:p};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(v){k.renderText(v.message,function(w){this.setState({messageText:w});}.bind(this));},shouldComponentUpdate:function(v,w){return (this.state.messageText!=w.messageText||v.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){var v=m.findDOMNode(this.refs.attachment);k.renderAttachmentLegacy(v,this.props.message);g.scry(v,'img').forEach(function(w){var x=h.listen(w,'load',function(){this.props.onImageLoad(w);x.remove();}.bind(this));}.bind(this));},render:function(){return (m.createElement("div",m.__spread({},this.props,{className:r(this.props.className,"_5ye6"),style:Object.assign({},this.props.style,this._getStyle()),title:q(new Date(this.props.message.timestamp),'g:ia')}),k.renderIcon(this.props.message),m.createElement("div",{className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.createElement("div",{className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!n.isVideoCallSupported())return null;return (m.createElement(i,{message:this.props.message,onClick:this.props.onVideoCallLinkClick}));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;}});e.exports=u;},null);
__d("ChatConversation.react",["ChatDateBreak.react","ChatMessage.react","ImmutableObject","MercuryActionType","MercuryLogMessage.react","React","cx","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=l,p=o.PropTypes,q=1000*60*60,r=l.createClass({displayName:"ChatConversation",propTypes:{maxBubbleWidth:p.number.isRequired,messages:p.arrayOf(p.instanceOf(i)).isRequired,onCallLinkClick:p.func,onImageLoad:p.func,onStickerClick:p.func},componentWillReceiveProps:function(s){n(s.maxBubbleWidth===this.props.maxBubbleWidth);},render:function(){var s=this.props.messages,t=[];for(var u=0;u<s.length;u++){var v=s[u],w=(u>0)?s[u-1]:null;if(!w||v.timestamp-w.timestamp>q)t.push(l.createElement(g,{date:new Date(v.timestamp),key:'db:'+v.message_id}));if(v.action_type==j.LOG_MESSAGE){t.push(l.createElement(k,{className:"_5w0o",key:v.message_id,message:v,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else t.push(l.createElement(h,{key:v.message_id,message:v,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));}return l.createElement("div",null,t);}});e.exports=r;},null);
__d("MercuryMessageList",["immutable","LogHistory","Map","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h.getInstance('mercury_message_list');function l(n){this.$MercuryMessageList0=g.List(n||[]);this.$MercuryMessageList1();}l.prototype.append=function(n){var o;this.$MercuryMessageList0=(o=this.$MercuryMessageList0).push.apply(o,n);this.$MercuryMessageList1();m('append',n);};l.prototype.prepend=function(n){var o;this.$MercuryMessageList0=(o=this.$MercuryMessageList0).unshift.apply(o,n);this.$MercuryMessageList1();m('prepend',n);};l.prototype.update=function(n){var o=n.filter(function(p){return this.contains(p);}.bind(this));if(o.length===0)return;this.$MercuryMessageList0=this.$MercuryMessageList0.withMutations(function(p){o.forEach(function(q){var r=this.$MercuryMessageList2.get(q.message_id);if(r!==(void 0))p.set(r,q);}.bind(this));}.bind(this));m('update',o);};l.prototype.reorder=function(n){this.$MercuryMessageList0=g.List(n);this.$MercuryMessageList1();m('reorder',n);};l.prototype.at=function(n){return this.$MercuryMessageList0.get(n);};l.prototype.contains=function(n){return this.$MercuryMessageList2.has(n.message_id);};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toMap=function(){return new i(g.Seq(this.$MercuryMessageList0).map(function(n){return [n.message_id,n];}));};l.prototype.$MercuryMessageList1=function(){this.$MercuryMessageList2=new i(g.Seq(this.$MercuryMessageList0).map(function(n,o){return [n.message_id,o];}));};function m(event,n){j(function(){k.debug(event,{messageIDs:n.map(function(o){return o.message_id;})});},0);}e.exports=l;},null);
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryViewer","MercuryMessageList","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","merge","mixInEventEmitter","setImmediate","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();'use strict';var r=b('MercuryMessages').get(),s=b('MercuryThreadInformer').get(),t=b('MercuryThreads').get(),u=h.getInstance('mercury_message_store');function v(x,y){this.$MercuryMessageStore0=x;this.$MercuryMessageStore1=new j();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=y||l.RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore6=new k();this.$MercuryMessageStore6.addSubscriptions(s.subscribe('messages-received',function(z,aa){return this.$MercuryMessageStore8(aa);}.bind(this)),s.subscribe('messages-updated',function(z,aa){return aa[this.$MercuryMessageStore0]&&this.$MercuryMessageStore9(aa[this.$MercuryMessageStore0]);}.bind(this)),s.subscribe('messages-reordered',function(z,aa){return aa[this.$MercuryMessageStore0]&&this.$MercuryMessageStorea();}.bind(this)));u.debug('constructed',{threadID:this.$MercuryMessageStore0});this.$MercuryMessageStoreb();}v.prototype.setNewThreadID=function(x){this.$MercuryMessageStorec=x;};v.prototype.destroy=function(){this.$MercuryMessageStore6&&this.$MercuryMessageStore6.release();u.debug('destroyed',{threadID:this.$MercuryMessageStore0});};v.prototype.subscribe=function(x){return this.addRetroactiveListener('updated',x);};v.prototype.fetchMoreMessages=function(){if(r.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&r.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(t.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;this.$MercuryMessageStoreb();return true;};v.prototype.$MercuryMessageStoreb=function(){var x=this.$MercuryMessageStore4+this.$MercuryMessageStore5*this.$MercuryMessageStore2;u.debug('fetching',{threadID:this.$MercuryMessageStore0,limit:x});r.getThreadMessagesRange(this.$MercuryMessageStore0,0,x,this.$MercuryMessageStored.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(r.hasLoadedNMessages(this.$MercuryMessageStore0,x))p(function(){this.$MercuryMessageStorea();}.bind(this));};v.prototype.$MercuryMessageStored=function(x){if(x&&x.length){this.$MercuryMessageStore3=x[0].timestamp;this.$MercuryMessageStore4=x.length;u.debug('fetched',{threadID:this.$MercuryMessageStore0,earliestMessageTimestamp:this.$MercuryMessageStore3,count:this.$MercuryMessageStore4});}else if(x&&!x.length&&!this.$MercuryMessageStore4)this.$MercuryMessageStoree(v.THREAD_IS_EMPTY);};v.prototype.$MercuryMessageStore8=function(x){var y=[],z=x[this.$MercuryMessageStore0];if(z&&z.length)y=y.concat(z);if(this.$MercuryMessageStorec){var aa=x[this.$MercuryMessageStorec];if(aa&&aa.length){y=y.concat(aa);this.$MercuryMessageStorec=null;}}if(y.length){this.$MercuryMessageStore1.append(y);this.$MercuryMessageStore4+=y.length;var ba=y.every(function(ca){return ca.author!=i.getID();});this.$MercuryMessageStoree(v.MESSAGES_RECEIVED,{allFromOthers:ba});}};v.prototype.$MercuryMessageStore9=function(x){this.$MercuryMessageStore1.update(r.getMessagesFromIDs(Object.keys(x)));this.$MercuryMessageStoref();this.$MercuryMessageStoree(v.MESSAGES_CHANGED);};v.prototype.$MercuryMessageStorea=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(r.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStoref();this.$MercuryMessageStoree(v.MESSAGES_REORDERED);};v.prototype.$MercuryMessageStoree=function(x,y){var z=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',n({messages:z,eventType:x},y));w(this.$MercuryMessageStore0,x,z);};v.prototype.$MercuryMessageStoref=function(){var x=this.$MercuryMessageStore1.at(0);if(x)this.$MercuryMessageStore3=x.timestamp;};function w(x,y,z){q(function(){u.debug('update:'+y,{threadID:x,messageIDs:z.map(function(aa){return aa.message_id;})});},0);}m(v,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});o(v,{updated:true});e.exports=v;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","BanzaiLogger","BootloadedComponent.react","Bootloader","ChatConfig","ChatConversation.react","ChatTabViewEvents","ChatWelcomeMessage","CSS","DOM","Event","MercuryLastMessageIndicator.react","LiveTimer","MercuryViewer","MercuryMessageStore","React","Scroll","ServerTime","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","UserAgent_DEPRECATED","arrayContains","copyProperties","getElementPosition","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){b.__markCompiled&&b.__markCompiled();'use strict';var ja=70,ka=null,la=20;function ma(oa){if(ka===null){var pa=oa.childNodes[0];ca.set(oa,'overflow','scroll');ka=pa.clientWidth-ja;ca.set(oa,'overflow','');}return ka;}function na(oa,pa,qa,ra,sa,ta,ua,va){this.loadingIcon=sa;this.threadID=oa;this.sheetController=pa;this.scrollContainer=qa;this.conversationElem=ra;this.tabView=va;t.restart(y.get()/1000);this._loadingMoreMessages=false;function wa(){n.inform('interaction-with-tab',oa);}this._subscriptions=new da();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),r.listen(this.scrollContainer,'mousedown',wa));if(ea.firefox()){var xa=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(xa,wa,false);}else this._subscriptions.addSubscriptions(r.listen(this.scrollContainer,'mousewheel',wa));this._subscriptions.addSubscriptions(r.listen(this.scrollContainer,'scroll',ia(this.scrolling,50,this)));if(l.get('chat_react')){var ya;w.render(w.createElement(j,{bootloadPlaceholder:w.createElement("span",null),bootloadComponent:function(ab){k.loadModules(["ChatTypingIndicators.react"],ab);},threadID:this.threadID,indicatorsWillShow:function(){return ya=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return ya&&this.scrollToBottom(true);}.bind(this)}),ua);}else k.loadModules(["MercuryTypingIndicator"],function(ab){this.typingIndicator=new ab(this.threadID,ua,this);}.bind(this));var za;this.lastMessageIndicatorNode=ta;this.lastMessageIndicator=w.render(w.createElement(s,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return za=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return za&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);this.initializeConversation();}ga(na.prototype,{initializeConversation:function(){this._store=new v(this.threadID);this._conversation=w.render(w.createElement(m,{maxBubbleWidth:ma(this.scrollContainer),messages:[],onImageLoad:function(oa){var pa=this.scrollContainer,qa=x.getTop(pa)+pa.clientHeight;if(qa+oa.offsetHeight>=pa.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(oa,pa,qa){n.inform('video-call-clicked',{userID:oa,threadID:pa,clickSource:qa});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(function(oa){if(oa.eventType==v.MESSAGES_RECEIVED&&oa.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(oa.eventType==v.MESSAGES_REORDERED){this._loadingMoreMessages=false;p.hide(this.loadingIcon);}var pa=this.isScrolledToBottom(),qa=this._getLoadingHeight(),ra=this.scrollContainer.scrollHeight,sa=x.getTop(this.scrollContainer),ta=oa.messages,ua=o.getWelcomeMessage(this.threadID);if(ua)ta.push(ua);this._conversation.setProps({messages:ta},function(){if(pa||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(oa.eventType==v.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-ra-qa+sa);}.bind(this));this.lastMessageIndicator.setProps({lastMessage:ta.length>0?ta[ta.length-1]:null});if(oa.eventType==v.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(ta)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(oa.eventType==v.MESSAGES_CHANGED)this._checkToAnimateSticker();}.bind(this)));},setShouldScrollToBottom:function(oa){this._shouldScrollToBottom=oa;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){p.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&x.getTop(this.scrollContainer);},destroy:function(){q.scry(this.conversationElem,'.stickerContainer').forEach(function(oa){return w.unmountComponentAtNode(oa);});w.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();w.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(oa){if(!aa.shouldShowStickerReplyNUX()||!oa.length)return false;var pa=oa[oa.length-1];if(pa.author===u.getID())return false;if(pa.has_attachment)return pa.attachments.some(function(qa){return qa.attach_type==='sticker';});return false;},isScrolledToBottom:function(oa){var pa=this.scrollContainer;oa=oa||la;return x.getTop(pa)+pa.clientHeight>=pa.scrollHeight-oa;},isScrolledNearTop:function(){return x.getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(oa){this.scrollToPosition(this.scrollContainer.scrollHeight,oa);},scrollToPosition:function(oa,pa){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(pa===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',oa).ease(g.ease.end).duration(400).go();}else x.setTop(this.scrollContainer,oa);},_onStickerClick:function(oa,pa){if(!oa)return;i.log('StickersLoggerConfig',{event:'click_sticker',packid:oa,stickerid:pa});var qa=this.tabView;aa.onTrayDataReady(function(){if(fa(aa.getPackIDsInTray(),oa)){var ra=aa.getPack(oa);if(ra&&ra.isPromoted)z.addPack(oa);qa.setStickersFlyoutPackID(oa);}else ba.showStore(oa);});},_checkToAnimateSticker:function(){var oa=ha(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:x.getTop(this.scrollContainer),top:oa.y,viewHeight:oa.height});},setNewThreadID:function(oa){this._store.setNewThreadID(oa);}});e.exports=na;},null);
__d("ChatTabOfficeStatus",["fbt","formatDate","CSS"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=1,k=2,l=3,m={update:function(n,o){if(!n||!o||!o.officeStatus)return;this._updateIcon(n,o);this._updateTooltip(n,o);},_updateIcon:function(n,o){i.removeClass(n,'officeStatusNone');i.removeClass(n,'officeStatusAvailable');i.removeClass(n,'officeStatusSporadic');i.removeClass(n,'officeStatusOutOfOffice');switch(o.officeStatus){case j:i.addClass(n,'officeStatusAvailable');break;case k:i.addClass(n,'officeStatusSporadic');break;case l:i.addClass(n,'officeStatusOutOfOffice');break;default:i.addClass(n,'officeStatusNone');break;}},_updateTooltip:function(n,o){var p='';switch(o.officeStatus){case j:p+=g._("AVAILABLE");p+='\n';break;case k:p+=g._("SPORADIC");p+='\n';break;case l:p+=g._("OFF THE GRID");p+='\n';break;default:p+=g._("UNKNOWN");p+='\n';break;}if(o.officeStatusComment)p+=o.officeStatusComment;if(o.officeStatusLocation)p+=' ('+o.officeStatusLocation+')';if(o.officeStatusComment||o.officeStatusLocation)p+='\n';if(o.officeStatusEndDate){var q=h(o.officeStatusEndDate,'M d, Y');p+=g._("Until {date}",[g.param("date",q)]);}n.setAttribute('aria-label',p);n.setAttribute('data-hover','tooltip');}};e.exports=m;},null);
__d("ChatTabTypeaheadRenderer",["DOM","CompactTypeaheadRenderer","MercuryTypeaheadConstants","MercuryThreadMetadataRawRenderer","TypeaheadFacepile"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(n,o){switch(n.type){case i.USER_TYPE:case i.PAGE_TYPE:return h(n,o);case i.THREAD_TYPE:return m(n,o);default:return g.create('div');}}function m(n,o){var p=[],q=n.mercury_thread;if(q.image_src){p.push(g.create('img',{alt:'',src:q.image_src}));}else{var r=n.participants_to_render.map(function(u){return u.big_image_src||u.image_src;});if(r){if(r instanceof Array){r=k.render(r);}else r=g.create('img',{alt:'',src:r});p.push(r);}}var s=q.name,t=j.renderRawParticipantList(q.thread_id,n.participants_to_render,q.participants.length,{names_renderer:j.renderShortNames});p.push(g.create('span',{className:'timestamp'},q.timestamp_relative));p.push(g.create('span',{className:'text'},s));p.push(g.create('span',{className:'subtext'},t));return g.create('li',{className:'node'},p);}l.className='compact';e.exports=l;},null);
__d("ChatAddFriendsTabSheetRawRenderer",["ChatConfig","ChatTabTypeaheadRenderer","ContextualTypeaheadView","DOM","Event","MercuryConfig","MercuryDataSourceWrapper","MercuryTypeahead","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q={render:function(r,s,t,u,v,w){var x=w?o[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():o[':fb:mercury:chat:tab-sheet:add-friends'].build(),y={};if(l.MercuryDataSourceProcessor){y=w?m.chat_typeahead_source:m.chat_add_people_source;y.setShowThreads(w);}else if(w){y=m.source;}else y=m.add_people_source;var z=new n(y,i);z.setViewOption('renderer',h);z.setExcludedParticipantsFromThreadMeta(u);if(!w){var aa=g.get('IsWorkUser',false)?p._("Add co-workers to this chat"):p._("Add friends to this chat");z.setPlaceholder(aa);}z.build();j.replace(x.getNode('participantsTypeahead'),z.getElement());j.setContent(t,x.getRoot());z.getTokenizer().adjustWidth();var ba=x.getNode('participantsTypeahead').getAttribute('data-labelid'),ca=j.scry(z.getElement(),'input[type="text"]')[0];if(ca)if(ba){ca.setAttribute('aria-labelledby',ba);}else ca.setAttribute('aria-label',p._("To"));z.focus();if(!w){var da=function(){var ea=z.getSelectedParticipantIDs();if(ea.length)v(ea);s.close(r);};k.listen(x.getNode('doneButton'),'click',da);z.subscribe('tokens-return',function(){if(z.getTokens().length)da();});}return z;}};e.exports=q;},null);
__d("XAssociateGroupThreadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/groups\/messenger\/associate_group_thread\/",{});},null);
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryIDs","MercuryLocalIDs","MercuryViewer","MercuryServerDispatcher","XAssociateGroupThreadController","MercuryThreads","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=b('MercuryThreads').get(),q=b('MercuryServerRequests').get(),r=o.getURIBuilder().getURI().toString();function s(){}i(s,{subscribe:function(u,v){u.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(u,v);}.bind(this));},createGroupThreadFromChooserDialog:function(u,v){var w=j.serialize(u.getRoot()),x=JSON.parse(w.profileChooserItems),y=[];for(var z in x)if(x[z])y.push(z);var aa=s.createThreadForFBIDs(y),ba=q.subscribe('update-thread-ids',function(ca,da){for(var ea in da)if(da[ea]==aa){var fa=p.getThreadMetaNow(aa),ga=q.getServerThreadIDNow(aa);if(fa&&!fa.is_canonical&&ga)n.trySend(r,{group_id:v,thread_id:ga});new g('/ajax/groups/chat/log',{group_id:v,message_id:ea}).send();q.unsubscribe(ba);break;}});u.hide();},createThreadForTokens:function(u){var v=m.getID();if(!u.length)return;u=u.filter(function(x){return x!==v;});var w;if(u.length===0){return;}else if(u.length===1){w=k.getThreadIDFromParticipantID(u[0]);h.openThread(w,'ChatTabView');}else{w=l.generateThreadID();u.unshift(v);p.createNewLocalThread(w,u);h.openThread(w,'MultiChatController');}return w;},createThreadForFBIDs:function(u){var v=[];for(var w=0;w<u.length;w++)v.push("fbid:"+u[w]);return s.createThreadForTokens(v);}});var t={};t[r]={mode:n.IMMEDIATE};n.registerEndpoints(t);e.exports=s;},null);
__d("ChatAddFriendsTabSheet",["ArbiterMixin","BanzaiLogger","ChatAddFriendsTabSheetRawRenderer","ChatConfig","ChatOpenTab","ChatTabActions","MercuryConfig","MercuryLogMessageType","MercurySourceType","MercuryTypeaheadConstants","MultiChatController","Style","copyProperties","MercuryMessageObject","MercuryMessageActions","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=b('MercuryMessageObject').get(),u=b('MercuryMessageActions').get(),v=b('MercuryThreadActions').get(),w=b('MercuryThreads').get();function x(ba,ca,da,ea){this._threadID=ba;this._rootElement=ca;this._sheetView=da;this._typeahead=null;this._chatTabView=ea;}s(x.prototype,g,{render:function(){w.getThreadMeta(this._threadID,function(ba){var ca=ba.is_canonical_user?y:z,da=w.isNewEmptyLocalThread(this._threadID);this._typeahead=i.render(this,this._sheetView,this._rootElement,ba,ca.bind(null,ba),da);this._typeahead.subscribe('tokens-changed',function(){if(m.MercuryDataSourceProcessor){if(da)aa(this,this._typeahead,this._threadID,this._chatTabView);}else this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));this._typeahead.subscribe('esc-pressed',function(){this.inform('esc-pressed');}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return r.get(this._rootElement,'height');}});function y(ba,ca){var da=ba.participants;q.createThreadForTokens(da.concat(ca));}function z(ba,ca){var da=ba.thread_id;if(w.isEmptyLocalThread(da)){v.addParticipants(da,ca);}else u.send(t.constructLogMessageObject(o.CHAT_WEB,da,n.SUBSCRIBE,{added_participants:ca}));k.openThread(da,'ChatAddFriendsTabSheet');}function aa(ba,ca,da,ea){var fa=ca.getTypeahead().getData(),ga=ca.getTokens(),ha=ca.getTypeahead().getCore();ha.getElement().removeAttribute('disabled');fa.setShowThreads(ga.length===0);var ia=ga.length==1&&ga[0].getInfo().render_type===p.THREAD_TYPE;if(ia){var ja=ga[0].getInfo().mercury_thread;if(ja){var ka=j.get('chat_react_share_uploader')?ea._sharePreview.getShareData():ea._shareLinkUploader.getShareData();if(ka)var la=j.get('chat_react_share_uploader')?function(ma){return ma.loadShareFromParams(ka.share_type,ka.share_params);}:function(ma){return ma.loadShareFromParams(ka.type,ka.params);};k.openThread(ja.thread_fbid,'openGroupChat','',la);}h.log('MercuryQueryResultsLoggerConfig',{event:'chat_tab_group_thread_click'});l.closeTab(da,'open_group_chat');}else{if(ga.length==1&&ga[0].getInfo().render_type===p.PAGE_TYPE)ha.getElement().setAttribute('disabled','disabled');h.log('MercuryQueryResultsLoggerConfig',{event:'chat_tab_tokens_changed',chat_tab_tokens:ga.map(function(ma){return ma.info.uid;})});ba.inform('chat/tokens-changed',{token_count:ga.length});}}e.exports=x;},null);
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w=l._("Done"),x=l._("Hide"),y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;},null);
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessageObject","MercuryMessageActions","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryMessageObject').get(),m=b('MercuryMessageActions').get(),n=b('MercuryServerRequests').get(),o=b('MercuryThreads').get(),p='/ajax/chat/multichat/name_conversation/dismiss.php',q={};function r(s,t,u){"use strict";this.$ChatNameConversationTabSheet0=s;this.$ChatNameConversationTabSheet1=t;this.$ChatNameConversationTabSheet2=u;this.$ChatNameConversationTabSheet3=false;}r.prototype.render=function(){"use strict";o.getThreadMeta(this.$ChatNameConversationTabSheet0,function(s){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,s,this.$ChatNameConversationTabSheet4.bind(null,s),this.$ChatNameConversationTabSheet5.bind(this,s));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};r.prototype.isPermanent=function(){"use strict";return true;};r.prototype.isSheetWithInput=function(){"use strict";return true;};r.prototype.getType=function(){"use strict";return 'name_conversation_type';};r.prototype.open=function(s){"use strict";this.$ChatNameConversationTabSheet3=s;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};r.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};r.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};r.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!q[this.$ChatNameConversationTabSheet0];};r.prototype.$ChatNameConversationTabSheet7=function(){"use strict";q[this.$ChatNameConversationTabSheet0]=true;};r.prototype.$ChatNameConversationTabSheet5=function(s){"use strict";if(!s.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();n.getServerThreadID(s.thread_id,function(t){new g(p).setData({thread_fbid:t}).send();});}};r.prototype.$ChatNameConversationTabSheet4=function(s,t){"use strict";var u=s.name;if((t||u)&&(t!=u))m.send(l.constructLogMessageObject(k.CHAT_WEB,s.thread_id,j.THREAD_NAME,{name:t}),null,i.CHAT);};e.exports=r;},null);
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(n.getNode('text'),l._("Scroll down to see new messages."));i.setContent(this._rootElement,n.getRoot());g.listen(n.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatNoRecipientsTabSheet",["DOM","MercuryViewer","ChatTabTemplates","copyProperties","fbt","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryThreads').get(),m=b('MercuryThreadInformer').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;m.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}j(n.prototype,{render:function(){var o=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),k._("Everyone has left the conversation."));g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=h.getID(),q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;},null);
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","JSXDOM","Event","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","WorkModeConfig","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();function u(v,w,x){this._rootElement=w;this._sheetView=x;this._logger=m.create('blackbird');this._canonicalUser=n.getUserIDFromThreadID(v);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}r(u.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var v=p[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),w='fbid:'+this._canonicalUser;o.get(w,function(x){var y='fbChatGoOnlineLink',z=k.a({href:"#",className:y},t._("turn on chat")),aa;if(q.is_work_user){aa=t._("To chat with {name} and other co-workers, {link}.",[t.param("name",x.short_name),t.param("link",z)]);}else aa=t._("To chat with {name} and other friends, {link}.",[t.param("name",x.short_name),t.param("link",z)]);j.setContent(v.getNode('text'),aa);i.addClass(v.getRoot(),"_1sk1");j.setContent(this._rootElement,v.getRoot());l.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),y)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(v){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(v){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=u;},null);
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","fbt","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l,m,n){this._threadID=l;this._rootElement=m;this._sheetView=n;}j(k.prototype,{render:function(){var l=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(l.getNode('text'),i._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,l.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=k;},null);
__d("ChatReadOnlyTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyTabSheet0=l;this.$ChatReadOnlyTabSheet1=m;this.$ChatReadOnlyTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getReason(j.getThreadMetaNow(this.$ChatReadOnlyTabSheet0));g.render(g.createElement("div",{className:"_87-"},l),this.$ChatReadOnlyTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};e.exports=k;},null);
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(n.getNode('text'),l._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,n.getRoot());g.listen(n.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","ChatTabTemplates"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";this.$ChatEmployeeAwaySheet0=o;this.$ChatEmployeeAwaySheet1=p;this.$ChatEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$ChatEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$ChatEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$ChatEmployeeAwaySheet2.close(this);};e.exports=n;},null);
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=m.getUserIDFromThreadID(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;n.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message.",[r.param("name",v.short_name)]);break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message.",[r.param("name",v.short_name)]);break;default:w=r._("You turned off chat for {name} but you can still send them a message.",[r.param("name",v.short_name)]);}i.setContent(t.getNode('text'),w+' ');var x=r._("Turn on chat for {name}?",[r.param("name",v.short_name)]);i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;n.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;},null);
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMutedTabSheet","ChatEmployeeAwaySheet","ChatUserBlockedTabSheet","MercuryIDs","MercurySheetView","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=function(u,v,w,x){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView,x);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new n(u,v,this._sheetView);this._employeeAwaySheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);if(!q.getUserIDFromThreadID(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};s(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},openEmployeeAwaySheet:function(){this._employeeAwaySheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},onEscape:function(u){this._addFriendsTabSheet.subscribe('esc-pressed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;},null);
__d("ChatTitleLink.react",["Link.react","MercuryThreadTitle.react","React","TrackingNodes","cx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=i,m=l.PropTypes,n=i.createClass({displayName:"ChatTitleLink",propTypes:{href:m.string,isNewThread:m.bool,thread:m.object,viewer:m.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (i.createElement(g,{"aria-level":"3",className:(("titlebarText")+(this.props.href===null?' '+"noLink":'')),"data-ft":j.getTrackingInfo(j.types.TITLE),"data-hover":"tooltip",href:this.props.href},i.createElement(h,{ref:"threadTitle",isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});e.exports=n;},null);
__d("ChatVideoCallButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i,n=m.PropTypes,o=i.createClass({displayName:"ChatVideoCallButton",mixins:[h],propTypes:{onClick:n.func,onKeyUp:n.func,shown:n.bool,tooltipLabel:n.string},getDefaultProps:function(){return {tooltipLabel:(l._("Start a video call"))};},render:function(){var p=j.getTrackingInfo(j.types.VIDEOCHAT),q=JSON.stringify({videochat:'call_clicked_bhat_tab'});return (i.createElement(g,{"aria-label":this.props.tooltipLabel,className:(("videoicon")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":p,"data-gt":q,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp}));}});e.exports=o;},null);
__d("EmoticonUtils",["EmoticonsList","Parent"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i='emoticon_',j=g.symbols,k={getEmoteFromTarget:function(l){var m=h.byClass(l,'emoticon');if(!m)return null;var n=null;m.className.split(' ').forEach(function(o){if(o.startsWith(i))n=o.substring(i.length);});return j[n]||null;},insertEmoticon:function(l,m,n){var o=m.substring(0,n.start),p=m.substring(n.end);if(n.start>0&&!o.endsWith(' '))l=' '+l;if(!p.startsWith(' '))l+=' ';var q=o+l+p;n.start+=l.length;n.end=n.start;return {result:q,start:n.start,end:n.end};}};e.exports=k;},null);
__d("MercurySharePreview.react",["AsyncRequest","LeftRight.react","LoadingIndicator.react","MercuryFallbackShareAttachment.react","MercuryShareAttachmentRenderLocations","React","XUICloseButton.react","cx","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=l,q=p.PropTypes,r=l.createClass({displayName:"MercurySharePreview",propTypes:{imageSize:q.shape({width:q.number.isRequired,height:q.number.isRequired}).isRequired,location:q.oneOf(k.getValues()).isRequired,share:q.shape({params:q.array,type:q.number}),uri:q.string,onClose:q.func,onUpdate:q.func},getInitialState:function(){return {attachmentData:null,loading:false};},componentWillMount:function(){this._requestID=1337;this._currentRequest=null;},componentWillUnmount:function(){this._reset();},componentWillReceiveProps:function(s){o(!(s.share&&s.uri));if(!s.share&&!s.uri)return this._reset();var t=this.state.attachmentData||this.state.loading;if(s.share&&!t){this._loadFromShare(s.share);}else if(s.uri&&!(t&&this.props.uri==s.uri))this._loadFromURI(s.uri);},componentDidUpdate:function(s,t){this.props.onUpdate&&this.props.onUpdate(this);},getShareData:function(){return this.state.attachmentData&&this.state.attachmentData.share_data;},isLoading:function(){return this.state.loading;},_loadFromShare:function(s){this._currentRequest=new g().setURI('/message_share_attachment/fromParams/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,share_params:s.params,share_type:s.type}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_loadFromURI:function(s){this._currentRequest=new g().setURI('/message_share_attachment/fromURI/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,uri:s}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_getNextRequestID:function(){return (++this._requestID);},_getCurrentRequestID:function(){return this._requestID;},_onShareLoaded:function(s,t){if(this._getCurrentRequestID()!==s)return;this.setState({loading:false,attachmentData:t.payload});},_close:function(){this._reset();this.props.onClose&&this.props.onClose();},_reset:function(){this._getNextRequestID();this._currentRequest&&this._currentRequest.abort();this._currentRequest=null;this.setState({loading:false,attachmentData:null});},render:function(){var s=(("_tig")+(' '+"_tih"));if(this.state.loading)return (l.createElement(h,{direction:h.DIRECTION.right,className:s},l.createElement(i,{className:"_tii",size:"large",color:"white"}),l.createElement(m,{className:"_tij",shade:"dark",size:"small",onClick:this._close})));var t=this.state.attachmentData;if(!t)return l.createElement("div",null);return (l.createElement("div",null,l.createElement(m,{className:"_tij",shade:"dark",size:"small",onClick:this._close}),l.createElement(j,{attachment:t,location:k.CHAT_PREVIEW})));}});e.exports=r;},null);
__d("MessengerContextualDialog.react",["LayerHideOnEscape","ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=12,l=i.createClass(h.createSpec({displayName:'MessengerContextualDialog',theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:k,length:16}},addedBehaviors:[g]}));e.exports=l;},null);
__d("P2PAddCreditCardDialog.react",["CurrentEnvironment","Link.react","P2PAPI","P2PAPIUtils","P2PCreditCardForm.react","P2PLoadingMask.react","P2PLinkConstants","React","P2PButton.react","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PText.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=n,y=x.PropTypes,z='fbP2PAddCreditCardDialog_learnMoreSentenceID',aa=g.messengerdotcom,ba=n.createClass({displayName:"P2PAddCreditCardDialog",propTypes:{asyncRequestState:y.object,onCancel:y.func,onError:y.func,onSaving:y.func,onSuccess:y.func,showPayButton:y.bool},getDefaultProps:function(){return {asyncRequestState:{},onCancel:v,onError:v,onSaving:v,onSuccess:v,showPayButton:false};},getInitialState:function(){return {isValid:false,formData:{},loading:false,requestID:'',saveErrors:null};},componentWillReceiveProps:function(ca){var da=ca.asyncRequestState?ca.asyncRequestState[this.state.requestID]:null;if(da){this.setState({requestID:''});if(da.error){this.handleOnSaveError(da.error);}else this.handleOnSaveSuccess(da);}},onSaveClick:function(){var ca=j.genRequestID();this.setState({loading:true,requestID:ca,saveErrors:null});this.props.onSaving();i.addCreditCard(Object.assign({requestID:ca},this.state.formData));},handleOnSaveSuccess:function(ca){this.props.onSuccess(ca);},handleOnSaveError:function(ca){this.setState({loading:false,saveErrors:ca});this.props.onError();},handleValidation:function(ca,da){this.setState({isValid:ca,formData:da});},isSaveButtonDisabled:function(){return this.state.loading||!this.state.isValid;},onToggle:function(ca){if(!ca)this.props.onCancel();},getButtonType:function(){var ca='default';if(this.props.showPayButton)ca='confirm';return ca;},getButtonText:function(){var ca=w._("Save");if(this.props.showPayButton)ca=w._("Pay");return ca;},renderAddCardForm:function(){var ca;if(aa)ca=n.createElement(o,{use:"default",size:"medium",label:w._("Cancel"),disabled:this.state.loading,onClick:this.props.onCancel});return (n.createElement("div",null,n.createElement(q,null,w._("Add Debit Card")),n.createElement(r,null,n.createElement(k,{onValidation:this.handleValidation,saveErrors:this.state.saveErrors}),n.createElement(t,{className:"_3-8y",id:z,type:"secondary"},w._("Your payment info is stored securely. {Learn more about p2p link}",[w.param("Learn more about p2p link",n.createElement(h,{"aria-describedby":z,href:m.addDebitCardHelpURI,target:"_blank"},w._("Learn more.")))]))),n.createElement(s,null,ca,n.createElement(o,{use:this.getButtonType(),size:"medium",label:this.getButtonText(),disabled:this.isSaveButtonDisabled(),onClick:this.onSaveClick}))));},render:function(){var ca;ca=aa?350:288;return (n.createElement(p,{layerHideOnBlur:false,ref:"dialog",onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:ca},this.renderAddCardForm(),n.createElement(l,{visible:this.state.loading})));}});e.exports=ba;},null);
__d("P2PConfirmAmountDialog.react",["CurrentEnvironment","React","P2PButton.react","P2PDialog.react","P2PDialogBody.react","P2PDialogFooter.react","P2PDialogTitle.react","P2PLoadingMask.react","P2PText.react","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=h,s=r.PropTypes,t=g.messengerdotcom,u=h.createClass({displayName:"P2PConfirmAmountDialog",propTypes:{amount:s.string,currencySymbol:s.string,onCancel:s.func,onConfirm:s.func,receiverName:s.string},getDefaultProps:function(){return {amount:'',currencySymbol:'',onCancel:p,onConfirm:p,receiverName:s.string};},getInitialState:function(){return {loading:false};},handleCancelClick:function(){this.props.onCancel();},handleConfirmClick:function(){this.setState({loading:true});this.props.onConfirm();},getFormattedAmount:function(){var v=this.props.amount,w=(parseFloat(v)).toFixed(2);return this.props.currencySymbol+''+w;},render:function(){var v=t?350:300;return (h.createElement(j,{layerHideOnBlur:false,shown:true,width:v},h.createElement(m,{showCloseButton:false},q._("Confirm Payment")),h.createElement(k,null,h.createElement(o,{type:"primary"},q._("Do you want to pay {recipient name} {amount}?",[q.param("recipient name",this.props.receiverName),q.param("amount",this.getFormattedAmount())]))),h.createElement(l,null,h.createElement(i,{label:q._("Cancel"),onClick:this.handleCancelClick,use:"default"}),h.createElement(i,{label:q._("Pay"),onClick:this.handleConfirmClick,use:"confirm"})),h.createElement(n,{visible:this.state.loading})));}});e.exports=u;},null);
__d("P2PSendMoneyAmountInput.react",["CurrentEnvironment","React","XUIError.react","P2PText.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=h,o=n.PropTypes,p=10000,q=g.messengerdotcom,r=h.createClass({displayName:"P2PSendMoneyAmountInput",propTypes:{currencySymbol:o.string,onInputChange:o.func,value:o.string},getDefaultProps:function(){return {currencySymbol:'$',onInputChange:l,value:''};},getInitialState:function(){return {inputError:null,maxInputWidth:q?236:100,value:this.props.value,width:''};},componentDidMount:function(){this.updateAmount(this.state.value);},handleAmountInputChange:function(s){var t=s.target.value;this.clearInputError();this.updateAmount(t);},clearInputError:function(){this.setState({inputError:null});},setInputError:function(s){this.setState({inputError:s});},updateAmount:function(s){var t=true,u;s=s.replace(/[^0-9\.]+/g,'');u=parseFloat(s);if(u>=p){t=false;this.setInputError(m._("Please enter a smaller amount"));}var v=s.split('.'),w=v[0],x=v[1];if(x!==undefined){s=(w&&parseFloat(w)!==0?w:'0')+'.'+x.substr(0,2);}else if(w&&parseFloat(w)===0)s='0';this.setValue(s);u=parseFloat(s);t=t&&!isNaN(u)&&u>0;this.props.onInputChange(s,t);},setValue:function(s){this.setState({value:s},this.updateWidth);},updateWidth:function(){var s=this.getMockWidth();if(s)this.setState({width:Math.min(s,this.state.maxInputWidth)});},getMockWidth:function(){return h.findDOMNode(this.refs.mock_input).offsetWidth;},render:function(){var s;if(q&&!this.state.value.length)s=h.createElement("div",{ref:"placeholder_input",className:"_1-sv"},"0");return (h.createElement("div",{className:(("_ipw")+(q?' '+"_1-sw":''))},h.createElement("label",null,h.createElement(j,{className:"_3-91 _1-sx",display:"inline",type:"primary"},m._("Enter Amount")),h.createElement("div",{className:(("_4puh")+(!this.state.value.length?' '+"_1-sy":''))},h.createElement("div",{className:"_5fbp"},this.props.currencySymbol),s,h.createElement("div",{ref:"mock_input",className:"_5fbs"},this.state.value),h.createElement(i,{xuiError:this.state.inputError},h.createElement("span",{className:"_1-sz"},h.createElement("input",{className:"_5fbv",onChange:this.handleAmountInputChange,ref:"textInput",style:{width:this.state.width},value:this.state.value})))))));}});e.exports=r;},null);
__d("P2PSendMoneyDialog.react",["Arbiter","CreditCardFormParam","Image.react","ImageBlock.react","Link.react","MessengerContextualDialog.react","P2PAPI","P2PAddCreditCardDialog.react","P2PButton.react","P2PCreditCardStore","P2PChooseCreditCardForm.react","P2PConfirmAmountDialog.react","P2PEditCreditCardDialog.react","P2PLinkConstants","P2PLoadingMask.react","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PQEValues","P2PSendMoneyAmountInput.react","P2PText.react","P2PVerifyCreditCardDialog.react","React","ReactLayeredComponentMixin","XUIContextualDialog.react","cx","fbt","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){b.__markCompiled&&b.__markCompiled();'use strict';var ia=ca,ja=ia.PropTypes,ka=ga._("Change"),la=ga._("Add Debit Card"),ma=100,na=ca.createClass({displayName:"P2PSendMoneyDialog",mixins:[da],propTypes:{amount:ja.string,currency:ja.string,currencySymbol:ja.string,onError:ja.func,onSendSuccess:ja.func,onToggle:ja.func,receiver:ja.object,theme:ja.string},getDefaultProps:function(){return {amount:'',currency:'USD',currencySymbol:'$',onError:ha,onSendSuccess:ha,onToggle:ha,receiver:{},theme:''};},getInitialState:function(){var oa=p.getAll();return {asyncRequestState:p.getAsyncRequestState(),addCreditCardDialogShown:false,amount:this.props.amount,creditCards:oa,confirmAmountDialogShown:false,isAmountValid:false,loading:false,selectedCard:oa[0],showChooseCreditCardForm:false,verifyCreditCardDialogShown:false};},_isAmountVerified:false,passwordCancelSubscribeToken:null,log:function(oa,pa){v.log(oa,Object.assign({www_event_flow:x.UI_FLOW_P2P_SEND,object_id:this.props.receiver.userId},pa));},componentWillUnmount:function(){if(this.passwordCancelSubscribeToken!==null){g.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},componentWillMount:function(){this.creditCardStoreSub=p.addListener('change',this.onCreditCardStoreChange);this.log(w.UI_ACTN_INITIATE_SEND);},onAmountInputChange:function(oa,pa){this.setState({amount:oa,isAmountValid:pa});},onCreditCardStoreChange:function(){var oa=p.getAll(),pa;if(this.state.selectedCard)pa=oa.filter(function(qa){return (qa.getCredentialId()===this.state.selectedCard.getCredentialId());}.bind(this))[0];if(!pa)pa=oa[0];this.setState({asyncRequestState:p.getAsyncRequestState(),creditCards:oa,selectedCard:pa});},shouldShowConfirmAmountDialog:function(){var oa=parseFloat(this.state.amount);return (!this._isAmountVerified&&oa>=ma);},shouldShowVerifyCreditCardDialog:function(){return !this.state.selectedCard.getIsVerified();},shouldShowEditCreditCardDialog:function(){return this.state.selectedCard.isExpired();},handleSendClick:function(oa){if(this.isSendButtonDisabled())return false;this.log(w.UI_ACTN_SEND_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this._isAmountVerified=false;this.initiatePayment();},initiatePayment:function(){if(this.shouldShowConfirmAmountDialog()){this.hideAllDialogs();this.setState({confirmAmountDialogShown:true});this.log(w.UI_ACTN_CONFIRM_AMOUNT,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowEditCreditCardDialog()){this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});this.log(w.UI_ACTN_EDIT_CARD,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowVerifyCreditCardDialog()){this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});this.log(w.UI_ACTN_VERIFY_CSC,{raw_amount:this.state.amount,currency:this.props.currency});return;}this.createTransaction();},shouldShowLoading:function(){return (!this.state.addCreditCardDialogShown&&!this.state.confirmAmountDialogShown&&!this.state.verifyCreditCardDialogShown&&!this.state.editCreditCardDialogShown);},createTransaction:function(){var oa={};this.setState({loading:this.shouldShowLoading()});oa[h.CREDENTIAL_ID]=this.state.selectedCard.getCredentialId();oa.amount=this.state.amount;oa.receiverId=this.props.receiver.userId;this.passwordCancelSubscribeToken=g.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);m.createTransaction({formData:oa,error:this.setCreateTransferError,success:this.setCreateTransferSuccess});this.log(w.UI_ACTN_CONFIRM_SEND,{raw_amount:this.state.amount,currency:this.props.currency});},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,confirmAmountDialogShown:false,verifyCreditCardDialogShown:false,editCreditCardDialogShown:false});},setCreateTransferError:function(oa){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onError(oa);this.log(w.UI_ACTN_SEND_FAIL);},setCreateTransferSuccess:function(oa){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onSendSuccess(oa);this.log(w.UI_ACTN_SEND_SUCCESS);},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},onAddCreditCardCancel:function(){this.setState({addCreditCardDialogShown:false});this.log(w.UI_ACTN_CANCEL_ADD_CARD);},onAddCreditCardSaving:function(){this.log(w.UI_ACTN_CONFIRM_CARD_DETAILS);},onAddCreditCardSuccess:function(oa){var pa=this.state.creditCards.filter(function(qa){var ra=qa.getCredentialId();return (oa[h.CREDENTIAL_ID]===ra);})[0];this.setState({selectedCard:pa});if(this.state.isAmountValid){this.initiatePayment();}else{this.setState({addCreditCardDialogShown:false});this.focusAmountInput();}this.log(w.UI_ACTN_ADD_CARD_SUCCESS);},onAddCreditCardError:function(){this.log(w.UI_ACTN_ADD_CARD_FAIL);},onEditCreditCardSuccess:function(){this.initiatePayment();},onEditCreditCardCancel:function(){this.setState({editCreditCardDialogShown:false});},focusAmountInput:function(){if(this.refs.send_money_amount_input)ca.findDOMNode(this.refs.send_money_amount_input).focus();},_handleToggle:function(oa){this.props.onToggle(oa);},_handleBlur:function(){this._handleToggle(false);if(!this.state.loading)this.log(w.UI_ACTN_SEND_MONEY_CANCELLED);},handleAddCreditCardClick:function(){this.setState({addCreditCardDialogShown:true,showChooseCreditCardForm:false});},handleBackClick:function(){this.setState({showChooseCreditCardForm:false},function(){this.focusAmountInput();});},handleChooseCardNextClick:function(){var oa=this.refs.choose_credit_card_form.getSelectedCard();this.setState({selectedCard:oa,showChooseCreditCardForm:false},function(){this.focusAmountInput();});},handleAddCardNextClick:function(){this.setState({addCreditCardDialogShown:true});this.log(w.UI_ACTN_INITIATE_ADD_CARD);},handleChangeSelectedCardClick:function(){var oa={};if(this.state.creditCards.length===1){oa.addCreditCardDialogShown=true;}else oa.showChooseCreditCardForm=true;this.setState(oa);},onConfirmAmountCancel:function(){this.setState({confirmAmountDialogShown:false});},onConfirmAmountSuccess:function(){this._isAmountVerified=true;this.initiatePayment();},onVerifyCreditCardSuccess:function(){this.initiatePayment();},onVerifyCreditCardCancel:function(){this.setState({verifyCreditCardDialogShown:false});},isSendButtonDisabled:function(){return (!this.state.isAmountValid||!this.state.creditCards.length||this.state.loading);},isAddCardNextButtonDisabled:function(){return !this.state.isAmountValid;},renderAddDebitCardLink:function(){return (ca.createElement(aa,{className:"_42h3",type:"secondary",ref:"send_money_dialog_add_card_text"},ca.createElement(k,{className:"_49nm",href:"#",onClick:this.handleAddCreditCardClick},la)));},renderSelectedCard:function(){var oa=this.state.selectedCard;return (ca.createElement(aa,{className:"_21x5",size:"small",type:"primary"},ca.createElement("div",{className:"_49nn"},oa.getName()),ca.createElement("div",{className:"_21wx"},oa.getCreditCardNumberFormatted()),ca.createElement("div",{className:"_21ww"},'\u00b7'),ca.createElement(k,{className:"_21wy",onClick:this.handleChangeSelectedCardClick,href:"#"},ka)));},renderFormButtons:function(){var oa;if(!this.state.creditCards.length){oa=this.renderAddCardNextButton();}else if(this.state.showChooseCreditCardForm){oa=ca.createElement("div",null,this.renderChooseCardBackButton(),this.renderChooseCardNextButton());}else oa=this.renderPayButton();return oa;},renderChooseCardBackButton:function(){return (ca.createElement(o,{className:"_2abj",label:ga._("Back"),onClick:this.handleBackClick,ref:"back_button",size:"medium",type:"secondary",use:"default"}));},renderAddCardNextButton:function(){return (ca.createElement(o,{className:"_5p-b",disabled:this.isAddCardNextButtonDisabled(),label:ga._("Next"),onClick:this.handleAddCardNextClick,ref:"add_card_next_button",size:"medium",type:"primary",use:"default"}));},renderChooseCardNextButton:function(){return (ca.createElement(o,{label:ga._("Next"),onClick:this.handleChooseCardNextClick,ref:"choose_card_next_button",size:"medium",type:"primary",use:"confirm"}));},renderPayButton:function(){return (ca.createElement(o,{className:"_21x6 _5p-b",disabled:this.isSendButtonDisabled(),label:ga._("Pay"),onClick:this.handleSendClick,ref:"send_button",size:"medium",type:"primary",use:"confirm"}));},renderPaymentDetails:function(){var oa,pa=y.SendMoneyFlyoutBottomText||'';if(this.state.creditCards.length){if(this.state.showChooseCreditCardForm){oa=this.renderAddDebitCardLink();}else oa=this.renderSelectedCard();}else oa=ca.createElement("div",{className:"_2abl"},ca.createElement(aa,{type:"secondary",ref:"send_money_dialog_add_card_next_text"},pa));return oa;},renderSendMoneyForm:function(){var oa=this.props.theme==='messenger'?32:40;return (ca.createElement("div",null,ca.createElement("div",{className:"_49no _2pi4",ref:"send_money_dialog_title"},ca.createElement(j,{spacing:"large"},ca.createElement(i,{className:"_5p-i",height:oa,src:this.props.receiver.big_image_src||this.props.receiver.image_src,width:oa}),ca.createElement("div",{className:"_3-8w"},ca.createElement(aa,{type:"secondary"},ga._("Send to")),ca.createElement(aa,{className:"_5p-j",size:"small",type:"primary",weight:"bold"},this.props.receiver.name))),ca.createElement(k,{className:"_49np",href:t.helpCenterURI,target:"_blank"})),ca.createElement("div",{className:"_2abm"},this.renderMainContainer()),ca.createElement("div",{className:(("_21w-")+(this.props.theme==='messenger'?' '+"_4eb_":''))},ca.createElement("div",{className:"_5p-k"},ca.createElement("div",{className:"_21x4"},this.renderPaymentDetails()),ca.createElement("div",{className:"_4zf-"},this.renderFormButtons())))));},renderMainContainer:function(){var oa;if(this.state.showChooseCreditCardForm){oa=ca.createElement("div",{className:"_xn7"},ca.createElement(q,{creditCards:this.state.creditCards,selectedCard:this.state.selectedCard,ref:"choose_credit_card_form"}));}else oa=ca.createElement("div",{className:"_2abn"},ca.createElement(z,{currencySymbol:this.props.currencySymbol,onInputChange:this.onAmountInputChange,ref:"send_money_amount_input",value:this.state.amount}));return oa;},renderLayers:function(){var oa={};if(this.state.addCreditCardDialogShown){oa.addCreditCard=ca.createElement(n,{asyncRequestState:this.state.asyncRequestState,ref:"send_money_dialog_add_credit_card_form",onCancel:this.onAddCreditCardCancel,onSuccess:this.onAddCreditCardSuccess,onError:this.onAddCreditCardError,onSaving:this.onAddCreditCardSaving,showPayButton:this.state.isAmountValid});}else if(this.state.confirmAmountDialogShown){oa.confirmAmount=ca.createElement(r,{amount:this.state.amount,currencySymbol:this.props.currencySymbol,onCancel:this.onConfirmAmountCancel,onConfirm:this.onConfirmAmountSuccess,receiverName:this.props.receiver.short_name});}else if(this.state.verifyCreditCardDialogShown){oa.verifyCreditCard=ca.createElement(ba,{asyncRequestState:this.state.asyncRequestState,creditCard:this.state.selectedCard,isSending:true,onCancel:this.onVerifyCreditCardCancel,onSuccess:this.onVerifyCreditCardSuccess});}else if(this.state.editCreditCardDialogShown)oa.confirmAmount=ca.createElement(s,{asyncRequestState:this.state.asyncRequestState,creditCard:this.state.selectedCard,onCancel:this.onEditCreditCardCancel,onSuccess:this.onEditCreditCardSuccess});return oa;},render:function(){var oa=this.props.theme==='messenger',pa=oa?l:ea,qa=oa?286:260;return (ca.createElement(pa,{alignment:oa?'right':'left',context:this.props.context,onBlur:this._handleBlur,onToggle:this._handleToggle,shown:true,width:qa,position:this.props.position||'above'},ca.createElement("div",{className:(("_21x9")+(oa?' '+"_1pka":''))},this.renderSendMoneyForm(),ca.createElement(u,{ref:"send_money_dialog_loader",visible:this.state.loading}))));}});e.exports=na;},null);
__d("P2PSendMoneyButton.react",["CurrentEnvironment","Link.react","P2PErrorDialog.react","P2PLinkConstants","P2PPasswordProtectionNUXDialog.react","P2PPasswordProtectionStatusTypes","P2PSendMoneyDialog.react","P2PTransferRiskResult","P2PTransferParam","P2PVerificationFlowHelper","React","ReactLayeredComponentMixin","TooltipLink.react","P2PActions","P2PButton.react","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PSuccessDialog.react","P2PText.react","P2PTransferStore","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){b.__markCompiled&&b.__markCompiled();'use strict';var fa=g.messengerdotcom,ga=q,ha=ga.PropTypes,ia=q.createClass({displayName:"P2PSendMoneyButton",mixins:[r],propTypes:{theme:ha.string,disabled:ha.bool,onTrigger:ha.func,receiver:ha.object},getDefaultProps:function(){return {disabled:false,onTrigger:da,receiver:{}};},getInitialState:function(){return {amount:'',confirmationDialogShown:false,dialogShown:false,passwordNUXPending:false,passwordProtectionNUXDialogShown:false,sendErrorObject:null,underManualReviewDialogShown:false};},componentDidMount:function(){this.transferStoreSub=ba.addListener('change',this.onTransferStoreChange);},componentWillUnmount:function(){if(this.transferStoreSub){this.transferStoreSub.remove();this.transferStoreSub=null;}},onTransferStoreChange:function(){var ja=ba.getChatSendViewProps(this.props.receiver.userId);if(!this.props.disabled&&ja)this.setState({dialogShown:ja.isOpen,amount:ja.amount});},originalCreateTransactionResponse:null,_onButtonClick:function(ja){ja.stopPropagation();if(this._clickGuard||this.props.disabled){this._clickGuard=null;return;}this.showSendMoneyDialog();},hideSendMoneyDialog:function(){t.chatSendViewClosed(this.props.receiver.userId);},showSendMoneyDialog:function(){t.chatSendViewOpened(this.props.receiver.userId);},_handleDialogToggle:function(ja){if(!ja){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},_prepareForClick:function(){this._clickGuard=this.state.dialogShown;},handleOnSendSuccess:function(ja){this.hideSendMoneyDialog();var ka=ja[o.RISK_RESULT];this.originalCreateTransactionResponse=ja;if(ka===n.REQUIRE_VERIFICATION){p.startVerificationFlow(ja.id,true,this.handlePostSendSteps);}else if(ka===n.UNDER_MANUAL_REVIEW){this.setState({underManualReviewDialogShown:true});}else this.handlePostSendSteps();},handlePostSendSteps:function(){var ja=this.originalCreateTransactionResponse,ka=ja.passwordProtection===l.NOT_SET;if(ja.isFirstSend){this.setState({confirmationDialogShown:true,passwordNUXPending:ka});}else if(ka)this.setState({passwordProtectionNUXDialogShown:true});this.originalCreateTransactionResponse=null;this.props.onTrigger();},onPasswordProtectionNUXComplete:function(){this.setState({passwordProtectionNUXDialogShown:false});},handleConfirmationOKClick:function(){this.setState({confirmationDialogShown:false,passwordProtectionNUXDialogShown:this.state.passwordNUXPending,passwordNUXPending:false});},handleSendError:function(ja){this.setState({sendErrorObject:ja});},handleErrorDialogOKClick:function(){this.setState({sendErrorObject:null});},onRiskResultDialogConfirmed:function(){this.setState({underManualReviewDialogShown:false},function(){this.handlePostSendSteps();}.bind(this));},getMoneyButtonNode:function(){return q.findDOMNode(this.refs.p2pSendMoneyButton);},renderLayers:function(){var ja={};if(this.state.sendErrorObject)ja.sendError=q.createElement(i,{error:this.state.sendErrorObject,onOKClick:this.handleErrorDialogOKClick,ref:"send_error",title:ea._("Problem Sending Money")});if(this.state.dialogShown)ja.sendMoneyDialog=q.createElement(m,{amount:this.state.amount,context:this.getMoneyButtonNode(),onToggle:this._handleDialogToggle,onError:this.handleSendError,onSendSuccess:this.handleOnSendSuccess,receiver:this.props.receiver,ref:'send_money_dialog',theme:this.props.theme});if(this.state.confirmationDialogShown)ja.confirmationDialog=q.createElement(z,{onOKClick:this.handleConfirmationOKClick,title:ea._("Payment Sent")},q.createElement(aa,{type:"primary"},ea._("When you receive money, it will go on this card too. You can update your card in {Link with text that goes to settings page}.",[ea.param("Link with text that goes to settings page",q.createElement(h,{target:"_blank",href:j.settingsWWWURI},ea._("Payments Settings")))])));if(this.state.passwordProtectionNUXDialogShown)ja.passwordProtectionNUXDialog=q.createElement(k,{onComplete:this.onPasswordProtectionNUXComplete});if(this.state.underManualReviewDialogShown)ja.underManualReviewDialog=q.createElement(v,{layerHideOnBlur:false,ref:"under_manual_review_dialog",shown:true,width:300},q.createElement(w,{showCloseButton:false},ea._("Reviewing Payment Info")),q.createElement(x,null,q.createElement(aa,{type:"primary"},ea._("For your security, this payment is in review for up to 24 hours. When it's confirmed, it will go through."))),q.createElement(y,null,q.createElement(u,{label:ea._("OK"),onClick:this.onRiskResultDialogConfirmed,use:"confirm"})));return ja;},render:function(){var ja=ea._("Send money"),ka='';if(this.props.receiver)ka=ea._("{receiverName} isn't able to receive money right now.",[ea.param("receiverName",this.props.receiver.short_name)]);var la=!this.props.disabled?ja:null,ma=this.props.disabled?ka:'';return (q.createElement(s,{alignH:"center",className:((this.state.dialogShown?"open":'')+(this.props.disabled?' '+"disabled":'')+(this.props.theme!=='messenger'?' '+"_5uqy":'')+(fa?' '+"_3ggc":'')),href:"#",position:"above",tooltip:ma,onClick:this._onButtonClick,onMouseDown:this._prepareForClick,title:la,ref:"p2pSendMoneyButton"}));}});e.exports=ia;},null);
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;},null);
__d("XStickerReplyNUXController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/stickers\/tooltip\/",{});},null);
__d("ChatTabView",["Arbiter","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","BanzaiODS","Bootloader","BootloadedComponent.react","ChatAddToThreadButton.react","ChatArchiveWarning.react","ChatBehavior","ChatCloseButton.react","ChatConfig","ChatContextualDialogController","ChatEmployeeAwayWarning","ChatOpenTab","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatStickerTriggerController","ChatTabActions","ChatTabMenu.react","ChatTabMessagesView","ChatTabOfficeStatus","ChatTabSheetController","ChatTabViewEvents","ChatTabViewInstances","ChatTitleLink.react","ChatVisibility","ChatVideoCallButton.react","MercuryConstants","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMEvent","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","FBRTCCore","Focus","ImmutableObject","Input","Keys","Locale","LogHistory","MercuryIDs","MercuryLogMessageType","MercuryParticipants","MercuryShareAttachmentRenderLocations","MercurySharePreview.react","MercurySourceType","MercuryThreadInfo","MercuryThreadMetadataRawRenderer","MercuryTypingReceiver","MercuryViewer","NubController","P2PSendMoneyButton.react","P2PTransferStore","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","Scroll","SelectionPosition","StickerActions","StickerConfig","StickerConstants","StickersFlyout.react","StickerState","Style","SubscriptionsHandler","SyntheticMouseEvent","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URLScraper","URI","UserAgent_DEPRECATED","WaterfallIDGenerator","WebMessengerDeleteThreadDialog","WebMessengerThreadPermalinks","XStickerReplyNUXController","cancelAnimationFrame","copyProperties","createCancelableFunction","csx","cx","emptyFunction","fbt","getActiveElement","isEmpty","requestAnimationFrame","setIntervalAcrossTransitions","ChatReactInput","MercuryMessageActions","MercuryMessages","MercuryMessageObject","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,ad,bd,cd,dd,ed,fd){b.__markCompiled&&b.__markCompiled();'use strict';var gd=b('ChatReactInput').module,hd=b('MercuryMessageActions').get(),id=b('MercuryMessages').get(),jd=b('MercuryMessageObject').get(),kd=b('MercuryServerRequests').get(),ld=b('MercuryThreadInformer').get(),md=b('MercuryThreadMetadataRenderer').get(),nd=b('MercuryThreadActions').get(),od=b('MercuryThreads').get(),pd=/^\s*$/,qd=ia,rd=null,sd,td=10,ud=960,vd=fb.getInstance('chat_tab_view');function wd(qe,re){var se=sa.create('div');re=re&&re.filter(function(ve){return ve!=pb.getID();});if(dd(re))return mc.remove(qe);var te=re.length,ue=te-td;if(ue>1)re=re.slice(0,td);ib.getMulti(re,function(ve){for(var we in ve){var xe=ve[we],ye=jc[':fb:mercury:chat:multichat-tooltip-item'].build();sa.setContent(ye.getNode('name'),xe.name);var ze=gb.getUserIDFromParticipantID(we),af=ze&&wb.get(ze)==k.ACTIVE;oa.conditionShow(ye.getNode('icon'),af);oa.conditionClass(ye.getNode('name'),'tooltipItemWithIcon',af);sa.appendContent(se,ye.getRoot());}if(ue>1){var bf=bd._("and {number of hidden chat participants} more.",[bd.param("number of hidden chat participants",ue)]);sa.appendContent(se,sa.create('div',{},bf));}mc.set(qe,se,'above');});}var xd={},yd=null,zd=false;function ae(qe,re,se){if(se){xd[qe]=re;if(!yd)yd=fd(be,600);}else{oa.removeClass(re,'highlightTitle');delete xd[qe];}}function be(){for(var qe in xd){var re=xd[qe];if(re.parentNode){oa.conditionClass(re,'highlightTitle',zd);}else delete xd[qe];}zd=!zd;if(!Object.keys(xd).length){clearInterval(yd);yd=null;}}function ce(qe){var re=gb.tokenize(qe);switch(re.type){case 'user':return jc[':fb:mercury:chat:user-tab'].build();}return jc[':fb:mercury:chat:multichat-tab'].build();}function de(qe){var re=qe._getInputValue(),se=qe._fileUploader.getAttachments();if(je(qe))fe(qe,re,se,function(te){var ue=qe._fileUploader.getImageFiles();if(ue.length>0){te.image_ids=ue;te.has_attachment=true;}var ve=qe._fileUploader.getAnimatedImageFiles();if(ve.length>0){te.gif_ids=ve;te.has_attachment=true;}var we=qe._fileUploader.getVideoFiles();if(we.length>0){te.video_ids=we;te.has_attachment=true;}var xe=qe._fileUploader.getAudioFiles();if(xe.length>0){te.audio_ids=xe;te.has_attachment=true;}var ye=qe._fileUploader.getFiles();if(ye.length>0){te.file_ids=ye;te.has_attachment=true;}hd.send(te);qe._fileUploader.removeAttachments();qe._shareLinkUploader&&qe._shareLinkUploader.clear();if(qe._sharePreview)qe._sharePreview.setProps({share:null,uri:null});if(!s.get('chat_react_input'))qe._getNode('input').value='';qe._typingDetector&&qe._typingDetector.resetState();qe._messagesView&&qe._messagesView.setShouldScrollToBottom(true);});}function ee(qe,re){if(re===0)return;le(qe,ub.POST_PUBLISHED,{count:re});qe._waterfallID=rc.generate();}function fe(qe,re,se,te){od.getThreadMeta(qe._threadID,function(ue){var ve=lb.CHAT_WEB;if(qe._shareLinkUploader&&qe._shareLinkUploader.getAttachData()&&qe._shareLinkUploader.loadedFromFeed())ve=lb.SAM_UFI;var we=jd.constructUserGeneratedMessageObject(re,ve,qe._threadID);if(se.length>0){we.has_attachment=true;we.raw_attachments=se;}if(qe._shareLinkUploader){var xe=qe._shareLinkUploader.getAttachData();if(xe){we.has_attachment=true;we.content_attachment=xe;}}if(qe._sharePreview){var ye=qe._sharePreview.getShareData();if(ye){we.has_attachment=true;we.shareable_attachment=ye;}}if(od.isNewEmptyLocalThread(qe._threadID)){var ze=qe._sheetController.getAddFriendsParticipants();if(ze===null||ze.length===0)return;ze=ze.filter(function(bf){return bf!=pb.getID();});if(ze.length===0){we.thread_id=gb.getThreadIDFromUserID(na.getID());}else if(ze.length===1){we.thread_id=gb.getThreadIDFromParticipantID(ze[0]);}else nd.addParticipants(qe._threadID,ze);}if(od.isEmptyLocalThread(qe._threadID)){we.message_id=gb.tokenize(qe._threadID).value;var af=od.getThreadMetaNow(ue.thread_id);we.specific_to_list=Array.from(af.participants);}if(typeof we!='undefined')we.signatureID=qe._signatureID;we.ui_push_phase=ma.UIPushPhase;te(we);if(qe._threadID!==we.thread_id&&!qe._photoUploader.isUploading()){ca.closeTab(qe._threadID);v.openThread(we.thread_id,'ChatTabView');}});}function ge(qe){qe._blocked=true;qe._sheetController.openUploadWarningTabSheet();}function he(qe){return (qe._fileUploader.isUploading()||qe._photoUploader.isUploading()||(qe._sharePreview&&qe._sharePreview.isLoading()));}function ie(qe){return (qe._fileUploader&&qe._fileUploader.isUploading());}function je(qe){var re=qe._getInputValue();if(!pd.test(re))return true;if(qe._fileUploader.getAttachments().length>0||qe._fileUploader.getImageFiles().length>0||qe._fileUploader.getAnimatedImageFiles().length>0||qe._fileUploader.getVideoFiles().length>0||qe._fileUploader.getAudioFiles().length>0||qe._fileUploader.getFiles().length>0)return true;if(qe._shareLinkUploader&&qe._shareLinkUploader.getAttachData())return true;if(qe._sharePreview&&qe._sharePreview.getShareData())return true;return false;}function ke(qe){qe._nubController.flyoutContentChanged();var re=qe._getNode('attachmentShelf');zb.setTop(re,re.scrollHeight);}function le(qe,re,se){ub.sendSignal(wc({qn:qe._waterfallID,step:re,uploader:ub.APP_CHAT},se||{}));}function me(qe,re,se,te,ue){var ve,we,xe;if(re)kd.ensureThreadIsFetched(re);this._threadID=qe;this._signatureID=se;this._eventListeners=[];this._tabTemplate=ce(qe);this._tabElem=this._tabTemplate.getRoot();if(ue){this.insertBefore(ue);}else this.appendTo(te);this._stickersFlyoutShown=false;this._messagesView=null;if(rd===null)rd=!s.get('seen_autosend_photo_nux');this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=rc.generate();this._subscriptionsHandler=new hc();this._initializeSheetController();var ye=[ad,this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeInput.bind(this),this._initializeStickers.bind(this),this._initializeAutoSendPhotoUploader.bind(this),this._initializeTitleHREF.bind(this),this._initializeP2P.bind(this),function(){od.getThreadMeta(this._threadID,function(bf){this._setUpMutingSettings(bf);}.bind(this));y.removeEmptyHrefs(this._tabElem);}.bind(this),function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}.bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this)];if(s.get('chat_defer_initialization',false)){var ze=function(bf){if(!bf.length){delete this._initFrame;return;}var cf=bf.shift();this._initFrame=ed(function(){ze(bf);});cf();}.bind(this);ze(ye);}else{var af;for(ve=ye,we=Array.isArray(ve),xe=0,ve=we?ve:ve[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(we){if(xe>=ve.length)break;af=ve[xe++];}else{xe=ve.next();if(xe.done)break;af=xe.value;}af();}}qd.set(qe,this);this._logOpenTab();}function ne(qe){if(qe._photoUploader.isUploading())le(qe,ub.CANCEL_DURING_UPLOAD);}function oe(){var qe,re,se,te;for(qe=qd.values(),re=Array.isArray(qe),se=0,qe=re?qe:qe[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(re){if(se>=qe.length)break;te=qe[se++];}else{se=qe.next();if(se.done)break;te=se.value;}te.updateAvailableStatus();te.updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],oe);vb.subscribe(['privacy-changed','privacy-availability-changed'],oe);q.subscribe(q.ON_CHANGED,function(){var qe,re,se,te;for(qe=qd.keys(),re=Array.isArray(qe),se=0,qe=re?qe:qe[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(re){if(se>=qe.length)break;te=qe[se++];}else{se=qe.next();if(se.done)break;te=se.value;}od.getThreadMeta(te,function(ue){qd.get(te)._updateUnreadCount(ue);});}});ob.addRetroactiveListener('state-changed',function(qe){for(var re in qe){var se=qe[re]&&qe[re].length,te=qd.get(re);te&&te.showTypingIndicator(se);}});ld.subscribe('threads-updated',function(qe,re){var se,te,ue,ve;for(se=qd.keys(),te=Array.isArray(se),ue=0,se=te?se:se[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(te){if(ue>=se.length)break;ve=se[ue++];}else{ue=se.next();if(ue.done)break;ve=ue.value;}var we=qd.get(ve);re[ve]&&we.updateTab();if(we._newThreadIDFromPhotoUpload&&!we._photoUploader.isUploading()&&re[we._newThreadIDFromPhotoUpload]){ca.closeTab(we._threadID);v.openThread(we._newThreadIDFromPhotoUpload,'ChatTabView');we._newThreadIDFromPhotoUpload=null;}}});ld.subscribe('threads-deleted',function(qe,re){var se,te,ue,ve;for(se=qd.keys(),te=Array.isArray(se),ue=0,se=te?se:se[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(te){if(ue>=se.length)break;ve=se[ue++];}else{ue=se.next();if(ue.done)break;ve=ue.value;}re[ve]&&ca.closeTab(ve,'thread_deleted');}});wc(me.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(qe){setTimeout((function(){this._sheetController.openNameConversationSheet(qe);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return oa.shown(this._tabElem);},setVisibleState:function(qe,re){var se=oa.shown(this._tabElem),te=oa.hasClass(this._tabElem,'opened');oa.conditionShow(this._tabElem,qe);oa.conditionClass(this._tabElem,'opened',re);if(!(se&&te)&&qe&&re){if(!this._messagesView)this._messagesView=new ea(this._threadID,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(se&&te&&!(qe&&re))this._contextualDialogController&&this._contextualDialogController.tabNotActive();},focus:function(){if(oa.hasClass(this._tabElem,'opened')){this._focusInput();}else this._getNode('dockButton').focus();},isFocused:function(){var qe=cd();return tb.byClass(qe,"_50mz")===this._tabElem;},hasEmptyInput:function(){var qe;if(s.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return false;qe=this._chatInput.getValue();}else qe=this._getNode('input').value;return pd.test(qe);},getInputElem:function(){if(s.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return null;return xb.findDOMNode(this._chatInput);}else return this._getNode('input');},setStickersFlyoutPackID:function(qe){if(this._stickerButton){this._setPackIDReact(qe);}else this._setPackIDLegacy(qe);},loadShareFromParams:function(qe,re){this._shareLinkUploader&&this._shareLinkUploader.loadShareFromParams(qe,re);if(this._sharePreview)this._sharePreview.setProps({share:{params:re,type:qe},uri:null});},_linkDropped:function(qe){this._shareLinkUploader&&this._shareLinkUploader.loadShare(qe);if(this._sharePreview)this._sharePreview.setProps({share:null,uri:qe});},_filesDropped:function(qe){if(this._fileUploader)this._fileUploader.addDroppedFiles(qe);},_setPackIDLegacy:function(qe){var re=this._stickersFlyout;if(!this._stickersFlyoutToggler||!re||!re.isMounted())return;bc.selectPack(qe);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(qe){if(!this._stickerButton.isMounted())return;bc.selectPack(qe);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(qe){this._stickerButton.showFlyout();this._stickersFlyoutShown=qe;},_toggleStickersFlyoutShownLegacy:function(qe){if(qe){lc.show(this._stickersFlyoutToggler);}else lc.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=qe;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(sd)return;var qe=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new i(uc.getURIBuilder().getURI()).setRelativeTo(qe).setData({thread_id:this._threadID}).setHandler(function(re){fc.clearShowStickerReplyNUX();}).send();},insertBefore:function(qe){sa.insertBefore(qe._tabElem,this._tabElem);},appendTo:function(qe){sa.appendContent(qe,this._tabElem);},nextTabIs:function(qe){var re=qe&&qe._tabElem;return this._tabElem.nextSibling==re;},getScrollTop:function(){return zb.getTop(sa.find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(qe){zb.setTop(sa.find(this._tabElem,'.fbNubFlyoutBody.scrollable'),qe);},_unmountComponentAtNodeSafe:function(qe){var re=this._getNode(qe);re&&xb.unmountComponentAtNode(re);},destroy:function(){this._initFrame&&vc(this._initFrame);this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();xb.unmountComponentAtNode(this._getNode('menuContainer'));if(s.get('chat_react_header')){xb.unmountComponentAtNode(this._getNode('addToThreadContainer'));this._unmountComponentAtNodeSafe('archiveContainer');this._unmountComponentAtNodeSafe('videoCallButtonContainer');xb.unmountComponentAtNode(this._getNode('closeButtonContainer'));xb.unmountComponentAtNode(this._getNode('titleContainer'));}if(s.get('chat_react_share_uploader')&&this._sharePreview&&this._sharePreview.isMounted()){xb.unmountComponentAtNode(xb.findDOMNode(this._sharePreview));}else this._shareLinkUploader&&this._shareLinkUploader.clear();try{xb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));}catch(qe){l.bumpEntityKey('chat.web','chattab.unmount_failed');}if(s.get('chat_react_sticker_button')){xb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));}else xb.unmountComponentAtNode(this._getNode('stickers'));if(cc.WebStickerTrigger)this._stickerTriggerController.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();if(s.get('chat_react_input')){xb.unmountComponentAtNode(this._getNode('inputContainer'));}else cb.reset(this._getNode('input'));sa.remove(this._tabElem);qd["delete"](this._threadID);ra.unregisterNubController(this._nubController);},updateAvailableStatus:function(){od.getThreadMeta(this._threadID,function(qe){var re=k.OFFLINE,se=false,te=this._getCanonicalUserID();if(te){re=wb.get(te);se=za.isAvailableForWebrtcCalling(te);}else{var ue=qe.participants.map(function(we){return gb.getUserIDFromParticipantID(we);});re=wb.getGroup(ue);}if(!ka.isOnline())re=k.OFFLINE;if(te)this._updateCallLink();oa.conditionClass(this._tabElem,"_5238",re===k.ACTIVE);oa.conditionClass(this._tabElem,"_4hwz",se);oa.conditionClass(this._tabElem,"_5239",re===k.MOBILE);var ve=this._getNode('presenceIndicator');switch(re){case k.ACTIVE:ve.setAttribute('alt',bd._("Online"));break;case k.MOBILE:ve.setAttribute('alt',bd._("Mobile"));break;default:ve.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){od.getThreadMeta(this._threadID,function(qe){var re=[this._getNode('name')];if(!s.get('chat_react_header')){re.push(this._getNode('titlebarText'));}else if(this._title.isMounted())this._title.setProps({thread:qe},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.getTitle());}.bind(this));md.renderAndSeparatedParticipantList(this._threadID,re,{names_renderer:nb.renderShortNames,check_length:true});this._updateControls(qe);this._updateMutingSettings(qe);this._updateUnreadCount(qe);this.updateMultichatTooltip();this._updateArchiveWarning(qe);this._updateEmployeeAwayWarning(qe);this._updateOfficeStatus(qe);this._updateNewThread(qe);this._updateNameConversationSheet(qe);this._updateReadOnlySheet(qe);this._updateSwitchToWork(qe);}.bind(this));},_updateNameConversationSheet:function(qe){if(mb.canReply(qe)&&!qe.name&&!qe.is_canonical&&!qe.name_conversation_sheet_dismissed&&!qe.has_email_participant&&!qe.read_only&&!od.isEmptyLocalThread(qe.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(qe){var re=mb.canReply(qe),se=od.isEmptyLocalThread(qe.thread_id);if(!re&&!se)this._sheetController.openReadOnlySheet();},updateSignatureID:function(qe){this._signatureID=qe;},_showPhotoNUXIfNecessary:function(){if(rd){rd=false;new i('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(qe){var re=mb.isMuted(qe);if(re)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(re);},_updateMutingSettings:function(qe){var re=mb.isMuted(qe),se=this._reactChatTabMenu.props.isMuted;if(re&&!se){this._sheetController.openThreadIsMutedTabSheet();}else if(!re&&se)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(re);},_updateActionMenu:function(qe){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({isMuted:qe});},_updateArchiveWarning:function(qe){if(na.isEmployee())ib.getMulti(qe.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateEmployeeAwayWarning:function(qe){u.updateEmployeeAwayWarning(qe,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),function(){});},_updateOfficeStatus:function(qe){var re=this._getNode('officeStatus');if(!re||gb.isMultichat(qe.thread_id))return;var se=gb.getParticipantIDFromUserID(qe.canonical_fbid);ib.get(se,function(te){fa.update(re,te);});},_updateSwitchToWork:function(qe){if(na.isEmployee()&&na.hasWorkUser()&&gb.isMultichat(qe.thread_id)){ib.getMulti(qe.participants,function(re){this._showSwitchToWork(this._isEmployeesOnly(re));}.bind(this));}else this._showSwitchToWork(false);},_updateControls:function(qe,re){var se=false;if(qe&&qe.thread_id){var te=gb.tokenize(qe.thread_id);if(te.type==='user'){var ue=te.value;se=!kd.isUser(ue);}}var ve=mb.canReply(qe)&&(!dd(qe.participants)||!!re);oa.conditionShow(this._inputContainerNode,ve);oa.conditionShow(this._iconsContainerNode,ve);if(this._reactChatTabMenu.isMounted()){this._reactChatTabMenu.setProps({isEmptyChat:od.isNewEmptyLocalThread(qe.thread_id),show:ve});if(se)this._reactChatTabMenu.setProps({showAddFriend:null});}var we=ve&&!se;if(s.get('chat_react_header')){this._addToThreadButton.isMounted()&&this._addToThreadButton.setProps({shown:we});}else oa.conditionShow(this._getNode('addToThreadLink'),we);this._resizeInputContainer();this._updateOrionTrigger(we);},_updateOrionTrigger:function(qe){if(qe)if(this._orionTrigger){this._setOrionTriggerProps();}else if(!this._orionTrigger)this._renderOrionTrigger();},_setOrionTriggerProps:function(){var qe=this.getParticipantIDForOrionNUX(),re=true;oa.conditionShow(this._orionTriggerContainer,qe);if(qe){ib.get(qe,function(se){se=bb.set(se,{userId:this._getUserIdFromParticipantID(qe)});if(se.orion_eligible||sb.hasReceivedFromSender(se.userId))re=false;this._orionTrigger.setProps({receiver:se,disabled:re});}.bind(this));}else this._orionTrigger.setProps({receiver:{}});},_getUserIdFromParticipantID:function(qe){return gb.getUserIDFromParticipantID(qe);},_onP2PTransferStoreChange:function(){this._renderOrionTrigger();if(this._transferStoreSub){this._transferStoreSub.remove();this._transferStoreSub=null;}},_isP2PEnabled:function(){return s.get('p2p_enabled');},_renderOrionTrigger:function(){var qe=this._isP2PEnabled()||sb.hasTransfers();if(qe){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=xb.render(xb.createElement(rb,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);oa.addClass(this._inputContainerNode,"_11d6");this._setOrionTriggerProps();}},getParticipantIDForOrionNUX:function(){var qe=this._sheetController.getAddFriendsTabSheet(),re=qe.getParticipants(),se=this._getCanonicalUserID(),te=null;if(se){te=gb.getParticipantIDFromUserID(se);}else if(od.isNewEmptyLocalThread(this._threadID)&&re&&re.length===1)te=re[0];return te;},_resizeInputContainer:function(){var qe=this._tabElem.clientWidth,re=2,se=qe-(this._inputContainerNode.clientWidth+re),te=eb.isRTL()?'left':'right';gc.set(this._iconsContainerNode,te,se+'px');if(!s.get('chat_react_input'))kc.getInstance(this._getNode('input')).update();},_updateNewThread:function(qe){if(od.isNewEmptyLocalThread(qe.thread_id))this.showAddFriend();},_isEmployeesOnly:function(qe){for(var re in qe)if(!qe[re].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(qe){var re=this._isEmployeesOnly(qe),se=s.get('chat_react_header'),te=se?this._getNode('archiveContainer'):this._getNode('titanArchiveWarning');if(te){if(this._titlebarTooltipAnchor)oa.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',re);if(se){this._archiveWarning.isMounted()&&this._archiveWarning.setProps({shown:re});}else oa.conditionShow(te,re);}},_showSwitchToWork:function(qe){if(this._reactChatTabMenu.isMounted())this._reactChatTabMenu.setProps({hasSwitchToWork:qe});},updateMultichatTooltip:function(){od.getThreadMeta(this._threadID,function(qe){if(!qe.is_canonical){var re;if(s.get('chat_react_header')){re=xb.findDOMNode(this._title);}else re=this._titlebarTooltipAnchor;wd(re,qe.participants);}}.bind(this));},_getNode:function(qe){return this._tabTemplate.getNode(qe);},_getCanonicalUserID:function(){return gb.getUserIDFromThreadID(this._threadID);},_listen:function(qe,event,re,se){var te=this._getNode(qe);if(te){this._eventListeners.push(ya.listen(te,event,re.bind(this)));}else if(!se)throw new Error('Could not find node "'+qe+'"');},_closePreClicked:function(qe){this._closeMouseDown=true;},_closeClicked:function(qe){ne(this);ca.closeTab(this._threadID);if(qe instanceof ic){qe.stopPropagation();return;}qe.kill();},_closeEnter:function(qe){if(qe.keyCode===db.RETURN)this._closeClicked(qe);},_nubClicked:function(qe){qe.kill();return ha.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===db.RETURN||event.keyCode===db.SPACE){ha.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===db.ESC){this._handleEscape();if(s.get('chat_react_input'))event=new ta(event);event.kill();}else if(event.keyCode===db.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var qe=ha.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});if(s.get('chat_react_input'))event=new ta(event);!qe&&event.kill();return true;}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}ne(this);if(this.hasEmptyInput()){ha.inform('esc-pressed',this._threadID);}else{var qe=bd._("Are you sure you want to close this chat window?"),re=bd._("You haven't sent your message."),se=new qa().setTitle(qe).setBody(re).setButtons([qa.CLOSE,qa.CANCEL]).setHandler(ha.inform.bind(ha,'esc-pressed',this._threadID,null)).setModal(true).show(),te=se.getButtonElement('yes');te&&ab.set(te);}},_titleClicked:function(event){var qe=event.getTarget();if(!tb.byClass(qe,'titlebarText')&&!tb.byClass(qe,'uiSelector')&&!tb.byClass(qe,'addToThread')&&!tb.byClass(qe,'optionMenu')&&!tb.byClass(qe,'videoicon')&&!tb.byClass(qe,'close')){event.kill();ca.lowerTab(this._threadID);this.focus();}},_callEnter:function(qe){if(qe.keyCode===db.RETURN)this._callClicked(qe);},_callClicked:function(qe){if(qe.target)qe.target.blur();var re=this._getCanonicalUserID();if(za.isAvailableForWebrtcCalling(re)){var se='chat_tab_icon';if(qe.target&&oa.hasClass(qe.target,'video_call_tour'))se='chat_tab_icon_tour';ha.inform('video-call-clicked',{threadID:this._threadID,userID:re,clickSource:se});}if(s.get('chat_react_header')){qe.stopPropagation();}else return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){kd.getServerThreadID(this._threadID,function(qe){h.send(new i(pc('/ajax/browser/dialog/multichat_members/').addQueryData({id:qe})));});},_deleteConversation:function(){sc.show(this._threadID);},_unsubscribeLinkClicked:function(){var qe=[];qe.push({name:'unsubscribe',label:bd._("Leave Conversation"),handler:this._unsubscribeToThread.bind(this)});qe.push(qa.CANCEL);new qa().setTitle(bd._("Leave Conversation?")).setBody(bd._("You will stop receiving messages from this conversation and people will see that you left.")).setButtons(qe).show();},_switchToWorkUserClicked:function(){var qe=[];qe.push({name:'move',label:bd._("Move Conversation"),handler:this._switchToWork.bind(this)});qe.push(qa.CANCEL);new qa().setTitle(bd._("Move Conversation to Work Account?")).setBody(bd._("Do you want to move this conversation so that it shows in your work account instead?")).setButtons(qe).show();},_getUserParticipants:function(qe){var re=[];qe.forEach(function(se){var te=gb.getUserIDFromParticipantID(se);te&&re.push(te);});return re;},_createGroupClicked:function(){od.getThreadMeta(this._threadID,function(qe){if(!qe.is_canonical){var re=pc('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),se=this._getUserParticipants(qe.participants);re.addQueryData({members:se});if(qe.name)re.addQueryData({name:qe.name});h.send(new i(re));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var qe=this._getCanonicalUserID(),re=pc('/ajax/chat/report.php').addQueryData({id:qe}).addQueryData({src:'top_report_link'});h.send(new i(re));},_inputPasted:function(event){if(qc.chrome()){var qe=event.clipboardData||event.originalEvent.clipboardData;if(!qe||!qe.items||qe.items.length<1)return;var re=qe.items[0].type;if(re!=='image/png')return;if(qe.items[0].getAsFile){var se=qe.items[0].getAsFile();this._photoUploader.uploadFile(se);}}},_focusInput:function(){if(s.get('chat_react_input')){this._chatInput&&this._chatInput.isMounted()&&this._chatInput.focus();}else this._getNode('input').focus();},_focusTab:function(){oa.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController&&this._contextualDialogController.tabFocused();if(!sd&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){sd=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);ha.inform('focus-tab',this._threadID);},_blurTab:function(){oa.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(qe){if(s.get('chat_react_header')){this._closeButton.isMounted()&&this._closeButton.setProps({active:qe});return;}var re=this._getNode('titlebarCloseButton'),se=qe?bd._("Press Esc to close"):bd._("Close tab");mc.set(re,se,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===db.RETURN&&!event.shiftKey){if(ie(this)){ge(this);event.kill&&event.kill();return;}de(this);if(cc.WebStickerTrigger)this._stickerTriggerController.activateAfterparty();event.kill&&event.kill();return;}if(event.keyCode===db.DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();ca.lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_initializeInput:function(){if(!s.get('chat_react_input')){var qe=this._inputContainerNode.clientHeight;kc.getInstance(this._getNode('input')).subscribe('resize',function(){var re=this._inputContainerNode.clientHeight;if(re!=qe)this._nubController.flyoutContentChanged();qe=re;}.bind(this));this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);if(qc.firefox()&&pa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._initializeThingsWithInputFn(this._tabTemplate.getNode('input'));}else this._chatInput=xb.render(xb.createElement(gd,{initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputChanged:function(re){if(cc.WebStickerTrigger)this._stickerTriggerController.updateInput(re);}.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onAddMention:this._onAddMention.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:this._toggleStickersFlyoutShownLegacy.bind(this,true),stickersFlyoutToggler:this._stickersFlyoutToggler,searchTriggeredWord:function(){this._toggleStickersFlyoutShownLegacy(true);this._searchStickers(this._stickerTriggerController.getTriggeredWord());}.bind(this),resizeFn:function(re){gc.set(this._getNode('inputContainer'),'height',re+'px');this._nubController.flyoutContentChanged();}.bind(this),uploadPhotoFn:function(re){this._photoUploader&&this._photoUploader.uploadFile(re);}.bind(this)}),this._getNode('chatInputContainer'));},_initializeSharePreview:function(qe,re){this._sharePreview=xb.render(xb.createElement(kb,{imageSize:{width:ud,height:ud},location:jb.CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){ke(this);this._unblockSend();}.bind(this)}),this._getNode('shareAttachmentShelf'));ya.listen(qe,'keyup',function(){var se=re?re():qe.value;!se.length&&this._urlScraper.reset();}.bind(this));this._urlScraper=new oc(qe,re);this._urlScraper.subscribe('match',function(se,te){this._sharePreview.setProps({share:null,uri:(te&&te.url)});}.bind(this));},_initializeThingsWithInputFn:function(qe,re){if(s.get('chat_react_share_uploader')){this._initializeSharePreview(qe,re);}else{this._shareLinkUploader=new z(this._getNode('shareAttachmentShelf'),qe,this.focus.bind(this),re,this._appendTextToInput.bind(this));this._initializeUploader(this._shareLinkUploader);}od.getThreadMeta(this._threadID,function(se){kd.getServerThreadID(this._threadID,function(te){this._typingDetector=new nc(this._getCanonicalUserID(),qe,'mercury-chat',null,te,re);}.bind(this));}.bind(this));},_getInputValue:function(){if(s.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return '';return this._chatInput.getValue()||'';}else return this._tabTemplate.getNode('input').value||'';},_appendTextToInput:function(qe){if(s.get('chat_react_input')){if(this._chatInput&&this._chatInput.isMounted())this._chatInput.appendText(qe);}else this._getNode('input').value+=qe;},_hasUnfinishedPost:function(){return je(this)||he(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){nd.markRead(this._threadID);nd.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(qe){this.tryMarkAsRead();if(tb.byTag(qe.getTarget(),'a')||sa.getSelection())return;this.focus();},_inputContainerClicked:function(qe){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(qe){if(s.get('chat_closed_tab_typing_indicator_animated')){var re=sa.find(this._tabElem,"._54m9");if(qe){this._animatedTypingIndicator=xb.render(xb.createElement(n,{bootloadPlaceholder:xb.createElement("span",null),bootloadComponent:function(se){m.loadModules(["MercuryTypingAnimation.react"],se);}}),re);this._updateAnimatedIndicatorColor();oa.addClass(this._tabElem,"_54m8");oa.show(re);}else{oa.removeClass(this._tabElem,"_54m8");oa.hide(re);xb.unmountComponentAtNode(re);this._animatedTypingIndicator=null;}}else oa.conditionClass(this._tabElem,'typing',qe);},_updateAnimatedIndicatorColor:function(){if(this._animatedTypingIndicator){var qe=oa.hasClass(this._tabElem,'highlightTab')?'light':'dark';this._animatedTypingIndicator.setProps({color:qe});}},_updateUnreadCount:function(qe){var re=qe.unread_count;if(typeof re!='undefined'){var se=!!re&&(!q.showsTabUnreadUI||q.showsTabUnreadUI()),te=this._getNode('numMessages');oa.conditionShow(te,se);oa.conditionClass(this._tabElem,'highlightTab',se);this._updateAnimatedIndicatorColor();ae(this._threadID,this._tabElem,se);sa.setContent(te,re);}},_updateCallLink:function(){var qe=this._getCanonicalUserID();if(qe===na.getID()){this._hideVideoCallouts();if(s.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({shown:false});}else oa.hide(this._getNode('videoCallLink'));return;}var re=za.callabilityForUser(qe),se=gb.getParticipantIDFromUserID(qe);if(re!=za.CallabilityStatus.AVAILABLE)this._hideVideoCallouts();ib.get(se,function(te){this._setVideoCallTooltip(za.generateCallButtonTooltip(te.short_name,re));}.bind(this));},_setVideoCallTooltip:function(qe){if(s.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({tooltipLabel:qe});}else mc.set(this._getNode('videoCallLink'),qe);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_setPrivacyLinkText:function(qe){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:qe});},_updatePrivacyLink:function(qe){var re;if(qe==x.OFFLINE){re=bd._("Go online");this._setPrivacyLinkText(re);return;}var se=this._getCanonicalUserID();if(!se)return;var te='fbid:'+se;ib.get(te,function(ue){if(!ue.is_friend){re=null;}else if(qe==x.BLOCKED){re=bd._("Turn On Chat for {name}",[bd.param("name",ue.short_name)]);}else re=bd._("Turn Off Chat for {name}",[bd.param("name",ue.short_name)]);this._setPrivacyLinkText(re);}.bind(this));},_unsubscribeToThread:function(){if(!od.isEmptyLocalThread(this._threadID)){var qe=jd.constructLogMessageObject(lb.CHAT_WEB,this._threadID,hb.UNSUBSCRIBE,{removed_participants:[pb.getID()]});hd.send(qe);}ca.closeTab(this._threadID,'unsubscribed');return true;},_switchToWork:function(){if(!od.isEmptyLocalThread(this._threadID)){var qe=jd.constructLogMessageObject(lb.CHAT_WEB,this._threadID,hb.SWITCH_TO_WORK,{removed_participants:[pb.getID()]});hd.send(qe);}ca.closeTab(this._threadID,'unsubscribed');return true;},_initializeSheetController:function(){this._sheetController=new ga(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){nd.unmute(this._threadID);this.focus();}.bind(this));this._sheetController.onTokensChanged(function(qe,re){od.getThreadMeta(this._threadID,function(se){this._updateControls(se,re.token_count);}.bind(this));}.bind(this));this._nubController=new qb().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));},_initializeUploader:function(qe){this._subscriptionsHandler.addSubscriptions(qe.subscribe(['all-uploads-completed','upload-canceled'],function(){return this._unblockSend();}.bind(this)),qe.subscribe('dom-updated',function(){ke(this);}.bind(this)),qe.subscribe('submit',function(){this._focusInput();}.bind(this)));},_initializeHeader:function(){this._initializeReactMenu(this._getNode('fileAttachmentShelf'));this._initializeArchiveWarning();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeCloseButton();this._initializeTitle();},_initializeReactMenu:function(qe){var re=this._getNode('menuContainer'),se=gb.isMultichat(this._threadID),te=od.isNewEmptyLocalThread(this._threadID),ue=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(re)this._reactChatTabMenu=xb.render(xb.createElement(da,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),deleteConversationFunc:this._deleteConversation.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),switchToWorkFunc:this._switchToWorkUserClicked.bind(this),isMultichat:se,isEmptyChat:te,showAddFriend:ue,threadID:this._threadID,attachmentsShelf:qe,onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:ke.bind(this,this),onSubmit:this._focusInput.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),re);},_initializeArchiveWarning:function(){if(s.get('chat_react_header'))this._archiveWarning=xb.render(xb.createElement(p,{isFBAtWork:s.IsWorkUser,shown:true}),this._getNode('archiveContainer'));},_initializeAddToThreadButton:function(){if(s.get('chat_react_header')){this._addToThreadButton=xb.render(xb.createElement(o,{isFBAtWork:s.get('IsWorkUser',false),onClick:this._addFriendLinkClicked.bind(this),shown:true}),this._getNode('addToThreadContainer'));}else this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);},_initializeVideoCallButton:function(){if(!gb.getUserIDFromThreadID(this._threadID))return;var qe=null;if(s.get('chat_react_header')){this._videoCallButton=xb.render(xb.createElement(la,{shown:true,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)}),this._getNode('videoCallButtonContainer'));qe=xb.findDOMNode(this._videoCallButton);}else{qe=this._getNode('videoCallLink');this._listen('videoCallLink','click',this._callClicked,true);this._listen('videoCallLink','keyup',this._callEnter,true);}this._contextualDialogController=new t(this._threadID,qe);},_initializeCloseButton:function(){if(s.get('chat_react_header')){this._closeButton=xb.render(xb.createElement(r,{onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)}),this._getNode('closeButtonContainer'));}else{this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);}},_initializeTitle:function(){if(s.get('chat_react_header')){var qe=od.getThreadMetaNow(this._threadID);this._title=xb.render(xb.createElement(ja,{isNewThread:od.isNewEmptyLocalThread(this._threadID),thread:qe,viewer:na.getID()}),this._getNode('titleContainer'));}},_initializeTitleHREF:function(){tc.getThreadURI(this._threadID,function(re){return this._setTitleHref(re);}.bind(this));if(!gb.getUserIDFromThreadID(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var qe=this._getCanonicalUserID();if(this._getCanonicalUserID()){ib.get(gb.getParticipantIDFromUserID(qe),function(re){if(re.href)this._setTitleHref(re.href);}.bind(this));}else if(this._reactChatTabMenu.getURL())this._setTitleHref(this._reactChatTabMenu.getURL());},_initializeUIListeners:function(){this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===db.TAB){this._focusInput();event.kill();}}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFileUploader:function(qe){this._fileUploader=qe;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=xb.render(xb.createElement(w,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_initializeStickers:function(){this._stickersFlyoutToggler=this._getNode('emoticons');if(s.get('chat_react_input')&&cc.WebStickerTrigger){this._stickerTriggerController=new ba(this._getNode('stickersTriggerFlyoutContainer'),this._getNode('emoticonIndicator'),this._stickersFlyoutToggler,this._stickerSelected.bind(this),this._searchStickers.bind(this));if(this._chatInput)this._stickerTriggerController.setInput(this._chatInput);}if(fc.shouldShowStickerSearchNUX())this._listen('emoticons','click',function(){if(fc.shouldShowStickerSearchNUX()){bc.selectPack(dc.SEARCH_PACK_ID);fc.clearShowStickerSearchNUX();}},true);if(s.get('chat_react_sticker_button')){this._stickerButton=xb.render(xb.createElement(aa,{className:"_4vui",flyoutAlignment:"left",onFlyoutShown:this._onFlyoutShown.bind(this),onFlyoutHidden:this._onFlyoutHidden.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));l.bumpEntityKey('chat.web','sticker_button.mounting_attempted');}else{var qe=this._getNode('stickers');if(qe)this._stickersFlyout=xb.render(xb.createElement(ec,{onStickerSelect:function(re){this._stickerSelected(re);}.bind(this),onShown:this._onFlyoutShown.bind(this),onHidden:this._onFlyoutHidden.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),qe);this._eventListeners.push(fc.addListener(fc.PACK_SELECTED,function(re){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:re});}.bind(this)));}},_initializeDragDropTarget:function(){var qe=ua.scry(this._tabElem,"._1ia");if(qe&&qe.length>0){this._dropTarget=new va(qe[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}},_initializeP2P:function(){od.getThreadMeta(this._threadID,function(qe){if(qe&&qe.thread_id){var re=gb.tokenize(qe.thread_id);if(re.type==='user'){var se=re.value;if(kd.isUser(se))this._renderOrionTrigger();}}}.bind(this));if(!this._isP2PEnabled())this._transferStoreSub=sb.addListener('change',this._onP2PTransferStoreChange.bind(this));},_initializeUnloadListeners:function(){this._checkUnsentMessages=xc(function(){if(this._hasUnfinishedPost())return bd._("You haven't sent your message yet. Do you want to leave without sending?");if(id.getNumberLocalMessages(this._threadID))return bd._("Your message is still being sent. Are you sure you want to leave?");return null;}.bind(this));yb.onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=xc(ne.bind(null,this));yb.onUnload(this._logUnsentPhotos);},_handlePUSubmit:function(qe,re){le(this,ub.UPLOAD_START,re);fe(this,'',[],function(se){if(this._threadID!==se.thread_id){this._newThreadIDFromPhotoUpload=se.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(se.thread_id);}se.content_attachment=null;hd.addAttachmentPlaceholder(se,re.upload_id,re);}.bind(this));pe('submit',re);this._focusInput();},_handlePULastUploadFailed:function(qe,re){le(this,ub.CLIENT_ERROR,re);pe('failed',re);hd.cancelAttachmentPlaceholder(re.upload_id,re);var se=bd._("Photo Upload Failed"),te=bd._("Please try again. Make sure you are uploading a valid photo.");new qa().setTitle(se).setBody(te).setButtons(qa.OK).show();},_handlePULastUploadCanceled:function(qe,re){le(this,ub.CANCEL_DURING_UPLOAD,re);pe('canceled',re);hd.cancelAttachmentPlaceholder(re.upload_id,re);},_handlePUAllUploadsCompleted:function(qe,re){le(this,ub.ALL_UPLOADS_DONE,re);pe('completed',re);hd.confirmAttachmentPlaceholder(re.upload_id,re);var se=re.image_ids.length||re.attachments.length;ee(this,se);},_stickerSelected:function(qe){fe(this,'',[],function(re){re.has_attachment=true;re.sticker_id=qe;hd.send(re);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(qe){var re=wa.symbols[qe];if(!re)return;if(s.get('chat_react_input')){this._chatInput.insertEmoticon(re);return;}this._selectionPosition=this._selectionPosition||new ac(this._getNode('input'));var se=kc.getInstance(this._getNode('input')),te=se.getValue(),ue=xa.insertEmoticon(re,te,this._selectionPosition.getPos());se.setValue(ue.result);this._selectionPosition.setPos(ue.start,ue.end);},_orionTriggered:function(){fe(this,'',[],function(qe){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){oa.addClass(this._getNode('emoticonIndicator'),'nux');sd=false;},_onFlyoutShown:function(qe){if(s.get('chat_react_sticker_button')){var re=this._stickersFlyout.props.packID;if(re!==dc.SEARCH_PACK_ID)this.focus();}if(cc.WebStickerTrigger){this._stickerTriggerController.onFlyoutShown(qe);}else qe();this._stickersFlyoutShown=true;},_searchStickers:function(qe,re){this._stickersFlyout.isMounted()&&this._stickersFlyout.setProps({packID:dc.SEARCH_PACK_ID,trigger:qe},re);},_onFlyoutHidden:function(){this._stickersFlyoutShown=false;this.focus();},_setTitleHref:function(qe){if(s.get('chat_react_header')){this._title.isMounted()&&this._title.setProps({href:qe});}else{var re=this._getNode('titlebarText');re.setAttribute('href',qe);re.removeAttribute('rel');oa.removeClass(re,'noLink');}},_onAddMention:function(qe){this._linkDropped((new pc(qe.getURI())).getQualifiedURI().toString());},_unblockSend:function(){if(!this._blocked||ie(this))return;this._blocked=false;de(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new j('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();}});function pe(qe,re){vd.debug('photo_uploader:'+qe,Object.assign({},re));}e.exports=me;},null);
__d("ChatTabViewCoordinator",["Arbiter","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l.create('chat_tab_coordinator');function o(p,q){var r=new j(p),s={},t=false;function u(){var y=h.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});n.log('process_tab_changed',{model_tabs:Object.keys(z),view_tabs:Object.keys(s)});for(var aa in s)if(!z[aa]){n.log('remove_tab',{tab_id:aa});s[aa].destroy();delete(s[aa]);}v(y);w(y);if(y.tabNeedsFocus&&!y.tabNeedsFocus.isFocused())y.tabNeedsFocus.focus();}function v(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!s[ba]){n.log('add_tab',{tab_id:ba});s[ba]=new i(ba,aa.server_id,aa.signatureID,p,z);ca=true;}else s[ba].updateSignatureID(aa.signatureID);if(s[ba].isFocused())y.tabNeedsFocus=s[ba];if(!ca&&!s[ba].nextTabIs(z)){var da=s[ba].getScrollTop();if(z){s[ba].insertBefore(z);}else s[ba].appendTo(p);if(da)s[ba].setScrollTop(da);}z=s[ba];});}function w(y){var z=q.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){s[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){s[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});r.setTabData(aa);x(ba);}function x(y){if(!y&&t){g.inform('layer_hidden',{type:'ChatTab'});t=false;}else if(y&&!t){g.inform('layer_shown',{type:'ChatTab'});t=true;}}if(m.isVideoCallSupported())k.addClass(p,'videoCallEnabled');q.subscribe('tabs-changed',u);u();}e.exports=o;},null);
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=175,v=269,w=0;function x(){return u;}function y(){return v;}function z(aa){this._root=aa;var ba=this._recalculateWidth.bind(this);m.listen(window,'resize',ba);j.subscribe('resize',ba);g.subscribeOnce('sidebar/initialized',ba,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(z.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var aa=z._getAvailableDockWidth(this._root),ba=Math.max(1,Math.floor(aa/y())),ca=ba!=this._maxShown;if(!this._viewState||ca||aa<=this._viewState.usedWidth||aa>this._viewState.widthToShowNext){this._availableWidth=aa;this._maxShown=ba;this._viewState=null;this._recalculateTabs(ca);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(aa){var ba=z._getTabsToShow(i.get(),this._availableWidth);if(aa||!q(this._viewState,ba)){this._viewState=ba;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>y();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var aa=i.get(),ba=this._viewState.tabsToShow;return aa.tabs.filter(function(ca){return ba[ca.id];});},getRightmostHiddenTab:function(){var aa=i.get(),ba=this._viewState.tabsToShow,ca=aa.tabs.filter(function(ea){return !ba[ea.id];}),da=ca.shift();return da?da.id:null;},getLeftmostVisibleTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.pop();return ba?ba.id:null;},getRaisedVisibleTabs:function(){var aa=[],ba=this.getShowingTabsOrder(),ca=ba.length;for(var da=0;da<ca;da++)if(i.getTab(ba[da].id).raised)aa.push(ba[da].id);return aa;},shouldPromoteOnRaise:function(aa){if(!this._viewState.tabsToShow[aa])return true;if(this._viewState.nextToHide!=aa)return false;var ba=i.getTab(aa),ca=ba&&ba.raised;return !ca&&(this._availableWidth-this._viewState.usedWidth<y()-x());}});r(z,{_getAvailableDockWidth:function(aa){var ba=l.getViewportWithoutScrollbarDimensions().width;ba-=p.getLeft()+p.getRight();ba-=50;var ca=n.byClass(aa,'fbDock'),da=k.find(ca,"._56ox"),ea=o.getElementDimensions(da).x;ba-=ea;var fa=k.scry(ca,"._56oy");ea+=o.getElementDimensions(fa.pop()).x;var ga=o.getElementDimensions(ca),ha=ga.x-ea;if(ha>w)w=ha;ba-=w;ba-=15;return Math.max(ba,0);},_getTabsToShow:function(aa,ba){ba=Math.max(ba,y()+1);function ca(sa,ta){return (sa.raised||!ta)?y():x();}var da=JSON.parse(JSON.stringify(aa.tabs)),ea=-1,fa=null;if(aa.promoted)da.forEach(function(sa,ta){if(sa.id===aa.promoted){ea=ta;fa=sa;}});var ga=0,ha=false,ia=0,ja=!fa;da.forEach(function(sa,ta){var ua=ca(sa,ha);ha=ha||!sa.raised;sa.leftmostOffset=ga+ua;ga+=ua;if(sa.leftmostOffset<ba)ia++;ja|=ta==ea;sa.alreadyPlacedPromoted=ja;});function ka(sa,ta,ua){var va={};for(var wa=0;wa<ta;wa++){var xa=sa[wa];if(!xa.alreadyPlacedPromoted&&wa==ta-1){va[ua]=true;}else va[xa.id]=true;}return va;}var la=ka(da,ia,aa.promoted),ma=ka(da,ia-1,aa.promoted),na=null;for(var oa in la)if(!ma[oa])na=oa;var pa=da[ia-1],qa=pa?pa.leftmostOffset:0,ra=Infinity;if(ia<da.length)ra=da[ia].leftmostOffset;return {nextToHide:na,tabsToShow:la,usedWidth:qa,widthToShowNext:ra};}});e.exports=z;},null);
__d("ChatApp",["BanzaiLogger","CSS","ChatPerfEvent","DOM","JSLogger","Promise","React","MNCommerceDialogContainer.react","csx","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q={init:function(t,u,v){if(this._isInitialized){k.create('chat_app').error('repeated_init');return;}var w=p();this._rootElem=t;var x=j.find(this._rootElem,"._1kh-");m.render(m.createElement(n,null),x);l.resolve().then(function(){return r(v);}).then(function(){return s(u);}).then(function(){this._isInitialized=this._isLoaded=true;g.log('ChatPerfLoggerConfig',{event:i.TTI,duration:p()-w});}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;h.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){h.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(t){t.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(t){t.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');t.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function r(t){return new l(function(u){d(['MercuryChannelHandler','MercuryDeliveryState','MercuryServerRequests','MercuryStateCheck'],function(v,w,x,y){v.get().turnOn();x.get().handleUpdate(t);w.get();y.get();u();});});}function s(t){return new l(function(u){d(['ChatTabController','ChatTabViewCoordinator','TabsViewport'],function(v,w,x){q.tabsViewport=new x(t);q.tabViewCoordinator=new w(t,q.tabsViewport);q.tabController=new v(q.tabsViewport);u();});});}e.exports=q;},null);