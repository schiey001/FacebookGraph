/*!CK:166707030!*//*1432613180,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9CoRt"]); }

__d("MessagingRealtimeConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={VIEWER_FBID:"realtime_viewer_fbid"};},null);
__d("SyncRequestStatusEnum",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={PENDING:0,ACCEPTED:1,REJECTED:2,EXPIRED:3,CANCELED:4,namesByValue:["PENDING","ACCEPTED","REJECTED","EXPIRED","CANCELED"]};},null);
__d("ChatConfig",["ChatConfigInitialData","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={},j={get:function(k,l){return k in i?i[k]:l;},set:function(k){if(arguments.length>1){var l={};l[k]=arguments[1];k=l;}h(i,k);},getDebugInfo:function(){return i;}};j.set(g);e.exports=j;},null);
__d("SystemEvents",["Arbiter","ErrorUtils","SystemEventsInitialData","UserAgent_DEPRECATED","copyProperties","setIntervalAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=new g(),n=[],o=1000;l(function(){for(var y=0;y<n.length;y++)n[y]();},o);function p(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}function q(){return i.ORIGINAL_USER_ID;}var r=q(),s=navigator.onLine;function t(){if(!s){s=true;m.inform(m.ONLINE,s);}}function u(){if(s){s=false;m.inform(m.ONLINE,s);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=t;document.body.onoffline=u;});}else n.push(function(){(navigator.onLine?t:u)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}var v=r;n.push(function(){var y=p();if(v!=y){m.inform(m.USER,y);v=y;}});var w=Date.now();function x(){var y=Date.now(),z=y-w,aa=z<0||z>10000;w=y;if(aa)m.inform(m.TIME_TRAVEL,z);return aa;}n.push(x);n.push(function(){if(window.onerror!=h.onerror)window.onerror=h.onerror;});k(m,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(y){return (y||p())==r;},isOnline:function(){return j.chrome()||s;},checkTimeTravel:x});e.exports=m;},null);
__d("ChannelSubdomain",["Event","JSLogger","Run","setTimeoutAcrossTransitions","LogHistory","WebStorage"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('LogHistory').getInstance('channel'),l=b('WebStorage').getLocalStorage(),m=h.create('channel'),n='channel_sub:',o=7,p=100*1000,q=null,r;function s(){if(r){clearTimeout(r);r=null;}if(l&&q!=null)l.removeItem(n+q);q=null;}function t(u,v,w){var x=(u-1)*o;if(w){if(r)clearTimeout(r);q=r=null;}if(v==null)v=Math.floor(Math.random()*x);if(q==null)if(l){var y=[];for(var z=0;z<l.length;z++){var aa=l.key(z);if(aa.indexOf(n)===0){var ba=parseInt(aa.substr(n.length),10);y[ba]=parseInt(l.getItem(aa),10);}}var ca=Date.now()-p;for(z=0;z<x;z++){var da=(z+v)%x;if(!y[da]||y[da]<ca){q=da;break;}}if(q!=null){var ea=function(){try{l.setItem(n+q,Date.now());}catch(fa){k.warn('subdomain set failed',fa.message);}r=j(ea,p/2);};ea();}else{k.warn('no channel subdomain',y);m.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',s);}else i.onUnload(s);}else q=v;return q==null?null:q%o;}e.exports={allocate:t,clear:s};},null);
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===(void 0))j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;},null);
__d("ChannelTransport",["AjaxRequest","ChannelConstants","DocRPC","LogHistory","URI","copyProperties","bind","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j.getInstance('channel');function p(){return (1048576*Math.random()|0).toString(36);}function q(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new k(aa).setDomain(ba+z.host+'.'+z.domain).setPort(z.port).setSecure(new k(window.location.href).isSecure());return ca;}function r(z){var aa={partition:z.partition,cb:p()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=q(z,'/p').setQueryData(aa);o.log('start_p',{uri:ba.toString()});var ca=new g('GET',ba);if(g.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){o.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function s(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){o.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){r(z);ea(false);};var fa=n(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:p()};if(z.sticky_token)ga.sticky_token=z.sticky_token;if(z.sticky_pool)ga.sticky_pool=z.sticky_pool;if(z.lastRequestErrorReason){ga.reason=z.lastRequestErrorReason;z.lastRequestErrorReason=null;}if(z.uid&&z.viewerUid){ga.uid=z.uid;ga.viewer_uid=z.viewerUid;}if(z.watchdog&&z.watchdog.enabled)ga.wtc=z.watchdog.doSerialize();da=Date.now();ca.src=q(z,'/ping').setQueryData(ga);return ca;}function t(z){var aa={channel:z.user_channel,partition:z.partition,clientid:z.sessionID,cb:p(),cap:0,uid:z.uid,viewer_uid:z.viewerUid};if(z.sticky_token)aa.sticky_token=z.sticky_token;if(z.sticky_pool)aa.sticky_pool=z.sticky_pool;if(z.is_offline||z.shouldSuppressPresence){aa.state='offline';}else aa.state='active';if(aa.state===z.lastPresenceState)return;z.lastPresenceState=aa.state;if(z.profile)aa.profile=z.profile;if(z.capabilities)aa.cap=z.capabilities;var ba=q(z,'/active_ping').setQueryData(aa),ca=new g('GET',ba);if(g.supportsCORS())ca.xhr.withCredentials=true;ca.onError=function(da){o.warn('active_ping_error');};ca.onSuccess=function(da){o.log('active_ping_ok');};ca.timeout=z.P_TIMEOUT;ca.send();}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)o.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:p(),idle:ea,cap:0};if(!!z.watchdog&&z.watchdog.enabled)fa.wtc=z.watchdog.doSerialize();fa.msgs_recv=z.estimatedReceived;if(z.uid&&z.viewerUid){fa.uid=z.uid;fa.viewer_uid=z.viewerUid;}if(z.stableDeviceId)fa.sdi=1;if(z.sticky_token)fa.sticky_token=z.sticky_token;if(z.sticky_pool)fa.sticky_pool=z.sticky_pool;if('trace_id' in z)fa.traceid=z.trace_id;if(z.is_offline||z.shouldSuppressPresence){fa.state='offline';}else if(z.userActive>0&&ea<60)fa.state='active';z.lastPresenceState=fa.state;if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.capabilities)fa.cap=z.capabilities;var ga=q(z,'/pull').setQueryData(fa),ha=z.fantail_enabled?'POST':'GET',ia=new g(ha,ga);if(g.supportsCORS())ia.xhr.withCredentials=true;ia.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ia.onJSON=aa;ia.onSuccess=ba;ia.onError=function(){var la=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ma=la?ba:ca;return ma&&ma.apply(this,arguments);};if(z.fantail_logs&&z.fantail_logs.length>0){var ja={};for(var ka=0;ka<z.fantail_logs.length;ka++)l(ja,z.fantail_logs[ka]);ia.send(ja);z.fantail_logs=[];}else ia.send();z.inStreaming=z.streamingCapable;return ia;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}l(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')n(m(this.manager,'exitState',{status:h.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=s(aa,m(ba,'exitState',{status:h.OK,stateId:aa.stateId}),m(ba,'exitState',{status:h.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(ba,'_processTransportData',aa.stateId),m(ba,'exitState',{status:h.OK,stateId:aa.stateId}),m(ba,'exitState',{status:h.ERROR,stateId:aa.stateId}));}});function x(z){o.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);i.publish(this,'outerTransport');}l(x.prototype,{logName:'iframe',_initIframe:function(z){o.log('iframe_init_start');window.onchanneliframeready=function(){o.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(z){this._iframeURI=q(z,z.path);if(z.resources){var aa=this._iframeURI.getDomain();z.resources=z.resources.map(function(da){var ea=new k(da);if(ea.getPath().startsWith('/intern/rsrc.php')&&ea.getQueryData().origin!==(void 0))return ea.addQueryData('origin',aa).toString();return da;});}if(z.bustIframe){var ba={partition:z.partition,cb:p()};this._iframeURI.setQueryData(ba);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(ca){o.error('iframe_uri_set_error',ca);this.exitState({status:h.ERROR,stateId:z.stateId},ca+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:h.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==h.OK)this._iframeProxy=i.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}l(y.prototype,{logName:'iframe(inner)',init:function(){i.publish(this,'innerTransport');try{var aa=i.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);l(this,aa);this.exitState({status:h.OK,stateId:1e+06});}catch(z){o.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=s(aa,m(this,'exitState',{status:h.OK,stateId:aa.stateId}),m(this,'exitState',{status:h.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(this,'_processTransportData',aa.stateId),m(this,'exitState',{status:h.OK,stateId:aa.stateId}),m(this,'exitState',{status:h.ERROR,stateId:aa.stateId}));}});e.exports={getURI:q,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y,sendActivePing:t};},null);
__d("PresenceUtil",["CurrentUser","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h(0,4294967295)+1;function j(){return i;}function k(){return g.isLoggedInNow();}e.exports={getSessionID:j,hasUserCookie:k};},null);
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","PresencePrivacyInitialData","JSLogger","PresenceUtil","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=n({},k.privacyData),v=k.visibility,w=n({},k.privacyData),x=v,y=k.onlinePolicy,z=y,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=n(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==j.getID()){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);n(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(m!=null){var sa=qa.getData();sa.window_id=m.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=j.getID()){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===m.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}n(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},isUserOffline:function(){return this.getVisibility()===da.OFFLINE;},allows:function(qa){if(this.isUserOffline())return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed',g.BEHAVIOR_STATE);ca().log('initialized',{visibility:v,policy:y});g.subscribe(l.DUMP_EVENT,function(qa,ra){ra.presence_privacy={initial:k.privacyData,current:u};});g.subscribe(i.getArbiterType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof(sa)!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}.bind(this));a.PresencePrivacy=e.exports=da;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};e.exports=j;},null);
__d("MovingStat",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;},null);
__d("Dcode",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;},null);
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error',y);}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v){u.debug('stale_cookie',o);return;}var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;},null);
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=n.cookiePollInterval||2000,p=n.shouldSuppress||false,q=[],r=[],s=null,t=null,u=0,v=null,w=0,x=['sb2','t2','lm2','uct2','tr','tw','at','wml'],y=i.create('presence_state');function z(){return j.getSubCookie('state');}function aa(){u=Date.now();j.store();ea(t);}var ba=l(aa,0);function ca(ja){if(typeof ja=='undefined'||isNaN(ja)||ja==Number.POSITIVE_INFINITY||ja==Number.NEGATIVE_INFINITY)ja=0;return ja;}function da(ja){var ka={};if(ja){x.forEach(function(na){ka[na]=ja[na];});if(u<ja.ut)y.error('new_cookie',{cookie_time:ja.ut,local_time:u});}ka.ut=u;for(var la=0,ma=q.length;la<ma;la++)h.applyWithGuard(q[la],null,[ka]);t=ka;return t;}function ea(ja){w++;u=ca(ja.ut);if(!s)s=m(ha,o);t=ja;if(v===null)v=ja;for(var ka=0,la=r.length;ka<la;ka++)h.applyWithGuard(r[ka],null,[ja]);w--;}function fa(ja){if(ja&&ja.ut)if(u<ja.ut){return true;}else if(ja.ut<u)y.error('old_cookie',{cookie_time:ja.ut,local_time:u});return false;}function ga(){var ja=z();if(fa(ja))t=ja;return t;}function ha(){var ja=z();if(fa(ja))ea(ja);}j.register('state',da);g.subscribe(i.DUMP_EVENT,function(ja,ka){ka.presence_state={initial:k({},v),state:k({},t),update_time:u,sync_paused:w,poll_time:o};});(function(){var ja=ga();if(ja){ea(ja);}else{y.debug('no_cookie_initial');ea(da());return;}})();var ia={doSync:function(ja){if(w)return;if(ja){aa();}else ba();},registerStateStorer:function(ja){q.push(ja);},registerStateLoader:function(ja){r.push(ja);},get:function(){return ga();},getInitial:function(){return v;},shouldSuppress:function(){return p;},verifyNumber:ca};e.exports=ia;},null);
__d("VideoCallSupport",["ChannelConstants","RTCConfig","UserAgent"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={isSendWebrtcSupported:function(){return h.SendNewVCGK;},isReceiveWebrtcSupported:function(){return h.ReceiveNewVCGK;},isVideoInteropSupported:function(){return h.VideoInteropGK;},isVideoCallSupported:function(){return j.isSendWebrtcSupported();},isWebrtcSupported:function(){return (i.isBrowser('Chrome >= 28')||i.isBrowser('Firefox >= 25')||i.isBrowser('Opera >= 20'));},isOSSupported:function(){return !i.isPlatform('Android')&&!i.isPlatform('iOS');},getCapabilities:function(){var k=0;if(this.isReceiveWebrtcSupported())k=g.CAPABILITY_VOIP_INTEROP;return k;}};e.exports=j;},null);
__d("RTISession",["URI","AjaxRequest","copyProperties","invariant","ErrorUtils"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){j(n);j(q);j(r);this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){j(n);j(o);j(q);var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)j(!o[x]);i(w,o);var y=new g(n).setDomain(u).setPort(this.port).setSecure(new g(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new h(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};e.exports=m;},null);
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","FBAjaxRequest","ISB","JSLogger","MessagingRealtimeConstants","ModulePerformanceGating","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","VideoCallSupport","RTISession","copyProperties","createArrayFromMixed","errorCode","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","WebStorage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){b.__markCompiled&&b.__markCompiled();var ka=b('WebStorage').getSessionStorage(),la='chproxy_base_sess',ma,na=s.create('channel'),oa=null;function pa(eb){oa=eb;}var qa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ra={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),lastPresenceState:null,lastRequestErrorReason:null,seq:0,estimatedReceived:0,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),stableDeviceId:false,capabilities:da.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:x.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},sa={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var eb=this.accumulatedPullTimeMillis,fb=Date.now();if(this.pullStartTimeMillis>0&&fb-this.pullStartTimeMillis<=ra.LONGPOLL_TIMEOUT)eb+=(fb-this.pullStartTimeMillis);var gb=eb/1000;if(gb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return gb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(eb,fb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=(Date.now()-this.pullStartTimeMillis);if(eb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(eb){return eb.indexOf('pull')===0||eb.indexOf('init')===0||eb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var eb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)eb+=(Date.now()-this.timeInGoodStatesStartMillis);return eb/1000;},clientEnteredState:function(eb){if(!this.enabled)return;var fb=this.isGoodState(eb);if(fb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!fb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(eb){if(!this.enabled)return;if(eb.indexOf('pull')===0){this.reportPullSent();}else if(eb.indexOf('ping')===0&&ra.lastRequestErrorReason!==j.SYS_TIMETRAVEL&&ra.lastRequestErrorReason!==j.SYS_ONLINE&&ra.lastRequestErrorReason!==j.SYS_OWNER&&ra.lastRequestErrorReason!==j.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return "";return (this.getTimeSinceFirstPullSentSeconds()).toFixed(0)+','+(this.getAccumulatedPullTimeSeconds()).toFixed(0)+','+(this.getPingToPullRatio()).toFixed(3)+','+(this.getUptimeSeconds()).toFixed(0)+','+(this.getTotalTimeInGoodStatesSeconds()).toFixed(0);}},ta=1,ua={},va=0;function wa(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function xa(){var eb={};if(ma.getConfig('host'))eb[ma.getConfig('user_channel')]=ma.getConfig('seq',0);return eb;}function ya(){var eb=Date.now(),fb=Date.now(),gb={total:0},hb='idle',ib=false;aa.subscribe([aa.USER,aa.ONLINE,aa.TIME_TRAVEL],function(lb,mb){ab(true);fb=null;ma.lastPullTime=Date.now();var nb;switch(lb){case aa.USER:nb=aa.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case aa.ONLINE:nb=mb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case aa.TIME_TRAVEL:nb=j.SYS_TIMETRAVEL;break;}ma.exitState({status:nb,stateId:ta});});var jb=function(lb,mb){var nb=Date.now(),ob;if(mb){eb=nb;ob=mb.nextState||mb.state;}else ob=hb;aa.checkTimeTravel();if(fb){var pb=Math.round((nb-fb)/1000);if(pb>0){gb[hb]=(gb[hb]||0)+pb;gb.total+=pb;}}hb=ob;fb=nb;if(!lb){gb.lastSuccessTime=wa();gb.online=aa.isOnline();na.log('rollup',gb);}};h.subscribe(j.ON_ENTER_STATE,jb);ia(jb,60000);h.subscribe(s.DUMP_EVENT,function(lb,mb){mb.channelRollup=gb;});var kb=function(){if(ma.isShutdown()||ma.shouldIdle())return;aa.checkTimeTravel();var lb=Date.now()-(ma.lastPullTime||p.start);if(!ib&&lb>ra.STALL_THRESHOLD){var mb=wa();na.error('stall',{lastSuccessTime:mb,rollupState:hb});ib=true;}var nb=Date.now()-eb;if(ma.state=='pull'&&nb>ra.JUMPSTART_THRESHOLD){eb=null;na.warn('jumpstart',{state:ma.state,dormant:nb});ma.enterState('init');}};ia(kb,10000);}function za(){var eb=Date.now(),fb=1;function gb(){ja(gb,fb*1000);var lb=ma.state;if(lb=='idle'&&ma.shouldIdle())return;na.bump('conn_t',fb);if(lb=='pull')na.bump('conn_t_pull',fb);}gb();var hb=[15,30,60,120,240],ib=false,jb=false;function kb(lb){ja(function(){na.rate('pullenter_'+lb,ib);na.rate('pullexit_'+lb,jb);},lb*1000);}while(hb.length)kb(hb.shift());h.subscribe(j.ON_ENTER_STATE,function(lb,mb){if(mb.state=='pull')ib=true;eb=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(lb,mb){if(mb.state!='pull'||!eb)return;var nb='other';if(mb.status==j.OK){jb=true;nb='ok';}else if(mb.xhr&&mb.xhr.errorType){nb=/ar:(\w+)/.test(mb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(mb.status))return;var ob=(Date.now()-eb)/1000;if(ob<0){return;}else if(ob>3600)ob=3600;na.bump('conn_num');na.bump('conn_exit',ob);na.bump('conn_num_'+nb);na.bump('conn_exit_'+nb,ob);});}function ab(eb){if(eb){va=0;ua={};}else va++;}function bb(){if(!ra.stableDeviceId)return;var eb={};eb.sessionID=ra.sessionID;eb.seq=ra.seq;eb.estimatedReceived=ra.estimatedReceived;ka.setItem(la,JSON.stringify(eb));}function cb(eb){if(!eb)return false;eb=eb.trim();if(eb.length===0)return false;try{var gb=JSON.parse(eb),hb=function(jb){if(typeof(gb[jb])=="number")return gb[jb];na.error("not an integer: "+jb+"="+gb[jb]);throw "NotAnInteger";};ra.seq=hb('seq');ra.estimatedReceived=hb('estimatedReceived');var ib=gb.sessionID;if(ib&&ib.length&&ib.trim()){ra.sessionID=ib;return true;}return false;}catch(fb){na.error("unable to parse state: "+eb);return false;}}ma={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:pa,backoff:false,init:function(eb){this.init=function(){};this._logFantail('client initialized',j.FANTAIL_INFO);var fb=!!ra.use_sticky_session,gb=false;ra.stableDeviceId=false;if(fb&&ka){ra.stableDeviceId=true;var hb=true;for(var ib=0;ib<ka.length;ib++){var jb=ka.key(ib);if(jb.indexOf(la)===0){gb=cb(ka.getItem(jb));hb=!gb;break;}}if(hb)bb();}this._logFantail('using session id: '+ra.sessionID+(gb?' [restored]':' [new]'),j.FANTAIL_INFO);sa.enabled=!!ra.watchdog_enabled;ra.watchdog=sa;if(typeof(ca)!='undefined'){ca.subscribe(function(){ra.userActive=Date.now();m.sendActivePing(ra);}.bind(this));}else na.error('user_activity_undefined');w.register('ch',xa);var kb=this.getConfig('max_conn',2);ra.subdomain=l.allocate(kb);this._transportRate=new v(30000);var lb=(g.supportsCORS()&&!ra.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[lb](this);if(eb)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,nb){nb.transportRate=this._transportRate.tally();nb.transportType=lb;nb.transportVersion=2;}.bind(this));ya();za();if(ma.getConfig('tryStreaming')&&ma.getConfig('host')&&g.supportsCORS()&&!ra.forceIframe){var mb=ra.MIN_INIT_PROBE_DELAY+Math.random()*ra.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ja(this._probeTest,mb);}},configure:function(){var eb=ga(arguments);na.log('configure',eb);eb.forEach(fa.bind(null,ra));h.inform(j.ON_CONFIG,this);},getConfig:function(eb,fb){return eb in ra?ra[eb]:fb;},getCompleteConfig:function(){return ra;},getWatchdog:function(){return sa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(aa.isPageOwner()&&aa.isOnline());},_sendIframeError:function(eb){var fb=new i().setURI('/ajax/presence/reconnect.php').setData({reason:eb,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);fb.specifiesWriteRequiredParams()&&fb.send();},_getDelay:function(){var eb=Math.min(ra.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,va-1)),ra.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ra)eb=ra.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(eb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)na.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(eb){this._inEnterState=false;throw eb;}},_enterState:function(eb){if((eb.indexOf('pull')===0||eb.indexOf('ping')===0||eb.indexOf('shutdown')===0)&&!!ra.active_config_refresh){var fb=Date.now(),gb=(fb-ra.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in ra&&ra.config_refresh_seconds>0&&gb>ra.config_refresh_seconds){eb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',j.FANTAIL_DEBUG);}}if(eb.indexOf('reconnect')===0)ra.reconnectOverrideTimeMillis=Date.now();var hb=this.backoff?this._getDelay():0;this.backoff=false;var ib=ga(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+eb,j.FANTAIL_WARN);return;}if(eb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',j.FANTAIL_WARN);return;}ta++;ra.stateId=ta;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(eb)){var jb=this._transportRate.tally().timeAverage,kb=ma.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(jb>=kb){if(!this._throttled){this._throttled=true;na.warn('throttled');}na.bump('throttle');hb=1000/kb;}}else if(!(/#$/.test(eb)))hb=this._getDelay();eb=eb.replace(/\W*$/,'');if(!qa[eb]){this._logFantail('invalid state: '+eb,j.FANTAIL_ERROR);throw new Error('invalid state:'+eb);}var lb;if(hb<=0){lb={state:eb};this._transportRate.add(1);this.state=eb;var mb=this['_enter_'+this.state];if(mb){ib.shift();mb.apply(this,ib);}if(/init|idle|pull|ping/.test(this.state)){if(ra.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];sa.transportEnteredState(eb);sa.clientEnteredState(eb);ra.is_offline=!n.isOnline();ra.capabilities=da.getCapabilities();this._logFantail('entering transport state: '+this.state,j.FANTAIL_INFO);this.transport.enterState(this.state,ra);if(this.state=='ping'){lb.url=m.getURI(ra).toString();lb.port=ra.port||'undefined';}}}else{this.state='idle';this.nextState=eb;lb={state:this.state,delay:hb,nextState:eb};ib[0]=eb+'#';this._deferredTransition=ja((function(){this._deferredTransition=null;this.enterState.apply(this,ib);}).bind(this),hb);}if(/pull/.test(eb)){lb.client_id=ra.sessionID;lb.streaming=ra.inStreaming;}na.log('enter_'+this.state,lb);h.inform(j.ON_ENTER_STATE,lb);},exitState:function(eb,fb){var gb=eb.stateId,hb=eb.status;if((hb==j.SYS_TIMETRAVEL||hb==j.SYS_ONLINE||hb==j.SYS_NONOWNER||hb==j.SYS_OWNER)&&sa)sa.initialize();if(this.isShutdown()||gb<ta)return;var ib=ga(arguments),jb=this.state;ib[0]=eb.status;var kb={state:jb,status:hb};if(/pull/.test(jb)){kb.client_id=ra.sessionID;kb.streaming=ra.inStreaming;}if(/ping/.test(jb)&&hb!=j.OK)kb.url=m.getURI(ra).toString();if(this.nextState)kb.nextState=this.nextState;if(fb&&fb.errorType){ra.lastRequestErrorReason=fb.errorType;kb.xhr=fb.toJSON?fb.toJSON():fb;if(fb.errorType==g.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',j.FANTAIL_ERROR);this.proxyDown=true;}delete kb.xhr.json;}else if(hb!=j.OK)ra.lastRequestErrorReason=hb;if(fb&&fb.json){if(fb.json.t)kb.t=fb.json.t;if(fb.json.reason)kb.reason=fb.json.reason;if(fb.json.seq)kb.seq=fb.json.seq;}na.log('exit_'+jb,kb);h.inform(j.ON_EXIT_STATE,kb);var lb=this['_exit_'+jb];if(lb)hb=lb.apply(this,ib)||hb;if(hb!=j.OK){ab();ua[jb]=(ua[jb]||0)+1;}var mb=qa[this.nextState||jb][hb]||qa._all[hb],nb=mb&&mb.replace(/!*$/,'');if(!nb){na.error('terminal_transition',kb);this._shutdownHint=j.HINT_INVALID_STATE;mb='shutdown!';this._logFantail('entering shutdown state',j.FANTAIL_ERROR);}this._lastState=jb;this._lastStatus=hb;this.enterState(mb);},_processTransportData:function(eb,fb){var gb=fb.json,hb=gb.t;if('s' in gb){gb.seq=gb.s;delete gb.s;}if(gb.u&&ra.user&&gb.u!=ra.user){na.warn('misguided_msg',{user:ra.user,target:gb.u});this._reportProxyMisguidedMsg(gb.u,ra.user);return;}var ib=ra.seq;if('seq' in gb){ra.seq=gb.seq;x.doSync();}switch(hb){case 'continue':if(ra.inStreaming&&this.heartbeats.length<1){ra.streamingCapable=false;na.log('switch_to_longpoll');ja(this._probeTest,ra.PROBE_DELAY);}ab(true);if(!ra.inStreaming||ra.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:eb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+gb.reason,j.FANTAIL_INFO);this.exitState({status:'refresh_'+(gb.reason||0),stateId:eb},fb);break;case 'backoff':this._logFantail('server told client to back off',j.FANTAIL_WARN);ab();this.backoff=true;break;case 'lb':var jb=gb.lb_info;if(jb){ra.sticky_token=jb.sticky;if('pool' in jb){ra.sticky_pool=jb.pool;}else ra.host=jb.vip;if(g.supportsCORS()&&!ra.forceIframe){var kb=ra.subdomain===null?ra.host:(ra.subdomain+'-'+ra.host),lb=new ea(kb,ra.port,ra.sticky_pool,ra.sticky_token,ra.uid,ra.viewer_uid,ra.profile,ra.sessionID,ra.capabilities);h.inform(j.RTI_SESSION,lb);}}else na.error('bad lb info');break;case 'test_streaming':ja(this._probeTest,500);break;case 'fullReload':w.clear();na.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);ab(true);this._logFantail('full reload incurred',j.FANTAIL_INFO);this.exitState({status:j.ERROR_MISSING,stateId:eb},fb);break;case 'msg':var mb,nb,ob,pb;ab(true);if('tr' in gb)ra.trace_id=gb.tr;nb=gb.ms;ob=ra.seq-nb.length;for(mb=0;mb<nb.length;mb++,ob++){ra.estimatedReceived++;if(ob>=ib){pb=nb[mb];if(pb.type){var qb=j.getArbiterType(pb.type);if(pb.type==='messaging'){var rb={type:'messaging',event:pb.event};if(pb.message){rb.inbox_unread=pb.unread_counts&&pb.unread_counts.inbox;rb.tid=pb.message.tid;rb.mid=pb.message.mid;this._logFantail('got message with id: '+pb.message.mid,j.FANTAIL_INFO);}na.debug('message',rb);}else if(pb.type==='m_messaging'){na.debug('message',{type:'m_messaging',tid:pb.tid,mid:pb.uuid});}else if(pb.type==='pages_messaging'){if(pb.unread_counts&&pb.unread_counts.inbox)h.inform(j.getArbiterType('pages_inbox_count_update'),{page_id:pb[t.VIEWER_FBID],inbox_unread:pb.unread_counts.inbox});}else if(pb.type==='skywalker'){qb=j.SKYWALKER;}else na.debug('message',{type:pb.type});h.inform(qb,{obj:pb});}}else na.warn('seq_regression',{seq:ob,last_seq:ib,messages:nb.length});}break;case 'heartbeat':if(ra.inStreaming){var sb=Date.now();if(this.heartbeats.length>0){var tb=sb-this.heartbeats[this.heartbeats.length-1];na.log('heartbeat_interval',{client_id:ra.sessionID,interval:tb});}this.heartbeats.push(sb);}break;default:this._logFantail('got an unknown protocol message: '+hb,j.FANTAIL_ERROR);na.error('unknown_msg_type',{type:hb});break;}bb();},_enter_init:function(){if(ua.init>=ma.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ta}),0);this._initTimer=ja(this.exitState.bind(this,{status:j.ERROR,stateId:ta},'timeout'),ra.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(eb){this._logFantail('entered reconnect with reason: '+eb,j.FANTAIL_INFO);var fb=ta;if(!y.hasUserCookie()){this._logFantail('user has no cookie???',j.FANTAIL_WARN);na.warn('no_user_cookie');setTimeout(function(){ma._shutdownHint=j.HINT_AUTH;ma.exitState({status:j.ERROR_SHUTDOWN,stateId:fb});},0);return;}var gb={reason:eb,fb_dtsg:o.getToken()};if(r.token)gb.fb_isb=r.token;if(oa)oa(gb);var hb=new q('GET','/ajax/presence/reconnect.php',gb);hb.onSuccess=(function(){ma.configure(hb.json);w.store();this.exitState({status:j.OK,stateId:fb});}).bind(this);hb.onError=(function(){var ib=hb.json&&hb.json.error;this._logFantail('reconnect error: '+hb.errorType,j.FANTAIL_ERROR);if(hb.errorType==g.TRANSPORT_ERROR||hb.errorType==g.PROXY_ERROR||hb.errorType==g.SERVICE_UNAVAILABLE)this._shutdownHint=j.HINT_CONN;if(ib&&ib==1356007){this._shutdownHint=j.HINT_MAINT;}else if(ib==1357001||ib==1357004||ib==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:fb},hb);}).bind(this);hb.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!ra.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in ra&&ra.shutdown_recovery_interval_seconds>0){var eb=ra.shutdown_recovery_interval_seconds*1000;ja((function(){h.inform(j.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),eb);}},_exit_init:function(eb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(eb==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(eb,fb){var gb=eb==j.OK;sa.reportPullReturned(gb,this);if(gb){this.lastPullTime=Date.now();}else{var hb="exit status: "+eb;if(fb&&fb.errorType)hb+=" ajax request error: "+fb.errorType;this._logFantail('pull failed with status: '+hb,j.FANTAIL_ERROR);}},_exit_ping:function(eb){if(eb==j.OK){var fb=Date.now()-(this.lastPullTime||p.start);if(fb>ra.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',j.FANTAIL_ERROR);return j.ERROR_STALE;}}else this._logFantail('ping failed with status: '+eb,j.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(eb,fb){this._logFantail('misguided message to '+fb+' meant for '+eb,j.FANTAIL_ERROR);var gb=Date.now();if(gb-this.lastReportOnMisguidedMsgTime<=ra.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=gb;var hb={received_uid:eb,expected_uid:fb};if(ra.sticky_token)hb.sticky_token=ra.sticky_token;var ib=new ba('/err_misguided_msg').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(hb),jb=new g('GET',ib);if(g.supportsCORS())jb.xhr.withCredentials=true;jb.onSuccess=function(kb){};jb.onError=function(kb){};jb.onJSON=function(kb,lb){};jb.send();},_probeTest:function(){ra.streamingCapable=false;var eb=[],fb={mode:'stream',format:'json'};if(ra.sticky_token)fb.sticky_token=ra.sticky_token;var gb=new ba('/probe').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(fb),hb=new g('GET',gb);hb.onJSON=function(ib,jb){if(ib&&ib.json&&ib.json.t==='heartbeat'){eb.push(Date.now());if(eb.length>=2){var kb=eb[1]-eb[0];if(kb>=ra.PROBE_HEARTBEATS_INTERVAL_LOW&&kb<=ra.PROBE_HEARTBEATS_INTERVAL_HIGH){ra.streamingCapable=true;na.log('switch_to_streaming');}na.log('probe_ok',{time:kb});}}};hb.onSuccess=function(ib){if(eb.length!=2){ra.streamingCapable=false;na.error('probe_error',{error:'beats.length = '+eb.length});}};hb.onError=function(ib){ra.streamingCapable=false;na.error('probe_error',ib);};na.log('probe_request');hb.send();},_logFantail:function(eb,fb){var gb=ra.fantail_queue_capacity||ra.FANTAIL_QUEUE_CAPACITY;if(!ra.fantail_enabled||ra.fantail_logs.length>gb)return;var hb='fantail queue size exceeded',ib=j.FANTAIL_WARN;if(ra.fantail_logs.length<gb){hb=eb;ib=fb;}var jb=ra.fantail_logs.length,kb={};kb['time'+jb]=Date.now();kb['log'+jb]=hb;kb['severity'+jb]=ib;ra.fantail_logs.push(kb);}};e.exports=ma;function db(){if(k.channelConfig){ma.configure(k.channelConfig);if(/shutdown/.test(k.state))ma._shutdownHint=j[k.reason];ma.init(k.state,k.reason);}}if(u.js_module_defer_channel_manager_start){z.onAfterLoad(db);}else db();},null);
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","ModulePerformanceGating","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=o.create('channel_connection'),r=null,s=null,t=null,u=null,v=0,w=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});k.onBeforeUnload(function(){});function x(){if(s){clearTimeout(s);s=null;}}function y(){x();q.log('unmute_warning');w.inform(w.UNMUTE_WARNING);}function z(ea){x();s=p(y,ea);q.log('mute_warning',{time:ea});w.inform(w.MUTE_WARNING);}function aa(){if(t){clearTimeout(t);t=null;}}function ba(ea,fa){aa();if(ea===m.ON_ENTER_STATE&&(fa.nextState||fa.state)==='pull'){if(u!==w.CONNECTED){q.log('connected');var ga=!u;u=w.CONNECTED;v=0;w.inform(w.CONNECTED,{init:ga});}}else if(ea===m.ON_ENTER_STATE&&((fa.nextState||fa.state)==='ping'||(!fa.nextState&&fa.state==='idle'))){t=p(function(){var ha=null;if(!(fa.state==='idle'&&!fa.nextState))ha=(fa.delay||0);q.log('reconnecting',{delay:ha});if(w.disconnected())q.log('reconnecting_ui',{delay:ha});u=w.RECONNECTING;(fa.state==='idle')&&v++;if(v>1){w.inform(w.RECONNECTING,ha);}else if(!fa.nextState&&fa.state==='idle')ba(ea,fa);},500);}else if(ea===m.ON_SHUTDOWN){q.log('shutdown',{reason:fa.reason});u=w.SHUTDOWN;v=0;w.inform(w.SHUTDOWN,fa.reason);}}function ca(){if(n.isShutdown()){ba(m.ON_SHUTDOWN,n._shutdownHint);}else ba(m.ON_ENTER_STATE,{state:n.state,nextState:n.nextState,delay:0});}if(j.js_module_defer_channel_manager_start){k.onAfterLoad(ca);}else ca();h(w,{disconnected:function(){return u===w.SHUTDOWN||(u===w.RECONNECTING&&!s&&v>1);},isShutdown:function(){return u===w.SHUTDOWN;},reconnect:function(ea){if(n.state==='ping'||n.isShutdown())return;q.log('reconnect',{now:ea});w.inform(w.RECONNECTING,0);if(!!ea){if(r!==null){clearTimeout(r);r=null;}n.enterState('ping!');}else if(!r)r=p(function(){n.enterState('ping!');r=null;},i.get('channel_manual_reconnect_defer_msec'));},unmuteWarning:y});function da(){g.subscribe([m.ON_ENTER_STATE,m.ON_SHUTDOWN],ba);g.subscribe(m.ATTEMPT_RECONNECT,function(){if(w.disconnected())w.reconnect();});l.subscribe(l.TIME_TRAVEL,function(){w.reconnect();z(i.get('mute_warning_time_msec'));});k.onBeforeUnload(aa,false);}if(j.js_module_defer_channel_manager_start){k.onAfterLoad(da);}else da();e.exports=w;},null);
__d("AvailableListConstants",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline',ACTIVE_ON_WEB:g._("Web"),ACTIVE_ON_MOBILE:g._("Mobile")};a.AvailableListConstants=e.exports=h;},null);
__d("LastMobileActiveTimes",["ServerTime","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={};function j(n){if(!n||n<0)return '';var o=(g.get()/1000)-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",[h.param("count",1)]);}else if(p<60){return h._("{count}m",[h.param("count",p)]);}else if(q<24){return h._("{count}h",[h.param("count",q)]);}else if(r<3){return h._("{count}d",[h.param("count",r)]);}else return '';}function k(n,o){if(!(n in i)||i[n]<o)i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));},get:function(n){return l(n);}};e.exports=m;},null);
__d("PresenceStatus",["ArbiterMixin","AvailableListConstants","BanzaiODS","ChatVisibility","CurrentUser","LastMobileActiveTimes","LogHistory","PresencePrivacy","ServerTime","createObjectFrom","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();i.setEntitySample('presence',.0001);var r=m.getInstance('presence_status'),s={},t={},u={},v={},w={},x={},y={},z=Object.assign({},g),aa=q(function(){return z.inform('change');},0);Object.assign(z,{resetPresenceData:function(){t={};u={};y={};x={};w={};},reset:function(){z.resetPresenceData();v={};},get:function(ba){if(ba==k.getID())return j.isOnline()?h.ACTIVE:h.OFFLINE;var ca=h.OFFLINE;if(ba in t)ca=t[ba];if(ca===h.OFFLINE||ca===h.IDLE)if(v[ba])ca=h.MOBILE;if(!n.allows(ba))ca=h.OFFLINE;return ca;},getCapabilities:function(ba){var ca=z.get(ba);if(ca==h.OFFLINE)return 0;var da=u[ba];return da?da:0;},getDetailedActivePresence:function(ba){var ca=y[ba];if(!ca)return h.ACTIVE_ON_WEB;var da=this._getDetailedActivePresenceFromObject(ca);if(da)return da;if(!s[ba]){r.error('inconsistent_presence',{id:ba,presence:z.getDebugInfo(ba)});i.bumpEntityKey('presence','inconsistent_presence');s[ba]=true;}return null;},_getDetailedActivePresenceFromObject:function(ba){var ca=ba[h.WEB_STATUS],da=ba[h.FB_APP_STATUS],ea=ba[h.MESSENGER_STATUS],fa=ba[h.OTHER_STATUS];if(da===h.STATUS_ACTIVE||ea===h.STATUS_ACTIVE){return h.ACTIVE_ON_MOBILE;}else if(ca===h.STATUS_ACTIVE||fa===h.STATUS_ACTIVE)return h.ACTIVE_ON_WEB;},isMessengerUser:function(ba){var ca=y[ba];if(ca)if(ca[h.MESSENGER_STATUS]==h.STATUS_ACTIVE)return true;return v[ba];},hasDetailedPresenceData:function(ba){return y[ba]!=null;},getGroup:function(ba){return ba.some(function(ca){if(ca==k.getID())return false;return (z.get(ca)===h.ACTIVE);})?h.ACTIVE:h.OFFLINE;},set:function(ba,ca,da,ea,fa,ga){if(ba==k.getID())return false;switch(ca){case h.OFFLINE:case h.IDLE:case h.ACTIVE:case h.MOBILE:break;default:return false;}var ha=z.get(ba),ia=ha!=ca;if((ia&&ha==h.ACTIVE)||(ca==h.ACTIVE)){var ja={};ja[ba]=o.get()/1000;l.update(ja);}var ka=false;if(!ia&&fa)ka=z.getCapabilities(ba)!=fa;if(da){w[ba]=o.get();x[ba]=ea;}t[ba]=ca;if(fa)u[ba]=fa;if(ga)y[ba]=ga;var la=ia||ka;if(la)aa();return la;},setMobileFriends:function(ba){v=p(ba);},getOnlineIDs:function(){var ba,ca=[];for(ba in t)if(z.get(ba)===h.ACTIVE)ca.push(ba);return ca;},getAvailableIDs:function(){var ba=z.getOnlineIDs(),ca;for(ca in v){if(t[ca])continue;ba.push(ca);}return ba;},getOnlineCount:function(){return z.getOnlineIDs().length;},getPresenceStats:function(){var ba=0,ca=0,da=0,ea=0,fa=0;for(var ga in t){ba+=1;switch(z.get(ga)){case h.OFFLINE:ca+=1;break;case h.IDLE:da+=1;break;case h.ACTIVE:ea+=1;break;case h.MOBILE:fa+=1;break;default:break;}}return {total:ba,offline:ca,idle:da,active:ea,mobile:fa};},getDebugInfo:function(ba){return {id:ba,presence:t[ba],detailedPresence:y[ba],overlaySource:x[ba],overlayTime:w[ba],mobile:v[ba]};}});e.exports=z;},null);
__d("TypingStates",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={INACTIVE:0,TYPING:1,QUITTING:2};e.exports=g;},null);
__d("AvailableList",["Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","BanzaiODS","Bootloader","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","JSLogger","LastMobileActiveTimes","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","TypingStates","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();k.setEntitySample('presence',.0001);var aa=x({},j,h);aa.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ja,ka){g.inform(ja,ka);});var ba=y(function(){aa.inform(j.ON_AVAILABILITY_CHANGED);},0);function ca(ja,ka,la,ma,na,oa){var pa=t.set(ja,ka,la,ma,na,oa);if(pa)ba();}function da(ja){var ka=ja.payload.availability||{};for(var la in ka)ca(la,ka[la].a,true,'mercury_tabs',ka[la].c,ka[la].p);}function ea(){ia&&ia.restart();}function fa(){ia&&ia.stop();}function ga(ja){var ka=aa.getDebugInfo(ja),la=(ka.presence==j.ACTIVE),ma=new i('/ajax/mercury/tabs_presence.php').setData({target_id:ja,to_online:la,presence_source:ka.overlaySource,presence_time:ka.overlayTime}).setHandler(da).setErrorHandler(z).setAllowCrossPageTransition(true).send();}function ha(ja,ka){ka.chat_config=o.getDebugInfo();ka.available_list_debug_info={};t.getAvailableIDs().forEach(function(la){ka.available_list_debug_info[la]=aa.getDebugInfo(la);});ka.available_list_poll_interval=aa._poller&&aa._poller.getInterval();}var ia;l.loadModules(["PresencePoller"],function(ja){ia=new ja(function(event){aa.inform(event);});ia.start();});x(aa,{get:function(ja){return t.get(ja);},updateForID:function(ja){ga(ja);},shouldUpdateForID:function(ja){if(o.get('avoid_available_list_updates',false))return t.getCapabilities(ja)===0;return true;},getWebChatNotification:function(){return ia&&ia.getWebChatNotification();},isUserIdle:function(){return ia&&ia.getIsUserIdle();},isReady:function(){return !!ia;},set:function(ja,ka,la,ma,na){ca(ja,ka,true,la,ma,na);},update:function(){ia&&ia.forceUpdate();},isIdle:function(ja){return aa.get(ja)==j.IDLE;},getDebugInfo:function(ja){var ka=t.getDebugInfo(ja),la=v.getNow(ja);if(la)ka.name=la.name;return ka;}});g.subscribe(q.DUMP_EVENT,ha);g.subscribe('chat-visibility/go-online',ea);g.subscribe('chat-visibility/go-offline',fa);s.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ba);m.subscribe([m.CONNECTED,m.RECONNECTING,m.SHUTDOWN,m.MUTE_WARNING,m.UNMUTE_WARNING],ba);g.subscribe(n.getArbiterType('buddylist_overlay'),function(ja,ka){var la={},ma=ka.obj.overlay;for(var na in ma){aa.set(na,ma[na].a,ma[na].s||'channel',ma[na].vc,ma[na].p);if(ma[na].la)la[na]=ma[na].la;}r.update(la);});g.subscribe([n.getArbiterType('typ'),n.getArbiterType('ttyp')],function(ja,ka){var la=ka.obj;if(la.st===w.TYPING){var ma=la.from;if(p.isOnline()){k.bumpEntityKey('presence','stale_presence_check_typing');var na=t.get(ma);if(na!=j.ACTIVE){var oa=r.get(ma)*1000,pa=u.get();if(!oa){k.bumpEntityKey('presence','no_detailed_presence_typing');}else if(pa-oa>5*60*1000){var qa='stale_presence_typing',ra=pa-oa;if(ra<10*60*1000){qa+='600';}else if(ra<60*60*1000)qa+='3600';k.bumpEntityKey('presence',qa);}}}aa.set(ma,j.ACTIVE,'channel-typing');}});g.subscribe(n.getArbiterType('messaging'),function(ja,ka){if(!p.isOnline())return;var la=ka.obj;if(la.message&&la.message.timestamp&&la.message.sender_fbid){var ma=u.get(),na=la.message.timestamp;if(ma-na<2*60*1000){k.bumpEntityKey('presence','stale_presence_check');var oa=la.message.sender_fbid,pa=t.get(oa);if(pa==j.ACTIVE)return;var qa=r.get(oa)*1000;if(!qa){k.bumpEntityKey('presence','no_detailed_presence');}else if(na-qa>5*60*1000){var ra='stale_presence',sa=na-qa;if(sa<10*60*1000){ra+='600';}else if(sa<60*60*1000)ra+='3600';k.bumpEntityKey('presence',ra);}}}});a.AvailableList=e.exports=aa;},null);